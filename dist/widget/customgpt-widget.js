!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("CustomGPTWidget",[],t):"object"==typeof exports?exports.CustomGPTWidget=t():e.CustomGPTWidget=t()}("undefined"!=typeof self?self:this,()=>(()=>{"use strict";var e,t={3345:(e,t,s)=>{s.d(t,{Hr:()=>o});var n=s(7047);function a(e,t,s){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var s=e[Symbol.toPrimitive];if(void 0!==s){var n=s.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}class r{constructor(e={}){a(this,"config",void 0),a(this,"abortController",null),a(this,"currentMessage",null),this.config={timeout:e.timeout||6e4,retryAttempts:e.retryAttempts||3,retryDelay:e.retryDelay||1e3}}async processStream(e,t){this.abortController=new AbortController,this.currentMessage={id:this.generateId(),content:"",citations:[],isComplete:!1};const s=e.getReader(),n=new TextDecoder;let a="";const r=setTimeout(()=>{this.cancel(),t.onError?.(new Error("Stream timeout"))},this.config.timeout);try{for(;;){const{done:e,value:r}=await s.read();if(e){this.currentMessage.isComplete=!0,t.onComplete?.();break}a+=n.decode(r,{stream:!0});const o=a.split("\n");a=o.pop()||"";for(const e of o)e.trim()&&await this.processLine(e,t)}}catch(e){e instanceof Error&&"AbortError"===e.name?t.onError?.(new Error("Stream cancelled")):t.onError?.(e instanceof Error?e:new Error("Unknown streaming error"))}finally{clearTimeout(r),s.releaseLock(),this.abortController=null}return this.currentMessage}async processLine(e,t){const s=(0,n.RW)(e);if(s&&this.currentMessage)switch(s.type){case"content":s.content&&(this.currentMessage.content+=s.content,t.onChunk?.(s.content));break;case"citation":s.citations&&(this.currentMessage.citations.push(...s.citations),s.citations.forEach(e=>{t.onCitation?.(e)}));break;case"done":return this.currentMessage.isComplete=!0,void t.onComplete?.();case"error":return void t.onError?.(new Error(s.error||"Stream error"))}}cancel(){this.abortController&&this.abortController.abort()}getCurrentMessage(){return this.currentMessage}isStreaming(){return null!==this.abortController&&null!==this.currentMessage&&!this.currentMessage.isComplete}generateId(){return Math.random().toString(36).substring(2)+Date.now().toString(36)}}const o=new class{constructor(e=3){a(this,"streams",new Map),a(this,"maxConcurrentStreams",void 0),this.maxConcurrentStreams=e}async startStream(e,t,s,n){if(this.streams.size>=this.maxConcurrentStreams)throw new Error(`Maximum concurrent streams (${this.maxConcurrentStreams}) reached`);this.streams.has(e)&&this.cancelStream(e);const a=new r(n);this.streams.set(e,a);try{return await a.processStream(t,{...s,onComplete:()=>{this.streams.delete(e),s.onComplete?.()},onError:t=>{this.streams.delete(e),s.onError?.(t)}})}catch(t){throw this.streams.delete(e),t}}cancelStream(e){const t=this.streams.get(e);t&&(t.cancel(),this.streams.delete(e))}cancelAllStreams(){this.streams.forEach(e=>e.cancel()),this.streams.clear()}getActiveStreams(){return Array.from(this.streams.keys())}getStreamStatus(e){const t=this.streams.get(e);return t?{exists:!0,isStreaming:t.isStreaming(),message:t.getCurrentMessage()}:{exists:!1,isStreaming:!1,message:null}}getActiveStreamCount(){return this.streams.size}}},4276:(e,t,s)=>{s.d(t,{default:()=>Ve});var n=s(758),a=s(9576),r=s(1681),o=s(7874),i=s(2221),c=s(8077),l=s(9033),d=s(7047),g=s(9400),u=s(9014),m=s(8080),h=s(3498),p=s(578),f=s(4347),y=s(8589),v=s(5368),x=s(2012),w=s(8637),S=s(846),b=s(6070);const j=(0,S.F)("inline-flex items-center justify-center rounded-lg text-sm font-medium transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-brand-500 focus-visible:ring-offset-2 disabled:opacity-50 disabled:pointer-events-none",{variants:{variant:{default:"bg-brand-500 text-white hover:bg-brand-600 shadow-sm",destructive:"bg-red-500 text-white hover:bg-red-600 shadow-sm",outline:"border border-gray-300 bg-white hover:bg-gray-50 text-gray-900",secondary:"bg-gray-100 text-gray-900 hover:bg-gray-200",ghost:"hover:bg-gray-100 text-gray-900",link:"text-brand-600 underline-offset-4 hover:underline"},size:{default:"h-10 py-2 px-4",sm:"h-8 px-3 text-xs",lg:"h-12 px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),N=n.forwardRef(({className:e,variant:t,size:s,asChild:n=!1,...a},r)=>(0,b.jsx)("button",{className:(0,d.cn)(j({variant:t,size:s,className:e})),ref:r,...a}));N.displayName="Button";var C=s(9716),A=s(1912),_=s(4712);const E=({citation:e,index:t,isExpanded:s,onToggle:n,onClick:a})=>(0,b.jsxs)("div",{className:"border border-gray-200 rounded-lg overflow-hidden transition-all hover:border-gray-300",children:[(0,b.jsxs)("button",{onClick:n,className:"w-full px-3 py-2 flex items-center gap-3 hover:bg-gray-50 transition-colors text-left",children:[(0,b.jsx)("div",{className:"flex-shrink-0 w-6 h-6 rounded bg-brand-100 flex items-center justify-center",children:(0,b.jsx)("span",{className:"text-xs font-medium text-brand-700",children:t})}),(0,b.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,b.jsx)("div",{className:"font-medium text-sm text-gray-900 line-clamp-1",children:e.title}),(0,b.jsx)("div",{className:"text-xs text-gray-500 line-clamp-1",children:e.source||e.url})]}),(0,b.jsx)(A.A,{className:(0,d.cn)("w-4 h-4 text-gray-400 transition-transform flex-shrink-0",s&&"rotate-180")})]}),(0,b.jsx)(C.N,{children:s&&(0,b.jsx)(i.P.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.2},className:"overflow-hidden",children:(0,b.jsxs)("div",{className:"px-3 py-2 border-t border-gray-100 bg-gray-50",children:[(0,b.jsx)("p",{className:"text-sm text-gray-700 mb-2",children:e.content}),e.confidence&&(0,b.jsxs)("div",{className:"mb-2",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between text-xs text-gray-500 mb-1",children:[(0,b.jsx)("span",{children:"Relevance"}),(0,b.jsxs)("span",{children:[Math.round(100*e.confidence),"%"]})]}),(0,b.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-1.5",children:(0,b.jsx)("div",{className:"bg-brand-500 h-1.5 rounded-full transition-all",style:{width:100*e.confidence+"%"}})})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[e.url&&(0,b.jsxs)("a",{href:e.url,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-1 text-xs text-brand-600 hover:text-brand-700 transition-colors",children:["View source",(0,b.jsx)(p.A,{className:"w-3 h-3"})]}),a&&(0,b.jsx)(N,{size:"sm",variant:"ghost",onClick:()=>a(e),className:"h-6 px-2 text-xs",children:"View details"})]})]})})})]}),I=({citations:e,onCitationClick:t,maxVisible:s=5,className:a})=>{const[r,o]=(0,n.useState)(new Set),[c,l]=(0,n.useState)(!1),g=c?e:e.slice(0,s),u=e.length>s;return 0===e.length?null:(0,b.jsxs)("div",{className:(0,d.cn)("mt-4 space-y-2",a),children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[(0,b.jsx)(_.A,{className:"w-4 h-4"}),(0,b.jsx)("span",{className:"font-medium",children:"Sources"}),(0,b.jsxs)("span",{className:"text-gray-400",children:["(",e.length,")"]}),u&&(0,b.jsx)(N,{size:"sm",variant:"ghost",onClick:()=>l(!c),className:"ml-auto h-6 px-2 text-xs",children:c?"Show less":`Show all ${e.length}`})]}),(0,b.jsx)("div",{className:"space-y-2",children:(0,b.jsx)(C.N,{children:g.map((e,s)=>(0,b.jsx)(i.P.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},transition:{duration:.2,delay:.05*s},children:(0,b.jsx)(E,{citation:e,index:s+1,isExpanded:r.has(e.id),onToggle:()=>(e=>{const t=new Set(r);r.has(e)?t.delete(e):t.add(e),o(t)})(e.id),onClick:t})},e.id))})}),u&&!c&&(0,b.jsx)("div",{className:"pt-2",children:(0,b.jsxs)(N,{size:"sm",variant:"outline",onClick:()=>l(!0),className:"w-full",children:["Show ",e.length-s," more sources"]})})]})},M=({language:e,value:t})=>{const[s,a]=(0,n.useState)(!1);return(0,b.jsxs)("div",{className:"relative group",children:[(0,b.jsx)("div",{className:"absolute right-2 top-2 opacity-0 group-hover:opacity-100 transition-opacity",children:(0,b.jsx)(N,{size:"sm",variant:"ghost",onClick:async()=>{await(0,d.lW)(t)&&(a(!0),r.oR.success("Code copied to clipboard"),setTimeout(()=>a(!1),2e3))},className:"h-6 px-2 text-xs bg-gray-800 text-white hover:bg-gray-700",children:s?"Copied!":"Copy"})}),(0,b.jsx)(m.A,{language:e,style:h.A,customStyle:{margin:0,borderRadius:"0.5rem",fontSize:"0.875rem"},children:t})]})},P=()=>(0,b.jsx)("span",{className:"inline-block w-0.5 h-4 bg-gray-900 animate-blink ml-0.5 align-middle"}),k=({content:e,isStreaming:t})=>(0,b.jsxs)("div",{className:"prose prose-sm max-w-none text-gray-900",children:[(0,b.jsx)(g.oz,{remarkPlugins:[u.A],components:{code({className:e,children:t,...s}){const n=/language-(\w+)/.exec(e||"");return!!n&&n?(0,b.jsx)(M,{language:n[1],value:String(t).replace(/\n$/,""),...s}):(0,b.jsx)("code",{className:"px-1 py-0.5 rounded bg-gray-100 text-sm font-medium",...s,children:t})},a:({href:e,children:t})=>(0,b.jsxs)("a",{href:e,target:"_blank",rel:"noopener noreferrer",className:"text-brand-600 hover:text-brand-700 no-underline hover:underline inline-flex items-center gap-1",children:[t,(0,b.jsx)(p.A,{className:"w-3 h-3"})]})},children:e}),t&&(0,b.jsx)(P,{})]}),R=({message:e,onFeedback:t})=>{const[s,a]=(0,n.useState)(e.feedback||null),o=e=>{a(e),t?.(e),r.oR.success("Thanks for your feedback!")};return(0,b.jsxs)("div",{className:"mt-3 flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[(0,b.jsx)(N,{size:"icon",variant:"ghost",onClick:async()=>{await(0,d.lW)(e.content)&&r.oR.success("Message copied to clipboard")},className:"h-8 w-8 text-gray-500 hover:text-gray-700",title:"Copy message",children:(0,b.jsx)(f.A,{className:"h-4 w-4"})}),(0,b.jsx)(N,{size:"icon",variant:"ghost",onClick:()=>o("like"),className:(0,d.cn)("h-8 w-8 text-gray-500 hover:text-gray-700","like"===s&&"text-green-600 hover:text-green-700"),title:"Good response",children:(0,b.jsx)(y.A,{className:"h-4 w-4"})}),(0,b.jsx)(N,{size:"icon",variant:"ghost",onClick:()=>o("dislike"),className:(0,d.cn)("h-8 w-8 text-gray-500 hover:text-gray-700","dislike"===s&&"text-red-600 hover:text-red-700"),title:"Bad response",children:(0,b.jsx)(v.A,{className:"h-4 w-4"})}),(0,b.jsx)(N,{size:"icon",variant:"ghost",onClick:()=>{r.oR.info("Regenerating response...")},className:"h-8 w-8 text-gray-500 hover:text-gray-700",title:"Regenerate response",children:(0,b.jsx)(x.A,{className:"h-4 w-4"})})]})},O=({message:e,isStreaming:t=!1,isLast:s=!1,onCitationClick:n,onFeedback:a,className:r})=>{const o="user"===e.role;return(0,b.jsx)(i.P.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.3},className:(0,d.cn)("group relative px-4 py-6 transition-colors",o?"bg-white":"bg-gray-50 border-y border-gray-100","hover:bg-opacity-80",r),children:(0,b.jsxs)("div",{className:"max-w-3xl mx-auto flex gap-4",children:[(0,b.jsx)("div",{className:"flex-shrink-0",children:o?(0,b.jsx)("div",{className:"w-8 h-8 rounded-full bg-gray-800 flex items-center justify-center",children:(0,b.jsx)(w.A,{className:"w-4 h-4 text-white"})}):(0,b.jsx)("div",{className:"w-8 h-8 rounded-full bg-white border border-gray-200 flex items-center justify-center",children:(0,b.jsx)(l.A,{className:"w-4 h-4 text-brand-600"})})}),(0,b.jsxs)("div",{className:"flex-1 overflow-hidden",children:[e.status&&"sent"!==e.status&&(0,b.jsxs)("div",{className:"mb-2 text-xs text-gray-500",children:["sending"===e.status&&"Sending...","error"===e.status&&(0,b.jsx)("span",{className:"text-red-500",children:"Failed to send"})]}),o?(0,b.jsx)("p",{className:"text-gray-900 whitespace-pre-wrap",children:e.content}):(0,b.jsx)(k,{content:e.content,isStreaming:t}),e.citations&&e.citations.length>0&&(0,b.jsx)(I,{citations:e.citations,onCitationClick:n}),(0,b.jsx)("div",{className:"mt-2 text-xs text-gray-400",children:(0,d.Ey)(e.timestamp)}),!o&&!t&&(0,b.jsx)(R,{message:e,onFeedback:a})]})]})})};var T=s(3429),$=s(999),F=s(2020),L=s(5476),U=s(1016),D=s(3897),q=s(7052);const K=({file:e,onRemove:t})=>{const s=(0,d.I3)(e.type);return(0,b.jsxs)(i.P.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.9},className:"flex items-center gap-2 px-3 py-1.5 bg-gray-100 hover:bg-gray-200 rounded-lg transition-colors",children:[(0,b.jsx)("div",{className:"text-gray-600",children:s}),(0,b.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,b.jsx)("div",{className:"text-sm font-medium text-gray-900 truncate",children:e.name}),(0,b.jsxs)("div",{className:"text-xs text-gray-500 flex items-center gap-2",children:[(0,b.jsx)("span",{children:(0,d.v7)(e.size)}),"uploading"===e.status&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("span",{children:"•"}),(0,b.jsxs)("span",{children:[e.progress,"%"]})]}),"error"===e.status&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("span",{children:"•"}),(0,b.jsxs)("span",{className:"text-red-500 flex items-center gap-1",children:[(0,b.jsx)($.A,{className:"w-3 h-3"}),"Error"]})]})]})]}),"uploading"===e.status&&(0,b.jsx)("div",{className:"absolute bottom-0 left-0 right-0 h-0.5 bg-gray-200 rounded-b",children:(0,b.jsx)("div",{className:"h-full bg-brand-500 rounded-b transition-all duration-300",style:{width:`${e.progress}%`}})}),(0,b.jsx)("button",{onClick:t,className:"p-0.5 rounded hover:bg-gray-300 transition-colors",disabled:"uploading"===e.status,children:(0,b.jsx)(F.A,{className:"w-3 h-3 text-gray-500"})})]})},z=({onUpload:e,disabled:t})=>{const s=(0,n.useRef)(null);return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("input",{ref:s,type:"file",multiple:!0,accept:d.aH.ACCEPTED_FILE_TYPES.join(","),onChange:t=>{const s=Array.from(t.target.files||[]);s.length>0&&(e(s),t.target.value="")},className:"hidden"}),(0,b.jsx)(N,{type:"button",size:"icon",variant:"ghost",onClick:()=>{s.current?.click()},disabled:t,className:"h-10 w-10 text-gray-600 hover:text-gray-800",title:"Upload files",children:(0,b.jsx)(L.A,{className:"h-5 w-5"})})]})},G=({onSend:e,disabled:t=!1,placeholder:s="Send a message...",maxLength:a=d.aH.MAX_MESSAGE_LENGTH,className:o})=>{const[c,l]=(0,n.useState)(""),[g,u]=(0,n.useState)([]),[m,h]=(0,n.useState)(!1),p=(0,n.useRef)(null),f=(0,n.useCallback)(()=>{const e=p.current;if(e){e.style.height="auto";const t=e.scrollHeight,s=200;e.style.height=`${Math.min(t,s)}px`}},[]),y=s=>{if(s.preventDefault(),t)return;if(!c.trim()&&0===g.length)return;const n=g.filter(e=>"uploaded"===e.status).map(e=>e.file);e(c.trim(),n),l(""),u([]),p.current&&(p.current.style.height="auto"),setTimeout(()=>{p.current?.focus()},0)},v=(0,n.useCallback)(e=>{const t=e.filter(e=>e.size>d.aH.MAX_FILE_SIZE?(r.oR.error(`File "${e.name}" is too large. Maximum size is ${(0,d.v7)(d.aH.MAX_FILE_SIZE)}`),!1):!!(0,d.B6)(e.type,d.aH.ACCEPTED_FILE_TYPES)||(r.oR.error(`File type "${e.type}" is not supported`),!1)).map(e=>({id:(0,d.$C)(),name:e.name,size:e.size,type:e.type,status:"uploading",progress:0,file:e}));u(e=>[...e,...t]),t.forEach(e=>{x(e)})},[]),x=e=>{let t=0;const s=setInterval(()=>{t+=20*Math.random(),t>=100?(t=100,clearInterval(s),u(t=>t.map(t=>t.id===e.id?{...t,status:"uploaded",progress:100}:t))):u(s=>s.map(s=>s.id===e.id?{...s,progress:Math.round(t)}:s))},100)},{getRootProps:w,getInputProps:S,isDragActive:j}=(0,T.VB)({onDrop:v,noClick:!0,noKeyboard:!0,accept:d.aH.ACCEPTED_FILE_TYPES.reduce((e,t)=>(e[t]=[],e),{}),maxSize:d.aH.MAX_FILE_SIZE,onDragEnter:()=>h(!0),onDragLeave:()=>h(!1)}),A=!t&&(c.trim()||g.some(e=>"uploaded"===e.status));return(0,b.jsxs)("div",{...w(),className:(0,d.cn)("border-t border-gray-200 bg-white px-4 py-3 relative",j&&"bg-brand-50",o),children:[(0,b.jsx)("input",{...S()}),(0,b.jsx)(C.N,{children:j&&(0,b.jsx)(i.P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"absolute inset-0 bg-brand-50 border-2 border-dashed border-brand-300 rounded-lg flex items-center justify-center z-10",children:(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)(U.A,{className:"w-8 h-8 text-brand-600 mx-auto mb-2"}),(0,b.jsx)("p",{className:"text-brand-700 font-medium",children:"Drop files here to upload"}),(0,b.jsx)("p",{className:"text-brand-600 text-sm",children:"Supports PDF, DOC, TXT, and more"})]})})}),(0,b.jsx)(C.N,{children:g.length>0&&(0,b.jsx)(i.P.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"mb-2 flex flex-wrap gap-2",children:g.map(e=>(0,b.jsx)(K,{file:e,onRemove:()=>{return t=e.id,void u(e=>e.filter(e=>e.id!==t));var t}},e.id))})}),(0,b.jsxs)("form",{onSubmit:y,className:"flex items-end gap-2",children:[(0,b.jsx)(z,{onUpload:v,disabled:t}),(0,b.jsxs)("div",{className:"flex-1 relative",children:[(0,b.jsx)("textarea",{ref:p,value:c,onChange:e=>{const t=e.target.value;t.length<=a&&(l(t),f())},onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),y(e))},placeholder:s,disabled:t,rows:1,className:(0,d.cn)("w-full resize-none rounded-lg border border-gray-300","px-3 py-2 pr-12","focus:outline-none focus:ring-2 focus:ring-brand-500 focus:border-transparent","disabled:opacity-50 disabled:cursor-not-allowed","min-h-[44px] max-h-[200px]","placeholder:text-gray-500"),style:{height:"auto",overflowY:c.split("\n").length>5?"auto":"hidden"}}),c.length>0&&(0,b.jsxs)("div",{className:"absolute bottom-2 right-2 text-xs text-gray-400 pointer-events-none",children:[c.length,"/",a]})]}),(0,b.jsx)(N,{type:"submit",size:"icon",disabled:!A,className:(0,d.cn)("h-10 w-10 flex-shrink-0",t&&"animate-pulse"),title:t?"Stop generating":"Send message",children:t?(0,b.jsx)(D.A,{className:"h-5 w-5"}):(0,b.jsx)(q.A,{className:"h-5 w-5"})})]}),(0,b.jsxs)("div",{className:"mt-2 flex items-center justify-between text-xs text-gray-500",children:[(0,b.jsx)("span",{children:"Press Enter to send, Shift+Enter for new line"}),(0,b.jsxs)("span",{children:["Supports ",d.aH.ACCEPTED_FILE_TYPES.length,"+ file formats"]})]})]})},J=({className:e})=>(0,b.jsx)("div",{className:(0,d.cn)("px-4 py-6 bg-gray-50 border-y border-gray-100",e),children:(0,b.jsxs)("div",{className:"max-w-3xl mx-auto flex gap-4",children:[(0,b.jsx)("div",{className:"w-8 h-8 rounded-full bg-white border border-gray-200 flex items-center justify-center flex-shrink-0",children:(0,b.jsx)(l.A,{className:"w-4 h-4 text-brand-600"})}),(0,b.jsxs)("div",{className:"flex items-center gap-1 py-2",children:[(0,b.jsx)("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce-subtle"}),(0,b.jsx)("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce-subtle delay-100"}),(0,b.jsx)("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce-subtle delay-200"})]})]})});var V=s(908),B=s(871),W=s(5294),H=s(1446),Y=s(4974),Q=s(3345),Z=s(5772);function X(e,t,s){const n=`customgpt-messages-cache-${e}`;function a(e,t){try{const s=localStorage.getItem(n),a=s?JSON.parse(s):{};a[e]=t,localStorage.setItem(n,JSON.stringify(a))}catch(e){}}return(0,H.vt)((r,o)=>({messages:new Map,streamingMessage:null,isStreaming:!1,loading:!1,error:null,sendMessage:async(n,a)=>{const i="undefined"!=typeof window&&window.__customgpt_demo_mode;if(!t||!s)throw Z.v.error("MESSAGES","Store references not provided"),new Error("Store references not provided");const c=t.getState().currentAgent;if(!c)throw Z.v.error("MESSAGES","No agent selected"),new Error("No agent selected");Z.v.info("MESSAGES","Sending message from widget store",{sessionId:e,agentId:c.id,agentName:c.project_name,messageLength:n.length,hasFiles:a&&a.length>0});const l=await s.getState().ensureConversation("string"==typeof c.id?parseInt(c.id):c.id,n);if(Z.v.info("MESSAGES","Conversation ensured",{conversationId:l.id,sessionId:l.session_id,hasSessionId:!!l.session_id,isNew:!l.message_count||0===l.message_count}),!l.session_id)throw Z.v.error("MESSAGES","Conversation missing session_id",{conversation:l}),new Error("Conversation missing session_id");r({loading:!0,error:null});const g=l.id.toString(),u={id:(0,d.$C)(),role:"user",content:n,timestamp:(new Date).toISOString(),status:"sending"};o().addMessage(g,u);const m={id:(0,d.$C)(),role:"assistant",content:"",timestamp:(new Date).toISOString(),citations:[]};r({streamingMessage:m,isStreaming:!0,loading:!1});try{if(a&&a.length>0){const e=(0,Y.KU)();await Promise.all(a.map(t=>e.uploadFile(c.id,t)))}u.status="sent",o().addMessage(g,u);const e=(0,Y.KU)();if(Z.v.info("MESSAGES","Starting message stream",{agentId:c.id,sessionId:l.session_id,messageContent:n.substring(0,50)}),i){await new Promise(e=>setTimeout(e,1e3));const e=`This is a demo response to: "${n}"`;o().updateStreamingMessage(e),await new Promise(e=>setTimeout(e,500));const t=o().streamingMessage;return t&&(t.status="sent",o().addMessage(g,t)),void r({streamingMessage:null,isStreaming:!1})}try{await e.sendMessageStream(c.id,l.session_id,{prompt:n,response_source:"default",stream:1},{onChunk:e=>{if(Z.v.debug("MESSAGES","Received stream chunk",{type:e.type,hasContent:!!e.content,contentLength:e.content?.length,contentPreview:e.content?.substring(0,50)}),"content"===e.type&&e.content)o().updateStreamingMessage(e.content,e.citations);else if("citation"===e.type&&e.citations){const t=o().streamingMessage;t&&r({streamingMessage:{...t,citations:e.citations}})}},onComplete:()=>{const e=o().streamingMessage;e&&(e.status="sent",o().addMessage(g,e)),r({streamingMessage:null,isStreaming:!1}),s.getState().updateConversation(l.id,l.session_id,{name:l.name})},onError:async t=>{Z.v.error("MESSAGES","Streaming failed, attempting fallback to non-streaming",t);try{const t=await e.sendMessage(c.id,l.session_id,{prompt:n,response_source:"default",stream:0}),s=o().streamingMessage;if(s&&t){let e;e=t.data?t.data:t,s.content=e?.openai_response||e?.content||"No response received",s.citations=e?.citations||[],s.status="sent",o().addMessage(g,s)}r({streamingMessage:null,isStreaming:!1})}catch(e){throw Z.v.error("MESSAGES","Both streaming and non-streaming failed",e),e}}})}catch(e){throw Z.v.error("MESSAGES","Failed to send message",e),r({streamingMessage:null,isStreaming:!1,error:e instanceof Error?e.message:"Failed to send message"}),e}}catch(e){throw Z.v.error("MESSAGES","Error in sendMessage",e),r({error:e instanceof Error?e.message:"Failed to send message",streamingMessage:null,isStreaming:!1,loading:!1}),e}},loadMessages:async e=>{r({loading:!0,error:null});try{const t=function(e){try{const t=localStorage.getItem(n);return t&&JSON.parse(t)[e]||null}catch(e){return null}}(e);if(t)return void r(s=>({messages:new Map(s.messages).set(e,t),loading:!1}));r(t=>({messages:new Map(t.messages).set(e,[]),loading:!1}))}catch(e){Z.v.error("MESSAGES","Failed to load messages",e),r({error:e instanceof Error?e.message:"Failed to load messages",loading:!1})}},addMessage:(e,t)=>{r(s=>{const n=new Map(s.messages),r=n.get(e)||[],o=r.findIndex(e=>e.id===t.id);return o>=0?r[o]=t:r.push(t),n.set(e,r),a(e,r),{messages:n}})},updateStreamingMessage:(e,t)=>{r(s=>s.streamingMessage?{streamingMessage:{...s.streamingMessage,content:s.streamingMessage.content+e,citations:t||s.streamingMessage.citations}}:s)},clearMessages:e=>{if(e){r(t=>{const s=new Map(t.messages);return s.delete(e),{messages:s}});try{const t=localStorage.getItem(n);if(t){const s=JSON.parse(t);delete s[e],localStorage.setItem(n,JSON.stringify(s))}}catch(e){}}else{r({messages:new Map});try{localStorage.removeItem(n)}catch(e){}}},cancelStreaming:()=>{Q.Hr.cancelAllStreams(),r({isStreaming:!1,streamingMessage:null})},getMessagesForConversation:e=>o().messages.get(e)||[],updateMessageFeedback:(e,t)=>{r(s=>{const n=new Map(s.messages);for(const[s,r]of n){const o=r.findIndex(t=>t.id===e);if(-1!==o){const e=[...r];e[o]={...e[o],feedback:t},n.set(s,e),a(s,e);break}}return{messages:n}})},reset:()=>{r({messages:new Map,streamingMessage:null,isStreaming:!1,loading:!1,error:null})}}))}function ee(e){const t=`customgpt-conversations-cache-${e}`,s=`customgpt-conversation-activity-${e}`;function n(e,s){try{const n=localStorage.getItem(t),a=n?JSON.parse(n):{};a[e]=s,localStorage.setItem(t,JSON.stringify(a))}catch(e){}}function a(e){try{const s=localStorage.getItem(t);if(!s)return null;return JSON.parse(s)[e]||null}catch(e){return null}}function r(){try{const e=localStorage.getItem(s);return e?JSON.parse(e):{}}catch(e){return{}}}return(0,H.vt)((t,o)=>({conversations:[],currentConversation:null,loading:!1,error:null,lastConversationActivity:r(),fetchConversations:async s=>{const r="undefined"!=typeof window&&window.__customgpt_demo_mode;Z.v.info("CONVERSATIONS","Fetching conversations for widget",{sessionId:e,projectId:s,isDemoMode:r}),t({loading:!0,error:null});try{if(r)return o().loadConversations(s.toString());const a=`widget_conversations_${e}`,i=JSON.parse(localStorage.getItem(a)||"[]");if(0===i.length)return void t({conversations:[],loading:!1});const c=(0,Y.KU)(),l=await c.getConversations(s);let d=[];l&&"object"==typeof l&&(Array.isArray(l.data)?d=l.data:Array.isArray(l)?d=l:l.data&&Array.isArray(l.data.data)&&(d=l.data.data));const g=d.filter(e=>i.includes(e.id));Z.v.info("CONVERSATIONS","Filtered widget conversations",{totalFromAPI:d.length,widgetSpecific:g.length,widgetConvIds:i}),t({conversations:g,loading:!1}),n(s.toString(),g)}catch(e){Z.v.error("CONVERSATIONS","Failed to fetch conversations",e);const n=a(s.toString());t({conversations:n||[],error:e instanceof Error?e.message:"Failed to fetch conversations",loading:!1})}},loadConversations:async s=>{const n="undefined"!=typeof window&&window.__customgpt_demo_mode;Z.v.info("CONVERSATIONS","Loading conversations for widget store",{sessionId:e,agentId:s,isDemoMode:n}),t({loading:!0,error:null});try{const n=a(s);if(n){const s=n.filter(t=>t.session_id&&t.session_id.includes(e));t({conversations:s,loading:!1}),Z.v.info("CONVERSATIONS","Loaded session-specific conversations",{totalCached:n.length,sessionSpecific:s.length,sessionId:e})}else t({conversations:[],loading:!1})}catch(e){Z.v.error("CONVERSATIONS","Failed to load conversations",e),t({error:e instanceof Error?e.message:"Failed to load conversations",loading:!1,conversations:[]})}},createConversation:async(s,a)=>{const r="undefined"!=typeof window&&window.__customgpt_demo_mode;Z.v.info("CONVERSATIONS","Creating conversation in widget store",{sessionId:e,projectId:s,name:a}),t({loading:!0,error:null});try{const i=(0,Y.KU)();if(r){const r=Date.now(),i=`demo_session_${r}_${Math.floor(1e6*Math.random())}_${e}`,c={id:Math.floor(1e6*Math.random()),session_id:i,project_id:s,name:a||"New Conversation",message_count:0,created_at:(new Date).toISOString(),updated_at:(new Date).toISOString(),deleted_at:null};return t(e=>({conversations:[...e.conversations,c],currentConversation:c,loading:!1})),void n(s.toString(),[...o().conversations])}const c=(await i.createConversation(s,a?{name:a}:void 0)).data,l=`widget_conversations_${e}`,d=JSON.parse(localStorage.getItem(l)||"[]");d.push(c.id),localStorage.setItem(l,JSON.stringify(d)),Z.v.info("CONVERSATIONS","Created conversation via API",{conversationId:c.id,sessionId:c.session_id,projectId:c.project_id,widgetSessionId:e}),t(e=>({conversations:[...e.conversations,c],currentConversation:c,loading:!1})),n(s.toString(),o().conversations)}catch(e){throw Z.v.error("CONVERSATIONS","Failed to create conversation",e),t({error:e instanceof Error?e.message:"Failed to create conversation",loading:!1}),e}},updateConversation:async(e,s,a)=>{Z.v.info("CONVERSATIONS","Updating conversation in widget store",{sessionId:s,conversationId:e,data:a}),t(t=>({conversations:t.conversations.map(t=>t.id.toString()===e.toString()?{...t,name:a.name,updated_at:(new Date).toISOString()}:t)}));const r=o().currentConversation;r&&r.id.toString()===e.toString()&&t({currentConversation:{...r,name:a.name,updated_at:(new Date).toISOString()}});const i=o().conversations.find(t=>t.id.toString()===e.toString())?.project_id;i&&n(i.toString(),o().conversations)},deleteConversation:async s=>{Z.v.info("CONVERSATIONS","Deleting conversation from widget store",{sessionId:e,conversationId:s});const a=o().conversations.find(e=>e.id.toString()===s);a&&(t(e=>({conversations:e.conversations.filter(e=>e.id.toString()!==s),currentConversation:e.currentConversation?.id.toString()===s?null:e.currentConversation})),n(a.project_id.toString(),o().conversations))},selectConversation:n=>{if(Z.v.info("CONVERSATIONS","Selecting conversation in widget store",{sessionId:e,conversationId:n?.id}),t({currentConversation:n}),n){const e={...o().lastConversationActivity};e[n.project_id.toString()]=n.id.toString(),t({lastConversationActivity:e}),function(e){try{localStorage.setItem(s,JSON.stringify(e))}catch(e){}}(e)}},ensureConversation:async(e,s)=>{const{conversations:n,currentConversation:a}=o();e.toString();if(a&&a.project_id===e)return a;const r=n.find(t=>t.project_id===e);if(r)return t({currentConversation:r}),r;const i=s?s.substring(0,50)+(s.length>50?"...":""):"New Conversation";await o().createConversation(e,i);const c=o().conversations[o().conversations.length-1];return t({currentConversation:c}),c},reset:()=>{t({conversations:[],currentConversation:null,loading:!1,error:null,lastConversationActivity:{}})}}))}function te(e){const t=`customgpt-agents-cache-${e}`,s=`customgpt-selected-agent-${e}`;function n(e){try{localStorage.setItem(t,JSON.stringify(e))}catch(e){}}function a(e){try{e?localStorage.setItem(s,e):localStorage.removeItem(s)}catch(e){}}return(0,H.vt)((r,o)=>({agents:[],currentAgent:null,loading:!1,error:null,fetchAgents:async()=>o().loadAgents(),loadAgents:async()=>{const o="undefined"!=typeof window&&window.__customgpt_demo_mode,i=`__customgpt_widget_${e}`,c="undefined"!=typeof window?window[i]:null;Z.v.info("AGENTS","Loading agents for widget store",{sessionId:e,isDemoMode:o,hasWidget:!!c,configuredAgentId:c?.config?.agentId}),r({loading:!0,error:null});try{if(c?.config?.agentId){const e=(0,Y.KU)();if(o){const e={id:c.config.agentId,project_name:c.config.name||"CustomGPT Assistant",type:"WIDGET",created_at:(new Date).toISOString(),updated_at:(new Date).toISOString(),is_chat_active:!0,is_shared:!1,user_id:0,team_id:0};return r({agents:[e],currentAgent:e,loading:!1}),n([e]),void a(e.id.toString())}try{const t=await e.getAgent(c.config.agentId),s=t.data||t;return Z.v.info("AGENTS","Fetched specific agent from API",{agentId:s.id,agentName:s.project_name}),r({agents:[s],currentAgent:s,loading:!1}),n([s]),void a(s.id.toString())}catch(e){Z.v.error("AGENTS","Failed to fetch specific agent",e);const s=function(){try{const e=localStorage.getItem(t);return e?JSON.parse(e):null}catch(e){return null}}();if(s&&s.length>0){const e=s.find(e=>e.id===c.config.agentId)||s[0];return void r({agents:s,currentAgent:e,loading:!1})}throw e}}if(!o){const e=(0,Y.KU)(),t=await e.getAgents();let o=[];Array.isArray(t)?o=t:t.data&&Array.isArray(t.data)?o=t.data:t.data&&t.data.data&&Array.isArray(t.data.data)&&(o=t.data.data),Z.v.info("AGENTS","Fetched agents from API",{count:o.length});const i=function(){try{return localStorage.getItem(s)}catch(e){return null}}(),c=i&&o.find(e=>e.id.toString()===i)||o[0];return r({agents:o,currentAgent:c||null,loading:!1}),n(o),void(c&&a(c.id.toString()))}if(o){const e=[{id:1,project_name:"Demo Assistant",type:"DEMO",created_at:(new Date).toISOString(),updated_at:(new Date).toISOString(),is_chat_active:!0,is_shared:!1,user_id:0,team_id:0}];return r({agents:e,currentAgent:e[0],loading:!1}),n(e),void a(e[0].id.toString())}r({agents:[],currentAgent:null,loading:!1})}catch(e){Z.v.error("AGENTS","Failed to load agents",e),r({error:e instanceof Error?e.message:"Failed to load agents",loading:!1})}},selectAgent:t=>{Z.v.info("AGENTS","Selecting agent in widget store",{sessionId:e,agentId:t?.id,agentName:t?.project_name}),r({currentAgent:t}),a(t?.id.toString()||null);const s=`__customgpt_widget_${e}`,n="undefined"!=typeof window?window[s]:null;n&&t&&(n.config.agentId=t.id,n.config.name=t.project_name)},setAgents:e=>{r({agents:e}),n(e)},updateAgent:async(t,s)=>{Z.v.info("AGENTS","Updating agent in widget store",{sessionId:e,agentId:t,data:s});const a=o().agents.find(e=>e.id===t);if(!a)throw new Error("Agent not found");const i={...a,...s};return r(e=>({agents:e.agents.map(e=>e.id===t?i:e),currentAgent:e.currentAgent?.id===t?i:e.currentAgent})),n(o().agents),i},deleteAgent:async t=>{Z.v.info("AGENTS","Deleting agent from widget store",{sessionId:e,agentId:t}),r(e=>({agents:e.agents.filter(e=>e.id!==t),currentAgent:e.currentAgent?.id===t?null:e.currentAgent})),n(o().agents)},createAgent:async e=>{throw new Error("Creating agents is not supported in widget mode")},replicateAgent:async e=>{throw new Error("Replicating agents is not supported in widget mode")},getAgentStats:async e=>({messages_sent:0,users_interacted:0,last_message_at:null}),reset:()=>{r({agents:[],currentAgent:null,loading:!1,error:null});try{localStorage.removeItem(t),localStorage.removeItem(s)}catch(e){}}}))}const se=(0,n.createContext)(null),ne=({children:e,sessionId:t})=>{const s=(0,n.useRef)(null);if(!s.current){const e=te(t),n=ee(t),a=X(t,e,n);s.current={messageStore:a,conversationStore:n,agentStore:e}}return(0,b.jsx)(se.Provider,{value:{stores:s.current},children:e})};function ae(){try{return null!==(0,n.useContext)(se)}catch{return!1}}function re(){const e=(0,n.useContext)(se);return e?.stores}function oe(){const e=ae(),t=re();return e&&t?(0,H.Pj)(t.messageStore):(0,o.useMessageStore)()}function ie(){const e=ae(),t=re();return e&&t?(0,H.Pj)(t.conversationStore):(0,o.useConversationStore)()}function ce(){const e=ae(),t=re();return e&&t?(0,H.Pj)(t.agentStore):(0,o.useAgentStore)()}const le=({agent:e,isSelected:t,onSelect:s,onSettingsClick:n})=>(0,b.jsxs)("div",{className:(0,d.cn)("flex items-center justify-between p-3 rounded-lg cursor-pointer transition-colors group","hover:bg-gray-50",t&&"bg-brand-50 hover:bg-brand-100"),onClick:()=>s(e),children:[(0,b.jsxs)("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[(0,b.jsx)("div",{className:(0,d.cn)("w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0",t?"bg-brand-600":"bg-gray-200"),children:(0,b.jsx)(l.A,{className:(0,d.cn)("w-4 h-4",t?"text-white":"text-gray-600")})}),(0,b.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("h3",{className:"font-medium text-gray-900 truncate",children:e.project_name}),t&&(0,b.jsx)(V.A,{className:"w-4 h-4 text-brand-600 flex-shrink-0"})]}),(0,b.jsxs)("div",{className:"flex items-center gap-3 mt-1 text-xs text-gray-400",children:[e.settings?.chatbot_model&&(0,b.jsxs)("span",{children:["Model: ",e.settings.chatbot_model]}),(0,b.jsxs)("span",{children:["Status: ",e.is_chat_active?"Active":"Inactive"]})]})]})]}),n&&(0,b.jsx)(N,{size:"icon",variant:"ghost",onClick:t=>{t.stopPropagation(),n(e)},className:"opacity-0 group-hover:opacity-100 transition-opacity h-6 w-6 text-gray-400 hover:text-gray-600",title:"Agent Settings",children:(0,b.jsx)(B.A,{className:"h-3 w-3"})})]}),de=({className:e,showSettings:t=!0,onSettingsClick:s})=>{const[a,o]=(0,n.useState)(!1),c=(0,n.useRef)(null),{agents:g,currentAgent:u,loading:m,error:h,fetchAgents:p,selectAgent:f}=ce();(0,n.useEffect)(()=>{const e=e=>{c.current&&!c.current.contains(e.target)&&o(!1)};if(a)return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[a]);const y=async()=>{try{await p(),r.oR.success("Agents refreshed")}catch(e){r.oR.error("Failed to refresh agents")}},v=e=>{f(e),o(!1),r.oR.success(`Switched to ${e.project_name}`)};return m&&0===g.length?(0,b.jsx)("div",{className:(0,d.cn)("p-3 bg-white border rounded-lg",e),children:(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)("div",{className:"w-8 h-8 rounded-full bg-gray-200 animate-pulse"}),(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsx)("div",{className:"h-4 bg-gray-200 rounded animate-pulse mb-2"}),(0,b.jsx)("div",{className:"h-3 bg-gray-100 rounded animate-pulse w-3/4"})]})]})}):h&&0===g.length?(0,b.jsx)("div",{className:(0,d.cn)("p-3 bg-white border rounded-lg",e),children:(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)("div",{className:"w-8 h-8 rounded-full bg-red-100 flex items-center justify-center",children:(0,b.jsx)($.A,{className:"w-4 h-4 text-red-600"})}),(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsx)("p",{className:"text-sm text-red-600 font-medium",children:"Failed to load agents"}),(0,b.jsx)("p",{className:"text-xs text-red-500",children:h})]}),(0,b.jsx)(N,{size:"sm",variant:"ghost",onClick:y,className:"text-red-600 hover:text-red-700",children:(0,b.jsx)(W.A,{className:"w-4 h-4"})})]})}):u||0!==g.length?(0,b.jsxs)("div",{className:(0,d.cn)("relative",e),ref:c,children:[(0,b.jsx)("button",{onClick:async()=>{const e=!a;if(o(e),e)try{await p()}catch(e){}},className:(0,d.cn)("w-full p-3 bg-white border rounded-lg text-left transition-colors","hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-brand-500 focus:border-transparent",a&&"ring-2 ring-brand-500 border-transparent"),children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[(0,b.jsx)("div",{className:"w-8 h-8 rounded-full bg-brand-600 flex items-center justify-center flex-shrink-0",children:(0,b.jsx)(l.A,{className:"w-4 h-4 text-white"})}),(0,b.jsx)("div",{className:"flex-1 min-w-0",children:(0,b.jsx)("h3",{className:"font-medium text-gray-900 truncate",children:u?.project_name||"Select Agent"})})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(N,{size:"icon",variant:"ghost",onClick:e=>{e.stopPropagation(),y()},disabled:m,className:"h-6 w-6 text-gray-400 hover:text-gray-600",title:"Refresh Agents",children:(0,b.jsx)(W.A,{className:(0,d.cn)("h-3 w-3",m&&"animate-spin")})}),(0,b.jsx)(A.A,{className:(0,d.cn)("w-4 h-4 text-gray-400 transition-transform",a&&"rotate-180")})]})]})}),(0,b.jsx)(C.N,{children:a&&(0,b.jsx)(i.P.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},transition:{duration:.2},className:"absolute top-full left-0 right-0 mt-2 bg-white border rounded-lg shadow-lg z-50 max-h-80 overflow-y-auto",children:(0,b.jsxs)("div",{className:"p-2",children:[(0,b.jsx)("div",{className:"px-2 py-1 mb-2",children:(0,b.jsxs)("h4",{className:"text-xs font-medium text-gray-500 uppercase tracking-wide",children:["Available Agents (",Array.isArray(g)?g.length:0,")"]})}),(0,b.jsx)("div",{className:"space-y-1",children:Array.isArray(g)&&g.length>0?g.map(e=>(0,b.jsx)(le,{agent:e,isSelected:u?.id===e.id,onSelect:v,onSettingsClick:t?s:void 0},e.id)):(0,b.jsxs)("div",{className:"px-2 py-4 text-center",children:[(0,b.jsx)("p",{className:"text-sm text-gray-500",children:"No agents found"}),(0,b.jsxs)(N,{size:"sm",variant:"ghost",onClick:y,className:"mt-2",children:[(0,b.jsx)(W.A,{className:"w-4 h-4 mr-2"}),"Refresh"]})]})})]})})})]}):(0,b.jsx)("div",{className:(0,d.cn)("p-3 bg-white border rounded-lg",e),children:(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)("div",{className:"w-8 h-8 rounded-full bg-gray-200 flex items-center justify-center",children:(0,b.jsx)(l.A,{className:"w-4 h-4 text-gray-600"})}),(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsx)("p",{className:"text-sm text-gray-600 font-medium",children:"No agents available"}),(0,b.jsx)("p",{className:"text-xs text-gray-500",children:"Check your API configuration"})]}),(0,b.jsx)(N,{size:"sm",variant:"ghost",onClick:y,disabled:m,children:(0,b.jsx)(W.A,{className:(0,d.cn)("w-4 h-4",m&&"animate-spin")})})]})})};var ge=s(3373),ue=s(6069),me=s(354),he=s(7292);const pe=({isOpen:e,onClose:t,citationId:s,projectId:a})=>{const[r,o]=(0,n.useState)(!1),[c,l]=(0,n.useState)(null),[d,g]=(0,n.useState)(null),[u,m]=(0,n.useState)(!1),{currentAgent:h}=(0,he.o)(),f=a||h?.id;(0,n.useEffect)(()=>{e&&f&&s&&y()},[e,f,s]);const y=async()=>{if(f&&s){o(!0),l(null),m(!1);try{const e=(0,Y.KU)(),t=await e.getCitation(f,"string"==typeof s?parseInt(s,10):s);t.data&&(g(t.data),Z.v.info("CITATION","Citation details fetched",{citationId:s,projectId:f,hasImage:!!t.data.image}))}catch(e){const t=e instanceof Error?e.message:"Failed to fetch citation details";l(t),Z.v.error("CITATION","Failed to fetch citation details",{error:e,citationId:s,projectId:f})}finally{o(!1)}}else l("Missing project or citation information")};return e?(0,b.jsx)(C.N,{children:(0,b.jsxs)("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[(0,b.jsx)(i.P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:t,className:"absolute inset-0 bg-black/50"}),(0,b.jsxs)(i.P.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"relative bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-hidden",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between p-4 border-b",children:[(0,b.jsx)("h2",{className:"text-lg font-semibold text-gray-900",children:"Citation Details"}),(0,b.jsx)(N,{variant:"ghost",size:"icon",onClick:t,className:"h-8 w-8",children:(0,b.jsx)(F.A,{className:"h-4 w-4"})})]}),(0,b.jsx)("div",{className:"p-4 overflow-y-auto max-h-[calc(90vh-120px)]",children:r?(0,b.jsx)("div",{className:"flex items-center justify-center py-12",children:(0,b.jsx)(ge.A,{className:"h-8 w-8 animate-spin text-gray-400"})}):c?(0,b.jsxs)("div",{className:"flex items-center gap-3 p-4 bg-red-50 rounded-lg",children:[(0,b.jsx)($.A,{className:"h-5 w-5 text-red-600 flex-shrink-0"}),(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsx)("p",{className:"text-sm font-medium text-red-900",children:"Error loading citation"}),(0,b.jsx)("p",{className:"text-sm text-red-700 mt-1",children:c})]})]}):d?(0,b.jsxs)("div",{className:"space-y-4",children:[d.image&&!u&&(0,b.jsx)("div",{className:"relative rounded-lg overflow-hidden bg-gray-100",children:(0,b.jsx)("img",{src:d.image,alt:d.title,className:"w-full h-auto",onError:()=>m(!0)})}),(0,b.jsx)("div",{children:(0,b.jsx)("h3",{className:"text-xl font-semibold text-gray-900",children:d.title})}),(0,b.jsxs)("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[(0,b.jsx)(ue.A,{className:"h-4 w-4"}),(0,b.jsx)("a",{href:d.url,target:"_blank",rel:"noopener noreferrer",className:"hover:text-brand-600 transition-colors truncate",children:d.url})]}),d.description&&(0,b.jsx)("div",{className:"prose prose-gray max-w-none",children:(0,b.jsx)("p",{className:"text-gray-700",children:d.description})}),(0,b.jsxs)("div",{className:"pt-4 border-t space-y-2",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between text-sm",children:[(0,b.jsx)("span",{className:"text-gray-500",children:"Citation ID"}),(0,b.jsxs)("span",{className:"font-mono text-gray-700",children:["#",d.id]})]}),d.image&&(0,b.jsxs)("div",{className:"flex items-center justify-between text-sm",children:[(0,b.jsx)("span",{className:"text-gray-500",children:"Has preview image"}),(0,b.jsx)(me.A,{className:"h-4 w-4 text-gray-400"})]})]})]}):null}),(0,b.jsx)("div",{className:"p-4 border-t bg-gray-50",children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)("div",{className:"text-xs text-gray-500",children:"Open Graph data from cited source"}),d&&(0,b.jsxs)("a",{href:d.url,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-2 px-3 py-1.5 text-sm font-medium text-brand-600 hover:text-brand-700 transition-colors",children:["Visit source",(0,b.jsx)(p.A,{className:"h-3.5 w-3.5"})]})]})})]})]})}):null};var fe=s(6424),ye=s(5854),ve=s(783),xe=s(9606);const we=({sessionId:e,maxConversations:t,currentConversationId:s,onConversationChange:a,onCreateConversation:o,className:c,refreshKey:l})=>{const[g,u]=(0,n.useState)([]),[m,h]=(0,n.useState)(null),[p,f]=(0,n.useState)(""),[y,v]=(0,n.useState)(!1);(0,n.useEffect)(()=>{const t=()=>{const t=localStorage.getItem(`customgpt_conversations_${e}`);if(t)try{const e=JSON.parse(t);u(e)}catch(e){}};return t(),window.addEventListener("storage",t),()=>window.removeEventListener("storage",t)},[e,l]);const x=t=>{const s=g.map(e=>e.id===t?{...e,title:p}:e);u(s),localStorage.setItem(`customgpt_conversations_${e}`,JSON.stringify(s)),h(null)},w=g.find(e=>e.id===s);return(0,b.jsxs)("div",{className:(0,d.cn)("relative",c),children:[(0,b.jsxs)("button",{onClick:()=>v(!y),className:"flex items-center gap-2 px-3 py-2 text-sm font-medium text-gray-700 hover:bg-gray-100 rounded-lg transition-colors w-full",children:[(0,b.jsx)(fe.A,{className:"w-4 h-4"}),(0,b.jsx)("span",{className:"truncate flex-1 text-left",children:w?.title||"Select Conversation"}),(0,b.jsx)("svg",{className:(0,d.cn)("w-4 h-4 transition-transform",y&&"rotate-180"),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),(0,b.jsx)(C.N,{children:y&&(0,b.jsxs)(i.P.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},transition:{duration:.2},className:"absolute top-full left-0 right-0 mt-2 bg-white rounded-lg shadow-lg border border-gray-200 z-50 max-h-80 overflow-y-auto",children:[(0,b.jsxs)("button",{onClick:()=>{t&&g.length>=t?r.oR.error(`You've reached the maximum limit of ${t} conversations. Please delete an existing conversation to create a new one.`):o?.()},disabled:!!t&&g.length>=t,className:"flex items-center gap-2 w-full px-4 py-3 text-sm font-medium text-brand-600 hover:bg-brand-50 disabled:opacity-50 disabled:cursor-not-allowed border-b",children:[(0,b.jsx)(ye.A,{className:"w-4 h-4"}),"New Conversation"]}),(0,b.jsx)("div",{className:"py-2",children:g.map(t=>(0,b.jsx)("div",{className:(0,d.cn)("group flex items-center px-4 py-2 hover:bg-gray-50",s===t.id&&"bg-brand-50"),children:m===t.id?(0,b.jsxs)("div",{className:"flex items-center gap-2 flex-1",children:[(0,b.jsx)("input",{type:"text",value:p,onChange:e=>f(e.target.value),onKeyDown:e=>{"Enter"===e.key&&x(t.id),"Escape"===e.key&&h(null)},className:"flex-1 px-2 py-1 text-sm border rounded focus:outline-none focus:ring-1 focus:ring-brand-500",autoFocus:!0}),(0,b.jsx)("button",{onClick:()=>x(t.id),className:"p-1 text-green-600 hover:bg-green-50 rounded",children:(0,b.jsx)(V.A,{className:"w-4 h-4"})}),(0,b.jsx)("button",{onClick:()=>h(null),className:"p-1 text-gray-400 hover:bg-gray-100 rounded",children:(0,b.jsx)(F.A,{className:"w-4 h-4"})})]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("button",{onClick:()=>(e=>{a?.(e),v(!1)})(t),className:"flex-1 text-left",children:[(0,b.jsx)("div",{className:"text-sm font-medium text-gray-900 truncate",children:t.title}),(0,b.jsx)("div",{className:"text-xs text-gray-500",children:new Date(t.createdAt).toLocaleDateString()})]}),(0,b.jsxs)("div",{className:"flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[(0,b.jsx)("button",{onClick:()=>(e=>{h(e.id),f(e.title)})(t),className:"p-1 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded",children:(0,b.jsx)(ve.A,{className:"w-3 h-3"})}),(0,b.jsx)("button",{onClick:()=>(t=>{if(g.length<=1)return void r.oR.error("Cannot delete the last conversation");const n=g.filter(e=>e.id!==t);u(n),localStorage.setItem(`customgpt_conversations_${e}`,JSON.stringify(n)),s===t&&n.length>0&&a?.(n[0])})(t.id),className:"p-1 text-gray-400 hover:text-red-600 hover:bg-red-50 rounded",children:(0,b.jsx)(xe.A,{className:"w-3 h-3"})})]})]})},t.id))})]})})]})},Se=(0,n.createContext)(void 0),be=({widgetInstance:e,children:t})=>(0,b.jsx)(Se.Provider,{value:e,children:t}),je=["What can you help me with?","Explain this document","Summarize key points","Answer my questions"],Ne=({prompt:e,onClick:t})=>(0,b.jsx)("button",{onClick:()=>t(e),className:"p-3 text-left bg-white border border-gray-200 rounded-lg hover:border-gray-300 hover:shadow-sm transition-all text-sm text-gray-700",children:e}),Ce=({onPromptClick:e})=>{const{currentAgent:t}=ce();return(0,b.jsx)("div",{className:"flex flex-col items-center justify-center h-full px-4 py-8",children:(0,b.jsxs)(i.P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},className:"text-center max-w-md",children:[(0,b.jsx)("div",{className:"w-16 h-16 rounded-full bg-brand-100 flex items-center justify-center mb-6 mx-auto",children:(0,b.jsx)(c.A,{className:"w-8 h-8 text-brand-600"})}),(0,b.jsxs)("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:["Welcome to ",t?.project_name||"CustomGPT","!"]}),(0,b.jsx)("p",{className:"text-gray-600 mb-8",children:"I'm here to help answer your questions and assist with your tasks. How can I help you today?"}),(0,b.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 w-full",children:je.map((t,s)=>(0,b.jsx)(i.P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3,delay:.1+.1*s},children:(0,b.jsx)(Ne,{prompt:t,onClick:e})},s))})]})})},Ae=({className:e})=>{const{messages:t,streamingMessage:s,isStreaming:a,error:r,sendMessage:o}=oe(),{currentConversation:i}=ie(),{currentAgent:c}=ce(),l=(0,n.useRef)(null),[g,u]=n.useState(null),[m,h]=n.useState(!1),p=i&&t.get(i.id.toString())||[];(0,n.useEffect)(()=>{l.current&&l.current.scrollTo({top:l.current.scrollHeight,behavior:"smooth"})},[p,s]);const f=e=>{Z.v.info("UI","Citation clicked",{citationId:e.id,citationIndex:e.index,citationTitle:e.title}),e.id&&(u(e.id),h(!0))};return(0,b.jsxs)("div",{ref:l,className:(0,d.cn)("flex-1 overflow-y-auto scroll-smooth","bg-gradient-to-b from-gray-50 to-white",e),children:[r&&(0,b.jsxs)("div",{className:"p-4 m-4 bg-red-50 border border-red-200 rounded-lg",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 text-red-800",children:[(0,b.jsx)("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20",children:(0,b.jsx)("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})}),(0,b.jsx)("span",{className:"font-medium",children:r.includes("unauthorized")||r.includes("403")?"Authorization Error":"Error"})]}),(0,b.jsx)("p",{className:"text-red-700 mt-1 text-sm",children:r.includes("unauthorized")||r.includes("403")?"Your API key does not have permission to access this agent's conversations. Please check your API key permissions or contact support.":r})]}),0===p.length&&!s&&!r&&(0,b.jsx)(Ce,{onPromptClick:e=>{Z.v.info("UI","Example prompt clicked",{prompt:e}),o(e)}}),p.length>0&&(0,b.jsx)("div",{className:"space-y-0",children:p.map((e,t)=>(0,b.jsx)(O,{message:e,isLast:t===p.length-1,onCitationClick:f,onFeedback:t=>((e,t)=>{Z.v.info("UI","Message feedback provided",{messageId:e,feedback:t})})(e.id,t)},e.id))}),s&&(0,b.jsx)(O,{message:s,isStreaming:!0,isLast:!0,onCitationClick:f}),a&&!s&&(0,b.jsx)(J,{}),g&&(0,b.jsx)(pe,{isOpen:m,onClose:()=>{h(!1),u(null)},citationId:g,projectId:c?.id})]})},_e=({mode:e="standalone",onClose:t,onAgentSettings:s,enableConversationManagement:n=!1,maxConversations:a,sessionId:r,currentConversationId:o,onConversationChange:i,onCreateConversation:c,conversationRefreshKey:d})=>{const{currentAgent:g}=ce();return"widget"===e||"floating"===e?(0,b.jsxs)("header",{className:"border-b border-gray-200 bg-white",children:[n&&r&&(0,b.jsx)("div",{className:"px-4 py-2 border-b border-gray-100",children:(0,b.jsx)(we,{sessionId:r,maxConversations:a,currentConversationId:o,onConversationChange:i,onCreateConversation:c,className:"w-full",refreshKey:d})}),(0,b.jsxs)("div",{className:"flex items-center justify-between px-4 py-3",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[(0,b.jsx)("div",{className:"w-8 h-8 rounded-lg bg-brand-500 flex items-center justify-center flex-shrink-0",children:(0,b.jsx)(l.A,{className:"w-5 h-5 text-white"})}),(0,b.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,b.jsx)("h2",{className:"font-semibold text-gray-900 truncate",children:g?.project_name||"CustomGPT Assistant"}),(0,b.jsx)("p",{className:"text-xs text-gray-500",children:g?.is_chat_active?"Online":"Offline"})]})]}),t&&(0,b.jsxs)("button",{onClick:t,className:"p-1.5 rounded-lg hover:bg-gray-100 transition-colors flex-shrink-0",children:[(0,b.jsx)("span",{className:"sr-only",children:"Close"}),"×"]})]})]}):"standalone"===e?(0,b.jsxs)("header",{className:"flex items-center justify-between px-4 py-3 border-b border-gray-200 bg-white",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)("div",{className:"w-8 h-8 rounded-lg bg-brand-500 flex items-center justify-center",children:(0,b.jsx)(l.A,{className:"w-5 h-5 text-white"})}),(0,b.jsx)("h1",{className:"text-lg font-semibold text-gray-900",children:"Agent Chat"})]}),(0,b.jsx)("div",{className:"flex-1 max-w-xs ml-4",children:(0,b.jsx)(de,{onSettingsClick:s,className:"w-full"})})]}):null},Ee=({mode:e="standalone",className:t,onClose:s,onAgentSettings:a,enableConversationManagement:o=!1,maxConversations:i,sessionId:c,threadId:l,onConversationChange:g,onMessage:u,conversationRefreshKey:m})=>{const{sendMessage:h,isStreaming:p,cancelStreaming:f}=oe(),{fetchAgents:y,agents:v,currentAgent:x}=ce(),{currentConversation:w}=ie(),S=(0,n.useContext)(Se)||null,[j,N]=n.useState(null);(0,n.useEffect)(()=>{(async()=>{if(0!==v.length||x)Z.v.debug("UI","Agents already initialized",{agentCount:v.length,hasCurrentAgent:!!x,currentAgentName:x?.project_name});else{Z.v.info("UI","Initializing agents on ChatContainer mount");try{await y(),Z.v.info("UI","Agents initialized successfully",{agentCount:v.length})}catch(e){Z.v.error("UI","Failed to initialize agents",e,{errorMessage:e instanceof Error?e.message:String(e)})}}})()},[]);return(0,b.jsxs)("div",{className:(0,d.cn)("flex flex-col bg-white","standalone"===e&&"h-full","widget"===e&&"h-[600px] w-[400px] rounded-lg shadow-xl border border-gray-200","floating"===e&&"h-[600px] w-[400px] rounded-lg shadow-2xl border border-gray-200",t),children:[(0,b.jsx)(_e,{mode:e,onClose:s,onAgentSettings:e=>{Z.v.info("UI","Agent settings requested",{agentId:e.id,agentName:e.project_name}),a?.(e)},enableConversationManagement:o,maxConversations:i,sessionId:c,currentConversationId:j||w?.id.toString(),onConversationChange:e=>{N(e.id),g?.(e),S&&S.switchConversation(e.id)},onCreateConversation:()=>{if(S){const e=S.createConversation();if(e)N(e.id);else{const e=S.configuration?.maxConversations||5;r.oR.error(`You've reached the maximum limit of ${e} conversations. Please delete an existing conversation to create a new one.`)}}},conversationRefreshKey:m}),(0,b.jsx)(Ae,{className:"flex-1"}),(0,b.jsx)(G,{onSend:async(e,t)=>{Z.v.info("UI","Sending message from ChatContainer",{contentLength:e.length,hasFiles:t&&t.length>0,fileCount:t?.length||0,currentAgent:x?.project_name,agentId:x?.id});try{await h(e,t),Z.v.info("UI","Message sent successfully")}catch(e){Z.v.error("UI","Failed to send message from ChatContainer",e,{errorMessage:e instanceof Error?e.message:String(e),isAuthError:e instanceof Error&&(e.message.includes("403")||e.message.includes("unauthorized"))})}},disabled:p,placeholder:p?"AI is thinking...":"Send a message..."}),("widget"===e||"floating"===e)&&(0,b.jsx)("div",{className:"px-4 py-2 border-t border-gray-100 bg-gray-50",children:(0,b.jsx)("a",{href:"https://customgpt.ai",target:"_blank",rel:"noopener noreferrer",className:"text-xs text-gray-500 hover:text-gray-700 transition-colors block text-center",children:"Powered by CustomGPT.ai"})})]})};var Ie=s(7600),Me=s.n(Ie),Pe=s(3252),ke=s(348),Re=s(6846),Oe=s(2923),Te=s(3458),$e=s(1216),Fe=s(9666),Le=s(4004),Ue=s(9062);const De=({conversation:e,isSelected:t,onSelect:s,onDelete:a,onRename:r})=>{const[o,c]=(0,n.useState)(!1),[l,g]=(0,n.useState)(e.name),[u,m]=(0,n.useState)(!1),h=(0,n.useRef)(null),p=(0,n.useRef)(null);(0,n.useEffect)(()=>{const e=e=>{p.current&&!p.current.contains(e.target)&&m(!1)};if(u)return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[u]),(0,n.useEffect)(()=>{o&&h.current&&(h.current.focus(),h.current.select())},[o]);const f=()=>{l.trim()&&l.trim()!==e.name&&r(e.id.toString(),l.trim()),c(!1),g(e.name)};return(0,b.jsx)("div",{className:(0,d.cn)("group relative p-3 rounded-lg cursor-pointer transition-colors","hover:bg-gray-50",t&&"bg-brand-50 hover:bg-brand-100"),onClick:()=>!o&&s(e),children:(0,b.jsxs)("div",{className:"flex items-start justify-between gap-2",children:[(0,b.jsxs)("div",{className:"flex-1 min-w-0",children:[o?(0,b.jsx)("input",{ref:h,type:"text",value:l,onChange:e=>g(e.target.value),onBlur:f,onKeyDown:t=>{"Enter"===t.key?f():"Escape"===t.key&&(c(!1),g(e.name))},className:"w-full px-2 py-1 text-sm font-medium text-gray-900 bg-white border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-brand-500 focus:border-transparent",maxLength:100}):(0,b.jsx)("h3",{className:"font-medium text-gray-900 text-sm truncate",children:e.name}),(0,b.jsxs)("div",{className:"flex items-center gap-2 mt-1 text-xs text-gray-500",children:[(0,b.jsx)(Pe.A,{className:"w-3 h-3"}),(0,b.jsx)("span",{children:(0,d.Ey)(e.updated_at)}),e.message_count&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("span",{children:"•"}),(0,b.jsxs)("span",{children:[e.message_count," messages"]})]})]})]}),!o&&(0,b.jsxs)("div",{className:"relative",ref:p,children:[(0,b.jsx)(N,{size:"icon",variant:"ghost",onClick:e=>{e.stopPropagation(),m(!u)},className:"opacity-0 group-hover:opacity-100 transition-opacity h-6 w-6 text-gray-400 hover:text-gray-600",children:(0,b.jsx)(ke.A,{className:"h-3 w-3"})}),(0,b.jsx)(C.N,{children:u&&(0,b.jsx)(i.P.div,{initial:{opacity:0,scale:.95,y:-5},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95,y:-5},transition:{duration:.1},className:"absolute right-0 top-6 mt-1 w-32 bg-white border border-gray-200 rounded-lg shadow-lg z-50",children:(0,b.jsxs)("div",{className:"py-1",children:[(0,b.jsxs)("button",{onClick:e=>{e.stopPropagation(),c(!0),m(!1)},className:"flex items-center gap-2 w-full px-3 py-2 text-sm text-gray-700 hover:bg-gray-50",children:[(0,b.jsx)(Re.A,{className:"w-3 h-3"}),"Rename"]}),(0,b.jsxs)("button",{onClick:t=>{t.stopPropagation(),a(e.id.toString()),m(!1)},className:"flex items-center gap-2 w-full px-3 py-2 text-sm text-red-600 hover:bg-red-50",children:[(0,b.jsx)(xe.A,{className:"w-3 h-3"}),"Delete"]})]})})})]})]})})},qe=({className:e,isCollapsed:t=!1,onToggle:s})=>{const[a,o]=(0,n.useState)(""),[i,c]=(0,n.useState)(!1),{conversations:g,currentConversation:u,loading:m,error:h,fetchConversations:p,createConversation:f,selectConversation:y,deleteConversation:v,updateConversation:x}=ie(),{currentAgent:w}=ce(),{clearMessages:S,loadMessages:j}=oe();(0,n.useEffect)(()=>{const e="undefined"!=typeof window&&window.__customgpt_demo_mode;w&&!e?(Z.v.info("UI","Agent changed in sidebar, fetching conversations",{agentId:w.id,agentName:w.project_name,isActive:w.is_chat_active}),p(w.id)):w?e&&Z.v.info("UI","Skipping conversation fetch in demo mode"):Z.v.warn("UI","No current agent selected in sidebar")},[w,p]),Array.isArray(g);const C=Array.isArray(g)?g.filter(e=>e.name.toLowerCase().includes(a.toLowerCase())):[],A=async e=>{Z.v.info("UI","Selecting conversation",{conversationId:e.id,conversationName:e.name,projectId:e.project_id,messageCount:e.message_count}),y(e);try{Z.v.info("UI","Loading messages for selected conversation",{conversationId:e.id,agentId:w?.id,agentName:w?.project_name}),await j(e.id.toString()),Z.v.info("UI","Messages loaded successfully for conversation",{conversationId:e.id})}catch(t){Z.v.error("UI","Failed to load messages for conversation",t,{conversationId:e.id,errorMessage:t instanceof Error?t.message:String(t),errorType:t instanceof Error?t.constructor.name:typeof t}),r.oR.error("Failed to load conversation messages")}},_=async(e,t)=>{const s=g.find(t=>t.id.toString()===e);if(s)try{await x(s.project_id,s.session_id,{name:t}),r.oR.success("Conversation renamed")}catch(e){r.oR.error("Failed to rename conversation")}};return t?(0,b.jsx)("div",{className:(0,d.cn)("w-12 bg-gray-50 border-r border-gray-200 flex flex-col",e),children:(0,b.jsx)("div",{className:"p-2",children:(0,b.jsx)(N,{size:"icon",variant:"ghost",onClick:s,className:"w-8 h-8",title:"Expand sidebar",children:(0,b.jsx)(Oe.A,{className:"h-4 w-4"})})})}):(0,b.jsxs)("div",{className:(0,d.cn)("w-80 bg-gray-50 border-r border-gray-200 flex flex-col",e),children:[(0,b.jsxs)("div",{className:"p-4 border-b border-gray-200 bg-white",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,b.jsx)("h2",{className:"font-semibold text-gray-900",children:"Conversations"}),(0,b.jsx)(N,{size:"icon",variant:"ghost",onClick:s,className:"h-8 w-8",title:"Collapse sidebar",children:(0,b.jsx)(F.A,{className:"h-4 w-4"})})]}),(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)(Te.A,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"}),(0,b.jsx)("input",{type:"text",placeholder:"Search conversations...",value:a,onChange:e=>o(e.target.value),className:"w-full pl-9 pr-3 py-2 text-sm border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-brand-500 focus:border-transparent"})]})]}),(0,b.jsxs)("div",{className:"p-4 space-y-2",children:[(0,b.jsx)(Me(),{href:"/create",children:(0,b.jsxs)(N,{className:"w-full justify-start gap-2",variant:"default",children:[(0,b.jsx)(l.A,{className:"w-4 h-4"}),"Create New Agent"]})}),(0,b.jsxs)(N,{onClick:async()=>{if(w&&!i){Z.v.info("UI","Creating new conversation",{agentId:w.id,agentName:w.project_name}),c(!0);try{const e=`New Chat ${(new Date).toLocaleDateString()}`;await f(w.id,e),S(),Z.v.info("UI","New conversation created successfully",{name:e}),r.oR.success("New conversation created")}catch(e){Z.v.error("UI","Failed to create conversation",e,{agentId:w.id,errorMessage:e instanceof Error?e.message:String(e)}),r.oR.error("Failed to create new conversation")}finally{c(!1)}}},disabled:!w||i,className:"w-full justify-start gap-2",variant:"outline",children:[(0,b.jsx)(ye.A,{className:"w-4 h-4"}),i?"Creating...":"New Chat"]}),(0,b.jsxs)("div",{className:"border-t border-gray-200 pt-2 mt-3 space-y-1",children:[(0,b.jsx)(Me(),{href:"/analytics",children:(0,b.jsxs)(N,{className:"w-full justify-start gap-2",variant:"ghost",size:"sm",children:[(0,b.jsx)($e.A,{className:"w-4 h-4"}),"Analytics"]})}),(0,b.jsx)(Me(),{href:"/pages",children:(0,b.jsxs)(N,{className:"w-full justify-start gap-2",variant:"ghost",size:"sm",children:[(0,b.jsx)(Fe.A,{className:"w-4 h-4"}),"Pages"]})}),(0,b.jsx)(Me(),{href:"/sources",children:(0,b.jsxs)(N,{className:"w-full justify-start gap-2",variant:"ghost",size:"sm",children:[(0,b.jsx)(Le.A,{className:"w-4 h-4"}),"Sources"]})}),(0,b.jsx)(Me(),{href:"/debug",children:(0,b.jsxs)(N,{className:"w-full justify-start gap-2",variant:"ghost",size:"sm",children:[(0,b.jsx)(Ue.A,{className:"w-4 h-4"}),"Debug Logs"]})})]}),(0,b.jsxs)(N,{onClick:()=>{w&&(Z.v.info("UI","Manual refresh conversations clicked",{agentId:w.id,agentName:w.project_name}),p(w.id))},disabled:!w||m,className:"w-full justify-start gap-2",variant:"ghost",size:"sm",children:[(0,b.jsx)(W.A,{className:(0,d.cn)("w-4 h-4",m&&"animate-spin")}),"Refresh Conversations"]})]}),(0,b.jsx)("div",{className:"flex-1 overflow-y-auto",children:!m||Array.isArray(g)&&0!==g.length?!h||Array.isArray(g)&&0!==g.length?0===C.length?(0,b.jsxs)("div",{className:"p-4 text-center",children:[(0,b.jsx)(Oe.A,{className:"w-8 h-8 text-gray-400 mx-auto mb-2"}),(0,b.jsx)("p",{className:"text-sm text-gray-500",children:a?"No conversations found":"No conversations yet"}),!a&&(0,b.jsx)("p",{className:"text-xs text-gray-400 mt-1",children:"Start a new conversation to get going"}),w&&(0,b.jsxs)("div",{className:"text-xs text-gray-400 mt-2 space-y-1",children:[(0,b.jsxs)("p",{children:["Agent: ",w.project_name," (ID: ",w.id,")"]}),h&&(0,b.jsxs)("p",{className:"text-red-500",children:["Error: ",h]}),(0,b.jsxs)("p",{children:["Conversations loaded: ",g.length]})]})]}):(0,b.jsx)("div",{className:"p-2 space-y-1",children:C.map(e=>(0,b.jsx)(De,{conversation:e,isSelected:u?.id===e.id,onSelect:A,onDelete:e=>(async e=>{try{await v(e),r.oR.success("Conversation deleted")}catch(e){r.oR.error("Failed to delete conversation")}})(e),onRename:_},e.id))}):(0,b.jsxs)("div",{className:"p-4 text-center",children:[(0,b.jsx)("p",{className:"text-sm text-red-600 mb-2",children:"Failed to load conversations"}),(0,b.jsx)(N,{size:"sm",variant:"ghost",onClick:()=>w&&p(w.id),children:"Try Again"})]}):(0,b.jsx)("div",{className:"p-4 space-y-3",children:[...Array(3)].map((e,t)=>(0,b.jsxs)("div",{className:"animate-pulse",children:[(0,b.jsx)("div",{className:"h-4 bg-gray-200 rounded mb-2"}),(0,b.jsx)("div",{className:"h-3 bg-gray-100 rounded w-3/4"})]},t))})}),(0,b.jsx)("div",{className:"p-4 border-t border-gray-200 bg-white",children:(0,b.jsxs)("div",{className:"text-xs text-gray-500 text-center",children:[C.length," conversation",1!==C.length?"s":"",w&&(0,b.jsxs)("span",{className:"block mt-1",children:["Agent: ",w.project_name]})]})})]})},Ke=({mode:e="standalone",className:t,onClose:s,onAgentSettings:a,showSidebar:r=!0,enableConversationManagement:o=!1,maxConversations:i,sessionId:c,threadId:l,onConversationChange:d,onMessage:g,widgetInstance:u,conversations:m,currentConversation:h,conversationRefreshKey:p})=>{const[f,y]=(0,n.useState)(!1),{currentConversation:v}=ie(),{loadMessages:x}=oe();(0,n.useEffect)(()=>{const e="undefined"!=typeof window&&window.__customgpt_demo_mode;v&&!e&&x(v.id.toString())},[v,x]);return r&&"standalone"===e?(0,b.jsxs)("div",{className:"flex h-full bg-white",children:[(0,b.jsx)(qe,{isCollapsed:f,onToggle:()=>{y(!f)}}),(0,b.jsx)("div",{className:"flex-1 flex flex-col min-w-0",children:(0,b.jsx)(Ee,{mode:e,className:"h-full",onClose:s,onAgentSettings:a,enableConversationManagement:o,maxConversations:i,sessionId:c,threadId:l,onConversationChange:d,onMessage:g,conversationRefreshKey:p})})]}):(0,b.jsx)(Ee,{mode:e,className:t,onClose:s,onAgentSettings:a,enableConversationManagement:o,maxConversations:i,sessionId:c,threadId:l,onConversationChange:d,onMessage:g,conversationRefreshKey:p})};function ze(e,t,s){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var s=e[Symbol.toPrimitive];if(void 0!==s){var n=s.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}class Ge{constructor(e){if(ze(this,"container",null),ze(this,"root",null),ze(this,"config",void 0),ze(this,"isOpen",!1),ze(this,"sessionId",void 0),ze(this,"currentConversationId",null),ze(this,"instanceKey",void 0),ze(this,"conversationRefreshKey",0),!e.apiKey)throw new Error("CustomGPT Widget: API key is required");if(!e.agentId)throw new Error("CustomGPT Widget: Agent ID is required");if(this.config={mode:"embedded",theme:"light",position:"bottom-right",width:"400px",height:"600px",enableCitations:!0,enableFeedback:!0,enableConversationManagement:!1,...e},!1!==this.config.isolateConversations){const e=this.config.mode||"widget",t=this.config.containerId||"default",s=`${"undefined"!=typeof performance?performance.now():Date.now()}_${Math.random().toString(36).substr(2,9)}_${Math.random().toString(36).substr(2,5)}`;this.sessionId=`session_${e}_${t}_${s}`}else this.config.sessionId?this.sessionId=this.config.sessionId:this.sessionId=this.generateSessionId();if("undefined"!=typeof window){const e=`__customgpt_widget_${this.sessionId}`;window[e]=this,window.__customgpt_widget_instance||(window.__customgpt_widget_instance=this),this.instanceKey=e}this.init()}generateSessionId(){return`session_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}async init(){o.useConfigStore.getState().setApiKey(this.config.apiKey),this.config.enableConversationManagement&&(this.config.isolateConversations?(window.__customgpt_sessions||(window.__customgpt_sessions={}),window.__customgpt_sessions[this.sessionId]={sessionId:this.sessionId,maxConversations:this.config.maxConversations,enableConversationManagement:!0}):window.__customgpt_session={sessionId:this.sessionId,maxConversations:this.config.maxConversations,enableConversationManagement:!0});const e="demo-api-key"===this.config.apiKey||this.config.apiKey.startsWith("demo-")||this.config.apiKey.startsWith("test-");window.__customgpt_demo_mode=!!e;const t="string"==typeof this.config.agentId?parseInt(this.config.agentId):this.config.agentId;if(e){const e={id:t,project_name:this.config.agentName||"Demo Assistant",is_chat_active:!0};o.useAgentStore.getState().selectAgent(e),o.useAgentStore.getState().setAgents([e])}else try{const e=(0,Y.KU)(),s=await e.getAgents(),n=(Array.isArray(s)?s:s.data||[]).find(e=>e.id===t);if(n)this.config.agentName&&(n.project_name=this.config.agentName),o.useAgentStore.getState().selectAgent(n),o.useAgentStore.getState().setAgents([n]);else{const e={id:t,project_name:this.config.agentName||`Project ${t}`,is_chat_active:!0};o.useAgentStore.getState().selectAgent(e),o.useAgentStore.getState().setAgents([e])}}catch(e){const s={id:t,project_name:this.config.agentName||`Project ${t}`,is_chat_active:!0};o.useAgentStore.getState().selectAgent(s),o.useAgentStore.getState().setAgents([s])}if(this.createContainer(),this.render(),this.config.enableConversationManagement){const e=this.getConversations();if(0===e.length)setTimeout(()=>{this.createConversation("New Chat")},100);else if(this.currentConversationId=e[0].id,!1===this.config.isolateConversations&&"undefined"!=typeof window){const{useConversationStore:t}=s(7874),n=e[0],a={...n,project_id:parseInt(this.config.agentId)||0,session_id:this.sessionId,name:n.title};t.setState({conversations:[a],currentConversation:a})}}!1!==this.config.isolateConversations&&"undefined"!=typeof window&&(window.__customgpt_widget_instances=window.__customgpt_widget_instances||{},window.__customgpt_widget_instances[this.sessionId]=this,window.__customgpt_active_widget_session=this.sessionId)}createContainer(){const{mode:e,containerId:t}=this.config;if("embedded"===e&&t){if(this.container=document.getElementById(t),!this.container)throw new Error(`Container with id "${t}" not found`)}else"floating"===e?(this.container=document.createElement("div"),this.container.id="customgpt-floating-widget",this.setupFloatingStyles(),document.body.appendChild(this.container)):(this.container=document.createElement("div"),this.container.id="customgpt-widget",document.body.appendChild(this.container))}setupFloatingStyles(){if(!this.container||"floating"!==this.config.mode)return;const{position:e,width:t,height:s}=this.config;switch(Object.assign(this.container.style,{position:"fixed",zIndex:"9999",width:t||"400px",height:s||"600px",boxShadow:"0 10px 25px rgba(0, 0, 0, 0.2)",borderRadius:"12px",overflow:"hidden",transition:"all 0.3s ease",backgroundColor:"white"}),this.container.classList.add("floating-mode"),this.container.classList.add("customgpt-floating-container"),e){case"bottom-right":Object.assign(this.container.style,{bottom:"20px",right:"20px"});break;case"bottom-left":Object.assign(this.container.style,{bottom:"20px",left:"20px"});break;case"top-right":Object.assign(this.container.style,{top:"20px",right:"20px"});break;case"top-left":Object.assign(this.container.style,{top:"20px",left:"20px"})}this.container.style.display="none",this.container.style.opacity="0",this.container.style.transform="translateY(20px)"}render(){if(!this.container)return;"embedded"===this.config.mode&&(this.container.classList.add("customgpt-embedded-widget"),Object.assign(this.container.style,{width:this.config.width||"400px",height:this.config.height||"600px",margin:"0 auto",display:"block"})),this.root||(this.root=(0,a.H)(this.container));const e=()=>{"undefined"==typeof window||window.__customgpt_widget_instance||(window.__customgpt_widget_instance=this);const e=this.currentConversationId||this.config.threadId;this.sessionId;return(0,b.jsx)(ne,{sessionId:this.sessionId,children:(0,b.jsx)(be,{widgetInstance:this,children:(0,b.jsxs)("div",{className:`customgpt-widget-wrapper widget-mode ${this.config.mode}-mode`,children:[(0,b.jsx)(Ke,{mode:"embedded"===this.config.mode?"widget":"floating",onClose:"floating"===this.config.mode?()=>{this.close(),this.config.onClose?.()}:void 0,showSidebar:!1,className:"w-full h-full",enableConversationManagement:this.config.enableConversationManagement,maxConversations:this.config.maxConversations,sessionId:this.sessionId,threadId:e,onConversationChange:this.config.onConversationChange,onMessage:this.config.onMessage,widgetInstance:!1!==this.config.isolateConversations?this:void 0,conversations:!1!==this.config.isolateConversations?this.getConversations():void 0,currentConversation:!1!==this.config.isolateConversations&&this.currentConversationId?this.getConversations().find(e=>e.id===this.currentConversationId):void 0,conversationRefreshKey:this.conversationRefreshKey}),(0,b.jsx)(r.l$,{position:"top-center",toastOptions:{style:{zIndex:1e4}}})]})})})};this.root.render((0,b.jsx)(e,{})),"embedded"===this.config.mode&&this.open()}getConversations(){const e=localStorage.getItem(`customgpt_conversations_${this.sessionId}`);if(e)try{return JSON.parse(e)}catch(e){}return[]}switchConversation(e){const t=this.getConversations().find(t=>t.id===e);if(t){if(this.currentConversationId=e,this.conversationRefreshKey++,!this.config.isolateConversations&&"undefined"!=typeof window){const{useConversationStore:t}=s(7874),n=this.getConversations().map(e=>({...e,project_id:parseInt(this.config.agentId)||0,session_id:this.sessionId,name:e.title})),a=n.find(t=>t.id===e);t.setState({conversations:n,currentConversation:a})}this.render(),this.config.onConversationChange?.(t)}}createConversation(e){const t=this.getConversations();if(this.config.maxConversations&&t.length>=this.config.maxConversations)return null;const n={id:`conv_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,title:e||`Conversation ${t.length+1}`,createdAt:(new Date).toISOString(),messages:[],project_id:parseInt(this.config.agentId)||0,session_id:this.sessionId,name:e||`Conversation ${t.length+1}`};if(t.unshift(n),this.saveConversations(t),this.currentConversationId=n.id,!this.config.isolateConversations&&"undefined"!=typeof window){const{useConversationStore:e,useMessageStore:t}=s(7874),a=t.getState(),r=this.getConversations().map(e=>({...e,project_id:parseInt(this.config.agentId)||0,session_id:this.sessionId,name:e.title}));e.setState({conversations:r,currentConversation:n}),a.clearMessages(n.id)}return this.conversationRefreshKey++,this.render(),n}updateConversationTitle(e,t){const s=this.getConversations(),n=s.find(t=>t.id===e);n&&(n.title=t,this.saveConversations(s),this.conversationRefreshKey++,this.render())}deleteConversation(e){const t=this.getConversations().filter(t=>t.id!==e);this.saveConversations(t),this.conversationRefreshKey++,this.currentConversationId===e?t.length>0?this.switchConversation(t[0].id):this.createConversation():this.render()}saveConversations(e){try{localStorage.setItem(`customgpt_conversations_${this.sessionId}`,JSON.stringify(e))}catch(e){e instanceof DOMException&&"QuotaExceededError"===e.name&&this.cleanupOldConversations()}}cleanupOldConversations(){const e=this.getConversations().slice(0,3);this.saveConversations(e)}open(){this.container&&(this.isOpen=!0,"floating"===this.config.mode&&(this.container.style.display="block",setTimeout(()=>{this.container&&(this.container.style.transform="translateY(0)",this.container.style.opacity="1")},10)),this.config.onOpen?.())}close(){this.container&&(this.isOpen=!1,"floating"===this.config.mode&&(this.container.style.transform="translateY(20px)",this.container.style.opacity="0",setTimeout(()=>{this.container&&(this.container.style.display="none")},300)))}toggle(){this.isOpen?this.close():this.open()}destroy(){this.root&&this.root.unmount(),this.container&&this.container.parentNode&&this.container.parentNode.removeChild(this.container),this.container=null,this.root=null}updateConfig(e){this.config={...this.config,...e},this.render()}refresh(){this.render()}get isOpened(){return this.isOpen}get configuration(){return{...this.config}}}const Je={init:e=>new Ge(e),create:e=>new Ge(e)};"undefined"!=typeof window&&(window.CustomGPTWidget=Je);const Ve=Je},4974:(e,t,s)=>{s.d(t,{KU:()=>l,kV:()=>d,uQ:()=>g});var n=s(7047),a=s(5772);function r(e,t,s){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var s=e[Symbol.toPrimitive];if(void 0!==s){var n=s.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}class o{constructor(e){r(this,"baseURL",void 0),r(this,"apiKey",void 0),r(this,"timeout",void 0),r(this,"retryAttempts",void 0),r(this,"retryDelay",void 0),r(this,"abortControllers",new Map),this.apiKey=e.apiKey,this.baseURL=e.baseURL||"https://app.customgpt.ai/api/v1",this.timeout=e.timeout||3e4,this.retryAttempts=e.retryAttempts||3,this.retryDelay=e.retryDelay||1e3,a.v.info("API_CLIENT","CustomGPT API Client initialized",{baseURL:this.baseURL,timeout:this.timeout,hasApiKey:!!this.apiKey,apiKeyPreview:this.apiKey?`${this.apiKey.substring(0,10)}...`:"none"})}async request(e,t={}){const{timeout:s=this.timeout,retryAttempts:r=this.retryAttempts,params:o,...c}=t,l=new URL(`${this.baseURL}${e}`);o&&Object.entries(o).forEach(([e,t])=>{null!=t&&l.searchParams.append(e,t.toString())});const d={Authorization:`Bearer ${this.apiKey}`,Accept:"application/json",...c.headers};c.body instanceof FormData||(d["Content-Type"]="application/json");const g={...c,headers:d};return a.v.apiRequest(e,c.method||"GET",{url:l.toString(),headers:{...d,Authorization:`Bearer ${this.apiKey.substring(0,10)}...`},body:c.body?"string"==typeof c.body?JSON.parse(c.body):"FormData":void 0}),(0,n.ZB)(async()=>{const t=new AbortController,n=this.generateRequestId();this.abortControllers.set(n,t);const r=setTimeout(()=>{t.abort()},s);try{const s=await fetch(l.toString(),{...g,signal:t.signal});if(clearTimeout(r),this.abortControllers.delete(n),!s.ok){const t=await s.text();let n,r;try{const e=JSON.parse(t);e.data&&e.data.code&&e.data.message?(n=e.data.message,r=e.data.code.toString()):(n=e.message||e.error||"Unknown error",r=e.code?.toString())}catch{n=t||`HTTP ${s.status}`}const o=this.getEnhancedErrorMessage(s.status,n,r);throw a.v.apiError(e,{status:s.status,message:o,originalMessage:n,errorCode:r,headers:Object.fromEntries(s.headers.entries())}),new i(s.status,o,r)}const o=await s.json();return a.v.apiResponse(e,s.status,{headers:Object.fromEntries(s.headers.entries()),dataPreview:JSON.stringify(o).substring(0,200)+"..."}),o}catch(e){if(clearTimeout(r),this.abortControllers.delete(n),e instanceof i)throw e;if(e instanceof Error&&"AbortError"===e.name)throw new i(408,"Request timeout");throw new i(0,e instanceof Error?e.message:"Network error")}},r,this.retryDelay)}async streamRequest(e,t={},s={}){const{timeout:r=6e4,params:o,...c}=t,{onChunk:l,onComplete:d,onError:g}=s;a.v.info("API_CLIENT","Starting stream request",{endpoint:e,method:t.method||"GET",hasBody:!!c.body,bodyContent:c.body?"string"==typeof c.body?JSON.parse(c.body):"FormData":void 0});const u=new URL(`${this.baseURL}${e}`);u.searchParams.append("stream","1"),u.searchParams.append("lang","en"),o&&Object.entries(o).forEach(([e,t])=>{null!=t&&u.searchParams.append(e,t.toString())});const m=new AbortController,h=this.generateRequestId();this.abortControllers.set(h,m);const p=setTimeout(()=>{m.abort()},r);try{a.v.apiRequest(e,c.method||"POST",{url:u.toString(),headers:{Authorization:`Bearer ${this.apiKey.substring(0,10)}...`,"Content-Type":"application/json",Accept:"text/event-stream"},body:c.body?JSON.parse(c.body):void 0});const t=await fetch(u.toString(),{...c,headers:{Authorization:`Bearer ${this.apiKey}`,"Content-Type":"application/json",Accept:"text/event-stream",...c.headers},signal:m.signal});if(!t.ok){const s=await t.text();let n,r;try{const e=JSON.parse(s);e.data&&e.data.code&&e.data.message?(n=e.data.message,r=e.data.code.toString()):(n=e.message||e.error||"Unknown error",r=e.code?.toString())}catch{n=s||`HTTP ${t.status}`}const o=this.getEnhancedErrorMessage(t.status,n,r);throw a.v.apiError(e,{status:t.status,message:o,originalMessage:n,errorCode:r,headers:Object.fromEntries(t.headers.entries())}),new i(t.status,o,r)}a.v.apiResponse(e,t.status,{headers:Object.fromEntries(t.headers.entries()),contentType:t.headers.get("content-type"),isEventStream:t.headers.get("content-type")?.includes("text/event-stream")});const s=t.body?.getReader();if(!s)throw new i(500,"No response body");const r=new TextDecoder;let o="";try{let e=!1;for(;;){const{done:t,value:i}=await s.read();if(t){if(a.v.info("STREAM","Stream ended",{hasReceivedData:e}),!e)return a.v.warn("STREAM","Stream ended without receiving any data - possible API issue"),void g?.(new Error("No data received from stream - the API may not support streaming or there was a connection issue"));d?.();break}o+=r.decode(i,{stream:!0});const c=o.split("\n");o=c.pop()||"";for(const t of c)if(t.trim()){e=!0,a.v.debug("STREAM","Raw SSE line received",{line:t.substring(0,200),fullLine:t,lineLength:t.length});const s=(0,n.RW)(t);if(s){if(a.v.debug("STREAM","Successfully parsed chunk",{type:s.type,hasContent:!!s.content,contentPreview:s.content?.substring(0,100),hasCitations:!!s.citations}),"done"===s.type)return a.v.info("STREAM","Stream completed with done signal"),void d?.();if("error"===s.type)return a.v.error("STREAM","Stream error received",{error:s.error}),void g?.(new Error(s.error||"Stream error"));l?.(s)}else a.v.warn("STREAM","Failed to parse chunk or chunk was null",{originalLine:t.substring(0,200)})}}}finally{s.releaseLock()}}catch(e){e instanceof i?g?.(e):e instanceof Error&&"AbortError"===e.name?g?.(new i(408,"Request timeout")):g?.(new i(0,e instanceof Error?e.message:"Network error"))}finally{clearTimeout(p),this.abortControllers.delete(h)}}cancelRequest(e){const t=this.abortControllers.get(e);t&&(t.abort(),this.abortControllers.delete(e))}cancelAllRequests(){this.abortControllers.forEach(e=>e.abort()),this.abortControllers.clear()}generateRequestId(){return Math.random().toString(36).substring(2)+Date.now().toString(36)}getEnhancedErrorMessage(e,t,s){switch(e){case 400:return t.includes("Agent id must be integer")?"Invalid agent ID provided. Please ensure you have selected a valid agent.":t.includes("Agent name can't be empty")?"Agent name cannot be empty. Please provide a valid agent name.":"Invalid request data. Please check your input and try again.";case 401:return t.includes("API Token is either missing or invalid")?"Authentication failed. Your API key is missing or invalid. Please check your API key in settings and ensure it has proper permissions.":"Authentication failed. Please check your API key and try again.";case 403:return t.includes("license")?"You do not have permission to manage licenses for this agent. Please ensure your API key has the necessary permissions or you are the owner of this agent.":t.includes("Licenses are not allowed")?"License management is not enabled for this agent. Please enable licenses in the agent settings first.":"Access denied. You do not have permission to perform this action. Please check your API key permissions.";case 404:return t.includes("Agent with id")?"The selected agent was not found or you don't have access to it. Please select a different agent or check your permissions.":t.includes("Agent license with id")?"The specified license was not found. It may have been deleted or you may not have access to it.":t.includes("Conversation message with id")||t.includes("not found")?"The requested conversation or message was not found. It may have been deleted or you may not have access to it.":"The requested resource was not found. Please check if it exists and you have access to it.";case 429:return t.includes("exhausted your current query credits")?"You have reached your query limit. Please upgrade your plan or contact customer support at https://customgpt.freshdesk.com/support/home for assistance.":"Rate limit exceeded. Please wait a moment and try again, or contact support if you need higher limits.";case 500:return t.includes("Internal Server Error")?"Server error occurred. Please try again in a few moments. If the problem persists, contact customer support.":"An unexpected server error occurred. Please try again later.";case 501:return t.includes("audio is not yet supported")?"Audio files are not currently supported. Please remove any audio files from your request and try again with text or other supported file types.":"This feature is not yet implemented. Please try a different approach.";case 408:return"Request timed out. Please check your internet connection and try again.";case 422:return t.includes("Agent id must be integer")?"Invalid agent ID format. Please ensure the agent ID is a valid number.":"Invalid data provided. Please check your input and ensure all required fields are correctly formatted.";default:return e>=500?`Server error (${e}): ${t}. Please try again later.`:e>=400?`Request error (${e}): ${t}. Please check your input and try again.`:t}}async getAgents(e){return this.request("/projects",{params:e})}async createAgent(e){const t=new FormData;return t.append("project_name",e.project_name),e.sitemap_path&&t.append("sitemap_path",e.sitemap_path),e.files&&e.files.length>0&&e.files.forEach((e,s)=>{t.append(`files[${s}]`,e)}),void 0!==e.is_shared&&t.append("is_shared",e.is_shared.toString()),this.request("/projects",{method:"POST",body:t})}async getAgent(e){return this.request(`/projects/${e}`)}async updateAgent(e,t){const s=new FormData;return void 0!==t.are_licenses_allowed&&s.append("are_licenses_allowed",t.are_licenses_allowed.toString()),this.request(`/projects/${e}`,{method:"POST",body:s})}async deleteAgent(e){return this.request(`/projects/${e}`,{method:"DELETE"})}async replicateAgent(e){return this.request(`/projects/${e}/replicate`,{method:"POST"})}async getAgentStats(e){return this.request(`/projects/${e}/stats`)}async getAgentSettings(e){return this.request(`/projects/${e}/settings`)}async updateAgentSettings(e,t){const s=t instanceof FormData;return this.request(`/projects/${e}/settings`,{method:"POST",body:s?t:JSON.stringify(t)})}async getConversations(e,t){const s={...t,userFilter:t?.userFilter||"all"};return this.request(`/projects/${e}/conversations`,{params:s})}async createConversation(e,t){return this.request(`/projects/${e}/conversations`,{method:"POST",body:t?JSON.stringify(t):JSON.stringify({})})}async updateConversation(e,t,s){return this.request(`/projects/${e}/conversations/${t}`,{method:"PUT",body:JSON.stringify(s)})}async deleteConversation(e,t){return this.request(`/projects/${e}/conversations/${t}`,{method:"DELETE"})}async getMessages(e,t,s){const n={...s,stream:!1,lang:"en"};return this.request(`/projects/${e}/conversations/${t}/messages`,{params:n})}async sendMessage(e,t,s){const n={prompt:s.prompt,response_source:s.response_source||"default",custom_persona:s.custom_persona,chatbot_model:s.chatbot_model,stream:0};return Object.keys(n).forEach(e=>{void 0===n[e]&&delete n[e]}),this.request(`/projects/${e}/conversations/${t}/messages`,{method:"POST",body:JSON.stringify(n),params:{stream:!1,lang:"en"}})}async sendMessageStream(e,t,s,n){const r={prompt:s.prompt,response_source:s.response_source||"default",custom_persona:s.custom_persona,chatbot_model:s.chatbot_model,stream:1};return Object.keys(r).forEach(e=>{void 0===r[e]&&delete r[e]}),a.v.info("API_CLIENT","Sending streaming message",{projectId:e,sessionId:t,prompt:s.prompt.substring(0,50),hasCustomPersona:!!s.custom_persona,responseSource:r.response_source,streamParam:r.stream}),this.streamRequest(`/projects/${e}/conversations/${t}/messages`,{method:"POST",body:JSON.stringify(r),params:{stream:1,lang:"en"}},n)}async getMessageById(e,t,s){return this.request(`/projects/${e}/conversations/${t}/messages/${s}`)}async updateMessageFeedback(e,t,s,n){return this.request(`/projects/${e}/conversations/${t}/messages/${s}/feedback`,{method:"PUT",body:JSON.stringify(n)})}async sendMessageOpenAIFormat(e,t){return this.request(`/projects/${e}/chat/completions`,{method:"POST",body:JSON.stringify({...t,stream:t.stream??!1,lang:t.lang||"en",is_inline_citation:t.is_inline_citation??!1})})}async getCitation(e,t){return this.request(`/projects/${e}/citations/${t}`)}async uploadFile(e,t,s){const n=new FormData;return n.append("file",t),s&&Object.entries(s).forEach(([e,t])=>{void 0!==t&&n.append(e,t.toString())}),this.request(`/projects/${e}/sources`,{method:"POST",body:n})}async getConversationAnalytics(e,t){const s=new URLSearchParams;return t?.start_date&&s.append("start_date",t.start_date),t?.end_date&&s.append("end_date",t.end_date),t?.limit&&s.append("limit",t.limit.toString()),this.request(`/projects/${e}/analytics/conversations${s.toString()?`?${s}`:""}`)}async getQueryAnalytics(e,t){const s=new URLSearchParams;return t?.start_date&&s.append("start_date",t.start_date),t?.end_date&&s.append("end_date",t.end_date),t?.limit&&s.append("limit",t.limit.toString()),this.request(`/projects/${e}/analytics/queries${s.toString()?`?${s}`:""}`)}async getTrafficAnalytics(e,t){const s=new URLSearchParams;return t?.start_date&&s.append("start_date",t.start_date),t?.end_date&&s.append("end_date",t.end_date),t?.period&&s.append("period",t.period),this.request(`/projects/${e}/analytics/traffic${s.toString()?`?${s}`:""}`)}async getStatistics(e){return this.request(`/projects/${e}/analytics/statistics`)}async getTrafficReport(e){return this.request(`/projects/${e}/reports/traffic`,{method:"GET"})}async getQueriesReport(e){return this.request(`/projects/${e}/reports/queries`,{method:"GET"})}async getConversationsReport(e){return this.request(`/projects/${e}/reports/conversations`,{method:"GET"})}async getAnalysisReport(e,t){const s=new URLSearchParams;return t&&s.append("interval",t),this.request(`/projects/${e}/reports/analysis${s.toString()?`?${s}`:""}`,{method:"GET"})}async getPages(e,t){const s=new URLSearchParams;return t?.page&&s.append("page",t.page.toString()),t?.limit&&s.append("limit",t.limit.toString()),t?.order&&s.append("order",t.order),t?.crawl_status&&s.append("crawl_status",t.crawl_status),t?.index_status&&s.append("index_status",t.index_status),this.request(`/projects/${e}/pages${s.toString()?`?${s}`:""}`)}async deletePage(e,t){return this.request(`/projects/${e}/pages/${t}`,{method:"DELETE"})}async reindexPage(e,t){return this.request(`/projects/${e}/pages/${t}/reindex`,{method:"POST"})}async getPageMetadata(e,t){return this.request(`/projects/${e}/pages/${t}/metadata`,{method:"GET"})}async updatePageMetadata(e,t,s){return this.request(`/projects/${e}/pages/${t}/metadata`,{method:"PUT",body:JSON.stringify(s)})}async previewFile(e){return this.request(`/preview/${e}`)}async getLicenses(e){return this.request(`/projects/${e}/licenses`)}async createLicense(e,t){return this.request(`/projects/${e}/licenses`,{method:"POST",body:JSON.stringify(t)})}async getLicense(e,t){return this.request(`/projects/${e}/licenses/${t}`)}async updateLicense(e,t,s){return this.request(`/projects/${e}/licenses/${t}`,{method:"PUT",body:JSON.stringify(s)})}async deleteLicense(e,t){return this.request(`/projects/${e}/licenses/${t}`,{method:"DELETE"})}async getSources(e){return this.request(`/projects/${e}/sources`)}async createSitemapSource(e,t){return this.request(`/projects/${e}/sources`,{method:"POST",body:JSON.stringify(t)})}async uploadFileSource(e,t){return this.request(`/projects/${e}/sources`,{method:"POST",body:t})}async updateSourceSettings(e,t,s){return this.request(`/projects/${e}/sources/${t}`,{method:"PUT",body:JSON.stringify(s)})}async deleteSource(e,t){return this.request(`/projects/${e}/sources/${t}`,{method:"DELETE"})}async instantSyncSource(e,t){return this.request(`/projects/${e}/sources/${t}/instant-sync`,{method:"PUT"})}async getUserLimits(){return this.request("/limits/usage")}async getUserProfile(){return this.request("/user")}async updateUserProfile(e){return this.request("/user",{method:"POST",body:e})}async get(e){return this.request(e)}async post(e,t){return this.request(e,{method:"POST",body:t instanceof FormData?t:t?JSON.stringify(t):void 0})}async put(e,t){return this.request(e,{method:"PUT",body:t?JSON.stringify(t):void 0})}async delete(e){return this.request(e,{method:"DELETE"})}}class i extends Error{constructor(e,t,s,n){super(t),this.status=e,this.code=s,this.details=n,this.name="APIError"}}let c=null;function l(){if(!c)throw new Error("API client not initialized. Call initializeClient() first.");return c}function d(e){return c=new o(e),c}function g(){return null!==c}},5772:(e,t,s)=>{function n(e,t,s){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var s=e[Symbol.toPrimitive];if(void 0!==s){var n=s.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}s.d(t,{v:()=>r});class a{constructor(){n(this,"isClient",void 0),n(this,"logs",[]),this.isClient="undefined"!=typeof window}static getInstance(){return a.instance||(a.instance=new a),a.instance}formatMessage(e){const{timestamp:t,level:s,category:n,message:a,data:r,error:o,stack:i}=e;let c=`[${t}] [${s.toUpperCase()}] [${n}] ${a}`;return r&&(c+=`\nData: ${JSON.stringify(r,null,2)}`),o&&(c+=`\nError: ${o.message||o}`,i&&(c+=`\nStack: ${i}`)),c}writeToFile(e){}log(e,t,s,n,a){const r={timestamp:(new Date).toISOString(),level:e,category:t,message:s,data:n,error:a?{message:a.message,code:a.code,status:a.status}:void 0,stack:a?.stack};this.logs.push(r),this.logs.length>1e3&&(this.logs=this.logs.slice(-500));r.timestamp.split("T")[1].split(".")[0];if(this.isClient);else{}"debug"===e&&this.isClient||this.sendToServer(r)}async sendToServer(e){try{await fetch("/api/log",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})}catch(e){}}debug(e,t,s){this.log("debug",e,t,s)}info(e,t,s){this.log("info",e,t,s)}warn(e,t,s){this.log("warn",e,t,s)}error(e,t,s,n){this.log("error",e,t,n,s)}getLogs(){return this.logs}clearLogs(){this.logs=[]}apiRequest(e,t,s){this.info("API_REQUEST",`${t} ${e}`,s)}apiResponse(e,t,s){const n=t>=400?"error":"info";this.log(n,"API_RESPONSE",`${e} - Status: ${t}`,s)}apiError(e,t){this.error("API_ERROR",`Failed request to ${e}`,t)}authCheck(e,t){this.info("AUTH",e,t)}authError(e,t){this.error("AUTH_ERROR",e,t)}navigation(e,t){this.info("NAVIGATION",`Navigating to ${e}`,t)}storeAction(e,t,s){this.debug("STORE",`${e}.${t}`,s)}}n(a,"instance",void 0);const r=a.getInstance()},7047:(e,t,s)=>{s.d(t,{$C:()=>o,B6:()=>l,Ey:()=>d,I3:()=>c,OX:()=>p,RW:()=>u,ZB:()=>h,aH:()=>f,cn:()=>r,lW:()=>g,v7:()=>i});var n=s(3526),a=s(4799);s(8404);function r(...e){return(0,a.QP)((0,n.$)(e))}function o(){return Math.random().toString(36).substring(2)+Date.now().toString(36)}function i(e){if(0===e)return"0 Bytes";const t=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,t)).toFixed(2))+" "+["Bytes","KB","MB","GB"][t]}function c(e){const t=e.toLowerCase();return t.includes("pdf")||t.includes("word")||t.includes("doc")?"📄":t.includes("text")||t.includes("txt")?"📝":t.includes("image")?"🖼️":t.includes("video")?"🎥":t.includes("audio")?"🎵":t.includes("excel")||t.includes("sheet")?"📊":t.includes("powerpoint")||t.includes("presentation")?"📈":t.includes("json")?"📋":t.includes("csv")?"📊":t.includes("zip")||t.includes("rar")?"🗜️":"📎"}function l(e,t){return t.some(t=>e.toLowerCase().includes(t.toLowerCase()))}function d(e){const t=new Date(e),s=(new Date).getTime()-t.getTime(),n=Math.floor(s/6e4),a=Math.floor(s/36e5),r=Math.floor(s/864e5);return n<1?"Just now":n<60?`${n}m ago`:a<24?`${a}h ago`:r<7?`${r}d ago`:t.toLocaleDateString()}async function g(e){try{return await navigator.clipboard.writeText(e),!0}catch(e){return!1}}function u(e){try{if(e.startsWith("event: ")){return"finish"===e.slice(7).trim()?{type:"done"}:null}if(e.startsWith("data: ")){const t=e.slice(6).trim();if("[DONE]"===t||"DONE"===t)return{type:"done"};try{const e=JSON.parse(t);if("object"==typeof e){if(e.type)return e;if(void 0!==e.content)return{type:"content",content:e.content,citations:e.citations};if(e.citations&&!e.content)return{type:"citation",citations:e.citations};if(void 0!==e.message)return{type:"content",content:e.message,citations:e.citations};if(e.delta&&void 0!==e.delta.content)return{type:"content",content:e.delta.content,citations:e.citations};if(e.choices&&e.choices[0]&&e.choices[0].delta){const t=e.choices[0].delta;if(void 0!==t.content)return{type:"content",content:t.content,citations:e.citations}}}return e}catch(e){return{type:"content",content:t}}}if(e.trim().startsWith("{"))try{const t=JSON.parse(e.trim());return void 0!==t.content||void 0!==t.citations?{type:t.content?"content":"citation",content:t.content,citations:t.citations}:void 0!==t.message?{type:"content",content:t.message,citations:t.citations}:t}catch(e){}return!e.trim()||e.includes("data:")||e.startsWith("{")?null:{type:"content",content:e.trim()}}catch(e){return null}}function m(e){return new Promise(t=>setTimeout(t,e))}async function h(e,t=3,s=1e3){let n;for(let a=1;a<=t;a++)try{return await e()}catch(e){if(n=e,a===t)throw n;const r=s*Math.pow(2,a-1);await m(r)}throw n}function p(e){const t=e.trim().split(/\s+/).slice(0,6).join(" ");return t.length>50?t.substring(0,50).trim()+"...":t}const f={MAX_FILE_SIZE:10485760,ACCEPTED_FILE_TYPES:["application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","text/plain","text/csv","application/json","application/xml","image/jpeg","image/png","image/gif","image/webp"],MAX_MESSAGE_LENGTH:4e3,API_TIMEOUT:3e4,STREAM_TIMEOUT:6e4,RETRY_ATTEMPTS:3,RETRY_DELAY:1e3}},7292:(e,t,s)=>{s.d(t,{o:()=>o});var n=s(1446),a=s(5189),r=s(4974);const o=(0,n.vt)()((0,a.Zr)((e,t)=>({agents:[],currentAgent:null,loading:!1,error:null,fetchAgents:async()=>{e({loading:!0,error:null});try{const s=(0,r.KU)(),n=await s.getAgents();let a=[];n&&"object"==typeof n&&(Array.isArray(n.data)?a=n.data:Array.isArray(n)?a=n:n.data&&Array.isArray(n.data.data)&&(a=n.data.data)),e({agents:a,loading:!1,currentAgent:t().currentAgent||(a.length>0?a[0]:null)})}catch(t){e({agents:[],error:t instanceof Error?t.message:"Failed to fetch agents",loading:!1})}},createAgent:async t=>{e({loading:!0,error:null});try{const s=(0,r.KU)(),n=(await s.createAgent(t)).data;return e(e=>({agents:[n,...e.agents],currentAgent:n,loading:!1})),n}catch(t){throw e({error:t instanceof Error?t.message:"Failed to create agent",loading:!1}),t}},selectAgent:t=>{e({currentAgent:t})},setAgents:s=>{e({agents:s,currentAgent:(()=>{const e=t().currentAgent;if(!e)return s.length>0?s[0]:null;return s.find(t=>t.id===e.id)||(s.length>0?s[0]:null)})()})},updateAgent:async(t,s)=>{e({loading:!0,error:null});try{const n=(0,r.KU)(),a=(await n.updateAgent(t,s)).data;return e(e=>({agents:e.agents.map(e=>e.id===t?a:e),currentAgent:e.currentAgent?.id===t?a:e.currentAgent,loading:!1})),a}catch(t){throw e({error:t instanceof Error?t.message:"Failed to update agent",loading:!1}),t}},deleteAgent:async t=>{e({loading:!0,error:null});try{const s=(0,r.KU)();await s.deleteAgent(t),e(e=>{const s=e.agents.filter(e=>e.id!==t);return{agents:s,currentAgent:e.currentAgent?.id===t?s.length>0?s[0]:null:e.currentAgent,loading:!1}})}catch(t){throw e({error:t instanceof Error?t.message:"Failed to delete agent",loading:!1}),t}},replicateAgent:async t=>{e({loading:!0,error:null});try{const s=(0,r.KU)(),n=(await s.replicateAgent(t)).data;return e(e=>({agents:[n,...e.agents],currentAgent:n,loading:!1})),n}catch(t){throw e({error:t instanceof Error?t.message:"Failed to replicate agent",loading:!1}),t}},getAgentStats:async e=>{try{const t=(0,r.KU)();return(await t.getAgentStats(e)).data}catch(e){throw e}}}),{name:"customgpt-agents",partialize:e=>({currentAgent:e.currentAgent})}))},7874:(e,t,s)=>{s.r(t),s.d(t,{cleanupStores:()=>_,initializeStores:()=>A,useAgentStore:()=>i.o,useAnalyticsStore:()=>x,useConfigStore:()=>o,useConversationStore:()=>d,useLicenseStore:()=>C,useMessageStore:()=>h,usePageStore:()=>w,useProfileStore:()=>b,useProjectSettingsStore:()=>N,useSourceStore:()=>S,useUIStore:()=>p});var n=s(1446),a=s(5189),r=s(4974);const o=(0,n.vt)()((0,a.Zr)((e,t)=>({apiKey:null,baseURL:"https://app.customgpt.ai/api/v1",theme:"light",setApiKey:s=>{e({apiKey:s}),s&&(0,r.kV)({apiKey:s,baseURL:t().baseURL})},setBaseURL:s=>{e({baseURL:s});const{apiKey:n}=t();n&&(0,r.kV)({apiKey:n,baseURL:s})},setTheme:t=>{e({theme:t}),"undefined"!=typeof window&&(document.documentElement.className=t)}}),{name:"customgpt-config",partialize:e=>({apiKey:e.apiKey,baseURL:e.baseURL,theme:e.theme}),onRehydrateStorage:()=>e=>{e?.apiKey&&!(0,r.uQ)()&&(0,r.kV)({apiKey:e.apiKey,baseURL:e.baseURL}),e?.theme&&"undefined"!=typeof window&&(document.documentElement.className=e.theme)}}));var i=s(7292),c=s(7047),l=s(5772);const d=(0,n.vt)()((0,a.Zr)((e,t)=>({conversations:[],currentConversation:null,loading:!1,error:null,fetchConversations:async t=>{l.v.info("CONVERSATIONS","Fetching conversations",{projectId:t}),e({loading:!0,error:null});try{const s=(0,r.KU)(),n=await s.getConversations(t);l.v.info("CONVERSATIONS","API response received",{projectId:t,responseType:typeof n,hasData:!!n?.data,dataLength:Array.isArray(n?.data)?n.data.length:0});let a=[];n&&"object"==typeof n&&(Array.isArray(n.data)?a=n.data:Array.isArray(n)?a=n:n.data&&Array.isArray(n.data.data)&&(a=n.data.data)),l.v.info("CONVERSATIONS","Processed conversations",{count:a.length,conversations:a.map(e=>({id:e.id,name:e.name,messagesCount:e.messages?.length||0}))}),e({conversations:a,loading:!1})}catch(s){l.v.error("CONVERSATIONS","Failed to fetch conversations",s,{projectId:t,errorType:s instanceof Error?s.constructor.name:typeof s,status:s?.status,message:s?.message}),e({error:s instanceof Error?s.message:"Failed to fetch conversations",loading:!1})}},createConversation:async(t,s)=>{e({loading:!0,error:null});try{const n=(0,r.KU)(),a=(await n.createConversation(t,s?{name:s}:void 0)).data;e(e=>({conversations:[a,...e.conversations],currentConversation:a,loading:!1}))}catch(t){throw e({error:t instanceof Error?t.message:"Failed to create conversation",loading:!1}),t}},selectConversation:t=>{e({currentConversation:t})},deleteConversation:async s=>{const{conversations:n,currentConversation:a}=t(),o=n.find(e=>e.id.toString()===s.toString());if(o){e({loading:!0,error:null});try{const t=(0,r.KU)();await t.deleteConversation(o.project_id,o.session_id);const i=n.filter(e=>e.id.toString()!==s.toString());e({conversations:i,currentConversation:a?.id.toString()===s.toString()?i.length>0?i[0]:null:a,loading:!1})}catch(t){throw e({error:t instanceof Error?t.message:"Failed to delete conversation",loading:!1}),t}}},updateConversation:async(t,s,n)=>{e({loading:!0,error:null});try{const a=(0,r.KU)(),o=(await a.updateConversation(t,s,n)).data;e(e=>({conversations:e.conversations.map(e=>e.id===t?o:e),currentConversation:e.currentConversation?.id===t?o:e.currentConversation,loading:!1}))}catch(t){throw e({error:t instanceof Error?t.message:"Failed to update conversation",loading:!1}),t}},ensureConversation:async(s,n)=>{const{currentConversation:a,conversations:r}=t();if(a&&a.project_id===s)return a;const o=r.filter(e=>e.project_id===s);if(o.length>0){const t=o[0];return e({currentConversation:t}),t}const i=n?(0,c.OX)(n):`Chat ${(new Date).toLocaleDateString()}`;return await t().createConversation(s,i),t().currentConversation}}),{name:`customgpt-conversations-${(()=>{if("undefined"==typeof window)return"server-session";if(window.__customgpt_current_session)return window.__customgpt_current_session;if(window.__customgpt_session)return window.__customgpt_session.sessionId;if(window.__customgpt_sessions){const e=window.__customgpt_sessions,t=Object.keys(e);if(t.length>0)return t[t.length-1]}try{let e=sessionStorage.getItem("customgpt_session_id");return e||(e=`session_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,sessionStorage.setItem("customgpt_session_id",e)),e}catch(e){return`session_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}})()}`,partialize:e=>({conversations:e.conversations,currentConversation:e.currentConversation}),onRehydrateStorage:()=>e=>{e&&!Array.isArray(e.conversations)&&(e.conversations=[])}}));var g=s(3345);const u="customgpt-messages-cache";function m(e,t){try{const s=localStorage.getItem(u),n=s?JSON.parse(s):{};n[e]=t,localStorage.setItem(u,JSON.stringify(n))}catch(e){}}const h=(0,n.vt)((e,t)=>({messages:new Map,streamingMessage:null,isStreaming:!1,loading:!1,error:null,sendMessage:async(s,n)=>{"undefined"!=typeof window&&window.__customgpt_demo_mode;const a=i.o.getState(),o=d.getState(),{currentAgent:g}=a;if(!g)throw l.v.error("MESSAGES","No agent selected when trying to send message"),new Error("No agent selected");l.v.info("MESSAGES","Sending message",{agentId:g.id,agentName:g.project_name,messageLength:s.length,hasFiles:n&&n.length>0});const u=await o.ensureConversation(g.id,s);if(l.v.info("MESSAGES","Conversation ensured",{conversationId:u.id,sessionId:u.session_id,hasSessionId:!!u.session_id,isNew:!u.message_count||0===u.message_count}),!u.session_id)throw l.v.error("MESSAGES","Conversation missing session_id",{conversation:u}),new Error("Conversation missing session_id");e({loading:!0,error:null});const m={id:(0,c.$C)(),role:"user",content:s,timestamp:(new Date).toISOString(),status:"sending"};t().addMessage(u.id.toString(),m);const h={id:(0,c.$C)(),role:"assistant",content:"",timestamp:(new Date).toISOString(),citations:[]};e({streamingMessage:h,isStreaming:!0,loading:!1});try{if(n&&n.length>0){const e=(0,r.KU)();await Promise.all(n.map(t=>e.uploadFile(g.id,t)))}m.status="sent",t().addMessage(u.id.toString(),m);const a=(0,r.KU)();l.v.info("MESSAGES","Starting message stream",{agentId:g.id,sessionId:u.session_id,messageContent:s.substring(0,50)});try{await a.sendMessageStream(g.id,u.session_id,{prompt:s,response_source:"default",stream:1},{onChunk:s=>{if(l.v.debug("MESSAGES","Received stream chunk",{type:s.type,hasContent:!!s.content,contentLength:s.content?.length,contentPreview:s.content?.substring(0,50)}),"content"===s.type&&s.content)t().updateStreamingMessage(s.content,s.citations);else if("citation"===s.type&&s.citations){const n=t().streamingMessage;n&&e({streamingMessage:{...n,citations:s.citations}})}},onComplete:()=>{const s=t().streamingMessage;s&&(s.status="sent",t().addMessage(u.id.toString(),s)),e({streamingMessage:null,isStreaming:!1})},onError:async n=>{l.v.error("MESSAGES","Streaming failed, attempting fallback to non-streaming",n,{errorMessage:n.message,agentId:g.id,sessionId:u.session_id});try{l.v.info("MESSAGES","Using non-streaming fallback");const n=await a.sendMessage(g.id,u.session_id,{prompt:s,response_source:"default",stream:0}),r=t().streamingMessage;if(r&&n){let e;e=n.data?n.data:n,r.content=e?.openai_response||e?.content||"No response received",r.citations=e?.citations||[],r.status="sent",t().addMessage(u.id.toString(),r)}e({streamingMessage:null,isStreaming:!1}),l.v.info("MESSAGES","Fallback to non-streaming successful")}catch(s){l.v.error("MESSAGES","Both streaming and non-streaming failed",s);const n=t().streamingMessage;n&&(n.content="Sorry, I encountered an error while processing your message. Please try again.",n.status="error",t().addMessage(u.id.toString(),n)),e({streamingMessage:null,isStreaming:!1,error:`Communication error: ${s instanceof Error?s.message:"Unknown error"}`})}}})}catch(e){throw l.v.error("MESSAGES","Failed to setup streaming",e),e}}catch(s){throw l.v.error("MESSAGES","Failed to send message",s,{errorType:s instanceof Error?s.constructor.name:typeof s,errorMessage:s instanceof Error?s.message:String(s),stack:s instanceof Error?s.stack:void 0,agentId:g.id,conversationId:u.id,sessionId:u.session_id}),m.status="error",t().addMessage(u.id.toString(),m),e({streamingMessage:null,isStreaming:!1,error:s instanceof Error?s.message:"Failed to send message",loading:!1}),s}},addMessage:(t,s)=>{e(e=>{const n=new Map(e.messages),a=n.get(t)||[],r=a.findIndex(e=>e.id===s.id);return r>=0?a[r]=s:a.push(s),n.set(t,a),m(t,a),{messages:n}})},updateStreamingMessage:(t,s)=>{e(e=>e.streamingMessage?{streamingMessage:{...e.streamingMessage,content:e.streamingMessage.content+t,citations:s||e.streamingMessage.citations}}:e)},clearMessages:t=>{e(e=>{if(t){const s=new Map(e.messages);return s.delete(t),{messages:s}}return{messages:new Map}})},updateMessageFeedback:async(e,s)=>{const n=i.o.getState(),a=d.getState(),{currentAgent:r}=n,{currentConversation:o}=a;if(!r||!o)return;const c=(t().messages.get(o.id.toString())||[]).find(t=>t.id===e);if(c)try{const e={...c,feedback:s};t().addMessage(o.id.toString(),e)}catch(e){t().addMessage(o.id.toString(),c)}},getMessagesForConversation:e=>t().messages.get(e)||[],cancelStreaming:()=>{g.Hr.cancelAllStreams(),e({streamingMessage:null,isStreaming:!1})},loadMessages:async t=>{if("undefined"!=typeof window&&window.__customgpt_demo_mode)return l.v.info("MESSAGES","Skipping message load in demo mode",{conversationId:t}),void e(e=>{const s=new Map(e.messages);return s.has(t)||s.set(t,[]),{messages:s,loading:!1}});if(t.startsWith("conv_"))return l.v.info("MESSAGES","Skipping API load for local conversation",{conversationId:t}),void e(e=>{const s=new Map(e.messages);return s.has(t)||s.set(t,[]),{messages:s,loading:!1}});const s=i.o.getState(),n=d.getState(),{currentAgent:a}=s,{conversations:o}=n;if(!a)return void l.v.warn("MESSAGES","No current agent when loading messages",{conversationId:t});const c=o.find(e=>e.id.toString()===t);if(!c)return l.v.error("MESSAGES","Conversation not found in store",{conversationId:t,availableConversations:o.map(e=>e.id)}),void e(e=>{const s=new Map(e.messages);return s.has(t)||s.set(t,[]),{messages:s,loading:!1}});l.v.info("MESSAGES","Loading messages for conversation",{conversationId:t,sessionId:c.session_id,agentId:a.id,agentName:a.project_name}),e({loading:!0,error:null});try{const s=(0,r.KU)(),n=await s.getMessages(a.id,c.session_id);l.v.info("MESSAGES","Messages API response received",{conversationId:t,responseType:typeof n,hasData:!!n?.data,dataLength:Array.isArray(n?.data)?n.data.length:0});let o=[];n&&"object"==typeof n&&(n.data&&n.data.messages&&Array.isArray(n.data.messages.data)?o=n.data.messages.data:Array.isArray(n.data)?o=n.data:Array.isArray(n)?o=n:n.data&&Array.isArray(n.data.data)&&(o=n.data.data)),l.v.info("MESSAGES","Processing messages",{conversationId:t,messagesCount:o.length,messageTypes:o.map(e=>e.role||"unknown")});const i=[];Array.isArray(o)&&o.forEach(e=>{const t=e.created_at||e.timestamp||(new Date).toISOString();e.user_query&&i.push({id:`${e.id}-user`||`user-${Math.random()}`,role:"user",content:e.user_query,timestamp:t,status:"sent"}),e.openai_response&&i.push({id:`${e.id}-assistant`||`assistant-${Math.random()}`,role:"assistant",content:e.openai_response,citations:e.citations||[],timestamp:t,status:"sent",feedback:e.response_feedback?.reaction||e.feedback})}),l.v.info("MESSAGES","Messages formatted successfully",{conversationId:t,formattedCount:i.length}),e(e=>{const s=new Map(e.messages);return s.set(t,i),m(t,i),{messages:s,loading:!1}})}catch(s){l.v.error("MESSAGES","Failed to load messages",s,{conversationId:t,agentId:a.id,errorType:s instanceof Error?s.constructor.name:typeof s,status:s?.status,message:s?.message});const n=function(e){try{const t=localStorage.getItem(u);return t&&JSON.parse(t)[e]||null}catch(e){return null}}(t);n&&n.length>0?(l.v.info("MESSAGES","Using cached messages as fallback",{conversationId:t,messageCount:n.length}),e(e=>{const s=new Map(e.messages);return s.set(t,n),{messages:s,loading:!1,error:"Using cached messages (API unavailable)"}})):e({error:s instanceof Error?s.message:"Failed to load messages",loading:!1})}}})),p=(0,n.vt)()((0,a.Zr)(e=>({sidebarOpen:!0,settingsOpen:!1,theme:"light",fontSize:"md",setSidebarOpen:t=>{e({sidebarOpen:t})},setSettingsOpen:t=>{e({settingsOpen:t})},setTheme:t=>{e({theme:t}),"undefined"!=typeof window&&(document.documentElement.className=t)},setFontSize:t=>{if(e({fontSize:t}),"undefined"!=typeof window){const e=document.documentElement;switch(e.classList.remove("text-sm","text-base","text-lg"),t){case"sm":e.classList.add("text-sm");break;case"lg":e.classList.add("text-lg");break;default:e.classList.add("text-base")}}}}),{name:"customgpt-ui",partialize:e=>({sidebarOpen:e.sidebarOpen,theme:e.theme,fontSize:e.fontSize}),onRehydrateStorage:()=>e=>{if("undefined"!=typeof window&&e){document.documentElement.className=e.theme;const t=document.documentElement;switch(t.classList.remove("text-sm","text-base","text-lg"),e.fontSize){case"sm":t.classList.add("text-sm");break;case"lg":t.classList.add("text-lg");break;default:t.classList.add("text-base")}}}}));var f=s(1681);const y=e=>e.toISOString().split("T")[0],v=()=>{const e=new Date,t=new Date;return t.setDate(t.getDate()-30),{startDate:y(t),endDate:y(e)}},x=(0,n.vt)((e,t)=>({analytics:null,loading:!1,error:null,dateRange:v(),fetchAnalytics:async s=>{e({loading:!0,error:null});try{const n=(0,r.KU)(),{startDate:a,endDate:o}=t().dateRange,[i,c,l,d,g]=await Promise.all([n.getConversationAnalytics(s,{start_date:a,end_date:o}),n.getQueryAnalytics(s,{start_date:a,end_date:o}),n.getTrafficAnalytics(s,{start_date:a,end_date:o,period:"day"}),n.getStatistics(s),n.getAnalysisReport(s,"weekly")]),u={conversations:{total:i.data?.total||0,active:i.data?.active||0,trend:i.data?.trend||0,data:i.data?.timeline||[]},queries:{total:c.data?.total||0,successful:c.data?.successful||0,failed:c.data?.failed||0,avgResponseTime:c.data?.avg_response_time||0,topQueries:c.data?.top_queries||[],data:c.data?.timeline||[]},traffic:{uniqueUsers:l.data?.unique_users||0,pageViews:l.data?.page_views||0,avgSessionDuration:l.data?.avg_session_duration||0,bounceRate:l.data?.bounce_rate||0,data:l.data?.timeline||[]},statistics:{totalMessages:d.data?.total_messages||0,totalConversations:d.data?.total_conversations||0,avgMessagesPerConversation:d.data?.avg_messages_per_conversation||0,satisfactionRate:d.data?.satisfaction_rate||0,responseAccuracy:d.data?.response_accuracy||0}};e({analytics:u,loading:!1})}catch(t){e({analytics:null,error:t instanceof Error?t.message:"Failed to fetch analytics",loading:!1}),f.oR.error("Failed to fetch analytics data")}},setDateRange:(t,s)=>{e({dateRange:{startDate:t,endDate:s}})},exportAnalytics:async e=>{const s=t().analytics;if(s)try{switch(e){case"json":const e=JSON.stringify(s,null,2),t=new Blob([e],{type:"application/json"}),n=URL.createObjectURL(t),a=document.createElement("a");a.href=n,a.download=`analytics-${(new Date).toISOString()}.json`,document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(n),f.oR.success("Analytics exported successfully");break;case"csv":f.oR.info("CSV export not yet implemented");break;case"pdf":f.oR.info("PDF export not yet implemented")}}catch(e){f.oR.error("Failed to export analytics")}else f.oR.error("No analytics data to export")},reset:()=>{e({analytics:null,loading:!1,error:null,dateRange:v()})}})),w=(0,n.vt)((e,t)=>({pages:[],loading:!1,error:null,paginationInfo:{current_page:1,total:0,per_page:20,last_page:1},queryParams:{page:1,limit:20,order:"desc",crawl_status:"all",index_status:"all"},fetchPages:async s=>{if((0,r.uQ)()){e({loading:!0,error:null});try{const n=(0,r.KU)(),{queryParams:a}=t(),o=await n.getPages(s,a);e({pages:o.data.pages.data,paginationInfo:{current_page:o.data.pages.current_page,total:o.data.pages.total,per_page:o.data.pages.per_page,last_page:o.data.pages.last_page},loading:!1})}catch(t){let s="Failed to fetch pages";400===t.status?s="Invalid request. Please check the project ID.":401===t.status?s="Authentication failed. Please log in again.":404===t.status?s="Project not found.":500===t.status&&(s="Server error. Please try again later."),e({error:s,loading:!1}),f.oR.error(s)}}else e({error:"API client not initialized"})},deletePage:async(t,s)=>{if((0,r.uQ)()){e({loading:!0,error:null});try{const n=(0,r.KU)();await n.deletePage(t,s),e(e=>({pages:e.pages.filter(e=>e.id!==s),loading:!1})),f.oR.success("Page deleted successfully")}catch(t){let s="Failed to delete page";401===t.status?s="Authentication failed. Please log in again.":404===t.status&&(s="Page not found."),e({error:s,loading:!1}),f.oR.error(s)}}else f.oR.error("API client not initialized")},reindexPage:async(t,s)=>{if((0,r.uQ)()){e({loading:!0,error:null});try{const n=(0,r.KU)();await n.reindexPage(t,s),e(e=>({pages:e.pages.map(e=>e.id===s?{...e,crawl_status:"queued",index_status:"queued"}:e),loading:!1})),f.oR.success("Page reindexing started")}catch(t){let s="Failed to reindex page";401===t.status?s="Authentication failed. Please log in again.":403===t.status&&(s="The page could not be reindexed."),e({error:s,loading:!1}),f.oR.error(s)}}else f.oR.error("API client not initialized")},setQueryParams:t=>{e(e=>({queryParams:{...e.queryParams,...t}}))},reset:()=>{e({pages:[],loading:!1,error:null,paginationInfo:{current_page:1,total:0,per_page:20,last_page:1},queryParams:{page:1,limit:20,order:"desc",crawl_status:"all",index_status:"all"}})}})),S=(0,n.vt)((e,t)=>({sources:[],currentSource:null,loading:!1,error:null,searchQuery:"",filter:{status:"all",type:"all",sortBy:"updated_at",sortOrder:"desc"},syncStatus:{syncing:!1},fetchSources:async t=>{e({loading:!0,error:null});try{(0,r.KU)();throw e({sources:[],loading:!1}),new Error("Sources API integration needs update")}catch(t){e({error:t instanceof Error?t.message:"Failed to fetch sources",loading:!1}),f.oR.error("Failed to load sources")}},fetchSource:async(t,s)=>{e({loading:!0,error:null});try{throw new Error("getSource API method not available")}catch(t){e({error:t instanceof Error?t.message:"Failed to fetch source",loading:!1}),f.oR.error("Failed to load source details")}},uploadSources:async(s,n)=>{e({loading:!0,error:null});try{(0,r.KU)();const a=n.map(e=>Promise.reject(new Error("uploadFile API method not available")));await Promise.all(a);await t().fetchSources(s),f.oR.success(`Successfully uploaded ${n.length} file(s)`),e({loading:!1})}catch(t){throw e({error:t instanceof Error?t.message:"Failed to upload sources",loading:!1}),f.oR.error("Failed to upload files"),t}},updateSource:async(t,s,n)=>{e({loading:!0,error:null});try{(0,r.KU)();throw new Error("updateSource API method not available")}catch(t){throw e({error:t instanceof Error?t.message:"Failed to update source",loading:!1}),f.oR.error("Failed to update source"),t}},deleteSource:async(t,s)=>{e({loading:!0,error:null});try{const n=(0,r.KU)();await n.deleteSource(t,parseInt(s)),e(e=>({sources:e.sources.filter(e=>e.id!==s),currentSource:e.currentSource?.id===s?null:e.currentSource,loading:!1})),f.oR.success("Source deleted successfully")}catch(t){throw e({error:t instanceof Error?t.message:"Failed to delete source",loading:!1}),f.oR.error("Failed to delete source"),t}},bulkDelete:async(t,s)=>{e({loading:!0,error:null});try{const n=(0,r.KU)();await Promise.all(s.map(e=>n.deleteSource(t,parseInt(e)))),e(e=>({sources:e.sources.filter(e=>!s.includes(e.id)),currentSource:s.includes(e.currentSource?.id||"")?null:e.currentSource,loading:!1})),f.oR.success(`Successfully deleted ${s.length} source(s)`)}catch(t){throw e({error:t instanceof Error?t.message:"Failed to delete sources",loading:!1}),f.oR.error("Failed to delete sources"),t}},syncSources:async t=>{e(e=>({syncStatus:{...e.syncStatus,syncing:!0,progress:0}}));try{(0,r.KU)();throw new Error("syncSources API method not available")}catch(t){throw e(e=>({syncStatus:{...e.syncStatus,syncing:!1},error:t instanceof Error?t.message:"Failed to sync sources"})),f.oR.error("Failed to sync sources"),t}},setSearchQuery:t=>{e({searchQuery:t})},setFilter:t=>{e(e=>({filter:{...e.filter,...t}}))},selectSource:t=>{e({currentSource:t})},reset:()=>{e({sources:[],currentSource:null,loading:!1,error:null,searchQuery:"",filter:{status:"all",type:"all",sortBy:"updated_at",sortOrder:"desc"},syncStatus:{syncing:!1}})}})),b=(0,n.vt)()((0,a.Zr)((e,t)=>({profile:null,loading:!1,error:null,fetchProfile:async()=>{e({loading:!0,error:null});try{const t=(0,r.KU)(),s=await t.get("/user");if("success"!==s.status)throw new Error("Failed to fetch profile");e({profile:s.data,loading:!1})}catch(t){e({error:`Failed to fetch profile: ${t instanceof Error?t.message:"Unknown error"}`,loading:!1}),f.oR.error("Failed to load profile")}},updateProfile:async(t,s)=>{e({loading:!0,error:null});try{const n=(0,r.KU)(),a=new FormData;a.append("name",t),s&&a.append("profile_photo",s);const o=await n.post("/user",a);if("success"!==o.status)throw new Error("Failed to update profile");e({profile:o.data,loading:!1}),f.oR.success("Profile updated successfully")}catch(t){e({error:`Failed to update profile: ${t instanceof Error?t.message:"Unknown error"}`,loading:!1}),f.oR.error("Failed to update profile")}},reset:()=>{e({profile:null,loading:!1,error:null})}}),{name:"profile-store",partialize:e=>({profile:e.profile})})),j=new Map,N=(0,n.vt)((e,t)=>({settings:null,settingsLoading:!1,settingsError:null,plugins:[],pluginsLoading:!1,pluginsError:null,stats:null,statsLoading:!1,statsError:null,fetchSettings:async t=>{const s=`settings-${t}`;if(!j.get(s)){j.set(s,!0),e({settingsLoading:!0,settingsError:null});try{const s=await(0,r.KU)().get(`/projects/${t}/settings`);if(200!==s.status)throw new Error("Failed to fetch project settings");e({settings:s.data,settingsLoading:!1,settingsError:null})}catch(t){const s=t instanceof Error?t.message:"Failed to fetch project settings";e({settingsError:s,settingsLoading:!1}),t instanceof Error&&!t.message.includes("404")&&f.oR.error(s)}finally{j.delete(s)}}},updateSettings:async(s,n)=>{e({settingsLoading:!0,settingsError:null});try{const a=new FormData;Object.entries(n).forEach(([e,t])=>{null!=t&&("example_questions"===e&&Array.isArray(t)?t.forEach((e,t)=>{a.append(`example_questions[${t}]`,e)}):t instanceof File?a.append(e,t):a.append(e,String(t)))});const o=await(0,r.KU)().post(`/projects/${s}/settings`,a);if(200!==o.status||!o.data.updated)throw new Error("Failed to update project settings");{const s={...t().settings||{},...n};e({settings:s,settingsLoading:!1}),f.oR.success("Project settings updated successfully")}}catch(t){const s=t instanceof Error?t.message:"Failed to update project settings";e({settingsError:s,settingsLoading:!1}),f.oR.error(s)}},fetchPlugins:async t=>{e({pluginsLoading:!0,pluginsError:null});try{const s=await(0,r.KU)().get(`/projects/${t}/plugins`);if(200!==s.status)throw new Error("Failed to fetch project plugins");e({plugins:Array.isArray(s.data)?s.data:[],pluginsLoading:!1})}catch(t){const s=t instanceof Error?t.message:"Failed to fetch project plugins";e({pluginsError:s,pluginsLoading:!1,plugins:[]})}},updatePlugin:async(s,n,a)=>{try{if(200!==(await(0,r.KU)().put(`/projects/${s}/plugins/${n}`,{enabled:a})).status)throw new Error("Failed to update plugin");{const s=t().plugins.map(e=>e.id===n?{...e,enabled:a}:e);e({plugins:s}),f.oR.success(`Plugin ${a?"enabled":"disabled"} successfully`)}}catch(e){const t=e instanceof Error?e.message:"Failed to update plugin";f.oR.error(t)}},fetchStats:async t=>{e({statsLoading:!0,statsError:null});try{const s=await(0,r.KU)().get(`/projects/${t}/stats`);if(200!==s.status)throw new Error("Failed to fetch project stats");e({stats:s.data,statsLoading:!1})}catch(t){const s=t instanceof Error?t.message:"Failed to fetch project stats";e({statsError:s,statsLoading:!1}),f.oR.error(s)}},reset:()=>{e({settings:null,settingsLoading:!1,settingsError:null,plugins:[],pluginsLoading:!1,pluginsError:null,stats:null,statsLoading:!1,statsError:null})}})),C=(0,n.vt)((e,t)=>({licenses:[],loading:!1,error:null,fetchLicenses:async t=>{e({loading:!0,error:null});try{const s=(0,r.KU)(),n=await s.getLicenses(t);l.v.info("LICENSES","API Response",{projectId:t,status:"success",responseType:typeof n,hasData:!!n?.data,dataType:Array.isArray(n?.data)?"array":typeof n?.data,dataLength:Array.isArray(n?.data)?n.data.length:0,fullResponse:n});const a=Array.isArray(n.data)?n.data:[];l.v.info("LICENSES","Processed licenses",{count:a.length,licenses:a.map(e=>({name:e.name,key:e.key?.substring(0,8)+"...",project_id:e.project_id}))}),e({licenses:a,loading:!1})}catch(s){l.v.error("LICENSES","Failed to fetch licenses",{projectId:t,errorType:s?.constructor?.name,errorMessage:s?.message,errorStatus:s?.status,errorCode:s?.code,fullError:s});const n=s instanceof Error?s.message:"Failed to fetch licenses";e({error:n,loading:!1,licenses:[]})}},createLicense:async(t,s)=>{e({loading:!0,error:null}),l.v.info("LICENSES","Creating license",{projectId:t,name:s});try{const n=(0,r.KU)(),a=await n.createLicense(t,{name:s});l.v.info("LICENSES","Create license API response",{projectId:t,name:s,status:"success",responseType:typeof a,hasData:!!a?.data,dataStructure:a?.data?Object.keys(a.data):[],licenseKey:a.data?.licenseKey?.substring(0,8)+"...",fullResponse:a});const o=a.data?.license||a.data;return o&&(l.v.info("LICENSES","New license created",{licenseName:o.name,licenseKey:o.key?.substring(0,8)+"...",project_id:o.project_id}),e(e=>({licenses:[...e.licenses,o],loading:!1}))),o}catch(n){l.v.error("LICENSES","Failed to create license",{projectId:t,name:s,errorType:n?.constructor?.name,errorMessage:n?.message,errorStatus:n?.status,errorCode:n?.code,fullError:n});const a=n instanceof Error?n.message:"Failed to create license";throw e({error:a,loading:!1}),n}},updateLicense:async(t,s,n)=>{e({loading:!0,error:null});try{const a=(0,r.KU)(),o=await a.updateLicense(t,s,{name:n});l.v.info("LICENSES","Updated license",{projectId:t,licenseId:s,name:n});(o.license||o.data)&&e(e=>({licenses:e.licenses.map(e=>e.key===s?{...e,name:n,updated_at:(new Date).toISOString()}:e),loading:!1}))}catch(t){l.v.error("LICENSES","Failed to update license",t);const s=t instanceof Error?t.message:"Failed to update license";throw e({error:s,loading:!1}),t}},deleteLicense:async(t,s)=>{e({loading:!0,error:null});try{const n=(0,r.KU)();await n.deleteLicense(t,s),l.v.info("LICENSES","Deleted license",{projectId:t,licenseId:s}),e(e=>({licenses:e.licenses.filter(e=>e.key!==s),loading:!1}))}catch(t){l.v.error("LICENSES","Failed to delete license",t);const s=t instanceof Error?t.message:"Failed to delete license";throw e({error:s,loading:!1}),t}},clearError:()=>{e({error:null})}}));function A(){}function _(){}}},s={};function n(e){var a=s[e];if(void 0!==a)return a.exports;var r=s[e]={exports:{}};return t[e].call(r.exports,r,r.exports,n),r.exports}n.m=t,e=[],n.O=(t,s,a,r)=>{if(!s){var o=1/0;for(d=0;d<e.length;d++){for(var[s,a,r]=e[d],i=!0,c=0;c<s.length;c++)(!1&r||o>=r)&&Object.keys(n.O).every(e=>n.O[e](s[c]))?s.splice(c--,1):(i=!1,r<o&&(o=r));if(i){e.splice(d--,1);var l=a();void 0!==l&&(t=l)}}return t}r=r||0;for(var d=e.length;d>0&&e[d-1][2]>r;d--)e[d]=e[d-1];e[d]=[s,a,r]},n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var s in t)n.o(t,s)&&!n.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e={30:0};n.O.j=t=>0===e[t];var t=(t,s)=>{var a,r,[o,i,c]=s,l=0;if(o.some(t=>0!==e[t])){for(a in i)n.o(i,a)&&(n.m[a]=i[a]);if(c)var d=c(n)}for(t&&t(s);l<o.length;l++)r=o[l],n.o(e,r)&&e[r]&&e[r][0](),e[r]=0;return n.O(d)},s=Object("undefined"!=typeof self?self:this).webpackChunkCustomGPTWidget=Object("undefined"!=typeof self?self:this).webpackChunkCustomGPTWidget||[];s.forEach(t.bind(null,0)),s.push=t.bind(null,s.push.bind(s))})();var a=n.O(void 0,[96],()=>n(4276));return a=(a=n.O(a)).default})());
//# sourceMappingURL=customgpt-widget.js.map