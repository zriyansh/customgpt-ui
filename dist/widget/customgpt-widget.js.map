{"version":3,"file":"customgpt-widget.js","mappings":"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","sources":["webpack://CustomGPTWidget/webpack/universalModuleDefinition","webpack://CustomGPTWidget/webpack/runtime/chunk loaded","webpack://CustomGPTWidget/./src/lib/streaming/handler.ts","webpack://CustomGPTWidget/./src/components/ui/button.tsx","webpack://CustomGPTWidget/./src/components/chat/CitationList.tsx","webpack://CustomGPTWidget/./src/components/chat/Message.tsx","webpack://CustomGPTWidget/./src/components/chat/ChatInput.tsx","webpack://CustomGPTWidget/./src/components/chat/TypingIndicator.tsx","webpack://CustomGPTWidget/./src/store/widget-stores/messages.ts","webpack://CustomGPTWidget/./src/store/widget-stores/conversations.ts","webpack://CustomGPTWidget/./src/store/widget-stores/agents.ts","webpack://CustomGPTWidget/./src/widget/WidgetStoreContext.tsx","webpack://CustomGPTWidget/./src/hooks/useWidgetStore.ts","webpack://CustomGPTWidget/./src/components/chat/AgentSelector.tsx","webpack://CustomGPTWidget/./src/components/chat/CitationDetailsModal.tsx","webpack://CustomGPTWidget/./src/components/chat/ConversationManager.tsx","webpack://CustomGPTWidget/./src/widget/WidgetContext.tsx","webpack://CustomGPTWidget/./src/components/chat/ChatContainer.tsx","webpack://CustomGPTWidget/./src/components/chat/ConversationSidebar.tsx","webpack://CustomGPTWidget/./src/components/chat/ChatLayout.tsx","webpack://CustomGPTWidget/./src/widget/index.tsx","webpack://CustomGPTWidget/./src/lib/api/client.ts","webpack://CustomGPTWidget/./src/lib/logger.ts","webpack://CustomGPTWidget/./src/lib/utils.ts","webpack://CustomGPTWidget/./src/store/agents.ts","webpack://CustomGPTWidget/./src/store/config.ts","webpack://CustomGPTWidget/./src/store/conversations.ts","webpack://CustomGPTWidget/./src/store/messages.ts","webpack://CustomGPTWidget/./src/store/ui.ts","webpack://CustomGPTWidget/./src/store/analytics.ts","webpack://CustomGPTWidget/./src/store/pages.ts","webpack://CustomGPTWidget/./src/store/sources.ts","webpack://CustomGPTWidget/./src/store/profile.ts","webpack://CustomGPTWidget/./src/store/project-settings.ts","webpack://CustomGPTWidget/./src/store/licenses.ts","webpack://CustomGPTWidget/./src/store/index.ts","webpack://CustomGPTWidget/webpack/bootstrap","webpack://CustomGPTWidget/webpack/runtime/compat get default export","webpack://CustomGPTWidget/webpack/runtime/define property getters","webpack://CustomGPTWidget/webpack/runtime/global","webpack://CustomGPTWidget/webpack/runtime/hasOwnProperty shorthand","webpack://CustomGPTWidget/webpack/runtime/make namespace object","webpack://CustomGPTWidget/webpack/runtime/jsonp chunk loading","webpack://CustomGPTWidget/webpack/startup"],"sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine(\"CustomGPTWidget\", [], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"CustomGPTWidget\"] = factory();\n\telse\n\t\troot[\"CustomGPTWidget\"] = factory();\n})(typeof self !== 'undefined' ? self : this, () => {\nreturn ","var deferred = [];\n__webpack_require__.O = (result, chunkIds, fn, priority) => {\n\tif(chunkIds) {\n\t\tpriority = priority || 0;\n\t\tfor(var i = deferred.length; i > 0 && deferred[i - 1][2] > priority; i--) deferred[i] = deferred[i - 1];\n\t\tdeferred[i] = [chunkIds, fn, priority];\n\t\treturn;\n\t}\n\tvar notFulfilled = Infinity;\n\tfor (var i = 0; i < deferred.length; i++) {\n\t\tvar [chunkIds, fn, priority] = deferred[i];\n\t\tvar fulfilled = true;\n\t\tfor (var j = 0; j < chunkIds.length; j++) {\n\t\t\tif ((priority & 1 === 0 || notFulfilled >= priority) && Object.keys(__webpack_require__.O).every((key) => (__webpack_require__.O[key](chunkIds[j])))) {\n\t\t\t\tchunkIds.splice(j--, 1);\n\t\t\t} else {\n\t\t\t\tfulfilled = false;\n\t\t\t\tif(priority < notFulfilled) notFulfilled = priority;\n\t\t\t}\n\t\t}\n\t\tif(fulfilled) {\n\t\t\tdeferred.splice(i--, 1)\n\t\t\tvar r = fn();\n\t\t\tif (r !== undefined) result = r;\n\t\t}\n\t}\n\treturn result;\n};","import type { StreamChunk, Citation, StreamCallbacks, StreamHandlerConfig } from '@/types';\nimport { parseStreamChunk } from '@/lib/utils';\n\nexport interface StreamMessage {\n  id: string;\n  content: string;\n  citations: Citation[];\n  isComplete: boolean;\n}\n\nexport class StreamHandler {\n  private config: Required<StreamHandlerConfig>;\n  private abortController: AbortController | null = null;\n  private currentMessage: StreamMessage | null = null;\n\n  constructor(config: StreamHandlerConfig = {}) {\n    this.config = {\n      timeout: config.timeout || 60000,\n      retryAttempts: config.retryAttempts || 3,\n      retryDelay: config.retryDelay || 1000,\n    };\n  }\n\n  /**\n   * Process a streaming response\n   */\n  async processStream(\n    stream: ReadableStream,\n    callbacks: StreamCallbacks\n  ): Promise<StreamMessage> {\n    this.abortController = new AbortController();\n    this.currentMessage = {\n      id: this.generateId(),\n      content: '',\n      citations: [],\n      isComplete: false,\n    };\n\n    const reader = stream.getReader();\n    const decoder = new TextDecoder();\n    let buffer = '';\n\n    // Set timeout\n    const timeoutId = setTimeout(() => {\n      this.cancel();\n      callbacks.onError?.(new Error('Stream timeout'));\n    }, this.config.timeout);\n\n    try {\n      while (true) {\n        const { done, value } = await reader.read();\n\n        if (done) {\n          this.currentMessage.isComplete = true;\n          callbacks.onComplete?.();\n          break;\n        }\n\n        // Decode chunk and add to buffer\n        buffer += decoder.decode(value, { stream: true });\n        \n        // Process complete lines\n        const lines = buffer.split('\\n');\n        buffer = lines.pop() || ''; // Keep incomplete line in buffer\n\n        for (const line of lines) {\n          if (line.trim()) {\n            await this.processLine(line, callbacks);\n          }\n        }\n      }\n    } catch (error) {\n      if (error instanceof Error && error.name === 'AbortError') {\n        callbacks.onError?.(new Error('Stream cancelled'));\n      } else {\n        callbacks.onError?.(error instanceof Error ? error : new Error('Unknown streaming error'));\n      }\n    } finally {\n      clearTimeout(timeoutId);\n      reader.releaseLock();\n      this.abortController = null;\n    }\n\n    return this.currentMessage;\n  }\n\n  /**\n   * Process a single line from the stream\n   */\n  private async processLine(line: string, callbacks: StreamCallbacks): Promise<void> {\n    const chunk = parseStreamChunk(line);\n    \n    if (!chunk || !this.currentMessage) return;\n\n    switch (chunk.type) {\n      case 'content':\n        if (chunk.content) {\n          this.currentMessage.content += chunk.content;\n          callbacks.onChunk?.(chunk.content);\n        }\n        break;\n\n      case 'citation':\n        if (chunk.citations) {\n          this.currentMessage.citations.push(...chunk.citations);\n          chunk.citations.forEach((citation: Citation) => {\n            callbacks.onCitation?.(citation);\n          });\n        }\n        break;\n\n      case 'done':\n        this.currentMessage.isComplete = true;\n        callbacks.onComplete?.();\n        return;\n\n      case 'error':\n        callbacks.onError?.(new Error(chunk.error || 'Stream error'));\n        return;\n\n      default:\n        // Handle unknown chunk types gracefully\n        console.warn('Unknown stream chunk type:', chunk.type);\n    }\n  }\n\n  /**\n   * Cancel the current stream\n   */\n  cancel(): void {\n    if (this.abortController) {\n      this.abortController.abort();\n    }\n  }\n\n  /**\n   * Get current message state\n   */\n  getCurrentMessage(): StreamMessage | null {\n    return this.currentMessage;\n  }\n\n  /**\n   * Check if streaming is active\n   */\n  isStreaming(): boolean {\n    return this.abortController !== null && this.currentMessage !== null && !this.currentMessage.isComplete;\n  }\n\n  private generateId(): string {\n    return Math.random().toString(36).substring(2) + Date.now().toString(36);\n  }\n}\n\n/**\n * Utility class for managing multiple concurrent streams\n */\nexport class StreamManager {\n  private streams: Map<string, StreamHandler> = new Map();\n  private maxConcurrentStreams: number;\n\n  constructor(maxConcurrentStreams: number = 3) {\n    this.maxConcurrentStreams = maxConcurrentStreams;\n  }\n\n  /**\n   * Start a new stream\n   */\n  async startStream(\n    streamId: string,\n    stream: ReadableStream,\n    callbacks: StreamCallbacks,\n    config?: StreamHandlerConfig\n  ): Promise<StreamMessage> {\n    // Check if we're at the concurrent limit\n    if (this.streams.size >= this.maxConcurrentStreams) {\n      throw new Error(`Maximum concurrent streams (${this.maxConcurrentStreams}) reached`);\n    }\n\n    // Cancel existing stream with same ID if it exists\n    if (this.streams.has(streamId)) {\n      this.cancelStream(streamId);\n    }\n\n    const handler = new StreamHandler(config);\n    this.streams.set(streamId, handler);\n\n    try {\n      const result = await handler.processStream(stream, {\n        ...callbacks,\n        onComplete: () => {\n          this.streams.delete(streamId);\n          callbacks.onComplete?.();\n        },\n        onError: (error) => {\n          this.streams.delete(streamId);\n          callbacks.onError?.(error);\n        },\n      });\n\n      return result;\n    } catch (error) {\n      this.streams.delete(streamId);\n      throw error;\n    }\n  }\n\n  /**\n   * Cancel a specific stream\n   */\n  cancelStream(streamId: string): void {\n    const handler = this.streams.get(streamId);\n    if (handler) {\n      handler.cancel();\n      this.streams.delete(streamId);\n    }\n  }\n\n  /**\n   * Cancel all active streams\n   */\n  cancelAllStreams(): void {\n    this.streams.forEach(handler => handler.cancel());\n    this.streams.clear();\n  }\n\n  /**\n   * Get active stream IDs\n   */\n  getActiveStreams(): string[] {\n    return Array.from(this.streams.keys());\n  }\n\n  /**\n   * Get stream status\n   */\n  getStreamStatus(streamId: string): {\n    exists: boolean;\n    isStreaming: boolean;\n    message: StreamMessage | null;\n  } {\n    const handler = this.streams.get(streamId);\n    \n    if (!handler) {\n      return { exists: false, isStreaming: false, message: null };\n    }\n\n    return {\n      exists: true,\n      isStreaming: handler.isStreaming(),\n      message: handler.getCurrentMessage(),\n    };\n  }\n\n  /**\n   * Get number of active streams\n   */\n  getActiveStreamCount(): number {\n    return this.streams.size;\n  }\n}\n\n/**\n * Parse Server-Sent Events (SSE) data\n */\nexport function parseSSEData(data: string): any | null {\n  try {\n    if (data === '[DONE]') {\n      return { type: 'done' };\n    }\n    \n    const parsed = JSON.parse(data);\n    \n    // Handle different response formats\n    if (parsed.choices && parsed.choices[0]) {\n      const choice = parsed.choices[0];\n      \n      if (choice.delta && choice.delta.content) {\n        return {\n          type: 'content',\n          content: choice.delta.content,\n        };\n      }\n      \n      if (choice.message && choice.message.content) {\n        return {\n          type: 'content',\n          content: choice.message.content,\n        };\n      }\n    }\n    \n    // Handle CustomGPT format\n    if (parsed.content) {\n      return {\n        type: 'content',\n        content: parsed.content,\n        citations: parsed.citations || [],\n      };\n    }\n    \n    return parsed;\n  } catch (error) {\n    console.error('Failed to parse SSE data:', error);\n    return null;\n  }\n}\n\n\n/**\n * Validate stream format\n */\nexport function validateStreamChunk(chunk: any): boolean {\n  if (!chunk || typeof chunk !== 'object') {\n    return false;\n  }\n\n  // Must have a type\n  if (!chunk.type || typeof chunk.type !== 'string') {\n    return false;\n  }\n\n  // Validate specific types\n  switch (chunk.type) {\n    case 'content':\n      return typeof chunk.content === 'string';\n    \n    case 'citation':\n      return Array.isArray(chunk.citations);\n    \n    case 'done':\n    case 'error':\n      return true;\n    \n    default:\n      return false;\n  }\n}\n\n// Global stream manager instance\nexport const globalStreamManager = new StreamManager();","/**\n * Button Component\n * \n * Reusable button component with multiple variants and sizes.\n * Built with class-variance-authority for type-safe styling.\n * \n * Variants:\n * - default: Primary brand button with shadow\n * - destructive: Red danger button for destructive actions\n * - outline: Secondary button with border\n * - secondary: Gray background button\n * - ghost: Transparent button with hover state\n * - link: Text-only button styled as link\n * \n * Sizes:\n * - default: Standard size (h-10)\n * - sm: Small size (h-8)\n * - lg: Large size (h-12)\n * - icon: Square icon button (10x10)\n * \n * Features:\n * - Full keyboard accessibility\n * - Focus ring for keyboard navigation\n * - Disabled state handling\n * - Smooth transitions\n * - Responsive to all button HTML attributes\n * \n * Usage examples:\n * <Button>Click me</Button>\n * <Button variant=\"destructive\">Delete</Button>\n * <Button size=\"sm\" variant=\"outline\">Cancel</Button>\n * <Button size=\"icon\" variant=\"ghost\"><Icon /></Button>\n * \n * Customization for contributors:\n * - Add new variants in the buttonVariants object\n * - Modify colors to match brand guidelines\n * - Add loading state with spinner\n * - Implement button groups\n * - Add icon support with left/right positioning\n */\n\nimport * as React from 'react';\nimport { cva, type VariantProps } from 'class-variance-authority';\nimport { cn } from '@/lib/utils';\n\n/**\n * Button variant configuration using class-variance-authority\n * \n * Base classes apply to all buttons, then variant-specific\n * classes are added based on the variant and size props.\n */\nconst buttonVariants = cva(\n  // Base classes for all buttons\n  'inline-flex items-center justify-center rounded-lg text-sm font-medium transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-brand-500 focus-visible:ring-offset-2 disabled:opacity-50 disabled:pointer-events-none',\n  {\n    variants: {\n      variant: {\n        default: 'bg-brand-500 text-white hover:bg-brand-600 shadow-sm',\n        destructive: 'bg-red-500 text-white hover:bg-red-600 shadow-sm',\n        outline: 'border border-gray-300 bg-white hover:bg-gray-50 text-gray-900',\n        secondary: 'bg-gray-100 text-gray-900 hover:bg-gray-200',\n        ghost: 'hover:bg-gray-100 text-gray-900',\n        link: 'text-brand-600 underline-offset-4 hover:underline',\n      },\n      size: {\n        default: 'h-10 py-2 px-4',\n        sm: 'h-8 px-3 text-xs',\n        lg: 'h-12 px-8',\n        icon: 'h-10 w-10',\n      },\n    },\n    defaultVariants: {\n      variant: 'default',\n      size: 'default',\n    },\n  }\n);\n\n/**\n * Button component props\n * \n * Extends standard HTML button attributes with variant props\n * @property variant - Visual style variant\n * @property size - Button size preset\n * @property asChild - Whether to render as child component (for composition)\n */\nexport interface ButtonProps\n  extends React.ButtonHTMLAttributes<HTMLButtonElement>,\n    VariantProps<typeof buttonVariants> {\n  asChild?: boolean;\n}\n\n/**\n * Button Component\n * \n * Forward ref component for proper ref handling in forms\n * and other use cases requiring direct DOM access.\n */\nconst Button = React.forwardRef<HTMLButtonElement, ButtonProps>(\n  ({ className, variant, size, asChild = false, ...props }, ref) => {\n    return (\n      <button\n        className={cn(buttonVariants({ variant, size, className }))}\n        ref={ref}\n        {...props}\n      />\n    );\n  }\n);\nButton.displayName = 'Button';\n\nexport { Button, buttonVariants };","/**\n * Citation List Component\n * \n * Displays a list of source citations from the AI's response.\n * Shows where the information came from with expandable details.\n * \n * Features:\n * - Expandable citation cards\n * - Confidence score visualization\n * - Direct source links\n * - Show more/less functionality\n * - Smooth expand/collapse animations\n * - Citation numbering\n * - View details modal integration\n * \n * UI/UX:\n * - Compact card design\n * - Progressive disclosure pattern\n * - Visual confidence indicators\n * - Hover states for interactivity\n * - Staggered animation on load\n * \n * Citation Display:\n * - Title and source URL\n * - Content preview\n * - Confidence percentage\n * - External link to source\n * - Details button for modal\n * \n * Customization for contributors:\n * - Add citation filtering\n * - Implement citation search\n * - Add export citations feature\n * - Enhance confidence visualization\n * - Add citation grouping by domain\n * - Implement citation tooltips\n * - Add citation copy functionality\n */\n\n'use client';\n\nimport React, { useState } from 'react';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport { \n  BookOpen, \n  ChevronDown, \n  ExternalLink \n} from 'lucide-react';\n\nimport type { CitationProps, Citation } from '@/types';\nimport { cn } from '@/lib/utils';\nimport { Button } from '@/components/ui/button';\n\n/**\n * Props for individual citation card\n * \n * @property citation - Citation data object\n * @property index - Display index (1-based)\n * @property isExpanded - Whether card is expanded\n * @property onToggle - Toggle expansion callback\n * @property onClick - Optional click handler for details\n */\ninterface CitationCardProps {\n  citation: Citation;\n  index: number;\n  isExpanded: boolean;\n  onToggle: () => void;\n  onClick?: (citation: Citation) => void;\n}\n\n/**\n * Citation Card Component\n * \n * Individual citation with expandable details.\n * Shows title, source, content, and confidence score.\n */\nconst CitationCard: React.FC<CitationCardProps> = ({\n  citation,\n  index,\n  isExpanded,\n  onToggle,\n  onClick,\n}) => {\n  return (\n    <div className=\"border border-gray-200 rounded-lg overflow-hidden transition-all hover:border-gray-300\">\n      <button\n        onClick={onToggle}\n        className=\"w-full px-3 py-2 flex items-center gap-3 hover:bg-gray-50 transition-colors text-left\"\n      >\n        {/* Citation Index */}\n        <div className=\"flex-shrink-0 w-6 h-6 rounded bg-brand-100 flex items-center justify-center\">\n          <span className=\"text-xs font-medium text-brand-700\">{index}</span>\n        </div>\n        \n        {/* Citation Info */}\n        <div className=\"flex-1 min-w-0\">\n          <div className=\"font-medium text-sm text-gray-900 line-clamp-1\">\n            {citation.title}\n          </div>\n          <div className=\"text-xs text-gray-500 line-clamp-1\">\n            {citation.source || citation.url}\n          </div>\n        </div>\n        \n        {/* Expand Icon */}\n        <ChevronDown\n          className={cn(\n            'w-4 h-4 text-gray-400 transition-transform flex-shrink-0',\n            isExpanded && 'rotate-180'\n          )}\n        />\n      </button>\n      \n      {/* Expanded Content */}\n      <AnimatePresence>\n        {isExpanded && (\n          <motion.div\n            initial={{ height: 0, opacity: 0 }}\n            animate={{ height: 'auto', opacity: 1 }}\n            exit={{ height: 0, opacity: 0 }}\n            transition={{ duration: 0.2 }}\n            className=\"overflow-hidden\"\n          >\n            <div className=\"px-3 py-2 border-t border-gray-100 bg-gray-50\">\n              <p className=\"text-sm text-gray-700 mb-2\">\n                {citation.content}\n              </p>\n              \n              {/* Confidence Score */}\n              {citation.confidence && (\n                <div className=\"mb-2\">\n                  <div className=\"flex items-center justify-between text-xs text-gray-500 mb-1\">\n                    <span>Relevance</span>\n                    <span>{Math.round(citation.confidence * 100)}%</span>\n                  </div>\n                  <div className=\"w-full bg-gray-200 rounded-full h-1.5\">\n                    <div \n                      className=\"bg-brand-500 h-1.5 rounded-full transition-all\"\n                      style={{ width: `${citation.confidence * 100}%` }}\n                    />\n                  </div>\n                </div>\n              )}\n              \n              {/* Actions */}\n              <div className=\"flex items-center gap-2\">\n                {citation.url && (\n                  <a\n                    href={citation.url}\n                    target=\"_blank\"\n                    rel=\"noopener noreferrer\"\n                    className=\"inline-flex items-center gap-1 text-xs text-brand-600 hover:text-brand-700 transition-colors\"\n                  >\n                    View source\n                    <ExternalLink className=\"w-3 h-3\" />\n                  </a>\n                )}\n                \n                {onClick && (\n                  <Button\n                    size=\"sm\"\n                    variant=\"ghost\"\n                    onClick={() => onClick(citation)}\n                    className=\"h-6 px-2 text-xs\"\n                  >\n                    View details\n                  </Button>\n                )}\n              </div>\n            </div>\n          </motion.div>\n        )}\n      </AnimatePresence>\n    </div>\n  );\n};\n\n/**\n * Citation List Component\n * \n * Main component that renders a list of citations with progressive disclosure.\n * Handles expansion state and show more/less functionality.\n * \n * @param citations - Array of citation objects to display\n * @param onCitationClick - Optional handler for citation detail clicks\n * @param maxVisible - Maximum citations to show initially (default: 5)\n * @param className - Additional CSS classes\n */\nexport const CitationList: React.FC<CitationProps> = ({ \n  citations, \n  onCitationClick,\n  maxVisible = 5,\n  className \n}) => {\n  // Track which citations are expanded\n  const [expanded, setExpanded] = useState<Set<string>>(new Set());\n  // Track whether to show all citations or just maxVisible\n  const [showAll, setShowAll] = useState(false);\n  \n  const visibleCitations = showAll ? citations : citations.slice(0, maxVisible);\n  const hasMore = citations.length > maxVisible;\n\n  /**\n   * Toggle citation expansion state\n   * \n   * Uses Set for efficient lookup and update of expanded citations\n   */\n  const toggleExpanded = (citationId: string) => {\n    const newExpanded = new Set(expanded);\n    if (expanded.has(citationId)) {\n      newExpanded.delete(citationId);\n    } else {\n      newExpanded.add(citationId);\n    }\n    setExpanded(newExpanded);\n  };\n\n  if (citations.length === 0) {\n    return null;\n  }\n\n  return (\n    <div className={cn('mt-4 space-y-2', className)}>\n      {/* Header */}\n      <div className=\"flex items-center gap-2 text-sm text-gray-600\">\n        <BookOpen className=\"w-4 h-4\" />\n        <span className=\"font-medium\">Sources</span>\n        <span className=\"text-gray-400\">({citations.length})</span>\n        \n        {hasMore && (\n          <Button\n            size=\"sm\"\n            variant=\"ghost\"\n            onClick={() => setShowAll(!showAll)}\n            className=\"ml-auto h-6 px-2 text-xs\"\n          >\n            {showAll ? 'Show less' : `Show all ${citations.length}`}\n          </Button>\n        )}\n      </div>\n      \n      {/* Citations */}\n      <div className=\"space-y-2\">\n        <AnimatePresence>\n          {visibleCitations.map((citation, idx) => (\n            <motion.div\n              key={citation.id}\n              initial={{ opacity: 0, y: 10 }}\n              animate={{ opacity: 1, y: 0 }}\n              exit={{ opacity: 0, y: -10 }}\n              transition={{ duration: 0.2, delay: idx * 0.05 }}\n            >\n              <CitationCard\n                citation={citation}\n                index={idx + 1}\n                isExpanded={expanded.has(citation.id)}\n                onToggle={() => toggleExpanded(citation.id)}\n                onClick={onCitationClick}\n              />\n            </motion.div>\n          ))}\n        </AnimatePresence>\n      </div>\n      \n      {/* Load More Button */}\n      {hasMore && !showAll && (\n        <div className=\"pt-2\">\n          <Button\n            size=\"sm\"\n            variant=\"outline\"\n            onClick={() => setShowAll(true)}\n            className=\"w-full\"\n          >\n            Show {citations.length - maxVisible} more sources\n          </Button>\n        </div>\n      )}\n    </div>\n  );\n};","/**\n * Message Component\n * \n * Displays individual chat messages with rich formatting support.\n * \n * Features:\n * - Markdown rendering with GitHub Flavored Markdown\n * - Syntax highlighting for code blocks\n * - Copy functionality for code and messages\n * - User feedback (thumbs up/down)\n * - Citation display and interaction\n * - Animated entrance and streaming cursor\n * - Different layouts for user vs assistant messages\n * \n * Customization:\n * - Modify avatar styles in the component\n * - Adjust markdown prose styles\n * - Customize code block themes (currently using oneDark)\n * - Change animation settings\n */\n\n'use client';\n\nimport React, { useState } from 'react';\nimport ReactMarkdown from 'react-markdown';\nimport remarkGfm from 'remark-gfm';\nimport { Prism as SyntaxHighlighter } from 'react-syntax-highlighter';\nimport { oneDark } from 'react-syntax-highlighter/dist/esm/styles/prism';\nimport { motion } from 'framer-motion';\nimport { \n  Bot, \n  User, \n  Copy, \n  ThumbsUp, \n  ThumbsDown, \n  RotateCw,\n  ExternalLink \n} from 'lucide-react';\nimport { toast } from 'sonner';\n\nimport type { MessageProps, Citation, ChatMessage } from '@/types';\nimport { cn, copyToClipboard, formatTimestamp } from '@/lib/utils';\nimport { Button } from '@/components/ui/button';\nimport { CitationList } from './CitationList';\n\ninterface CodeBlockProps {\n  /** Programming language for syntax highlighting */\n  language: string;\n  /** Code content to display */\n  value: string;\n}\n\n/**\n * CodeBlock Component\n * \n * Renders code with syntax highlighting and a copy button.\n * Uses react-syntax-highlighter with the oneDark theme.\n * Copy button appears on hover.\n */\nconst CodeBlock: React.FC<CodeBlockProps> = ({ language, value }) => {\n  const [copied, setCopied] = useState(false);\n  \n  const handleCopy = async () => {\n    const success = await copyToClipboard(value);\n    if (success) {\n      setCopied(true);\n      toast.success('Code copied to clipboard');\n      setTimeout(() => setCopied(false), 2000);\n    }\n  };\n\n  return (\n    <div className=\"relative group\">\n      <div className=\"absolute right-2 top-2 opacity-0 group-hover:opacity-100 transition-opacity\">\n        <Button\n          size=\"sm\"\n          variant=\"ghost\"\n          onClick={handleCopy}\n          className=\"h-6 px-2 text-xs bg-gray-800 text-white hover:bg-gray-700\"\n        >\n          {copied ? 'Copied!' : 'Copy'}\n        </Button>\n      </div>\n      <SyntaxHighlighter\n        language={language}\n        style={oneDark}\n        customStyle={{\n          margin: 0,\n          borderRadius: '0.5rem',\n          fontSize: '0.875rem',\n        }}\n      >\n        {value}\n      </SyntaxHighlighter>\n    </div>\n  );\n};\n\n/**\n * StreamingCursor Component\n * \n * Animated blinking cursor shown at the end of streaming messages\n * to indicate the AI is still generating content\n */\nconst StreamingCursor: React.FC = () => (\n  <span className=\"inline-block w-0.5 h-4 bg-gray-900 animate-blink ml-0.5 align-middle\" />\n);\n\ninterface MessageContentProps {\n  /** Markdown content to render */\n  content: string;\n  /** Whether the message is currently being streamed */\n  isStreaming?: boolean;\n}\n\n/**\n * MessageContent Component\n * \n * Renders message content with full markdown support including:\n * - Headers, lists, tables (via GFM)\n * - Inline and block code with syntax highlighting\n * - Links that open in new tabs\n * - Streaming cursor when content is being generated\n */\nconst MessageContent: React.FC<MessageContentProps> = ({ content, isStreaming }) => {\n  return (\n    <div className=\"prose prose-sm max-w-none text-gray-900\">\n      <ReactMarkdown\n        remarkPlugins={[remarkGfm]}\n        components={{\n          code({ className, children, ...props }) {\n            const match = /language-(\\w+)/.exec(className || '');\n            const isInline = !match;\n            return !isInline && match ? (\n              <CodeBlock\n                language={match[1]}\n                value={String(children).replace(/\\n$/, '')}\n                {...props}\n              />\n            ) : (\n              <code className=\"px-1 py-0.5 rounded bg-gray-100 text-sm font-medium\" {...props}>\n                {children}\n              </code>\n            );\n          },\n          a({ href, children }) {\n            return (\n              <a\n                href={href}\n                target=\"_blank\"\n                rel=\"noopener noreferrer\"\n                className=\"text-brand-600 hover:text-brand-700 no-underline hover:underline inline-flex items-center gap-1\"\n              >\n                {children}\n                <ExternalLink className=\"w-3 h-3\" />\n              </a>\n            );\n          },\n        }}\n      >\n        {content}\n      </ReactMarkdown>\n      {isStreaming && <StreamingCursor />}\n    </div>\n  );\n};\n\ninterface MessageActionsProps {\n  /** The message object containing content and metadata */\n  message: ChatMessage;\n  /** Handler for user feedback */\n  onFeedback?: (feedback: 'like' | 'dislike') => void;\n}\n\n/**\n * MessageActions Component\n * \n * Action buttons for assistant messages:\n * - Copy message content\n * - Thumbs up/down feedback\n * - Regenerate response (placeholder)\n * \n * Only visible on hover for cleaner UI\n */\nconst MessageActions: React.FC<MessageActionsProps> = ({ message, onFeedback }) => {\n  const [feedback, setFeedback] = useState<'like' | 'dislike' | null>(\n    message.feedback || null\n  );\n\n  const handleCopy = async () => {\n    const success = await copyToClipboard(message.content);\n    if (success) {\n      toast.success('Message copied to clipboard');\n    }\n  };\n\n  const handleFeedback = (type: 'like' | 'dislike') => {\n    setFeedback(type);\n    onFeedback?.(type);\n    toast.success('Thanks for your feedback!');\n  };\n\n  const handleRegenerate = () => {\n    // This would trigger message regeneration\n    toast.info('Regenerating response...');\n  };\n\n  return (\n    <div className=\"mt-3 flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity\">\n      <Button\n        size=\"icon\"\n        variant=\"ghost\"\n        onClick={handleCopy}\n        className=\"h-8 w-8 text-gray-500 hover:text-gray-700\"\n        title=\"Copy message\"\n      >\n        <Copy className=\"h-4 w-4\" />\n      </Button>\n      \n      <Button\n        size=\"icon\"\n        variant=\"ghost\"\n        onClick={() => handleFeedback('like')}\n        className={cn(\n          'h-8 w-8 text-gray-500 hover:text-gray-700',\n          feedback === 'like' && 'text-green-600 hover:text-green-700'\n        )}\n        title=\"Good response\"\n      >\n        <ThumbsUp className=\"h-4 w-4\" />\n      </Button>\n      \n      <Button\n        size=\"icon\"\n        variant=\"ghost\"\n        onClick={() => handleFeedback('dislike')}\n        className={cn(\n          'h-8 w-8 text-gray-500 hover:text-gray-700',\n          feedback === 'dislike' && 'text-red-600 hover:text-red-700'\n        )}\n        title=\"Bad response\"\n      >\n        <ThumbsDown className=\"h-4 w-4\" />\n      </Button>\n      \n      <Button\n        size=\"icon\"\n        variant=\"ghost\"\n        onClick={handleRegenerate}\n        className=\"h-8 w-8 text-gray-500 hover:text-gray-700\"\n        title=\"Regenerate response\"\n      >\n        <RotateCw className=\"h-4 w-4\" />\n      </Button>\n    </div>\n  );\n};\n\n/**\n * Message Component - Main Export\n * \n * Renders a complete message with avatar, content, citations, and actions.\n * \n * Layout:\n * - User messages: White background, user avatar, plain text\n * - Assistant messages: Gray background, bot avatar, markdown content\n * \n * Features:\n * - Smooth entrance animation with Framer Motion\n * - Hover effects for action visibility\n * - Status indicators (sending, error)\n * - Timestamp display\n * - Citation list integration\n * \n * @param message - The message data to display\n * @param isStreaming - Whether this message is being streamed\n * @param isLast - Whether this is the last message (affects scrolling)\n * @param onCitationClick - Handler for citation interactions\n * @param onFeedback - Handler for user feedback\n * @param className - Additional CSS classes\n */\nexport const Message: React.FC<MessageProps> = ({ \n  message, \n  isStreaming = false, \n  isLast = false,\n  onCitationClick,\n  onFeedback,\n  className \n}) => {\n  const isUser = message.role === 'user';\n  \n  return (\n    <motion.div\n      initial={{ opacity: 0, y: 10 }}\n      animate={{ opacity: 1, y: 0 }}\n      transition={{ duration: 0.3 }}\n      className={cn(\n        'group relative px-4 py-6 transition-colors',\n        isUser ? 'bg-white' : 'bg-gray-50 border-y border-gray-100',\n        'hover:bg-opacity-80',\n        className\n      )}\n    >\n      <div className=\"max-w-3xl mx-auto flex gap-4\">\n        {/* Avatar */}\n        <div className=\"flex-shrink-0\">\n          {isUser ? (\n            <div className=\"w-8 h-8 rounded-full bg-gray-800 flex items-center justify-center\">\n              <User className=\"w-4 h-4 text-white\" />\n            </div>\n          ) : (\n            <div className=\"w-8 h-8 rounded-full bg-white border border-gray-200 flex items-center justify-center\">\n              <Bot className=\"w-4 h-4 text-brand-600\" />\n            </div>\n          )}\n        </div>\n        \n        {/* Content */}\n        <div className=\"flex-1 overflow-hidden\">\n          {/* Message Status */}\n          {message.status && message.status !== 'sent' && (\n            <div className=\"mb-2 text-xs text-gray-500\">\n              {message.status === 'sending' && 'Sending...'}\n              {message.status === 'error' && (\n                <span className=\"text-red-500\">Failed to send</span>\n              )}\n            </div>\n          )}\n          \n          {/* Message Content */}\n          {isUser ? (\n            <p className=\"text-gray-900 whitespace-pre-wrap\">{message.content}</p>\n          ) : (\n            <MessageContent \n              content={message.content} \n              isStreaming={isStreaming}\n            />\n          )}\n          \n          {/* Citations */}\n          {message.citations && message.citations.length > 0 && (\n            <CitationList \n              citations={message.citations}\n              onCitationClick={onCitationClick}\n            />\n          )}\n          \n          {/* Timestamp */}\n          <div className=\"mt-2 text-xs text-gray-400\">\n            {formatTimestamp(message.timestamp)}\n          </div>\n          \n          {/* Actions */}\n          {!isUser && !isStreaming && (\n            <MessageActions \n              message={message}\n              onFeedback={onFeedback}\n            />\n          )}\n        </div>\n      </div>\n    </motion.div>\n  );\n};","/**\n * ChatInput Component\n * \n * Rich input field for sending messages and uploading files.\n * \n * Features:\n * - Auto-expanding textarea (up to 200px height)\n * - File upload with drag-and-drop support\n * - File type and size validation\n * - Progress tracking for uploads\n * - Character count display\n * - Keyboard shortcuts (Enter to send, Shift+Enter for newline)\n * - Animated file chips and drag overlay\n * \n * Customization:\n * - Modify CONSTANTS in utils for file limits\n * - Adjust max textarea height (line 144)\n * - Customize accepted file types\n * - Style the drag overlay and file chips\n */\n\n'use client';\n\nimport React, { useState, useRef, useCallback, KeyboardEvent, FormEvent } from 'react';\nimport { useDropzone } from 'react-dropzone';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport { \n  Send, \n  Square, \n  Paperclip, \n  X,\n  Upload,\n  AlertCircle \n} from 'lucide-react';\nimport { toast } from 'sonner';\n\nimport type { InputProps, FileUpload } from '@/types';\nimport { cn, formatFileSize, getFileIcon, isFileTypeAllowed, generateId, CONSTANTS } from '@/lib/utils';\nimport { Button } from '@/components/ui/button';\n\ninterface FileChipProps {\n  /** File upload object with metadata */\n  file: FileUpload;\n  /** Handler to remove this file */\n  onRemove: () => void;\n}\n\n/**\n * FileChip Component\n * \n * Displays an uploaded or uploading file with:\n * - File icon based on type\n * - Name and size\n * - Upload progress bar\n * - Remove button\n * - Error state indication\n */\nconst FileChip: React.FC<FileChipProps> = ({ file, onRemove }) => {\n  const fileIcon = getFileIcon(file.type);\n  \n  return (\n    <motion.div\n      initial={{ opacity: 0, scale: 0.9 }}\n      animate={{ opacity: 1, scale: 1 }}\n      exit={{ opacity: 0, scale: 0.9 }}\n      className=\"flex items-center gap-2 px-3 py-1.5 bg-gray-100 hover:bg-gray-200 rounded-lg transition-colors\"\n    >\n      <div className=\"text-gray-600\">{fileIcon}</div>\n      <div className=\"flex-1 min-w-0\">\n        <div className=\"text-sm font-medium text-gray-900 truncate\">\n          {file.name}\n        </div>\n        <div className=\"text-xs text-gray-500 flex items-center gap-2\">\n          <span>{formatFileSize(file.size)}</span>\n          {file.status === 'uploading' && (\n            <>\n              <span>•</span>\n              <span>{file.progress}%</span>\n            </>\n          )}\n          {file.status === 'error' && (\n            <>\n              <span>•</span>\n              <span className=\"text-red-500 flex items-center gap-1\">\n                <AlertCircle className=\"w-3 h-3\" />\n                Error\n              </span>\n            </>\n          )}\n        </div>\n      </div>\n      \n      {/* Progress Bar */}\n      {file.status === 'uploading' && (\n        <div className=\"absolute bottom-0 left-0 right-0 h-0.5 bg-gray-200 rounded-b\">\n          <div \n            className=\"h-full bg-brand-500 rounded-b transition-all duration-300\"\n            style={{ width: `${file.progress}%` }}\n          />\n        </div>\n      )}\n      \n      <button\n        onClick={onRemove}\n        className=\"p-0.5 rounded hover:bg-gray-300 transition-colors\"\n        disabled={file.status === 'uploading'}\n      >\n        <X className=\"w-3 h-3 text-gray-500\" />\n      </button>\n    </motion.div>\n  );\n};\n\ninterface FileUploadButtonProps {\n  /** Handler called when files are selected */\n  onUpload: (files: File[]) => void;\n  /** Whether the button is disabled */\n  disabled?: boolean;\n}\n\n/**\n * FileUploadButton Component\n * \n * Hidden file input with visible button trigger.\n * Accepts multiple files based on ACCEPTED_FILE_TYPES.\n */\nconst FileUploadButton: React.FC<FileUploadButtonProps> = ({ onUpload, disabled }) => {\n  const fileInputRef = useRef<HTMLInputElement>(null);\n  \n  const handleClick = () => {\n    fileInputRef.current?.click();\n  };\n  \n  const handleChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const files = Array.from(e.target.files || []);\n    if (files.length > 0) {\n      onUpload(files);\n      e.target.value = '';\n    }\n  };\n  \n  return (\n    <>\n      <input\n        ref={fileInputRef}\n        type=\"file\"\n        multiple\n        accept={CONSTANTS.ACCEPTED_FILE_TYPES.join(',')}\n        onChange={handleChange}\n        className=\"hidden\"\n      />\n      <Button\n        type=\"button\"\n        size=\"icon\"\n        variant=\"ghost\"\n        onClick={handleClick}\n        disabled={disabled}\n        className=\"h-10 w-10 text-gray-600 hover:text-gray-800\"\n        title=\"Upload files\"\n      >\n        <Paperclip className=\"h-5 w-5\" />\n      </Button>\n    </>\n  );\n};\n\n/**\n * ChatInput Component - Main Export\n * \n * Complete chat input with message composition and file upload.\n * \n * Props:\n * @param onSend - Handler called with message content and files\n * @param disabled - Disables input during message sending\n * @param placeholder - Placeholder text for the textarea\n * @param maxLength - Maximum message length (default from CONSTANTS)\n * @param className - Additional CSS classes\n * \n * State Management:\n * - input: Current message text\n * - files: Array of uploaded/uploading files\n * - isDragOver: Drag-and-drop state\n * \n * @example\n * <ChatInput \n *   onSend={(message, files) => handleSend(message, files)}\n *   disabled={isLoading}\n * />\n */\nexport const ChatInput: React.FC<InputProps> = ({ \n  onSend,\n  disabled = false,\n  placeholder = \"Send a message...\",\n  maxLength = CONSTANTS.MAX_MESSAGE_LENGTH,\n  className \n}) => {\n  const [input, setInput] = useState('');\n  const [files, setFiles] = useState<FileUpload[]>([]);\n  const [isDragOver, setIsDragOver] = useState(false);\n  const textareaRef = useRef<HTMLTextAreaElement>(null);\n  \n  /**\n   * Auto-resize textarea based on content\n   * Grows up to maxHeight (200px) then scrolls\n   */\n  const adjustTextareaHeight = useCallback(() => {\n    const textarea = textareaRef.current;\n    if (textarea) {\n      textarea.style.height = 'auto';\n      const scrollHeight = textarea.scrollHeight;\n      const maxHeight = 200; // Max height in pixels - customize as needed\n      textarea.style.height = `${Math.min(scrollHeight, maxHeight)}px`;\n    }\n  }, []);\n  \n  // Handle text input changes\n  const handleInputChange = (e: React.ChangeEvent<HTMLTextAreaElement>) => {\n    const value = e.target.value;\n    if (value.length <= maxLength) {\n      setInput(value);\n      adjustTextareaHeight();\n    }\n  };\n  \n  // Handle key presses\n  const handleKeyDown = (e: KeyboardEvent<HTMLTextAreaElement>) => {\n    if (e.key === 'Enter' && !e.shiftKey) {\n      e.preventDefault();\n      handleSubmit(e as any);\n    }\n  };\n  \n  // Handle form submission\n  const handleSubmit = (e: FormEvent) => {\n    e.preventDefault();\n    \n    if (disabled) return;\n    if (!input.trim() && files.length === 0) return;\n    \n    // Convert FileUpload objects to File objects\n    const fileObjects = files\n      .filter(f => f.status === 'uploaded')\n      .map(f => f.file); // Use the actual File object\n    \n    onSend(input.trim(), fileObjects);\n    \n    // Reset form\n    setInput('');\n    setFiles([]);\n    \n    // Reset textarea height\n    if (textareaRef.current) {\n      textareaRef.current.style.height = 'auto';\n    }\n    \n    // Focus textarea\n    setTimeout(() => {\n      textareaRef.current?.focus();\n    }, 0);\n  };\n  \n  /**\n   * Handle file uploads with validation\n   * Checks file size and type before accepting\n   * Shows toast notifications for validation errors\n   */\n  const handleFileUpload = useCallback((newFiles: File[]) => {\n    const validFiles = newFiles.filter(file => {\n      // Check file size against MAX_FILE_SIZE constant\n      if (file.size > CONSTANTS.MAX_FILE_SIZE) {\n        toast.error(`File \"${file.name}\" is too large. Maximum size is ${formatFileSize(CONSTANTS.MAX_FILE_SIZE)}`);\n        return false;\n      }\n      \n      // Check file type against ACCEPTED_FILE_TYPES\n      if (!isFileTypeAllowed(file.type, CONSTANTS.ACCEPTED_FILE_TYPES)) {\n        toast.error(`File type \"${file.type}\" is not supported`);\n        return false;\n      }\n      \n      return true;\n    });\n    \n    const uploadFiles: FileUpload[] = validFiles.map(file => ({\n      id: generateId(),\n      name: file.name,\n      size: file.size,\n      type: file.type,\n      status: 'uploading',\n      progress: 0,\n      file: file, // Store the actual File object\n    }));\n    \n    setFiles(prev => [...prev, ...uploadFiles]);\n    \n    // Simulate file upload\n    uploadFiles.forEach(uploadFile => {\n      simulateUpload(uploadFile);\n    });\n    \n  }, []);\n  \n  /**\n   * Simulate file upload progress\n   * In production, replace with actual upload logic\n   * Updates progress in 100ms intervals\n   */\n  const simulateUpload = (uploadFile: FileUpload) => {\n    let progress = 0;\n    const interval = setInterval(() => {\n      progress += Math.random() * 20;\n      \n      if (progress >= 100) {\n        progress = 100;\n        clearInterval(interval);\n        \n        // Mark file as uploaded\n        setFiles(prev => prev.map(f => \n          f.id === uploadFile.id \n            ? { ...f, status: 'uploaded' as const, progress: 100 }\n            : f\n        ));\n      } else {\n        // Update progress\n        setFiles(prev => prev.map(f => \n          f.id === uploadFile.id \n            ? { ...f, progress: Math.round(progress) }\n            : f\n        ));\n      }\n    }, 100);\n  };\n  \n  // Remove file\n  const removeFile = (fileId: string) => {\n    setFiles(prev => prev.filter(f => f.id !== fileId));\n  };\n  \n  /**\n   * Dropzone configuration for drag-and-drop\n   * - Accepts files based on ACCEPTED_FILE_TYPES\n   * - Validates file size\n   * - Shows overlay on drag\n   * - Disabled click/keyboard to use custom button\n   */\n  const { getRootProps, getInputProps, isDragActive } = useDropzone({\n    onDrop: handleFileUpload,\n    noClick: true, // Use custom button instead\n    noKeyboard: true,\n    accept: CONSTANTS.ACCEPTED_FILE_TYPES.reduce((acc, type) => {\n      acc[type] = [];\n      return acc;\n    }, {} as Record<string, string[]>),\n    maxSize: CONSTANTS.MAX_FILE_SIZE,\n    onDragEnter: () => setIsDragOver(true),\n    onDragLeave: () => setIsDragOver(false),\n  });\n  \n  const canSend = !disabled && (input.trim() || files.some(f => f.status === 'uploaded'));\n  \n  return (\n    <div \n      {...getRootProps()}\n      className={cn(\n        'border-t border-gray-200 bg-white px-4 py-3 relative',\n        isDragActive && 'bg-brand-50',\n        className\n      )}\n    >\n      <input {...getInputProps()} />\n      \n      {/* Drag Overlay */}\n      <AnimatePresence>\n        {isDragActive && (\n          <motion.div\n            initial={{ opacity: 0 }}\n            animate={{ opacity: 1 }}\n            exit={{ opacity: 0 }}\n            className=\"absolute inset-0 bg-brand-50 border-2 border-dashed border-brand-300 rounded-lg flex items-center justify-center z-10\"\n          >\n            <div className=\"text-center\">\n              <Upload className=\"w-8 h-8 text-brand-600 mx-auto mb-2\" />\n              <p className=\"text-brand-700 font-medium\">Drop files here to upload</p>\n              <p className=\"text-brand-600 text-sm\">\n                Supports PDF, DOC, TXT, and more\n              </p>\n            </div>\n          </motion.div>\n        )}\n      </AnimatePresence>\n      \n      {/* File Preview */}\n      <AnimatePresence>\n        {files.length > 0 && (\n          <motion.div\n            initial={{ opacity: 0, height: 0 }}\n            animate={{ opacity: 1, height: 'auto' }}\n            exit={{ opacity: 0, height: 0 }}\n            className=\"mb-2 flex flex-wrap gap-2\"\n          >\n            {files.map((file) => (\n              <FileChip\n                key={file.id}\n                file={file}\n                onRemove={() => removeFile(file.id)}\n              />\n            ))}\n          </motion.div>\n        )}\n      </AnimatePresence>\n      \n      <form onSubmit={handleSubmit} className=\"flex items-end gap-2\">\n        {/* File Upload Button */}\n        <FileUploadButton\n          onUpload={handleFileUpload}\n          disabled={disabled}\n        />\n        \n        {/* Text Input */}\n        <div className=\"flex-1 relative\">\n          <textarea\n            ref={textareaRef}\n            value={input}\n            onChange={handleInputChange}\n            onKeyDown={handleKeyDown}\n            placeholder={placeholder}\n            disabled={disabled}\n            rows={1}\n            className={cn(\n              'w-full resize-none rounded-lg border border-gray-300',\n              'px-3 py-2 pr-12',\n              'focus:outline-none focus:ring-2 focus:ring-brand-500 focus:border-transparent',\n              'disabled:opacity-50 disabled:cursor-not-allowed',\n              'min-h-[44px] max-h-[200px]',\n              'placeholder:text-gray-500'\n            )}\n            style={{\n              height: 'auto',\n              overflowY: input.split('\\n').length > 5 ? 'auto' : 'hidden',\n            }}\n          />\n          \n          {/* Character Count */}\n          {input.length > 0 && (\n            <div className=\"absolute bottom-2 right-2 text-xs text-gray-400 pointer-events-none\">\n              {input.length}/{maxLength}\n            </div>\n          )}\n        </div>\n        \n        {/* Send Button */}\n        <Button\n          type=\"submit\"\n          size=\"icon\"\n          disabled={!canSend}\n          className={cn(\n            'h-10 w-10 flex-shrink-0',\n            disabled && 'animate-pulse'\n          )}\n          title={disabled ? 'Stop generating' : 'Send message'}\n        >\n          {disabled ? (\n            <Square className=\"h-5 w-5\" />\n          ) : (\n            <Send className=\"h-5 w-5\" />\n          )}\n        </Button>\n      </form>\n      \n      {/* Input Hints */}\n      <div className=\"mt-2 flex items-center justify-between text-xs text-gray-500\">\n        <span>Press Enter to send, Shift+Enter for new line</span>\n        <span>Supports {CONSTANTS.ACCEPTED_FILE_TYPES.length}+ file formats</span>\n      </div>\n    </div>\n  );\n};","/**\n * Typing Indicator Component\n * \n * Shows animated typing indicator when AI is generating a response.\n * Provides visual feedback that the system is processing.\n * \n * Features:\n * - Three-dot bouncing animation\n * - AI avatar display\n * - Staggered animation delays\n * - Consistent styling with messages\n * - Subtle bounce effect\n * \n * Animation:\n * - Uses CSS animations defined in globals.css\n * - animate-bounce-subtle class for smooth motion\n * - Staggered delays (0ms, 100ms, 200ms)\n * - Creates wave-like effect\n * \n * Design:\n * - Matches message component layout\n * - Gray background for distinction\n * - Centered in chat container\n * - Responsive max-width\n * \n * Customization for contributors:\n * - Add different animation styles\n * - Implement custom messages (\"Thinking...\", \"Searching...\")\n * - Add progress indicator for long operations\n * - Customize avatar appearance\n * - Add sound effects option\n * - Implement skeleton loading alternative\n * - Add estimated time remaining\n */\n\n'use client';\n\nimport React from 'react';\nimport { Bot } from 'lucide-react';\nimport { cn } from '@/lib/utils';\n\n/**\n * Props for TypingIndicator\n * \n * @property className - Additional CSS classes for styling\n */\ninterface TypingIndicatorProps {\n  className?: string;\n}\n\n/**\n * Typing Indicator Component\n * \n * Displays animated dots to indicate AI is typing/processing.\n * Maintains visual consistency with message components.\n */\nexport const TypingIndicator: React.FC<TypingIndicatorProps> = ({ className }) => {\n  return (\n    <div className={cn(\n      'px-4 py-6 bg-gray-50 border-y border-gray-100',\n      className\n    )}>\n      <div className=\"max-w-3xl mx-auto flex gap-4\">\n        {/* Avatar */}\n        <div className=\"w-8 h-8 rounded-full bg-white border border-gray-200 flex items-center justify-center flex-shrink-0\">\n          <Bot className=\"w-4 h-4 text-brand-600\" />\n        </div>\n        \n        {/* Typing Animation */}\n        <div className=\"flex items-center gap-1 py-2\">\n          <div className=\"w-2 h-2 bg-gray-400 rounded-full animate-bounce-subtle\" />\n          <div className=\"w-2 h-2 bg-gray-400 rounded-full animate-bounce-subtle delay-100\" />\n          <div className=\"w-2 h-2 bg-gray-400 rounded-full animate-bounce-subtle delay-200\" />\n        </div>\n      </div>\n    </div>\n  );\n};","/**\n * Widget-specific Message Store Factory\n * \n * Creates an isolated message store instance for each widget.\n * This ensures messages are not shared between different widget instances.\n */\n\nimport { create, StoreApi } from 'zustand';\nimport type { ChatMessage, Citation, FeedbackType } from '@/types';\nimport { getClient } from '@/lib/api/client';\nimport { generateId } from '@/lib/utils';\nimport { globalStreamManager } from '@/lib/streaming/handler';\nimport { logger } from '@/lib/logger';\nimport type { AgentStore } from './agents';\nimport type { ConversationStore } from './conversations';\n\n// Message Store interface - copied from original to maintain compatibility\nexport interface MessageStore {\n  messages: Map<string, ChatMessage[]>;\n  streamingMessage: ChatMessage | null;\n  isStreaming: boolean;\n  loading: boolean;\n  error: string | null;\n  \n  sendMessage: (content: string, files?: File[]) => Promise<void>;\n  loadMessages: (conversationId: string) => Promise<void>;\n  addMessage: (conversationId: string, message: ChatMessage) => void;\n  updateStreamingMessage: (content: string, citations?: Citation[]) => void;\n  clearMessages: (conversationId?: string) => void;\n  updateMessageFeedback: (messageId: string, feedback: FeedbackType) => void;\n  cancelStreaming: () => void;\n  getMessagesForConversation: (conversationId: string) => ChatMessage[];\n  reset: () => void;\n}\n\n/**\n * Create a message store instance for a specific widget\n * @param sessionId - The widget's session ID for isolation\n * @param agentStore - Reference to the agent store\n * @param conversationStore - Reference to the conversation store\n */\nexport function createMessageStore(\n  sessionId: string,\n  agentStore?: StoreApi<AgentStore>,\n  conversationStore?: StoreApi<ConversationStore>\n): StoreApi<MessageStore> {\n  const MESSAGES_STORAGE_KEY = `customgpt-messages-cache-${sessionId}`;\n  \n  // Local storage helpers scoped to this instance\n  function saveMessagesToStorage(conversationId: string, messages: ChatMessage[]) {\n    try {\n      const stored = localStorage.getItem(MESSAGES_STORAGE_KEY);\n      const cache = stored ? JSON.parse(stored) : {};\n      cache[conversationId] = messages;\n      localStorage.setItem(MESSAGES_STORAGE_KEY, JSON.stringify(cache));\n    } catch (error) {\n      console.error('Failed to save messages to local storage:', error);\n    }\n  }\n\n  function loadMessagesFromStorage(conversationId: string): ChatMessage[] | null {\n    try {\n      const stored = localStorage.getItem(MESSAGES_STORAGE_KEY);\n      if (!stored) return null;\n      const cache = JSON.parse(stored);\n      return cache[conversationId] || null;\n    } catch (error) {\n      console.error('Failed to load messages from local storage:', error);\n      return null;\n    }\n  }\n\n  return create<MessageStore>((set, get) => ({\n    messages: new Map(),\n    streamingMessage: null,\n    isStreaming: false,\n    loading: false,\n    error: null,\n\n    sendMessage: async (content: string, files?: File[]) => {\n      const isDemoMode = typeof window !== 'undefined' && (window as any).__customgpt_demo_mode;\n      \n      // Use the passed store references\n      if (!agentStore || !conversationStore) {\n        logger.error('MESSAGES', 'Store references not provided');\n        throw new Error('Store references not provided');\n      }\n      \n      const currentAgent = agentStore.getState().currentAgent;\n      if (!currentAgent) {\n        logger.error('MESSAGES', 'No agent selected');\n        throw new Error('No agent selected');\n      }\n\n      logger.info('MESSAGES', 'Sending message from widget store', {\n        sessionId,\n        agentId: currentAgent.id,\n        agentName: currentAgent.project_name,\n        messageLength: content.length,\n        hasFiles: files && files.length > 0\n      });\n\n      // Ensure we have a conversation\n      const conversation = await conversationStore.getState().ensureConversation(\n        typeof currentAgent.id === 'string' ? parseInt(currentAgent.id) : currentAgent.id,\n        content\n      );\n\n      logger.info('MESSAGES', 'Conversation ensured', {\n        conversationId: conversation.id,\n        sessionId: conversation.session_id,\n        hasSessionId: !!conversation.session_id,\n        isNew: !conversation.message_count || conversation.message_count === 0\n      });\n\n      if (!conversation.session_id) {\n        logger.error('MESSAGES', 'Conversation missing session_id', { conversation });\n        throw new Error('Conversation missing session_id');\n      }\n\n      set({ loading: true, error: null });\n\n      const conversationId = conversation.id.toString();\n\n      // Create user message\n      const userMessage: ChatMessage = {\n        id: generateId(),\n        role: 'user',\n        content,\n        timestamp: new Date().toISOString(),\n        status: 'sending',\n      };\n\n      // Add user message to store\n      get().addMessage(conversationId, userMessage);\n\n      // Create assistant message placeholder\n      const assistantMessage: ChatMessage = {\n        id: generateId(),\n        role: 'assistant',\n        content: '',\n        timestamp: new Date().toISOString(),\n        citations: [],\n      };\n\n      set({ \n        streamingMessage: assistantMessage,\n        isStreaming: true,\n        loading: false,\n      });\n\n      try {\n        // Handle file uploads if present\n        if (files && files.length > 0) {\n          const client = getClient();\n          await Promise.all(\n            files.map(file => client.uploadFile(currentAgent.id, file))\n          );\n        }\n\n        // Update user message status\n        userMessage.status = 'sent';\n        get().addMessage(conversationId, userMessage);\n\n        // Start streaming with correct parameters\n        const client = getClient();\n        \n        logger.info('MESSAGES', 'Starting message stream', {\n          agentId: currentAgent.id,\n          sessionId: conversation.session_id,\n          messageContent: content.substring(0, 50)\n        });\n        \n        if (isDemoMode) {\n          // Demo mode - simulate streaming response\n          await new Promise(resolve => setTimeout(resolve, 1000));\n          \n          const demoResponse = `This is a demo response to: \"${content}\"`;\n          get().updateStreamingMessage(demoResponse);\n          \n          await new Promise(resolve => setTimeout(resolve, 500));\n          \n          const finalMessage = get().streamingMessage;\n          if (finalMessage) {\n            finalMessage.status = 'sent';\n            get().addMessage(conversationId, finalMessage);\n          }\n          \n          set({ \n            streamingMessage: null,\n            isStreaming: false,\n          });\n          return;\n        }\n        \n        // Real API streaming\n        try {\n          await client.sendMessageStream(\n            currentAgent.id,\n            conversation.session_id,\n            { \n              prompt: content,\n              response_source: 'default',\n              stream: 1\n            },\n            {\n              onChunk: (chunk) => {\n                logger.debug('MESSAGES', 'Received stream chunk', { \n                  type: chunk.type, \n                  hasContent: !!chunk.content,\n                  contentLength: chunk.content?.length,\n                  contentPreview: chunk.content?.substring(0, 50)\n                });\n                \n                if (chunk.type === 'content' && chunk.content) {\n                  get().updateStreamingMessage(chunk.content, chunk.citations);\n                } else if (chunk.type === 'citation' && chunk.citations) {\n                  // Handle citation-only chunks\n                  const current = get().streamingMessage;\n                  if (current) {\n                    set({\n                      streamingMessage: {\n                        ...current,\n                        citations: chunk.citations\n                      }\n                    });\n                  }\n                }\n              },\n              onComplete: () => {\n                const finalMessage = get().streamingMessage;\n                if (finalMessage) {\n                  finalMessage.status = 'sent';\n                  get().addMessage(conversationId, finalMessage);\n                }\n                \n                set({ \n                  streamingMessage: null,\n                  isStreaming: false,\n                });\n                \n                // Update conversation message count\n                conversationStore.getState().updateConversation(\n                  conversation.id,\n                  conversation.session_id,\n                  { name: conversation.name }\n                );\n              },\n              onError: async (streamError) => {\n                logger.error('MESSAGES', 'Streaming failed, attempting fallback to non-streaming', streamError);\n                \n                // Try fallback to non-streaming API\n                try {\n                  const response = await client.sendMessage(\n                    currentAgent.id,\n                    conversation.session_id,\n                    { \n                      prompt: content,\n                      response_source: 'default',\n                      stream: 0\n                    }\n                  );\n                  \n                  // Update streaming message with the complete response\n                  const finalMessage = get().streamingMessage;\n                  if (finalMessage && response) {\n                    let messageData: any;\n                    if (response.data) {\n                      messageData = response.data;\n                    } else {\n                      messageData = response as any;\n                    }\n                    \n                    finalMessage.content = messageData?.openai_response || messageData?.content || 'No response received';\n                    finalMessage.citations = messageData?.citations || [];\n                    finalMessage.status = 'sent';\n                    get().addMessage(conversationId, finalMessage);\n                  }\n                  \n                  set({ \n                    streamingMessage: null,\n                    isStreaming: false,\n                  });\n                  \n                } catch (fallbackError) {\n                  logger.error('MESSAGES', 'Both streaming and non-streaming failed', fallbackError);\n                  throw fallbackError;\n                }\n              }\n            }\n          );\n        } catch (error) {\n          logger.error('MESSAGES', 'Failed to send message', error);\n          \n          // Remove assistant message placeholder on error\n          set({ \n            streamingMessage: null,\n            isStreaming: false,\n            error: error instanceof Error ? error.message : 'Failed to send message'\n          });\n          \n          throw error;\n        }\n      } catch (error) {\n        logger.error('MESSAGES', 'Error in sendMessage', error);\n        set({ \n          error: error instanceof Error ? error.message : 'Failed to send message',\n          streamingMessage: null,\n          isStreaming: false,\n          loading: false,\n        });\n        throw error;\n      }\n    },\n\n    loadMessages: async (conversationId: string) => {\n      set({ loading: true, error: null });\n\n      try {\n        // Try to load from storage first\n        const cachedMessages = loadMessagesFromStorage(conversationId);\n        if (cachedMessages) {\n          set(state => ({\n            messages: new Map(state.messages).set(conversationId, cachedMessages),\n            loading: false,\n          }));\n          return;\n        }\n\n        // In a real implementation, would load from API\n        set(state => ({\n          messages: new Map(state.messages).set(conversationId, []),\n          loading: false,\n        }));\n      } catch (error) {\n        logger.error('MESSAGES', 'Failed to load messages', error);\n        set({ \n          error: error instanceof Error ? error.message : 'Failed to load messages',\n          loading: false \n        });\n      }\n    },\n\n    addMessage: (conversationId: string, message: ChatMessage) => {\n      set(state => {\n        const newMessages = new Map(state.messages);\n        const messages = newMessages.get(conversationId) || [];\n        \n        // Check if message already exists\n        const existingIndex = messages.findIndex(m => m.id === message.id);\n        if (existingIndex >= 0) {\n          messages[existingIndex] = message;\n        } else {\n          messages.push(message);\n        }\n        \n        newMessages.set(conversationId, messages);\n        \n        // Save to storage\n        saveMessagesToStorage(conversationId, messages);\n        \n        return { messages: newMessages };\n      });\n    },\n\n    updateStreamingMessage: (content: string, citations?: Citation[]) => {\n      set(state => {\n        if (!state.streamingMessage) return state;\n        \n        return {\n          streamingMessage: {\n            ...state.streamingMessage,\n            content: state.streamingMessage.content + content,\n            citations: citations || state.streamingMessage.citations,\n          },\n        };\n      });\n    },\n\n    clearMessages: (conversationId?: string) => {\n      if (conversationId) {\n        set(state => {\n          const newMessages = new Map(state.messages);\n          newMessages.delete(conversationId);\n          return { messages: newMessages };\n        });\n        \n        // Clear from storage\n        try {\n          const stored = localStorage.getItem(MESSAGES_STORAGE_KEY);\n          if (stored) {\n            const cache = JSON.parse(stored);\n            delete cache[conversationId];\n            localStorage.setItem(MESSAGES_STORAGE_KEY, JSON.stringify(cache));\n          }\n        } catch (error) {\n          console.error('Failed to clear messages from storage:', error);\n        }\n      } else {\n        // Clear all messages\n        set({ messages: new Map() });\n        \n        // Clear all from storage\n        try {\n          localStorage.removeItem(MESSAGES_STORAGE_KEY);\n        } catch (error) {\n          console.error('Failed to clear all messages from storage:', error);\n        }\n      }\n    },\n\n    cancelStreaming: () => {\n      globalStreamManager.cancelAllStreams();\n      set({ isStreaming: false, streamingMessage: null });\n    },\n\n    getMessagesForConversation: (conversationId: string): ChatMessage[] => {\n      return get().messages.get(conversationId) || [];\n    },\n\n    updateMessageFeedback: (messageId: string, feedback: FeedbackType) => {\n      set(state => {\n        const newMessages = new Map(state.messages);\n        \n        for (const [convId, messages] of newMessages) {\n          const messageIndex = messages.findIndex(m => m.id === messageId);\n          if (messageIndex !== -1) {\n            const updatedMessages = [...messages];\n            updatedMessages[messageIndex] = {\n              ...updatedMessages[messageIndex],\n              feedback,\n            };\n            newMessages.set(convId, updatedMessages);\n            saveMessagesToStorage(convId, updatedMessages);\n            break;\n          }\n        }\n        \n        return { messages: newMessages };\n      });\n    },\n\n    reset: () => {\n      set({\n        messages: new Map(),\n        streamingMessage: null,\n        isStreaming: false,\n        loading: false,\n        error: null,\n      });\n    },\n  }));\n}","/**\n * Widget-specific Conversation Store Factory\n * \n * Creates an isolated conversation store instance for each widget.\n * This ensures conversations are not shared between different widget instances.\n */\n\nimport { create, StoreApi } from 'zustand';\nimport type { Conversation } from '@/types';\nimport { getClient } from '@/lib/api/client';\nimport { generateId } from '@/lib/utils';\nimport { logger } from '@/lib/logger';\n\n// Conversation Store interface - widget-specific version\nexport interface ConversationStore {\n  conversations: Conversation[];\n  currentConversation: Conversation | null;\n  loading: boolean;\n  error: string | null;\n  lastConversationActivity: Record<string, string>;\n  \n  fetchConversations: (projectId: number) => Promise<void>;\n  loadConversations: (agentId: string) => Promise<void>; // Keep for compatibility\n  createConversation: (projectId: number, name?: string) => Promise<void>;\n  updateConversation: (conversationId: number, sessionId: string, data: { name: string }) => Promise<void>;\n  deleteConversation: (conversationId: string | number) => Promise<void>;\n  selectConversation: (conversation: Conversation) => void;\n  ensureConversation: (projectId: number, firstMessage?: string) => Promise<Conversation>;\n  reset: () => void;\n}\n\n/**\n * Create a conversation store instance for a specific widget\n * @param sessionId - The widget's session ID for isolation\n */\nexport function createConversationStore(sessionId: string): StoreApi<ConversationStore> {\n  const CONVERSATIONS_STORAGE_KEY = `customgpt-conversations-cache-${sessionId}`;\n  const ACTIVITY_STORAGE_KEY = `customgpt-conversation-activity-${sessionId}`;\n  \n  // Local storage helpers scoped to this instance\n  function saveConversationsToStorage(agentId: string, conversations: Conversation[]) {\n    try {\n      const stored = localStorage.getItem(CONVERSATIONS_STORAGE_KEY);\n      const cache = stored ? JSON.parse(stored) : {};\n      cache[agentId] = conversations;\n      localStorage.setItem(CONVERSATIONS_STORAGE_KEY, JSON.stringify(cache));\n    } catch (error) {\n      console.error('Failed to save conversations to storage:', error);\n    }\n  }\n\n  function loadConversationsFromStorage(agentId: string): Conversation[] | null {\n    try {\n      const stored = localStorage.getItem(CONVERSATIONS_STORAGE_KEY);\n      if (!stored) return null;\n      const cache = JSON.parse(stored);\n      return cache[agentId] || null;\n    } catch (error) {\n      console.error('Failed to load conversations from storage:', error);\n      return null;\n    }\n  }\n\n  function saveActivityToStorage(activity: Record<string, string>) {\n    try {\n      localStorage.setItem(ACTIVITY_STORAGE_KEY, JSON.stringify(activity));\n    } catch (error) {\n      console.error('Failed to save activity to storage:', error);\n    }\n  }\n\n  function loadActivityFromStorage(): Record<string, string> {\n    try {\n      const stored = localStorage.getItem(ACTIVITY_STORAGE_KEY);\n      return stored ? JSON.parse(stored) : {};\n    } catch (error) {\n      console.error('Failed to load activity from storage:', error);\n      return {};\n    }\n  }\n\n  return create<ConversationStore>((set, get) => ({\n    conversations: [],\n    currentConversation: null,\n    loading: false,\n    error: null,\n    lastConversationActivity: loadActivityFromStorage(),\n\n    fetchConversations: async (projectId: number) => {\n      // For widgets, we load conversations differently\n      const isDemoMode = typeof window !== 'undefined' && (window as any).__customgpt_demo_mode;\n      \n      logger.info('CONVERSATIONS', 'Fetching conversations for widget', {\n        sessionId,\n        projectId,\n        isDemoMode\n      });\n\n      set({ loading: true, error: null });\n\n      try {\n        if (isDemoMode) {\n          // In demo mode, just load from local storage\n          return get().loadConversations(projectId.toString());\n        }\n        \n        // Get the list of conversation IDs that belong to this widget session\n        const widgetConvKey = `widget_conversations_${sessionId}`;\n        const widgetConvIds = JSON.parse(localStorage.getItem(widgetConvKey) || '[]');\n        \n        if (widgetConvIds.length === 0) {\n          // No conversations created yet in this widget session\n          set({\n            conversations: [],\n            loading: false,\n          });\n          return;\n        }\n        \n        // Fetch conversations from API but only keep ones created in this widget session\n        const client = getClient();\n        const response = await client.getConversations(projectId);\n        \n        // Handle different response formats\n        let allConversations = [];\n        if (response && typeof response === 'object') {\n          if (Array.isArray((response as any).data)) {\n            allConversations = (response as any).data;\n          } else if (Array.isArray(response)) {\n            allConversations = response;\n          } else if ((response as any).data && Array.isArray((response as any).data.data)) {\n            allConversations = (response as any).data.data;\n          }\n        }\n        \n        // Filter to only include conversations created in this widget session\n        const widgetConversations = allConversations.filter((conv: Conversation) => \n          widgetConvIds.includes(conv.id)\n        );\n        \n        logger.info('CONVERSATIONS', 'Filtered widget conversations', {\n          totalFromAPI: allConversations.length,\n          widgetSpecific: widgetConversations.length,\n          widgetConvIds\n        });\n        \n        set({ \n          conversations: widgetConversations, \n          loading: false,\n        });\n        \n        // Save to local storage\n        saveConversationsToStorage(projectId.toString(), widgetConversations);\n      } catch (error) {\n        logger.error('CONVERSATIONS', 'Failed to fetch conversations', error);\n        // On error, try to load from local storage\n        const cached = loadConversationsFromStorage(projectId.toString());\n        set({ \n          conversations: cached || [],\n          error: error instanceof Error ? error.message : 'Failed to fetch conversations',\n          loading: false,\n        });\n      }\n    },\n\n    loadConversations: async (agentId: string) => {\n      const isDemoMode = typeof window !== 'undefined' && (window as any).__customgpt_demo_mode;\n      \n      logger.info('CONVERSATIONS', 'Loading conversations for widget store', {\n        sessionId,\n        agentId,\n        isDemoMode\n      });\n\n      set({ loading: true, error: null });\n\n      try {\n        // For widgets, we only load conversations from local storage that were created in this session\n        // We do NOT fetch from the API to ensure complete isolation\n        const cachedConversations = loadConversationsFromStorage(agentId);\n        \n        if (cachedConversations) {\n          // Filter to only include conversations created in this widget session\n          const sessionConversations = cachedConversations.filter(conv => \n            conv.session_id && conv.session_id.includes(sessionId)\n          );\n          \n          set({\n            conversations: sessionConversations,\n            loading: false,\n          });\n          \n          logger.info('CONVERSATIONS', 'Loaded session-specific conversations', {\n            totalCached: cachedConversations.length,\n            sessionSpecific: sessionConversations.length,\n            sessionId\n          });\n        } else {\n          // No conversations yet - start with empty array\n          set({\n            conversations: [],\n            loading: false,\n          });\n        }\n      } catch (error) {\n        logger.error('CONVERSATIONS', 'Failed to load conversations', error);\n        set({\n          error: error instanceof Error ? error.message : 'Failed to load conversations',\n          loading: false,\n          conversations: [] // Start with empty on error\n        });\n      }\n    },\n\n    createConversation: async (projectId: number, name?: string): Promise<void> => {\n      const isDemoMode = typeof window !== 'undefined' && (window as any).__customgpt_demo_mode;\n      \n      logger.info('CONVERSATIONS', 'Creating conversation in widget store', {\n        sessionId,\n        projectId,\n        name\n      });\n\n      set({ loading: true, error: null });\n\n      try {\n        // Use the API to create the conversation\n        const client = getClient();\n        \n        if (isDemoMode) {\n          // Demo mode - create locally only\n          const timestamp = Date.now();\n          const random = Math.floor(Math.random() * 1000000);\n          const sessionIdForConv = `demo_session_${timestamp}_${random}_${sessionId}`;\n\n          const newConversation: Conversation = {\n            id: Math.floor(Math.random() * 1000000),\n            session_id: sessionIdForConv,\n            project_id: projectId,\n            name: name || 'New Conversation',\n            message_count: 0,\n            created_at: new Date().toISOString(),\n            updated_at: new Date().toISOString(),\n            deleted_at: null,\n          };\n\n          set(state => ({\n            conversations: [...state.conversations, newConversation],\n            currentConversation: newConversation,\n            loading: false,\n          }));\n          \n          saveConversationsToStorage(projectId.toString(), [...get().conversations]);\n          return;\n        }\n        \n        // Create conversation via API\n        const response = await client.createConversation(projectId, name ? { name } : undefined);\n        const newConversation = response.data;\n        \n        // Ensure the conversation has our widget session ID in it for filtering\n        // Store the widget session ID in localStorage to track which conversations belong to this widget\n        const widgetConvKey = `widget_conversations_${sessionId}`;\n        const existingConvIds = JSON.parse(localStorage.getItem(widgetConvKey) || '[]');\n        existingConvIds.push(newConversation.id);\n        localStorage.setItem(widgetConvKey, JSON.stringify(existingConvIds));\n        \n        logger.info('CONVERSATIONS', 'Created conversation via API', {\n          conversationId: newConversation.id,\n          sessionId: newConversation.session_id,\n          projectId: newConversation.project_id,\n          widgetSessionId: sessionId\n        });\n        \n        set(state => ({ \n          conversations: [...state.conversations, newConversation],\n          currentConversation: newConversation,\n          loading: false,\n        }));\n        \n        // Save to local storage for this widget session\n        saveConversationsToStorage(projectId.toString(), get().conversations);\n      } catch (error) {\n        logger.error('CONVERSATIONS', 'Failed to create conversation', error);\n        set({ \n          error: error instanceof Error ? error.message : 'Failed to create conversation',\n          loading: false \n        });\n        throw error;\n      }\n    },\n\n    updateConversation: async (conversationId: number, sessionId: string, data: { name: string }) => {\n      logger.info('CONVERSATIONS', 'Updating conversation in widget store', {\n        sessionId: sessionId,\n        conversationId,\n        data\n      });\n\n      set(state => ({\n        conversations: state.conversations.map(conv =>\n          conv.id.toString() === conversationId.toString()\n            ? { ...conv, name: data.name, updated_at: new Date().toISOString() }\n            : conv\n        ),\n      }));\n\n      // Update current conversation if it's the one being updated\n      const current = get().currentConversation;\n      if (current && current.id.toString() === conversationId.toString()) {\n        set({\n          currentConversation: { ...current, name: data.name, updated_at: new Date().toISOString() },\n        });\n      }\n\n      // Save to storage\n      const projectId = get().conversations.find(c => c.id.toString() === conversationId.toString())?.project_id;\n      if (projectId) {\n        saveConversationsToStorage(projectId.toString(), get().conversations);\n      }\n    },\n\n    deleteConversation: async (conversationId: string | number) => {\n      logger.info('CONVERSATIONS', 'Deleting conversation from widget store', {\n        sessionId,\n        conversationId\n      });\n\n      const conversation = get().conversations.find(c => c.id.toString() === conversationId);\n      if (!conversation) return;\n\n      set(state => ({\n        conversations: state.conversations.filter(conv => conv.id.toString() !== conversationId),\n        currentConversation: state.currentConversation?.id.toString() === conversationId\n          ? null\n          : state.currentConversation,\n      }));\n\n      // Save to storage\n      saveConversationsToStorage(conversation.project_id.toString(), get().conversations);\n    },\n\n    selectConversation: (conversation: Conversation) => {\n      logger.info('CONVERSATIONS', 'Selecting conversation in widget store', {\n        sessionId,\n        conversationId: conversation?.id\n      });\n\n      set({ currentConversation: conversation });\n\n      // Update activity tracking\n      if (conversation) {\n        const activity = { ...get().lastConversationActivity };\n        activity[conversation.project_id.toString()] = conversation.id.toString();\n        set({ lastConversationActivity: activity });\n        saveActivityToStorage(activity);\n      }\n    },\n\n    ensureConversation: async (projectId: number, firstMessage?: string) => {\n      const { conversations, currentConversation } = get();\n      \n      const agentId = projectId.toString();\n      \n      // If we have a current conversation for this agent, use it\n      if (currentConversation && currentConversation.project_id === projectId) {\n        return currentConversation;\n      }\n\n      // Look for existing conversation for this agent\n      const existingConversation = conversations.find(c => c.project_id === projectId);\n      if (existingConversation) {\n        set({ currentConversation: existingConversation });\n        return existingConversation;\n      }\n\n      // Create new conversation\n      const title = firstMessage\n        ? firstMessage.substring(0, 50) + (firstMessage.length > 50 ? '...' : '')\n        : 'New Conversation';\n      \n      await get().createConversation(projectId, title);\n      \n      // Get the newly created conversation\n      const newConversation = get().conversations[get().conversations.length - 1];\n      set({ currentConversation: newConversation });\n      \n      return newConversation;\n    },\n\n    reset: () => {\n      set({\n        conversations: [],\n        currentConversation: null,\n        loading: false,\n        error: null,\n        lastConversationActivity: {},\n      });\n    },\n  }));\n}","/**\n * Widget-specific Agent Store Factory\n * \n * Creates an isolated agent store instance for each widget.\n * This ensures agent selection is not shared between different widget instances.\n */\n\nimport { create, StoreApi } from 'zustand';\nimport type { Agent } from '@/types';\nimport { getClient } from '@/lib/api/client';\nimport { logger } from '@/lib/logger';\n\n// Agent Store interface - widget-specific version with minimal methods\nexport interface AgentStore {\n  agents: Agent[];\n  currentAgent: Agent | null;\n  loading: boolean;\n  error: string | null;\n  \n  loadAgents: () => Promise<void>;\n  fetchAgents: () => Promise<void>; // Alias for compatibility\n  selectAgent: (agent: Agent) => void;\n  setAgents: (agents: Agent[]) => void;\n  updateAgent: (id: number, data: { are_licenses_allowed?: boolean }) => Promise<Agent>;\n  deleteAgent: (id: number) => Promise<void>;\n  createAgent: (data: any) => Promise<Agent>;\n  replicateAgent: (id: number) => Promise<Agent>;\n  getAgentStats: (id: number) => Promise<any>;\n  reset: () => void;\n}\n\n/**\n * Create an agent store instance for a specific widget\n * @param sessionId - The widget's session ID for isolation\n */\nexport function createAgentStore(sessionId: string): StoreApi<AgentStore> {\n  const AGENTS_STORAGE_KEY = `customgpt-agents-cache-${sessionId}`;\n  const SELECTED_AGENT_KEY = `customgpt-selected-agent-${sessionId}`;\n  \n  // Local storage helpers scoped to this instance\n  function saveAgentsToStorage(agents: Agent[]) {\n    try {\n      localStorage.setItem(AGENTS_STORAGE_KEY, JSON.stringify(agents));\n    } catch (error) {\n      console.error('Failed to save agents to storage:', error);\n    }\n  }\n\n  function loadAgentsFromStorage(): Agent[] | null {\n    try {\n      const stored = localStorage.getItem(AGENTS_STORAGE_KEY);\n      return stored ? JSON.parse(stored) : null;\n    } catch (error) {\n      console.error('Failed to load agents from storage:', error);\n      return null;\n    }\n  }\n\n  function saveSelectedAgentToStorage(agentId: string | null) {\n    try {\n      if (agentId) {\n        localStorage.setItem(SELECTED_AGENT_KEY, agentId);\n      } else {\n        localStorage.removeItem(SELECTED_AGENT_KEY);\n      }\n    } catch (error) {\n      console.error('Failed to save selected agent to storage:', error);\n    }\n  }\n\n  function loadSelectedAgentFromStorage(): string | null {\n    try {\n      return localStorage.getItem(SELECTED_AGENT_KEY);\n    } catch (error) {\n      console.error('Failed to load selected agent from storage:', error);\n      return null;\n    }\n  }\n\n  return create<AgentStore>((set, get) => ({\n    agents: [],\n    currentAgent: null,\n    loading: false,\n    error: null,\n\n    fetchAgents: async () => {\n      // Alias for loadAgents for compatibility\n      return get().loadAgents();\n    },\n\n    loadAgents: async () => {\n      const isDemoMode = typeof window !== 'undefined' && (window as any).__customgpt_demo_mode;\n      \n      // Get widget instance from window using session ID\n      const widgetKey = `__customgpt_widget_${sessionId}`;\n      const widget = typeof window !== 'undefined' ? (window as any)[widgetKey] : null;\n      \n      logger.info('AGENTS', 'Loading agents for widget store', {\n        sessionId,\n        isDemoMode,\n        hasWidget: !!widget,\n        configuredAgentId: widget?.config?.agentId\n      });\n\n      set({ loading: true, error: null });\n\n      try {\n        // If widget has a configured agentId, fetch that specific agent from API\n        if (widget?.config?.agentId) {\n          const client = getClient();\n          \n          if (isDemoMode) {\n            // Demo mode - create fake agent\n            const singleAgent: Agent = {\n              id: widget.config.agentId,\n              project_name: widget.config.name || 'CustomGPT Assistant',\n              type: 'WIDGET',\n              created_at: new Date().toISOString(),\n              updated_at: new Date().toISOString(),\n              is_chat_active: true,\n              is_shared: false,\n              user_id: 0,\n              team_id: 0,\n            };\n\n            set({\n              agents: [singleAgent],\n              currentAgent: singleAgent,\n              loading: false,\n            });\n\n            saveAgentsToStorage([singleAgent]);\n            saveSelectedAgentToStorage(singleAgent.id.toString());\n            return;\n          }\n          \n          try {\n            // Fetch the specific agent from API\n            const response = await client.getAgent(widget.config.agentId);\n            const agent = response.data || response;\n            \n            logger.info('AGENTS', 'Fetched specific agent from API', {\n              agentId: agent.id,\n              agentName: agent.project_name\n            });\n            \n            set({\n              agents: [agent],\n              currentAgent: agent,\n              loading: false,\n            });\n\n            saveAgentsToStorage([agent]);\n            saveSelectedAgentToStorage(agent.id.toString());\n            return;\n          } catch (error) {\n            logger.error('AGENTS', 'Failed to fetch specific agent', error);\n            // Fall back to cached data if available\n            const cachedAgents = loadAgentsFromStorage();\n            if (cachedAgents && cachedAgents.length > 0) {\n              const agent = cachedAgents.find(a => a.id === widget.config.agentId) || cachedAgents[0];\n              set({\n                agents: cachedAgents,\n                currentAgent: agent,\n                loading: false,\n              });\n              return;\n            }\n            throw error;\n          }\n        }\n\n        // No specific agent ID - fetch all agents from API\n        if (!isDemoMode) {\n          const client = getClient();\n          const response = await client.getAgents();\n          \n          // Handle different response formats\n          let agents: Agent[] = [];\n          if (Array.isArray(response)) {\n            agents = response;\n          } else if ((response as any).data && Array.isArray((response as any).data)) {\n            agents = (response as any).data;\n          } else if ((response as any).data && (response as any).data.data && Array.isArray((response as any).data.data)) {\n            agents = (response as any).data.data;\n          }\n          \n          logger.info('AGENTS', 'Fetched agents from API', {\n            count: agents.length\n          });\n          \n          // Select first agent or previously selected\n          const selectedAgentId = loadSelectedAgentFromStorage();\n          const selectedAgent = selectedAgentId \n            ? agents.find(a => a.id.toString() === selectedAgentId) || agents[0]\n            : agents[0];\n          \n          set({\n            agents,\n            currentAgent: selectedAgent || null,\n            loading: false,\n          });\n          \n          saveAgentsToStorage(agents);\n          if (selectedAgent) {\n            saveSelectedAgentToStorage(selectedAgent.id.toString());\n          }\n          return;\n        }\n\n        // Demo mode without specific agent ID\n        if (isDemoMode) {\n          // Create demo agents\n          const demoAgents: Agent[] = [\n            {\n              id: 1,\n              project_name: 'Demo Assistant',\n              type: 'DEMO',\n              created_at: new Date().toISOString(),\n              updated_at: new Date().toISOString(),\n              is_chat_active: true,\n              is_shared: false,\n              user_id: 0,\n              team_id: 0,\n            },\n          ];\n          \n          set({\n            agents: demoAgents,\n            currentAgent: demoAgents[0],\n            loading: false,\n          });\n          \n          saveAgentsToStorage(demoAgents);\n          saveSelectedAgentToStorage(demoAgents[0].id.toString());\n          return;\n        }\n\n        // Should not reach here\n        set({\n          agents: [],\n          currentAgent: null,\n          loading: false,\n        });\n      } catch (error) {\n        logger.error('AGENTS', 'Failed to load agents', error);\n        set({\n          error: error instanceof Error ? error.message : 'Failed to load agents',\n          loading: false,\n        });\n      }\n    },\n\n    selectAgent: (agent: Agent) => {\n      logger.info('AGENTS', 'Selecting agent in widget store', {\n        sessionId,\n        agentId: agent?.id,\n        agentName: agent?.project_name\n      });\n\n      set({ currentAgent: agent });\n      saveSelectedAgentToStorage(agent?.id.toString() || null);\n\n      // Update widget instance if available\n      const widgetKey = `__customgpt_widget_${sessionId}`;\n      const widget = typeof window !== 'undefined' ? (window as any)[widgetKey] : null;\n      \n      if (widget && agent) {\n        widget.config.agentId = agent.id;\n        widget.config.name = agent.project_name;\n      }\n    },\n\n    setAgents: (agents: Agent[]) => {\n      set({ agents });\n      saveAgentsToStorage(agents);\n    },\n\n    updateAgent: async (id: number, data: { are_licenses_allowed?: boolean }) => {\n      logger.info('AGENTS', 'Updating agent in widget store', {\n        sessionId,\n        agentId: id,\n        data\n      });\n\n      const agent = get().agents.find(a => a.id === id);\n      if (!agent) {\n        throw new Error('Agent not found');\n      }\n\n      const updatedAgent = { ...agent, ...data };\n      \n      set(state => ({\n        agents: state.agents.map(a =>\n          a.id === id ? updatedAgent : a\n        ),\n        currentAgent: state.currentAgent?.id === id\n          ? updatedAgent\n          : state.currentAgent,\n      }));\n\n      // Save to storage\n      saveAgentsToStorage(get().agents);\n      \n      return updatedAgent;\n    },\n\n    deleteAgent: async (id: number) => {\n      logger.info('AGENTS', 'Deleting agent from widget store', {\n        sessionId,\n        agentId: id\n      });\n\n      set(state => ({\n        agents: state.agents.filter(a => a.id !== id),\n        currentAgent: state.currentAgent?.id === id ? null : state.currentAgent,\n      }));\n\n      // Save to storage\n      saveAgentsToStorage(get().agents);\n    },\n\n    createAgent: async (data: any) => {\n      // Widgets typically don't create agents, but we need this for compatibility\n      throw new Error('Creating agents is not supported in widget mode');\n    },\n\n    replicateAgent: async (id: number) => {\n      // Widgets typically don't replicate agents\n      throw new Error('Replicating agents is not supported in widget mode');\n    },\n\n    getAgentStats: async (id: number) => {\n      // Return empty stats for widget mode\n      return {\n        messages_sent: 0,\n        users_interacted: 0,\n        last_message_at: null\n      };\n    },\n\n    reset: () => {\n      set({\n        agents: [],\n        currentAgent: null,\n        loading: false,\n        error: null,\n      });\n      \n      // Clear storage\n      try {\n        localStorage.removeItem(AGENTS_STORAGE_KEY);\n        localStorage.removeItem(SELECTED_AGENT_KEY);\n      } catch (error) {\n        console.error('Failed to clear agent storage:', error);\n      }\n    },\n  }));\n}","import React, { createContext, useContext, useRef, ReactNode } from 'react';\nimport { StoreApi } from 'zustand';\nimport { createMessageStore, MessageStore } from '../store/widget-stores/messages';\nimport { createConversationStore, ConversationStore } from '../store/widget-stores/conversations';\nimport { createAgentStore, AgentStore } from '../store/widget-stores/agents';\n\n/**\n * Widget Store Context\n * \n * Provides instance-specific Zustand stores for each widget.\n * This ensures complete data isolation between multiple widgets.\n * \n * Each widget instance gets its own:\n * - Message store (for chat messages)\n * - Conversation store (for conversation management)\n * - Agent store (for agent selection)\n * \n * The config store remains global as API configuration should be shared.\n */\n\ninterface WidgetStores {\n  messageStore: StoreApi<MessageStore>;\n  conversationStore: StoreApi<ConversationStore>;\n  agentStore: StoreApi<AgentStore>;\n}\n\ninterface WidgetStoreContextValue {\n  stores: WidgetStores;\n}\n\nexport const WidgetStoreContext = createContext<WidgetStoreContextValue | null>(null);\n\ninterface WidgetStoreProviderProps {\n  children: ReactNode;\n  sessionId: string;\n}\n\n/**\n * Widget Store Provider\n * \n * Creates and provides instance-specific stores for a widget.\n * Stores are created once per widget instance and reused.\n */\nexport const WidgetStoreProvider: React.FC<WidgetStoreProviderProps> = ({ \n  children, \n  sessionId \n}) => {\n  // Use ref to ensure stores are only created once per widget instance\n  const storesRef = useRef<WidgetStores | null>(null);\n  \n  if (!storesRef.current) {\n    // Create stores in the correct order, passing references to dependent stores\n    const agentStore = createAgentStore(sessionId);\n    const conversationStore = createConversationStore(sessionId);\n    const messageStore = createMessageStore(sessionId, agentStore, conversationStore);\n    \n    storesRef.current = {\n      messageStore,\n      conversationStore,\n      agentStore,\n    };\n  }\n  \n  return (\n    <WidgetStoreContext.Provider value={{ stores: storesRef.current }}>\n      {children}\n    </WidgetStoreContext.Provider>\n  );\n};\n\n/**\n * Hook to access widget-specific stores\n */\nexport const useWidgetStores = (): WidgetStores => {\n  const context = useContext(WidgetStoreContext);\n  if (!context) {\n    throw new Error('useWidgetStores must be used within WidgetStoreProvider');\n  }\n  return context.stores;\n};\n\n/**\n * Individual store hooks for easier access\n */\nexport const useWidgetMessageStore = () => {\n  const { messageStore } = useWidgetStores();\n  return messageStore;\n};\n\nexport const useWidgetConversationStore = () => {\n  const { conversationStore } = useWidgetStores();\n  return conversationStore;\n};\n\nexport const useWidgetAgentStore = () => {\n  const { agentStore } = useWidgetStores();\n  return agentStore;\n};","/**\n * Widget Store Hooks\n * \n * These hooks automatically select between global and widget-specific stores\n * based on whether the component is rendered inside a widget context.\n */\n\nimport { useContext } from 'react';\nimport { useStore } from 'zustand';\nimport { WidgetStoreContext } from '../widget/WidgetStoreContext';\nimport { useMessageStore as useGlobalMessageStore } from '../store';\nimport { useConversationStore as useGlobalConversationStore } from '../store';\nimport { useAgentStore as useGlobalAgentStore } from '../store';\nimport type { MessageStore } from '../store/widget-stores/messages';\nimport type { ConversationStore } from '../store/widget-stores/conversations';\nimport type { AgentStore } from '../store/widget-stores/agents';\n\n/**\n * Check if we're inside a widget context\n */\nfunction useIsInWidgetContext(): boolean {\n  try {\n    const context = useContext(WidgetStoreContext);\n    return context !== null;\n  } catch {\n    return false;\n  }\n}\n\n/**\n * Get widget stores if inside widget context\n */\nfunction useWidgetStores() {\n  const context = useContext(WidgetStoreContext);\n  return context?.stores;\n}\n\n/**\n * Message store hook that automatically selects the correct store\n */\nexport function useMessageStore() {\n  const isInWidget = useIsInWidgetContext();\n  const widgetStores = useWidgetStores();\n  \n  if (isInWidget && widgetStores) {\n    // Use widget-specific store\n    return useStore(widgetStores.messageStore);\n  }\n  \n  // Use global store\n  return useGlobalMessageStore();\n}\n\n/**\n * Conversation store hook that automatically selects the correct store\n */\nexport function useConversationStore() {\n  const isInWidget = useIsInWidgetContext();\n  const widgetStores = useWidgetStores();\n  \n  if (isInWidget && widgetStores) {\n    // Use widget-specific store\n    return useStore(widgetStores.conversationStore);\n  }\n  \n  // Use global store\n  return useGlobalConversationStore();\n}\n\n/**\n * Agent store hook that automatically selects the correct store\n */\nexport function useAgentStore() {\n  const isInWidget = useIsInWidgetContext();\n  const widgetStores = useWidgetStores();\n  \n  if (isInWidget && widgetStores) {\n    // Use widget-specific store\n    return useStore(widgetStores.agentStore);\n  }\n  \n  // Use global store\n  return useGlobalAgentStore();\n}\n\n/**\n * Export convenience functions to check store source\n */\nexport function useIsUsingWidgetStore(): boolean {\n  return useIsInWidgetContext();\n}\n\n/**\n * Get the current session ID if in widget context\n */\nexport function useWidgetSessionId(): string | null {\n  const context = useContext(WidgetStoreContext);\n  if (!context) return null;\n  \n  // Extract session ID from the store's localStorage key\n  // This is a bit hacky but works for now\n  const messageStore = context.stores.messageStore;\n  const state = messageStore.getState();\n  \n  // Try to get from widget context or fall back to parsing\n  return null; // TODO: Add sessionId to context if needed\n}","/**\n * Agent Selector Component\n * \n * Dropdown selector for switching between different CustomGPT agents.\n * Displays the current agent and allows users to select from available agents.\n * \n * Features:\n * - Current agent display with avatar\n * - Dropdown list of all available agents\n * - Agent metadata display (model, status)\n * - Quick settings access per agent\n * - Refresh agents functionality\n * - Loading and error states\n * - Click-outside-to-close behavior\n * - Smooth animations\n * \n * State Management:\n * - Uses agentStore for agent data\n * - Local state for dropdown open/close\n * - Automatic agent fetching on dropdown open\n * \n * UI/UX:\n * - Visual selection indicator (checkmark)\n * - Hover states for better interactivity\n * - Loading skeleton for initial load\n * - Error state with retry option\n * - Empty state guidance\n * \n * Customization for contributors:\n * - Add agent search/filter functionality\n * - Implement agent favorites/pinning\n * - Add agent creation shortcut\n * - Customize agent avatar display\n * - Add agent status indicators\n * - Implement agent grouping/categories\n * - Add keyboard navigation support\n */\n\n'use client';\n\nimport React, { useState, useRef, useEffect } from 'react';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport { \n  Bot, \n  ChevronDown, \n  Settings, \n  RefreshCw,\n  AlertCircle,\n  Check\n} from 'lucide-react';\nimport { toast } from 'sonner';\n\nimport type { Agent } from '@/types';\nimport { cn } from '@/lib/utils';\nimport { Button } from '@/components/ui/button';\nimport { useAgentStore } from '@/hooks/useWidgetStore';\n\n/**\n * Props for AgentSelector component\n * \n * @property className - Additional CSS classes\n * @property showSettings - Whether to show settings button for each agent\n * @property onSettingsClick - Callback when settings button is clicked\n */\ninterface AgentSelectorProps {\n  className?: string;\n  showSettings?: boolean;\n  onSettingsClick?: (agent: Agent) => void;\n}\n\n/**\n * Props for individual agent item in dropdown\n * \n * @property agent - Agent data object\n * @property isSelected - Whether this agent is currently selected\n * @property onSelect - Callback when agent is selected\n * @property onSettingsClick - Optional callback for settings button\n */\ninterface AgentItemProps {\n  agent: Agent;\n  isSelected: boolean;\n  onSelect: (agent: Agent) => void;\n  onSettingsClick?: (agent: Agent) => void;\n}\n\n/**\n * Individual Agent Item Component\n * \n * Renders a single agent in the dropdown list with:\n * - Agent avatar and name\n * - Selection indicator\n * - Metadata (model, status)\n * - Settings button (optional)\n */\nconst AgentItem: React.FC<AgentItemProps> = ({ \n  agent, \n  isSelected, \n  onSelect, \n  onSettingsClick \n}) => {\n  return (\n    <div\n      className={cn(\n        'flex items-center justify-between p-3 rounded-lg cursor-pointer transition-colors group',\n        'hover:bg-gray-50',\n        isSelected && 'bg-brand-50 hover:bg-brand-100'\n      )}\n      onClick={() => onSelect(agent)}\n    >\n      <div className=\"flex items-center gap-3 flex-1 min-w-0\">\n        {/* Avatar */}\n        <div className={cn(\n          'w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0',\n          isSelected ? 'bg-brand-600' : 'bg-gray-200'\n        )}>\n          <Bot className={cn(\n            'w-4 h-4',\n            isSelected ? 'text-white' : 'text-gray-600'\n          )} />\n        </div>\n        \n        {/* Agent Info */}\n        <div className=\"flex-1 min-w-0\">\n          <div className=\"flex items-center gap-2\">\n            <h3 className=\"font-medium text-gray-900 truncate\">\n              {agent.project_name}\n            </h3>\n            {isSelected && (\n              <Check className=\"w-4 h-4 text-brand-600 flex-shrink-0\" />\n            )}\n          </div>\n          \n          {/* Metadata */}\n          <div className=\"flex items-center gap-3 mt-1 text-xs text-gray-400\">\n            {agent.settings?.chatbot_model && (\n              <span>Model: {agent.settings.chatbot_model}</span>\n            )}\n            <span>Status: {agent.is_chat_active ? 'Active' : 'Inactive'}</span>\n          </div>\n        </div>\n      </div>\n      \n      {/* Settings Button */}\n      {onSettingsClick && (\n        <Button\n          size=\"icon\"\n          variant=\"ghost\"\n          onClick={(e) => {\n            e.stopPropagation();\n            onSettingsClick(agent);\n          }}\n          className=\"opacity-0 group-hover:opacity-100 transition-opacity h-6 w-6 text-gray-400 hover:text-gray-600\"\n          title=\"Agent Settings\"\n        >\n          <Settings className=\"h-3 w-3\" />\n        </Button>\n      )}\n    </div>\n  );\n};\n\n/**\n * Agent Selector Component\n * \n * Main component that provides agent switching functionality.\n * Manages dropdown state and handles agent selection.\n * \n * @param className - Additional CSS classes for styling\n * @param showSettings - Whether to show settings buttons (default: true)\n * @param onSettingsClick - Handler for agent settings clicks\n */\nexport const AgentSelector: React.FC<AgentSelectorProps> = ({ \n  className,\n  showSettings = true,\n  onSettingsClick\n}) => {\n  const [isOpen, setIsOpen] = useState(false);\n  const dropdownRef = useRef<HTMLDivElement>(null);\n  \n  const { \n    agents, \n    currentAgent, \n    loading, \n    error, \n    fetchAgents, \n    selectAgent \n  } = useAgentStore();\n\n  /**\n   * Close dropdown when clicking outside\n   * \n   * Uses mousedown event for better UX (closes before click completes)\n   */\n  useEffect(() => {\n    const handleClickOutside = (event: MouseEvent) => {\n      if (dropdownRef.current && !dropdownRef.current.contains(event.target as Node)) {\n        setIsOpen(false);\n      }\n    };\n\n    if (isOpen) {\n      document.addEventListener('mousedown', handleClickOutside);\n      return () => document.removeEventListener('mousedown', handleClickOutside);\n    }\n  }, [isOpen]);\n\n  /**\n   * Refresh agents list\n   * \n   * Fetches latest agents from the API and shows toast feedback\n   */\n  const handleRefresh = async () => {\n    try {\n      await fetchAgents();\n      toast.success('Agents refreshed');\n    } catch (error) {\n      toast.error('Failed to refresh agents');\n    }\n  };\n\n  /**\n   * Handle agent selection\n   * \n   * Updates the current agent, closes dropdown, and shows confirmation\n   */\n  const handleSelectAgent = (agent: Agent) => {\n    selectAgent(agent);\n    setIsOpen(false);\n    toast.success(`Switched to ${agent.project_name}`);\n  };\n\n  /**\n   * Toggle dropdown and fetch agents\n   * \n   * When opening, automatically fetches latest agents.\n   * Errors are logged but not shown to avoid annoying toasts.\n   */\n  const handleToggleDropdown = async () => {\n    const willOpen = !isOpen;\n    setIsOpen(willOpen);\n    \n    // Fetch agents when opening the dropdown\n    if (willOpen) {\n      try {\n        await fetchAgents();\n      } catch (error) {\n        console.error('Failed to fetch agents:', error);\n        // Don't show error toast here as it might be annoying\n      }\n    }\n  };\n\n  if (loading && agents.length === 0) {\n    return (\n      <div className={cn('p-3 bg-white border rounded-lg', className)}>\n        <div className=\"flex items-center gap-3\">\n          <div className=\"w-8 h-8 rounded-full bg-gray-200 animate-pulse\" />\n          <div className=\"flex-1\">\n            <div className=\"h-4 bg-gray-200 rounded animate-pulse mb-2\" />\n            <div className=\"h-3 bg-gray-100 rounded animate-pulse w-3/4\" />\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  if (error && agents.length === 0) {\n    return (\n      <div className={cn('p-3 bg-white border rounded-lg', className)}>\n        <div className=\"flex items-center gap-3\">\n          <div className=\"w-8 h-8 rounded-full bg-red-100 flex items-center justify-center\">\n            <AlertCircle className=\"w-4 h-4 text-red-600\" />\n          </div>\n          <div className=\"flex-1\">\n            <p className=\"text-sm text-red-600 font-medium\">Failed to load agents</p>\n            <p className=\"text-xs text-red-500\">{error}</p>\n          </div>\n          <Button\n            size=\"sm\"\n            variant=\"ghost\"\n            onClick={handleRefresh}\n            className=\"text-red-600 hover:text-red-700\"\n          >\n            <RefreshCw className=\"w-4 h-4\" />\n          </Button>\n        </div>\n      </div>\n    );\n  }\n\n  if (!currentAgent && agents.length === 0) {\n    return (\n      <div className={cn('p-3 bg-white border rounded-lg', className)}>\n        <div className=\"flex items-center gap-3\">\n          <div className=\"w-8 h-8 rounded-full bg-gray-200 flex items-center justify-center\">\n            <Bot className=\"w-4 h-4 text-gray-600\" />\n          </div>\n          <div className=\"flex-1\">\n            <p className=\"text-sm text-gray-600 font-medium\">No agents available</p>\n            <p className=\"text-xs text-gray-500\">Check your API configuration</p>\n          </div>\n          <Button\n            size=\"sm\"\n            variant=\"ghost\"\n            onClick={handleRefresh}\n            disabled={loading}\n          >\n            <RefreshCw className={cn('w-4 h-4', loading && 'animate-spin')} />\n          </Button>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className={cn('relative', className)} ref={dropdownRef}>\n      {/* Selected Agent Display */}\n      <button\n        onClick={handleToggleDropdown}\n        className={cn(\n          'w-full p-3 bg-white border rounded-lg text-left transition-colors',\n          'hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-brand-500 focus:border-transparent',\n          isOpen && 'ring-2 ring-brand-500 border-transparent'\n        )}\n      >\n        <div className=\"flex items-center justify-between\">\n          <div className=\"flex items-center gap-3 flex-1 min-w-0\">\n            {/* Avatar */}\n            <div className=\"w-8 h-8 rounded-full bg-brand-600 flex items-center justify-center flex-shrink-0\">\n              <Bot className=\"w-4 h-4 text-white\" />\n            </div>\n            \n            {/* Agent Info */}\n            <div className=\"flex-1 min-w-0\">\n              <h3 className=\"font-medium text-gray-900 truncate\">\n                {currentAgent?.project_name || 'Select Agent'}\n              </h3>\n            </div>\n          </div>\n          \n          <div className=\"flex items-center gap-2\">\n            {/* Refresh Button */}\n            <Button\n              size=\"icon\"\n              variant=\"ghost\"\n              onClick={(e) => {\n                e.stopPropagation();\n                handleRefresh();\n              }}\n              disabled={loading}\n              className=\"h-6 w-6 text-gray-400 hover:text-gray-600\"\n              title=\"Refresh Agents\"\n            >\n              <RefreshCw className={cn('h-3 w-3', loading && 'animate-spin')} />\n            </Button>\n            \n            {/* Dropdown Arrow */}\n            <ChevronDown className={cn(\n              'w-4 h-4 text-gray-400 transition-transform',\n              isOpen && 'rotate-180'\n            )} />\n          </div>\n        </div>\n      </button>\n\n      {/* Dropdown */}\n      <AnimatePresence>\n        {isOpen && (\n          <motion.div\n            initial={{ opacity: 0, y: -10 }}\n            animate={{ opacity: 1, y: 0 }}\n            exit={{ opacity: 0, y: -10 }}\n            transition={{ duration: 0.2 }}\n            className=\"absolute top-full left-0 right-0 mt-2 bg-white border rounded-lg shadow-lg z-50 max-h-80 overflow-y-auto\"\n          >\n            <div className=\"p-2\">\n              {/* Header */}\n              <div className=\"px-2 py-1 mb-2\">\n                <h4 className=\"text-xs font-medium text-gray-500 uppercase tracking-wide\">\n                  Available Agents ({Array.isArray(agents) ? agents.length : 0})\n                </h4>\n              </div>\n              \n              {/* Agent List */}\n              <div className=\"space-y-1\">\n                {Array.isArray(agents) && agents.length > 0 ? (\n                  agents.map((agent) => (\n                    <AgentItem\n                      key={agent.id}\n                      agent={agent}\n                      isSelected={currentAgent?.id === agent.id}\n                      onSelect={handleSelectAgent}\n                      onSettingsClick={showSettings ? onSettingsClick : undefined}\n                    />\n                  ))\n                ) : (\n                  <div className=\"px-2 py-4 text-center\">\n                    <p className=\"text-sm text-gray-500\">No agents found</p>\n                    <Button\n                      size=\"sm\"\n                      variant=\"ghost\"\n                      onClick={handleRefresh}\n                      className=\"mt-2\"\n                    >\n                      <RefreshCw className=\"w-4 h-4 mr-2\" />\n                      Refresh\n                    </Button>\n                  </div>\n                )}\n              </div>\n              \n            </div>\n          </motion.div>\n        )}\n      </AnimatePresence>\n    </div>\n  );\n};","/**\n * Citation Details Modal Component\n * \n * Modal dialog that displays detailed information about a citation,\n * including Open Graph data fetched from the cited source.\n * \n * Features:\n * - Open Graph data display (title, description, image)\n * - Loading and error states\n * - Responsive modal design\n * - Image preview with error handling\n * - Direct link to source\n * - Citation metadata display\n * - Smooth animations\n * \n * API Integration:\n * - Fetches citation details via getCitation API\n * - Handles Open Graph data response\n * - Graceful error handling\n * - Automatic retry on prop changes\n * \n * UI/UX:\n * - Backdrop click to close\n * - Escape key support (via close button)\n * - Loading spinner during fetch\n * - Error message display\n * - Image fallback on load error\n * \n * Customization for contributors:\n * - Add citation caching\n * - Implement citation sharing\n * - Add citation bookmarking\n * - Enhance image preview (zoom, gallery)\n * - Add citation analytics tracking\n * - Implement citation export\n * - Add related citations\n */\n\n'use client';\n\nimport React, { useState, useEffect } from 'react';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport { \n  X, \n  ExternalLink,\n  Loader,\n  AlertCircle,\n  Globe,\n  Image as ImageIcon\n} from 'lucide-react';\n\nimport { Button } from '@/components/ui/button';\nimport { cn } from '@/lib/utils';\nimport { getClient } from '@/lib/api/client';\nimport { logger } from '@/lib/logger';\nimport { useAgentStore } from '@/store/agents';\n\n/**\n * Open Graph data structure for citations\n * \n * @property id - Citation ID\n * @property url - Source URL\n * @property title - Page title from Open Graph\n * @property description - Page description\n * @property image - Optional preview image URL\n */\ninterface CitationOpenGraphData {\n  id: number;\n  url: string;\n  title: string;\n  description: string;\n  image?: string;\n}\n\n/**\n * Props for CitationDetailsModal\n * \n * @property isOpen - Whether modal is visible\n * @property onClose - Callback to close modal\n * @property citationId - ID of citation to display\n * @property projectId - Optional project ID (uses current agent if not provided)\n */\ninterface CitationDetailsModalProps {\n  isOpen: boolean;\n  onClose: () => void;\n  citationId: number | string;\n  projectId?: number;\n}\n\n/**\n * Citation Details Modal Component\n * \n * Displays rich preview of citation with Open Graph data.\n * Fetches citation details from API when opened.\n */\nexport const CitationDetailsModal: React.FC<CitationDetailsModalProps> = ({\n  isOpen,\n  onClose,\n  citationId,\n  projectId\n}) => {\n  const [loading, setLoading] = useState(false);\n  const [error, setError] = useState<string | null>(null);\n  const [citationData, setCitationData] = useState<CitationOpenGraphData | null>(null);\n  const [imageError, setImageError] = useState(false);\n  \n  const { currentAgent } = useAgentStore();\n  const effectiveProjectId = projectId || currentAgent?.id;\n\n  /**\n   * Fetch citation details when modal opens\n   * \n   * Triggers API call when modal becomes visible and required data is available\n   */\n  useEffect(() => {\n    if (isOpen && effectiveProjectId && citationId) {\n      fetchCitationDetails();\n    }\n  }, [isOpen, effectiveProjectId, citationId]);\n\n  /**\n   * Fetch citation Open Graph data from API\n   * \n   * Handles:\n   * - Parameter validation\n   * - API call with proper typing\n   * - Error handling with user-friendly messages\n   * - Loading state management\n   * - Logging for debugging\n   */\n  const fetchCitationDetails = async () => {\n    if (!effectiveProjectId || !citationId) {\n      setError('Missing project or citation information');\n      return;\n    }\n\n    setLoading(true);\n    setError(null);\n    setImageError(false);\n\n    try {\n      const client = getClient();\n      const response = await client.getCitation(\n        effectiveProjectId, \n        typeof citationId === 'string' ? parseInt(citationId, 10) : citationId\n      );\n      \n      if (response.data) {\n        setCitationData(response.data as unknown as CitationOpenGraphData);\n        logger.info('CITATION', 'Citation details fetched', {\n          citationId,\n          projectId: effectiveProjectId,\n          hasImage: !!response.data.image\n        });\n      }\n    } catch (err) {\n      const errorMessage = err instanceof Error ? err.message : 'Failed to fetch citation details';\n      setError(errorMessage);\n      logger.error('CITATION', 'Failed to fetch citation details', {\n        error: err,\n        citationId,\n        projectId: effectiveProjectId\n      });\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  if (!isOpen) return null;\n\n  return (\n    <AnimatePresence>\n      <div className=\"fixed inset-0 z-50 flex items-center justify-center p-4\">\n        {/* Backdrop */}\n        <motion.div\n          initial={{ opacity: 0 }}\n          animate={{ opacity: 1 }}\n          exit={{ opacity: 0 }}\n          onClick={onClose}\n          className=\"absolute inset-0 bg-black/50\"\n        />\n\n        {/* Modal */}\n        <motion.div\n          initial={{ opacity: 0, scale: 0.95 }}\n          animate={{ opacity: 1, scale: 1 }}\n          exit={{ opacity: 0, scale: 0.95 }}\n          className=\"relative bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-hidden\"\n        >\n          {/* Header */}\n          <div className=\"flex items-center justify-between p-4 border-b\">\n            <h2 className=\"text-lg font-semibold text-gray-900\">\n              Citation Details\n            </h2>\n            <Button\n              variant=\"ghost\"\n              size=\"icon\"\n              onClick={onClose}\n              className=\"h-8 w-8\"\n            >\n              <X className=\"h-4 w-4\" />\n            </Button>\n          </div>\n\n          {/* Content */}\n          <div className=\"p-4 overflow-y-auto max-h-[calc(90vh-120px)]\">\n            {loading ? (\n              <div className=\"flex items-center justify-center py-12\">\n                <Loader className=\"h-8 w-8 animate-spin text-gray-400\" />\n              </div>\n            ) : error ? (\n              <div className=\"flex items-center gap-3 p-4 bg-red-50 rounded-lg\">\n                <AlertCircle className=\"h-5 w-5 text-red-600 flex-shrink-0\" />\n                <div className=\"flex-1\">\n                  <p className=\"text-sm font-medium text-red-900\">Error loading citation</p>\n                  <p className=\"text-sm text-red-700 mt-1\">{error}</p>\n                </div>\n              </div>\n            ) : citationData ? (\n              <div className=\"space-y-4\">\n                {/* Open Graph Image */}\n                {citationData.image && !imageError && (\n                  <div className=\"relative rounded-lg overflow-hidden bg-gray-100\">\n                    <img\n                      src={citationData.image}\n                      alt={citationData.title}\n                      className=\"w-full h-auto\"\n                      onError={() => setImageError(true)}\n                    />\n                  </div>\n                )}\n\n                {/* Title */}\n                <div>\n                  <h3 className=\"text-xl font-semibold text-gray-900\">\n                    {citationData.title}\n                  </h3>\n                </div>\n\n                {/* URL */}\n                <div className=\"flex items-center gap-2 text-sm text-gray-600\">\n                  <Globe className=\"h-4 w-4\" />\n                  <a\n                    href={citationData.url}\n                    target=\"_blank\"\n                    rel=\"noopener noreferrer\"\n                    className=\"hover:text-brand-600 transition-colors truncate\"\n                  >\n                    {citationData.url}\n                  </a>\n                </div>\n\n                {/* Description */}\n                {citationData.description && (\n                  <div className=\"prose prose-gray max-w-none\">\n                    <p className=\"text-gray-700\">{citationData.description}</p>\n                  </div>\n                )}\n\n                {/* Metadata */}\n                <div className=\"pt-4 border-t space-y-2\">\n                  <div className=\"flex items-center justify-between text-sm\">\n                    <span className=\"text-gray-500\">Citation ID</span>\n                    <span className=\"font-mono text-gray-700\">#{citationData.id}</span>\n                  </div>\n                  {citationData.image && (\n                    <div className=\"flex items-center justify-between text-sm\">\n                      <span className=\"text-gray-500\">Has preview image</span>\n                      <ImageIcon className=\"h-4 w-4 text-gray-400\" />\n                    </div>\n                  )}\n                </div>\n              </div>\n            ) : null}\n          </div>\n\n          {/* Footer */}\n          <div className=\"p-4 border-t bg-gray-50\">\n            <div className=\"flex items-center justify-between\">\n              <div className=\"text-xs text-gray-500\">\n                Open Graph data from cited source\n              </div>\n              {citationData && (\n                <a\n                  href={citationData.url}\n                  target=\"_blank\"\n                  rel=\"noopener noreferrer\"\n                  className=\"inline-flex items-center gap-2 px-3 py-1.5 text-sm font-medium text-brand-600 hover:text-brand-700 transition-colors\"\n                >\n                  Visit source\n                  <ExternalLink className=\"h-3.5 w-3.5\" />\n                </a>\n              )}\n            </div>\n          </div>\n        </motion.div>\n      </div>\n    </AnimatePresence>\n  );\n};","/**\n * Conversation Manager Component\n * \n * Provides conversation switching UI for widget and floating modes.\n * Shows a list of conversations with ability to create new ones and switch between them.\n * \n * Features:\n * - Conversation list with titles and timestamps\n * - Create new conversation button\n * - Switch between conversations\n * - Edit conversation titles inline\n * - Delete conversations\n * - Session-based isolation\n */\n\nimport React, { useState, useEffect } from 'react';\nimport { Plus, MessageCircle, Edit2, Trash2, Check, X } from 'lucide-react';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport { toast } from 'sonner';\nimport { cn } from '@/lib/utils';\n\ninterface Conversation {\n  id: string;\n  title: string;\n  createdAt: string;\n  messages: any[];\n}\n\ninterface ConversationManagerProps {\n  sessionId: string;\n  maxConversations?: number;\n  currentConversationId?: string;\n  onConversationChange?: (conversation: Conversation) => void;\n  onCreateConversation?: () => void;\n  className?: string;\n  refreshKey?: number; // Add refresh key to force re-render\n}\n\nexport const ConversationManager: React.FC<ConversationManagerProps> = ({\n  sessionId,\n  maxConversations,\n  currentConversationId,\n  onConversationChange,\n  onCreateConversation,\n  className,\n  refreshKey,\n}) => {\n  const [conversations, setConversations] = useState<Conversation[]>([]);\n  const [editingId, setEditingId] = useState<string | null>(null);\n  const [editTitle, setEditTitle] = useState('');\n  const [isExpanded, setIsExpanded] = useState(false);\n\n  // Load conversations from localStorage\n  useEffect(() => {\n    const loadConversations = () => {\n      const stored = localStorage.getItem(`customgpt_conversations_${sessionId}`);\n      if (stored) {\n        try {\n          const parsed = JSON.parse(stored);\n          setConversations(parsed);\n        } catch (e) {\n          console.error('Failed to parse conversations:', e);\n        }\n      }\n    };\n\n    loadConversations();\n    // Listen for storage changes\n    window.addEventListener('storage', loadConversations);\n    return () => window.removeEventListener('storage', loadConversations);\n  }, [sessionId, refreshKey]); // Add refreshKey as dependency\n\n  const handleCreateConversation = () => {\n    if (maxConversations && conversations.length >= maxConversations) {\n      toast.error(`You've reached the maximum limit of ${maxConversations} conversations. Please delete an existing conversation to create a new one.`);\n      return;\n    }\n    onCreateConversation?.();\n  };\n\n  const handleSelectConversation = (conversation: Conversation) => {\n    onConversationChange?.(conversation);\n    setIsExpanded(false);\n  };\n\n  const handleEditStart = (conversation: Conversation) => {\n    setEditingId(conversation.id);\n    setEditTitle(conversation.title);\n  };\n\n  const handleEditSave = (conversationId: string) => {\n    const updated = conversations.map(c =>\n      c.id === conversationId ? { ...c, title: editTitle } : c\n    );\n    setConversations(updated);\n    localStorage.setItem(\n      `customgpt_conversations_${sessionId}`,\n      JSON.stringify(updated)\n    );\n    setEditingId(null);\n  };\n\n  const handleDelete = (conversationId: string) => {\n    if (conversations.length <= 1) {\n      toast.error('Cannot delete the last conversation');\n      return;\n    }\n    \n    const filtered = conversations.filter(c => c.id !== conversationId);\n    setConversations(filtered);\n    localStorage.setItem(\n      `customgpt_conversations_${sessionId}`,\n      JSON.stringify(filtered)\n    );\n    \n    // If deleting current conversation, switch to another\n    if (currentConversationId === conversationId && filtered.length > 0) {\n      onConversationChange?.(filtered[0]);\n    }\n  };\n\n  const currentConversation = conversations.find(c => c.id === currentConversationId);\n\n  return (\n    <div className={cn('relative', className)}>\n      {/* Collapsed View */}\n      <button\n        onClick={() => setIsExpanded(!isExpanded)}\n        className=\"flex items-center gap-2 px-3 py-2 text-sm font-medium text-gray-700 hover:bg-gray-100 rounded-lg transition-colors w-full\"\n      >\n        <MessageCircle className=\"w-4 h-4\" />\n        <span className=\"truncate flex-1 text-left\">\n          {currentConversation?.title || 'Select Conversation'}\n        </span>\n        <svg\n          className={cn('w-4 h-4 transition-transform', isExpanded && 'rotate-180')}\n          fill=\"none\"\n          stroke=\"currentColor\"\n          viewBox=\"0 0 24 24\"\n        >\n          <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M19 9l-7 7-7-7\" />\n        </svg>\n      </button>\n\n      {/* Expanded View */}\n      <AnimatePresence>\n        {isExpanded && (\n          <motion.div\n            initial={{ opacity: 0, y: -10 }}\n            animate={{ opacity: 1, y: 0 }}\n            exit={{ opacity: 0, y: -10 }}\n            transition={{ duration: 0.2 }}\n            className=\"absolute top-full left-0 right-0 mt-2 bg-white rounded-lg shadow-lg border border-gray-200 z-50 max-h-80 overflow-y-auto\"\n          >\n            {/* New Conversation Button */}\n            <button\n              onClick={handleCreateConversation}\n              disabled={maxConversations ? conversations.length >= maxConversations : false}\n              className=\"flex items-center gap-2 w-full px-4 py-3 text-sm font-medium text-brand-600 hover:bg-brand-50 disabled:opacity-50 disabled:cursor-not-allowed border-b\"\n            >\n              <Plus className=\"w-4 h-4\" />\n              New Conversation\n            </button>\n\n            {/* Conversation List */}\n            <div className=\"py-2\">\n              {conversations.map((conversation) => (\n                <div\n                  key={conversation.id}\n                  className={cn(\n                    'group flex items-center px-4 py-2 hover:bg-gray-50',\n                    currentConversationId === conversation.id && 'bg-brand-50'\n                  )}\n                >\n                  {editingId === conversation.id ? (\n                    // Edit Mode\n                    <div className=\"flex items-center gap-2 flex-1\">\n                      <input\n                        type=\"text\"\n                        value={editTitle}\n                        onChange={(e) => setEditTitle(e.target.value)}\n                        onKeyDown={(e) => {\n                          if (e.key === 'Enter') handleEditSave(conversation.id);\n                          if (e.key === 'Escape') setEditingId(null);\n                        }}\n                        className=\"flex-1 px-2 py-1 text-sm border rounded focus:outline-none focus:ring-1 focus:ring-brand-500\"\n                        autoFocus\n                      />\n                      <button\n                        onClick={() => handleEditSave(conversation.id)}\n                        className=\"p-1 text-green-600 hover:bg-green-50 rounded\"\n                      >\n                        <Check className=\"w-4 h-4\" />\n                      </button>\n                      <button\n                        onClick={() => setEditingId(null)}\n                        className=\"p-1 text-gray-400 hover:bg-gray-100 rounded\"\n                      >\n                        <X className=\"w-4 h-4\" />\n                      </button>\n                    </div>\n                  ) : (\n                    // View Mode\n                    <>\n                      <button\n                        onClick={() => handleSelectConversation(conversation)}\n                        className=\"flex-1 text-left\"\n                      >\n                        <div className=\"text-sm font-medium text-gray-900 truncate\">\n                          {conversation.title}\n                        </div>\n                        <div className=\"text-xs text-gray-500\">\n                          {new Date(conversation.createdAt).toLocaleDateString()}\n                        </div>\n                      </button>\n                      <div className=\"flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity\">\n                        <button\n                          onClick={() => handleEditStart(conversation)}\n                          className=\"p-1 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded\"\n                        >\n                          <Edit2 className=\"w-3 h-3\" />\n                        </button>\n                        <button\n                          onClick={() => handleDelete(conversation.id)}\n                          className=\"p-1 text-gray-400 hover:text-red-600 hover:bg-red-50 rounded\"\n                        >\n                          <Trash2 className=\"w-3 h-3\" />\n                        </button>\n                      </div>\n                    </>\n                  )}\n                </div>\n              ))}\n            </div>\n          </motion.div>\n        )}\n      </AnimatePresence>\n    </div>\n  );\n};","import React, { createContext, useContext } from 'react';\n\n// Widget instance type - we'll define the actual widget interface based on what we need\ninterface WidgetInstance {\n  sessionId: string;\n  createConversation: (title?: string) => any;\n  switchConversation: (conversationId: string) => void;\n  getConversations: () => any[];\n  updateConversationTitle: (conversationId: string, newTitle: string) => void;\n  deleteConversation: (conversationId: string) => void;\n  configuration?: any;\n}\n\n// Create the context with undefined default\nconst WidgetContext = createContext<WidgetInstance | undefined>(undefined);\n\n// Provider component props\ninterface WidgetProviderProps {\n  widgetInstance: WidgetInstance;\n  children: React.ReactNode;\n}\n\n// Provider component that will wrap the widget's React tree\nexport const WidgetProvider: React.FC<WidgetProviderProps> = ({ widgetInstance, children }) => {\n  return (\n    <WidgetContext.Provider value={widgetInstance}>\n      {children}\n    </WidgetContext.Provider>\n  );\n};\n\n// Custom hook to use the widget instance from any component\nexport const useWidget = (): WidgetInstance => {\n  const context = useContext(WidgetContext);\n  if (!context) {\n    throw new Error('useWidget must be used within a WidgetProvider');\n  }\n  return context;\n};\n\n// Optional: Hook that returns null instead of throwing if no widget context\nexport const useWidgetSafe = (): WidgetInstance | null => {\n  const context = useContext(WidgetContext);\n  return context || null;\n};","/**\n * ChatContainer Component\n * \n * Main chat interface component that manages the entire chat experience.\n * This is the primary component for integrating CustomGPT chat functionality.\n * \n * Features:\n * - Message display with streaming support\n * - Agent selection and switching\n * - Citation handling with modal details\n * - Multiple deployment modes (standalone, widget, floating)\n * - Welcome screen with example prompts\n * - Error handling and authorization checks\n * \n * For customization:\n * - Modify EXAMPLE_PROMPTS for different starter questions\n * - Customize WelcomeMessage for branding\n * - Adjust ChatHeader for different layouts\n * - Style using Tailwind classes throughout\n */\n\n'use client';\n\nimport React, { useEffect, useRef } from 'react';\nimport { motion } from 'framer-motion';\nimport { Sparkles, Bot } from 'lucide-react';\nimport Link from 'next/link';\nimport { toast } from 'sonner';\n\nimport type { ChatMessage, Citation, Agent } from '@/types';\nimport { cn } from '@/lib/utils';\nimport { Message } from './Message';\nimport { ChatInput } from './ChatInput';\nimport { TypingIndicator } from './TypingIndicator';\nimport { AgentSelector } from './AgentSelector';\nimport { CitationDetailsModal } from './CitationDetailsModal';\nimport { ConversationManager } from './ConversationManager';\nimport { logger } from '@/lib/logger';\nimport { useWidgetSafe } from '@/widget/WidgetContext';\nimport { useMessageStore, useConversationStore, useAgentStore } from '@/hooks/useWidgetStore';\n\n/**\n * Example prompts shown to users when starting a new conversation\n * Customize these based on your agent's capabilities and use cases\n */\nconst EXAMPLE_PROMPTS = [\n  \"What can you help me with?\",\n  \"Explain this document\",\n  \"Summarize key points\",\n  \"Answer my questions\",\n];\n\ninterface ExamplePromptCardProps {\n  /** The prompt text to display */\n  prompt: string;\n  /** Handler called when the prompt is clicked */\n  onClick: (prompt: string) => void;\n}\n\n/**\n * ExamplePromptCard Component\n * \n * Clickable card showing an example prompt that users can select\n * to quickly start a conversation\n */\nconst ExamplePromptCard: React.FC<ExamplePromptCardProps> = ({ prompt, onClick }) => {\n  return (\n    <button\n      onClick={() => onClick(prompt)}\n      className=\"p-3 text-left bg-white border border-gray-200 rounded-lg hover:border-gray-300 hover:shadow-sm transition-all text-sm text-gray-700\"\n    >\n      {prompt}\n    </button>\n  );\n};\n\ninterface WelcomeMessageProps {\n  /** Handler called when an example prompt is clicked */\n  onPromptClick: (prompt: string) => void;\n}\n\n/**\n * WelcomeMessage Component\n * \n * Displays a welcome screen when no messages exist in the conversation.\n * Shows the agent name, welcome text, and example prompts.\n * Uses Framer Motion for smooth animations.\n */\nconst WelcomeMessage: React.FC<WelcomeMessageProps> = ({ onPromptClick }) => {\n  const { currentAgent } = useAgentStore();\n  \n  return (\n    <div className=\"flex flex-col items-center justify-center h-full px-4 py-8\">\n      <motion.div\n        initial={{ opacity: 0, y: 20 }}\n        animate={{ opacity: 1, y: 0 }}\n        transition={{ duration: 0.5 }}\n        className=\"text-center max-w-md\"\n      >\n        {/* Logo */}\n        <div className=\"w-16 h-16 rounded-full bg-brand-100 flex items-center justify-center mb-6 mx-auto\">\n          <Sparkles className=\"w-8 h-8 text-brand-600\" />\n        </div>\n        \n        {/* Welcome Text */}\n        <h3 className=\"text-xl font-semibold text-gray-900 mb-2\">\n          Welcome to {currentAgent?.project_name || 'CustomGPT'}!\n        </h3>\n        <p className=\"text-gray-600 mb-8\">\n          I'm here to help answer your questions and assist with your tasks. How can I help you today?\n        </p>\n        \n        {/* Example Prompts */}\n        <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-3 w-full\">\n          {EXAMPLE_PROMPTS.map((prompt, idx) => (\n            <motion.div\n              key={idx}\n              initial={{ opacity: 0, y: 20 }}\n              animate={{ opacity: 1, y: 0 }}\n              transition={{ duration: 0.3, delay: 0.1 + (idx * 0.1) }}\n            >\n              <ExamplePromptCard\n                prompt={prompt}\n                onClick={onPromptClick}\n              />\n            </motion.div>\n          ))}\n        </div>\n      </motion.div>\n    </div>\n  );\n};\n\ninterface MessageAreaProps {\n  /** Additional CSS classes for styling */\n  className?: string;\n}\n\n/**\n * MessageArea Component\n * \n * Scrollable area that displays all messages in the current conversation.\n * Handles:\n * - Message rendering with streaming support\n * - Auto-scrolling to latest messages\n * - Citation click handling\n * - Error display\n * - Welcome message when empty\n * - Loading states with typing indicator\n */\nconst MessageArea: React.FC<MessageAreaProps> = ({ className }) => {\n  const { \n    messages, \n    streamingMessage, \n    isStreaming,\n    error,\n    sendMessage \n  } = useMessageStore();\n  const { currentConversation } = useConversationStore();\n  const { currentAgent } = useAgentStore();\n  const scrollRef = useRef<HTMLDivElement>(null);\n  \n  // Citation modal state - tracks which citation is being viewed\n  const [selectedCitationId, setSelectedCitationId] = React.useState<number | string | null>(null);\n  const [citationModalOpen, setCitationModalOpen] = React.useState(false);\n  \n  const conversationMessages = currentConversation \n    ? messages.get(currentConversation.id.toString()) || []\n    : [];\n  \n  /**\n   * Auto-scroll effect\n   * Automatically scrolls to the bottom when new messages arrive\n   * or when streaming messages are updated\n   */\n  useEffect(() => {\n    if (scrollRef.current) {\n      scrollRef.current.scrollTo({\n        top: scrollRef.current.scrollHeight,\n        behavior: 'smooth',\n      });\n    }\n  }, [conversationMessages, streamingMessage]);\n  \n  const handleExamplePrompt = (prompt: string) => {\n    logger.info('UI', 'Example prompt clicked', { prompt });\n    sendMessage(prompt);\n  };\n  \n  const handleCitationClick = (citation: Citation) => {\n    logger.info('UI', 'Citation clicked', {\n      citationId: citation.id,\n      citationIndex: citation.index,\n      citationTitle: citation.title\n    });\n    \n    // Open citation details modal with the citation ID\n    if (citation.id) {\n      setSelectedCitationId(citation.id);\n      setCitationModalOpen(true);\n    }\n  };\n  \n  const handleMessageFeedback = (messageId: string, feedback: 'like' | 'dislike') => {\n    logger.info('UI', 'Message feedback provided', {\n      messageId,\n      feedback\n    });\n    // This would be handled by the message store\n    console.log('Message feedback:', messageId, feedback);\n  };\n  \n  return (\n    <div\n      ref={scrollRef}\n      className={cn(\n        'flex-1 overflow-y-auto scroll-smooth',\n        'bg-gradient-to-b from-gray-50 to-white',\n        className\n      )}\n    >\n      {/* Error Message */}\n      {error && (\n        <div className=\"p-4 m-4 bg-red-50 border border-red-200 rounded-lg\">\n          <div className=\"flex items-center gap-2 text-red-800\">\n            <svg className=\"w-5 h-5\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\n              <path fillRule=\"evenodd\" d=\"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z\" clipRule=\"evenodd\" />\n            </svg>\n            <span className=\"font-medium\">\n              {error.includes('unauthorized') || error.includes('403') \n                ? 'Authorization Error' \n                : 'Error'}\n            </span>\n          </div>\n          <p className=\"text-red-700 mt-1 text-sm\">\n            {error.includes('unauthorized') || error.includes('403')\n              ? 'Your API key does not have permission to access this agent\\'s conversations. Please check your API key permissions or contact support.'\n              : error}\n          </p>\n        </div>\n      )}\n\n      {/* Welcome Message */}\n      {conversationMessages.length === 0 && !streamingMessage && !error && (\n        <WelcomeMessage onPromptClick={handleExamplePrompt} />\n      )}\n      \n      {/* Messages */}\n      {conversationMessages.length > 0 && (\n        <div className=\"space-y-0\">\n          {conversationMessages.map((message, index) => (\n            <Message\n              key={message.id}\n              message={message}\n              isLast={index === conversationMessages.length - 1}\n              onCitationClick={handleCitationClick}\n              onFeedback={(feedback) => handleMessageFeedback(message.id, feedback)}\n            />\n          ))}\n        </div>\n      )}\n      \n      {/* Streaming Message */}\n      {streamingMessage && (\n        <Message\n          message={streamingMessage}\n          isStreaming={true}\n          isLast={true}\n          onCitationClick={handleCitationClick}\n        />\n      )}\n      \n      {/* Typing Indicator */}\n      {isStreaming && !streamingMessage && (\n        <TypingIndicator />\n      )}\n      \n      {/* Citation Details Modal */}\n      {selectedCitationId && (\n        <CitationDetailsModal\n          isOpen={citationModalOpen}\n          onClose={() => {\n            setCitationModalOpen(false);\n            setSelectedCitationId(null);\n          }}\n          citationId={selectedCitationId}\n          projectId={currentAgent?.id}\n        />\n      )}\n    </div>\n  );\n};\n\ninterface ChatHeaderProps {\n  /** Deployment mode affects header layout */\n  mode?: 'standalone' | 'widget' | 'floating';\n  /** Handler for close button (widget/floating modes) */\n  onClose?: () => void;\n  /** Handler for agent settings button */\n  onAgentSettings?: (agent: Agent) => void;\n  /** Enable conversation management UI */\n  enableConversationManagement?: boolean;\n  /** Maximum conversations per session */\n  maxConversations?: number;\n  /** Session ID for conversation isolation */\n  sessionId?: string;\n  /** Current conversation ID */\n  currentConversationId?: string;\n  /** Callback when conversation changes */\n  onConversationChange?: (conversation: any) => void;\n  /** Callback to create new conversation */\n  onCreateConversation?: () => void;\n  /** Key to trigger ConversationManager refresh */\n  conversationRefreshKey?: number;\n}\n\n/**\n * ChatHeader Component\n * \n * Header bar for the chat interface. Layout changes based on deployment mode:\n * - Standalone: Full header with agent selector\n * - Widget/Floating: Compact header with close button\n * \n * Shows agent status (online/offline) and provides agent switching\n */\nconst ChatHeader: React.FC<ChatHeaderProps> = ({ \n  mode = 'standalone', \n  onClose,\n  onAgentSettings,\n  enableConversationManagement = false,\n  maxConversations,\n  sessionId,\n  currentConversationId,\n  onConversationChange,\n  onCreateConversation,\n  conversationRefreshKey\n}) => {\n  const { currentAgent } = useAgentStore();\n  \n  if (mode === 'widget' || mode === 'floating') {\n    return (\n      <header className=\"border-b border-gray-200 bg-white\">\n        {/* Conversation Manager */}\n        {enableConversationManagement && sessionId && (\n          <div className=\"px-4 py-2 border-b border-gray-100\">\n            <ConversationManager\n              sessionId={sessionId}\n              maxConversations={maxConversations}\n              currentConversationId={currentConversationId}\n              onConversationChange={onConversationChange}\n              onCreateConversation={onCreateConversation}\n              className=\"w-full\"\n              refreshKey={conversationRefreshKey}\n            />\n          </div>\n        )}\n        \n        {/* Header Content */}\n        <div className=\"flex items-center justify-between px-4 py-3\">\n          <div className=\"flex items-center gap-3 flex-1 min-w-0\">\n            <div className=\"w-8 h-8 rounded-lg bg-brand-500 flex items-center justify-center flex-shrink-0\">\n              <Bot className=\"w-5 h-5 text-white\" />\n            </div>\n            <div className=\"min-w-0 flex-1\">\n              <h2 className=\"font-semibold text-gray-900 truncate\">\n                {currentAgent?.project_name || 'CustomGPT Assistant'}\n              </h2>\n              <p className=\"text-xs text-gray-500\">\n                {currentAgent?.is_chat_active ? 'Online' : 'Offline'}\n              </p>\n            </div>\n          </div>\n          \n          {onClose && (\n            <button\n              onClick={onClose}\n              className=\"p-1.5 rounded-lg hover:bg-gray-100 transition-colors flex-shrink-0\"\n            >\n              <span className=\"sr-only\">Close</span>\n              ×\n            </button>\n          )}\n        </div>\n      </header>\n    );\n  }\n  \n  // For standalone mode, show agent selector header\n  if (mode === 'standalone') {\n    return (\n      <header className=\"flex items-center justify-between px-4 py-3 border-b border-gray-200 bg-white\">\n        <div className=\"flex items-center gap-3\">\n          <div className=\"w-8 h-8 rounded-lg bg-brand-500 flex items-center justify-center\">\n            <Bot className=\"w-5 h-5 text-white\" />\n          </div>\n          <h1 className=\"text-lg font-semibold text-gray-900\">\n            Agent Chat\n          </h1>\n        </div>\n        \n        <div className=\"flex-1 max-w-xs ml-4\">\n          <AgentSelector\n            onSettingsClick={onAgentSettings}\n            className=\"w-full\"\n          />\n        </div>\n      </header>\n    );\n  }\n  \n  return null;\n};\n\ninterface ChatContainerProps {\n  /** Deployment mode - affects layout and styling */\n  mode?: 'standalone' | 'widget' | 'floating';\n  /** Additional CSS classes */\n  className?: string;\n  /** Handler for close button (widget/floating modes) */\n  onClose?: () => void;\n  /** Handler when agent settings are requested */\n  onAgentSettings?: (agent: Agent) => void;\n  /** Enable conversation management UI */\n  enableConversationManagement?: boolean;\n  /** Maximum conversations per session */\n  maxConversations?: number;\n  /** Session ID for conversation isolation */\n  sessionId?: string;\n  /** Specific conversation thread to load */\n  threadId?: string;\n  /** Callback when conversation changes */\n  onConversationChange?: (conversation: any) => void;\n  /** Callback when message is sent/received */\n  onMessage?: (message: any) => void;\n  /** Key to trigger ConversationManager refresh */\n  conversationRefreshKey?: number;\n}\n\n/**\n * ChatContainer Component - Main Export\n * \n * The primary chat interface component. Can be deployed in three modes:\n * \n * 1. Standalone: Full-page chat interface\n *    - Use when chat is the main feature\n *    - No fixed dimensions, fills container\n * \n * 2. Widget: Embedded chat widget\n *    - Use for embedding in existing pages\n *    - Fixed dimensions with shadow\n * \n * 3. Floating: Floating chat bubble\n *    - Use for overlay chat interfaces\n *    - Fixed dimensions with stronger shadow\n * \n * @example\n * // Standalone mode\n * <ChatContainer mode=\"standalone\" />\n * \n * @example\n * // Widget mode with close handler\n * <ChatContainer \n *   mode=\"widget\" \n *   onClose={() => setShowChat(false)}\n * />\n */\nexport const ChatContainer: React.FC<ChatContainerProps> = ({ \n  mode = 'standalone',\n  className,\n  onClose,\n  onAgentSettings,\n  enableConversationManagement = false,\n  maxConversations,\n  sessionId,\n  threadId,\n  onConversationChange,\n  onMessage,\n  conversationRefreshKey\n}) => {\n  const { sendMessage, isStreaming, cancelStreaming } = useMessageStore();\n  const { fetchAgents, agents, currentAgent } = useAgentStore();\n  const { currentConversation } = useConversationStore();\n  \n  // Get widget instance from context\n  const widget = useWidgetSafe();\n  \n  // Track current conversation for the widget\n  const [currentConversationId, setCurrentConversationId] = React.useState<string | null>(null);\n  \n  // Handle conversation management\n  const handleConversationChange = (conversation: any) => {\n    setCurrentConversationId(conversation.id);\n    onConversationChange?.(conversation);\n    // The widget will handle the actual conversation switch\n    if (widget) {\n      widget.switchConversation(conversation.id);\n    }\n  };\n  \n  const handleCreateConversation = () => {\n    if (widget) {\n      const newConv = widget.createConversation();\n      if (newConv) {\n        setCurrentConversationId(newConv.id);\n      } else {\n        // Show user-friendly message when conversation limit is reached\n        const maxConversations = widget.configuration?.maxConversations || 5;\n        toast.error(`You've reached the maximum limit of ${maxConversations} conversations. Please delete an existing conversation to create a new one.`);\n      }\n    }\n  };\n\n  /**\n   * Agent initialization effect\n   * Fetches available agents when the component first mounts\n   * Only runs if agents haven't been loaded yet\n   */\n  useEffect(() => {\n    const initializeAgents = async () => {\n      // Only fetch if we don't have agents and no current agent\n      if (agents.length === 0 && !currentAgent) {\n        logger.info('UI', 'Initializing agents on ChatContainer mount');\n        try {\n          await fetchAgents();\n          logger.info('UI', 'Agents initialized successfully', {\n            agentCount: agents.length\n          });\n        } catch (error) {\n          logger.error('UI', 'Failed to initialize agents', error, {\n            errorMessage: error instanceof Error ? error.message : String(error)\n          });\n          console.error('Failed to initialize agents:', error);\n        }\n      } else {\n        logger.debug('UI', 'Agents already initialized', {\n          agentCount: agents.length,\n          hasCurrentAgent: !!currentAgent,\n          currentAgentName: currentAgent?.project_name\n        });\n      }\n    };\n\n    initializeAgents();\n  }, []); // Empty dependency array to run only once on mount\n  \n  const handleSendMessage = async (content: string, files?: File[]) => {\n    logger.info('UI', 'Sending message from ChatContainer', {\n      contentLength: content.length,\n      hasFiles: files && files.length > 0,\n      fileCount: files?.length || 0,\n      currentAgent: currentAgent?.project_name,\n      agentId: currentAgent?.id\n    });\n    \n    try {\n      await sendMessage(content, files);\n      logger.info('UI', 'Message sent successfully');\n    } catch (error) {\n      logger.error('UI', 'Failed to send message from ChatContainer', error, {\n        errorMessage: error instanceof Error ? error.message : String(error),\n        isAuthError: error instanceof Error && (error.message.includes('403') || error.message.includes('unauthorized'))\n      });\n      console.error('Failed to send message:', error);\n    }\n  };\n  \n  const handleStopGeneration = () => {\n    logger.info('UI', 'User cancelled streaming generation');\n    cancelStreaming();\n  };\n  \n  const handleAgentSettings = (agent: Agent) => {\n    logger.info('UI', 'Agent settings requested', {\n      agentId: agent.id,\n      agentName: agent.project_name\n    });\n    onAgentSettings?.(agent);\n    console.log('Agent settings requested for:', agent.project_name);\n  };\n  \n  return (\n    <div\n      className={cn(\n        'flex flex-col bg-white',\n        mode === 'standalone' && 'h-full',\n        mode === 'widget' && 'h-[600px] w-[400px] rounded-lg shadow-xl border border-gray-200',\n        mode === 'floating' && 'h-[600px] w-[400px] rounded-lg shadow-2xl border border-gray-200',\n        className\n      )}\n    >\n      <ChatHeader \n        mode={mode} \n        onClose={onClose}\n        onAgentSettings={handleAgentSettings}\n        enableConversationManagement={enableConversationManagement}\n        maxConversations={maxConversations}\n        sessionId={sessionId}\n        currentConversationId={currentConversationId || currentConversation?.id.toString()}\n        onConversationChange={handleConversationChange}\n        onCreateConversation={handleCreateConversation}\n        conversationRefreshKey={conversationRefreshKey}\n      />\n      <MessageArea className=\"flex-1\" />\n      <ChatInput\n        onSend={handleSendMessage}\n        disabled={isStreaming}\n        placeholder={isStreaming ? \"AI is thinking...\" : \"Send a message...\"}\n      />\n      \n      {/* Branding Footer */}\n      {(mode === 'widget' || mode === 'floating') && (\n        <div className=\"px-4 py-2 border-t border-gray-100 bg-gray-50\">\n          <a\n            href=\"https://customgpt.ai\"\n            target=\"_blank\"\n            rel=\"noopener noreferrer\"\n            className=\"text-xs text-gray-500 hover:text-gray-700 transition-colors block text-center\"\n          >\n            Powered by CustomGPT.ai\n          </a>\n        </div>\n      )}\n    </div>\n  );\n};","/**\n * Conversation Sidebar Component\n * \n * Manages the conversation list and provides quick navigation\n * between different chat sessions. Includes conversation management\n * features like create, rename, and delete.\n * \n * Features:\n * - Conversation list with search/filter\n * - Create new conversation\n * - Rename conversations inline\n * - Delete conversations with confirmation\n * - Agent management access\n * - Data source management\n * - Analytics dashboard access\n * - Collapsible sidebar\n * \n * State Management:\n * - Conversations from conversationStore\n * - Current conversation selection\n * - Search/filter state (local)\n * - Collapse state (passed from parent)\n * \n * UI/UX Features:\n * - Hover states and animations\n * - Keyboard shortcuts (future enhancement)\n * - Context menu for conversation actions\n * - Auto-scroll to selected conversation\n * - Responsive design for mobile\n * \n * Customization for contributors:\n * - Add conversation categories/folders\n * - Implement bulk operations\n * - Add export/import functionality\n * - Customize sidebar width\n * - Add conversation pinning\n * - Implement conversation search\n * - Add conversation templates\n */\n\n'use client';\n\nimport React, { useState, useRef, useEffect } from 'react';\nimport Link from 'next/link';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport { \n  MessageSquare, \n  Plus, \n  MoreHorizontal, \n  Trash2, \n  Edit3, \n  Calendar,\n  Search,\n  X,\n  Bot,\n  RefreshCw,\n  Database,\n  BarChart3,\n  FileText,\n  Bug\n} from 'lucide-react';\nimport { toast } from 'sonner';\n\nimport type { Conversation } from '@/types';\nimport { useConversationStore, useAgentStore, useMessageStore } from '@/hooks/useWidgetStore';\nimport { cn, formatTimestamp, generateConversationName } from '@/lib/utils';\nimport { Button } from '@/components/ui/button';\nimport { logger } from '@/lib/logger';\n\n/**\n * Props for individual conversation item\n * \n * @property conversation - Conversation data object\n * @property isSelected - Whether this conversation is currently active\n * @property onSelect - Callback when conversation is clicked\n * @property onDelete - Callback for deleting conversation\n * @property onRename - Callback for renaming conversation\n */\ninterface ConversationItemProps {\n  conversation: Conversation;\n  isSelected: boolean;\n  onSelect: (conversation: Conversation) => void;\n  onDelete: (conversationId: string) => void;\n  onRename: (conversationId: string, newName: string) => void;\n}\n\n/**\n * Individual Conversation Item Component\n * \n * Renders a single conversation in the sidebar with actions.\n * Features inline editing and context menu for management.\n */\nconst ConversationItem: React.FC<ConversationItemProps> = ({\n  conversation,\n  isSelected,\n  onSelect,\n  onDelete,\n  onRename\n}) => {\n  const [isEditing, setIsEditing] = useState(false);\n  const [editName, setEditName] = useState(conversation.name);\n  const [showMenu, setShowMenu] = useState(false);\n  const inputRef = useRef<HTMLInputElement>(null);\n  const menuRef = useRef<HTMLDivElement>(null);\n\n  // Close menu when clicking outside\n  useEffect(() => {\n    const handleClickOutside = (event: MouseEvent) => {\n      if (menuRef.current && !menuRef.current.contains(event.target as Node)) {\n        setShowMenu(false);\n      }\n    };\n\n    if (showMenu) {\n      document.addEventListener('mousedown', handleClickOutside);\n      return () => document.removeEventListener('mousedown', handleClickOutside);\n    }\n  }, [showMenu]);\n\n  // Focus input when editing starts\n  useEffect(() => {\n    if (isEditing && inputRef.current) {\n      inputRef.current.focus();\n      inputRef.current.select();\n    }\n  }, [isEditing]);\n\n  const handleEdit = () => {\n    setIsEditing(true);\n    setShowMenu(false);\n  };\n\n  const handleSaveEdit = () => {\n    if (editName.trim() && editName.trim() !== conversation.name) {\n      onRename(conversation.id.toString(), editName.trim());\n    }\n    setIsEditing(false);\n    setEditName(conversation.name);\n  };\n\n  const handleCancelEdit = () => {\n    setIsEditing(false);\n    setEditName(conversation.name);\n  };\n\n  const handleKeyDown = (e: React.KeyboardEvent) => {\n    if (e.key === 'Enter') {\n      handleSaveEdit();\n    } else if (e.key === 'Escape') {\n      handleCancelEdit();\n    }\n  };\n\n  const handleDelete = () => {\n    onDelete(conversation.id.toString());\n    setShowMenu(false);\n  };\n\n  return (\n    <div\n      className={cn(\n        'group relative p-3 rounded-lg cursor-pointer transition-colors',\n        'hover:bg-gray-50',\n        isSelected && 'bg-brand-50 hover:bg-brand-100'\n      )}\n      onClick={() => !isEditing && onSelect(conversation)}\n    >\n      <div className=\"flex items-start justify-between gap-2\">\n        <div className=\"flex-1 min-w-0\">\n          {isEditing ? (\n            <input\n              ref={inputRef}\n              type=\"text\"\n              value={editName}\n              onChange={(e) => setEditName(e.target.value)}\n              onBlur={handleSaveEdit}\n              onKeyDown={handleKeyDown}\n              className=\"w-full px-2 py-1 text-sm font-medium text-gray-900 bg-white border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-brand-500 focus:border-transparent\"\n              maxLength={100}\n            />\n          ) : (\n            <h3 className=\"font-medium text-gray-900 text-sm truncate\">\n              {conversation.name}\n            </h3>\n          )}\n          \n          <div className=\"flex items-center gap-2 mt-1 text-xs text-gray-500\">\n            <Calendar className=\"w-3 h-3\" />\n            <span>{formatTimestamp(conversation.updated_at)}</span>\n            {conversation.message_count && (\n              <>\n                <span>•</span>\n                <span>{conversation.message_count} messages</span>\n              </>\n            )}\n          </div>\n        </div>\n\n        {/* Menu Button */}\n        {!isEditing && (\n          <div className=\"relative\" ref={menuRef}>\n            <Button\n              size=\"icon\"\n              variant=\"ghost\"\n              onClick={(e) => {\n                e.stopPropagation();\n                setShowMenu(!showMenu);\n              }}\n              className=\"opacity-0 group-hover:opacity-100 transition-opacity h-6 w-6 text-gray-400 hover:text-gray-600\"\n            >\n              <MoreHorizontal className=\"h-3 w-3\" />\n            </Button>\n\n            {/* Dropdown Menu */}\n            <AnimatePresence>\n              {showMenu && (\n                <motion.div\n                  initial={{ opacity: 0, scale: 0.95, y: -5 }}\n                  animate={{ opacity: 1, scale: 1, y: 0 }}\n                  exit={{ opacity: 0, scale: 0.95, y: -5 }}\n                  transition={{ duration: 0.1 }}\n                  className=\"absolute right-0 top-6 mt-1 w-32 bg-white border border-gray-200 rounded-lg shadow-lg z-50\"\n                >\n                  <div className=\"py-1\">\n                    <button\n                      onClick={(e) => {\n                        e.stopPropagation();\n                        handleEdit();\n                      }}\n                      className=\"flex items-center gap-2 w-full px-3 py-2 text-sm text-gray-700 hover:bg-gray-50\"\n                    >\n                      <Edit3 className=\"w-3 h-3\" />\n                      Rename\n                    </button>\n                    <button\n                      onClick={(e) => {\n                        e.stopPropagation();\n                        handleDelete();\n                      }}\n                      className=\"flex items-center gap-2 w-full px-3 py-2 text-sm text-red-600 hover:bg-red-50\"\n                    >\n                      <Trash2 className=\"w-3 h-3\" />\n                      Delete\n                    </button>\n                  </div>\n                </motion.div>\n              )}\n            </AnimatePresence>\n          </div>\n        )}\n      </div>\n    </div>\n  );\n};\n\ninterface ConversationSidebarProps {\n  className?: string;\n  isCollapsed?: boolean;\n  onToggle?: () => void;\n}\n\nexport const ConversationSidebar: React.FC<ConversationSidebarProps> = ({\n  className,\n  isCollapsed = false,\n  onToggle\n}) => {\n  const [searchQuery, setSearchQuery] = useState('');\n  const [isCreating, setIsCreating] = useState(false);\n  \n  const { \n    conversations, \n    currentConversation, \n    loading, \n    error,\n    fetchConversations,\n    createConversation,\n    selectConversation,\n    deleteConversation,\n    updateConversation\n  } = useConversationStore();\n  \n  const { currentAgent } = useAgentStore();\n  const { clearMessages, loadMessages } = useMessageStore();\n\n  // Fetch conversations when agent changes\n  useEffect(() => {\n    // Skip API calls in demo mode\n    const isDemoMode = typeof window !== 'undefined' && (window as any).__customgpt_demo_mode;\n    \n    if (currentAgent && !isDemoMode) {\n      logger.info('UI', 'Agent changed in sidebar, fetching conversations', {\n        agentId: currentAgent.id,\n        agentName: currentAgent.project_name,\n        isActive: currentAgent.is_chat_active\n      });\n      console.log('ConversationSidebar: Agent changed, fetching conversations for:', currentAgent.project_name, currentAgent.id);\n      fetchConversations(currentAgent.id);\n    } else if (!currentAgent) {\n      logger.warn('UI', 'No current agent selected in sidebar');\n      console.log('ConversationSidebar: No current agent selected');\n    } else if (isDemoMode) {\n      logger.info('UI', 'Skipping conversation fetch in demo mode');\n    }\n  }, [currentAgent, fetchConversations]);\n\n  // Filter conversations based on search query\n  // Debug log to understand the conversations type\n  if (!Array.isArray(conversations)) {\n    console.warn('Conversations is not an array:', typeof conversations, conversations);\n  }\n  \n  const filteredConversations = Array.isArray(conversations) \n    ? conversations.filter(conversation =>\n        conversation.name.toLowerCase().includes(searchQuery.toLowerCase())\n      )\n    : [];\n\n  const handleNewConversation = async () => {\n    if (!currentAgent || isCreating) return;\n    \n    logger.info('UI', 'Creating new conversation', {\n      agentId: currentAgent.id,\n      agentName: currentAgent.project_name\n    });\n    \n    setIsCreating(true);\n    try {\n      const name = `New Chat ${new Date().toLocaleDateString()}`;\n      await createConversation(currentAgent.id, name);\n      clearMessages(); // Clear current messages when starting new conversation\n      logger.info('UI', 'New conversation created successfully', { name });\n      toast.success('New conversation created');\n    } catch (error) {\n      logger.error('UI', 'Failed to create conversation', error, {\n        agentId: currentAgent.id,\n        errorMessage: error instanceof Error ? error.message : String(error)\n      });\n      console.error('Failed to create conversation:', error);\n      toast.error('Failed to create new conversation');\n    } finally {\n      setIsCreating(false);\n    }\n  };\n\n  const handleSelectConversation = async (conversation: Conversation) => {\n    logger.info('UI', 'Selecting conversation', {\n      conversationId: conversation.id,\n      conversationName: conversation.name,\n      projectId: conversation.project_id,\n      messageCount: conversation.message_count\n    });\n    \n    selectConversation(conversation);\n    \n    // Load messages for the selected conversation\n    try {\n      logger.info('UI', 'Loading messages for selected conversation', {\n        conversationId: conversation.id,\n        agentId: currentAgent?.id,\n        agentName: currentAgent?.project_name\n      });\n      \n      await loadMessages(conversation.id.toString());\n      \n      logger.info('UI', 'Messages loaded successfully for conversation', {\n        conversationId: conversation.id\n      });\n    } catch (error) {\n      logger.error('UI', 'Failed to load messages for conversation', error, {\n        conversationId: conversation.id,\n        errorMessage: error instanceof Error ? error.message : String(error),\n        errorType: error instanceof Error ? error.constructor.name : typeof error\n      });\n      console.error('Failed to load messages for conversation:', error);\n      toast.error('Failed to load conversation messages');\n    }\n  };\n\n  const handleDeleteConversation = async (conversationId: string) => {\n    try {\n      await deleteConversation(conversationId);\n      toast.success('Conversation deleted');\n    } catch (error) {\n      console.error('Failed to delete conversation:', error);\n      toast.error('Failed to delete conversation');\n    }\n  };\n\n  const handleRenameConversation = async (conversationId: string, newName: string) => {\n    const conversation = conversations.find(c => c.id.toString() === conversationId);\n    if (!conversation) return;\n    \n    try {\n      await updateConversation(conversation.project_id, conversation.session_id, { name: newName });\n      toast.success('Conversation renamed');\n    } catch (error) {\n      console.error('Failed to rename conversation:', error);\n      toast.error('Failed to rename conversation');\n    }\n  };\n\n  if (isCollapsed) {\n    return (\n      <div className={cn('w-12 bg-gray-50 border-r border-gray-200 flex flex-col', className)}>\n        <div className=\"p-2\">\n          <Button\n            size=\"icon\"\n            variant=\"ghost\"\n            onClick={onToggle}\n            className=\"w-8 h-8\"\n            title=\"Expand sidebar\"\n          >\n            <MessageSquare className=\"h-4 w-4\" />\n          </Button>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className={cn('w-80 bg-gray-50 border-r border-gray-200 flex flex-col', className)}>\n      {/* Header */}\n      <div className=\"p-4 border-b border-gray-200 bg-white\">\n        <div className=\"flex items-center justify-between mb-3\">\n          <h2 className=\"font-semibold text-gray-900\">Conversations</h2>\n          <Button\n            size=\"icon\"\n            variant=\"ghost\"\n            onClick={onToggle}\n            className=\"h-8 w-8\"\n            title=\"Collapse sidebar\"\n          >\n            <X className=\"h-4 w-4\" />\n          </Button>\n        </div>\n        \n        {/* Search */}\n        <div className=\"relative\">\n          <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400\" />\n          <input\n            type=\"text\"\n            placeholder=\"Search conversations...\"\n            value={searchQuery}\n            onChange={(e) => setSearchQuery(e.target.value)}\n            className=\"w-full pl-9 pr-3 py-2 text-sm border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-brand-500 focus:border-transparent\"\n          />\n        </div>\n      </div>\n\n      {/* Action Buttons */}\n      <div className=\"p-4 space-y-2\">\n        <Link href=\"/create\">\n          <Button\n            className=\"w-full justify-start gap-2\"\n            variant=\"default\"\n          >\n            <Bot className=\"w-4 h-4\" />\n            Create New Agent\n          </Button>\n        </Link>\n        \n        <Button\n          onClick={handleNewConversation}\n          disabled={!currentAgent || isCreating}\n          className=\"w-full justify-start gap-2\"\n          variant=\"outline\"\n        >\n          <Plus className=\"w-4 h-4\" />\n          {isCreating ? 'Creating...' : 'New Chat'}\n        </Button>\n        \n        <div className=\"border-t border-gray-200 pt-2 mt-3 space-y-1\">\n          <Link href=\"/analytics\">\n            <Button\n              className=\"w-full justify-start gap-2\"\n              variant=\"ghost\"\n              size=\"sm\"\n            >\n              <BarChart3 className=\"w-4 h-4\" />\n              Analytics\n            </Button>\n          </Link>\n          \n          <Link href=\"/pages\">\n            <Button\n              className=\"w-full justify-start gap-2\"\n              variant=\"ghost\"\n              size=\"sm\"\n            >\n              <FileText className=\"w-4 h-4\" />\n              Pages\n            </Button>\n          </Link>\n          \n          <Link href=\"/sources\">\n            <Button\n              className=\"w-full justify-start gap-2\"\n              variant=\"ghost\"\n              size=\"sm\"\n            >\n              <Database className=\"w-4 h-4\" />\n              Sources\n            </Button>\n          </Link>\n          \n          <Link href=\"/debug\">\n            <Button\n              className=\"w-full justify-start gap-2\"\n              variant=\"ghost\"\n              size=\"sm\"\n            >\n              <Bug className=\"w-4 h-4\" />\n              Debug Logs\n            </Button>\n          </Link>\n        </div>\n        \n        <Button\n          onClick={() => {\n            if (currentAgent) {\n              logger.info('UI', 'Manual refresh conversations clicked', {\n                agentId: currentAgent.id,\n                agentName: currentAgent.project_name\n              });\n              fetchConversations(currentAgent.id);\n            }\n          }}\n          disabled={!currentAgent || loading}\n          className=\"w-full justify-start gap-2\"\n          variant=\"ghost\"\n          size=\"sm\"\n        >\n          <RefreshCw className={cn(\"w-4 h-4\", loading && \"animate-spin\")} />\n          Refresh Conversations\n        </Button>\n      </div>\n\n      {/* Conversations List */}\n      <div className=\"flex-1 overflow-y-auto\">\n        {loading && (!Array.isArray(conversations) || conversations.length === 0) ? (\n          <div className=\"p-4 space-y-3\">\n            {[...Array(3)].map((_, i) => (\n              <div key={i} className=\"animate-pulse\">\n                <div className=\"h-4 bg-gray-200 rounded mb-2\" />\n                <div className=\"h-3 bg-gray-100 rounded w-3/4\" />\n              </div>\n            ))}\n          </div>\n        ) : error && (!Array.isArray(conversations) || conversations.length === 0) ? (\n          <div className=\"p-4 text-center\">\n            <p className=\"text-sm text-red-600 mb-2\">Failed to load conversations</p>\n            <Button\n              size=\"sm\"\n              variant=\"ghost\"\n              onClick={() => currentAgent && fetchConversations(currentAgent.id)}\n            >\n              Try Again\n            </Button>\n          </div>\n        ) : filteredConversations.length === 0 ? (\n          <div className=\"p-4 text-center\">\n            <MessageSquare className=\"w-8 h-8 text-gray-400 mx-auto mb-2\" />\n            <p className=\"text-sm text-gray-500\">\n              {searchQuery ? 'No conversations found' : 'No conversations yet'}\n            </p>\n            {!searchQuery && (\n              <p className=\"text-xs text-gray-400 mt-1\">\n                Start a new conversation to get going\n              </p>\n            )}\n            {currentAgent && (\n              <div className=\"text-xs text-gray-400 mt-2 space-y-1\">\n                <p>Agent: {currentAgent.project_name} (ID: {currentAgent.id})</p>\n                {error && (\n                  <p className=\"text-red-500\">Error: {error}</p>\n                )}\n                <p>Conversations loaded: {conversations.length}</p>\n              </div>\n            )}\n          </div>\n        ) : (\n          <div className=\"p-2 space-y-1\">\n            {filteredConversations.map((conversation) => (\n              <ConversationItem\n                key={conversation.id}\n                conversation={conversation}\n                isSelected={currentConversation?.id === conversation.id}\n                onSelect={handleSelectConversation}\n                onDelete={(id) => handleDeleteConversation(id)}\n                onRename={handleRenameConversation}\n              />\n            ))}\n          </div>\n        )}\n      </div>\n\n      {/* Footer */}\n      <div className=\"p-4 border-t border-gray-200 bg-white\">\n        <div className=\"text-xs text-gray-500 text-center\">\n          {filteredConversations.length} conversation{filteredConversations.length !== 1 ? 's' : ''}\n          {currentAgent && (\n            <span className=\"block mt-1\">\n              Agent: {currentAgent.project_name}\n            </span>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n};","/**\n * Chat Layout Component\n * \n * Top-level layout component that orchestrates the chat interface.\n * Handles different deployment modes and manages the conversation sidebar.\n * \n * Deployment Modes:\n * - standalone: Full chat with sidebar (default for main app)\n * - widget: Embeddable chat without sidebar\n * - floating: Popup-style chat without sidebar\n * \n * Features:\n * - Responsive sidebar with collapse/expand\n * - Automatic message loading on conversation change\n * - Mode-specific rendering logic\n * - Clean separation of concerns\n * \n * Architecture:\n * - ChatLayout (this) - Layout orchestration\n *   - ConversationSidebar - Conversation list and management\n *   - ChatContainer - Main chat interface\n *     - Message - Individual messages\n *     - ChatInput - Message input area\n * \n * State Management:\n * - currentConversation from conversationStore\n * - loadMessages from messageStore\n * - Local state for sidebar collapse\n * \n * Customization for contributors:\n * - Add new deployment modes in the mode prop\n * - Customize sidebar behavior and persistence\n * - Add keyboard shortcuts for sidebar toggle\n * - Implement mobile-responsive sidebar\n * - Add sidebar position options (left/right)\n */\n\n'use client';\n\nimport React, { useState, useEffect } from 'react';\nimport type { Agent } from '@/types';\nimport { ChatContainer } from './ChatContainer';\nimport { ConversationSidebar } from './ConversationSidebar';\nimport { useConversationStore, useMessageStore } from '@/hooks/useWidgetStore';\n\n/**\n * Props for ChatLayout component\n * \n * @property mode - Deployment mode: standalone (with sidebar), widget, or floating\n * @property className - Additional CSS classes for styling\n * @property onClose - Callback for closing chat (widget/floating modes)\n * @property onAgentSettings - Callback for opening agent settings\n * @property showSidebar - Whether to show sidebar (only applies to standalone mode)\n * @property enableConversationManagement - Enable conversation switching UI\n * @property maxConversations - Maximum conversations per session\n * @property sessionId - Session ID for conversation isolation\n * @property threadId - Specific conversation thread to load\n * @property onConversationChange - Callback when conversation changes\n * @property onMessage - Callback when message is sent/received\n */\ninterface ChatLayoutProps {\n  mode?: 'standalone' | 'widget' | 'floating';\n  className?: string;\n  onClose?: () => void;\n  onAgentSettings?: (agent: Agent) => void;\n  showSidebar?: boolean;\n  enableConversationManagement?: boolean;\n  maxConversations?: number;\n  sessionId?: string;\n  threadId?: string;\n  onConversationChange?: (conversation: any) => void;\n  onMessage?: (message: any) => void;\n  widgetInstance?: any; // Widget instance for isolated conversation management\n  conversations?: any[]; // Current conversations for isolated mode\n  currentConversation?: any; // Current conversation for isolated mode\n  conversationRefreshKey?: number; // Key to trigger ConversationManager refresh\n}\n\n/**\n * Chat Layout Component\n * \n * Orchestrates the overall chat interface layout based on deployment mode.\n * In standalone mode, includes a collapsible conversation sidebar.\n * In widget/floating modes, renders only the chat container.\n */\nexport const ChatLayout: React.FC<ChatLayoutProps> = ({\n  mode = 'standalone',\n  className,\n  onClose,\n  onAgentSettings,\n  showSidebar = true,\n  enableConversationManagement = false,\n  maxConversations,\n  sessionId,\n  threadId,\n  onConversationChange,\n  onMessage,\n  widgetInstance,\n  conversations,\n  currentConversation,\n  conversationRefreshKey\n}) => {\n  const [sidebarCollapsed, setSidebarCollapsed] = useState(false);\n  const { currentConversation: storeCurrentConversation } = useConversationStore();\n  const { loadMessages } = useMessageStore();\n\n  /**\n   * Load messages when conversation changes\n   * \n   * Automatically fetches messages from the store when user\n   * switches between conversations. This ensures the chat\n   * always shows the correct message history.\n   */\n  useEffect(() => {\n    // Skip API calls in demo mode to prevent errors\n    const isDemoMode = typeof window !== 'undefined' && (window as any).__customgpt_demo_mode;\n    \n    if (storeCurrentConversation && !isDemoMode) {\n      loadMessages(storeCurrentConversation.id.toString());\n    }\n  }, [storeCurrentConversation, loadMessages]);\n\n  // Hide sidebar for widget and floating modes\n  // Only standalone mode shows the conversation sidebar\n  const shouldShowSidebar = showSidebar && mode === 'standalone';\n\n  /**\n   * Toggle sidebar collapsed state\n   * \n   * For contributors: Consider persisting this state to localStorage\n   * to remember user preference across sessions\n   */\n  const handleToggleSidebar = () => {\n    setSidebarCollapsed(!sidebarCollapsed);\n  };\n\n  if (!shouldShowSidebar) {\n    // For widget/floating modes, just show the chat container\n    return (\n      <ChatContainer\n        mode={mode}\n        className={className}\n        onClose={onClose}\n        onAgentSettings={onAgentSettings}\n        enableConversationManagement={enableConversationManagement}\n        maxConversations={maxConversations}\n        sessionId={sessionId}\n        threadId={threadId}\n        onConversationChange={onConversationChange}\n        onMessage={onMessage}\n        conversationRefreshKey={conversationRefreshKey}\n      />\n    );\n  }\n\n  return (\n    <div className=\"flex h-full bg-white\">\n      {/* Sidebar */}\n      <ConversationSidebar\n        isCollapsed={sidebarCollapsed}\n        onToggle={handleToggleSidebar}\n      />\n      \n      {/* Main Chat Area */}\n      <div className=\"flex-1 flex flex-col min-w-0\">\n        <ChatContainer\n          mode={mode}\n          className=\"h-full\"\n          onClose={onClose}\n          onAgentSettings={onAgentSettings}\n          enableConversationManagement={enableConversationManagement}\n          maxConversations={maxConversations}\n          sessionId={sessionId}\n          threadId={threadId}\n          onConversationChange={onConversationChange}\n          onMessage={onMessage}\n          conversationRefreshKey={conversationRefreshKey}\n        />\n      </div>\n    </div>\n  );\n};","import React from 'react';\nimport { createRoot } from 'react-dom/client';\nimport { Toaster } from 'sonner';\n\nimport '../../app/globals.css';\nimport './widget-styles.css';\nimport { WidgetConfig } from '../types';\nimport { useConfigStore, useAgentStore } from '../store';\nimport { ChatLayout } from '../components/chat/ChatLayout';\nimport { getClient } from '../lib/api/client';\nimport { WidgetProvider } from './WidgetContext';\nimport { WidgetStoreProvider } from './WidgetStoreContext';\n\n/**\n * Widget Configuration Interface\n * \n * Defines all configuration options for CustomGPT widget initialization.\n * This interface is used by both embedded widgets and floating buttons.\n * \n * @property apiKey - Required: Your CustomGPT API key\n * @property agentId - Required: Agent/Project ID from CustomGPT dashboard\n * @property agentName - Optional: Custom name to display instead of \"Agent - {ID}\"\n * @property containerId - DOM element ID for embedded mode (ignored in floating mode)\n * @property mode - Widget deployment mode: 'embedded' | 'floating' | 'widget'\n * @property theme - Color theme: 'light' | 'dark'\n * @property position - Position for floating mode: 'bottom-right' | 'bottom-left' | 'top-right' | 'top-left'\n * @property width - Widget width (default: '400px')\n * @property height - Widget height (default: '600px')\n * @property enableCitations - Show citation sources in messages\n * @property enableFeedback - Show thumbs up/down feedback buttons\n * \n * Conversation Management Options:\n * @property enableConversationManagement - Enable conversation switching UI\n * @property maxConversations - Maximum conversations per session (default: 5)\n * @property sessionId - Custom session ID (auto-generated if not provided)\n * @property threadId - Specific conversation thread to load\n * @property isolateConversations - Whether to isolate conversations from other widgets (default: true)\n * \n * Event Callbacks:\n * @property onOpen - Called when widget opens\n * @property onClose - Called when widget closes\n * @property onMessage - Called when new message is sent/received\n * @property onConversationChange - Called when conversation switches\n */\nexport interface CustomGPTWidgetConfig {\n  // Required properties\n  apiKey: string;\n  agentId: number | string;\n  \n  // Display properties\n  agentName?: string;\n  containerId?: string;\n  mode?: 'embedded' | 'floating' | 'widget';\n  theme?: 'light' | 'dark';\n  position?: 'bottom-right' | 'bottom-left' | 'top-right' | 'top-left';\n  width?: string;\n  height?: string;\n  \n  // Feature flags\n  enableCitations?: boolean;\n  enableFeedback?: boolean;\n  enableConversationManagement?: boolean;\n  \n  // Conversation management\n  maxConversations?: number;\n  sessionId?: string;\n  threadId?: string;\n  isolateConversations?: boolean; // New flag to isolate conversations\n  \n  // Event callbacks\n  onOpen?: () => void;\n  onClose?: () => void;\n  onMessage?: (message: any) => void;\n  onConversationChange?: (conversation: any) => void;\n}\n\n/**\n * CustomGPT Widget Class\n * \n * Main widget class that manages the lifecycle of CustomGPT chat instances.\n * Supports both embedded and floating deployment modes with full conversation management.\n * \n * @example\n * // Basic embedded widget\n * const widget = CustomGPTWidget.init({\n *   apiKey: 'your-api-key',\n *   agentId: '123',\n *   containerId: 'chat-container'\n * });\n * \n * @example\n * // Floating widget with conversation management\n * const widget = CustomGPTWidget.init({\n *   apiKey: 'your-api-key',\n *   agentId: '123',\n *   mode: 'floating',\n *   enableConversationManagement: true,\n *   maxConversations: 10\n * });\n */\nclass CustomGPTWidget {\n  private container: HTMLElement | null = null;\n  private root: any = null;\n  private config: CustomGPTWidgetConfig;\n  private isOpen: boolean = false;\n  public sessionId: string;\n  private currentConversationId: string | null = null;\n  private instanceKey?: string;\n  private conversationRefreshKey: number = 0;\n\n  constructor(config: CustomGPTWidgetConfig) {\n    // Validate required fields\n    if (!config.apiKey) {\n      throw new Error('CustomGPT Widget: API key is required');\n    }\n    \n    if (!config.agentId) {\n      throw new Error('CustomGPT Widget: Agent ID is required');\n    }\n\n    // Merge with defaults\n    this.config = {\n      mode: 'embedded',\n      theme: 'light',\n      position: 'bottom-right',\n      width: '400px',\n      height: '600px',\n      enableCitations: true,\n      enableFeedback: true,\n      enableConversationManagement: false,\n      ...config,\n    };\n\n    // Initialize session ID\n    // If isolateConversations is true, ensure each widget has a unique session\n    if (this.config.isolateConversations !== false) {\n      // Default to isolated conversations - each widget gets its own session\n      const modePrefix = this.config.mode || 'widget';\n      const containerId = this.config.containerId || 'default';\n      // Create a unique session ID that includes mode, container info, and a random component\n      // Use performance.now() for higher precision to avoid collisions\n      const timestamp = typeof performance !== 'undefined' ? performance.now() : Date.now();\n      const random = Math.random().toString(36).substr(2, 9);\n      const uniqueId = `${timestamp}_${random}_${Math.random().toString(36).substr(2, 5)}`;\n      this.sessionId = `session_${modePrefix}_${containerId}_${uniqueId}`;\n    } else if (this.config.sessionId) {\n      // Use provided session ID for sharing conversations\n      this.sessionId = this.config.sessionId;\n    } else {\n      // Generate a regular session ID\n      this.sessionId = this.generateSessionId();\n    }\n    \n    // Store widget instance reference for conversation management\n    // Use unique instance key to prevent conflicts between multiple widgets\n    if (typeof window !== 'undefined') {\n      const instanceKey = `__customgpt_widget_${this.sessionId}`;\n      (window as any)[instanceKey] = this;\n      \n      // DEPRECATED: Global reference kept for backward compatibility\n      // Don't overwrite if already exists to preserve first widget\n      if (!(window as any).__customgpt_widget_instance) {\n        (window as any).__customgpt_widget_instance = this;\n      }\n      \n      // Store instance key for later reference\n      this.instanceKey = instanceKey;\n    }\n\n    this.init();\n  }\n\n  /**\n   * Generates a unique session ID for conversation isolation\n   * @returns Unique session identifier\n   */\n  private generateSessionId(): string {\n    return `session_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\n  }\n\n  private async init() {\n    // Set up the API key in the config store\n    useConfigStore.getState().setApiKey(this.config.apiKey);\n    \n    // Configure session for conversation isolation\n    if (this.config.enableConversationManagement) {\n      // Store session configuration for conversation management\n      // If isolateConversations is true, use instance-specific session storage\n      if (this.config.isolateConversations) {\n        // Create instance-specific session object\n        if (!(window as any).__customgpt_sessions) {\n          (window as any).__customgpt_sessions = {};\n        }\n        (window as any).__customgpt_sessions[this.sessionId] = {\n          sessionId: this.sessionId,\n          maxConversations: this.config.maxConversations,\n          enableConversationManagement: true\n        };\n      } else {\n        // Use shared session (old behavior)\n        (window as any).__customgpt_session = {\n          sessionId: this.sessionId,\n          maxConversations: this.config.maxConversations,\n          enableConversationManagement: true\n        };\n      }\n    }\n    \n    // Check if using demo/test API key\n    const isDemoMode = this.config.apiKey === 'demo-api-key' || \n                      this.config.apiKey.startsWith('demo-') || \n                      this.config.apiKey.startsWith('test-');\n    \n    // Store demo mode flag for preventing unnecessary API calls\n    if (isDemoMode) {\n      (window as any).__customgpt_demo_mode = true;\n    } else {\n      // Ensure demo mode is disabled for valid API keys\n      (window as any).__customgpt_demo_mode = false;\n    }\n    \n    // Fetch the actual agent details\n    const agentId = typeof this.config.agentId === 'string' ? parseInt(this.config.agentId) : this.config.agentId;\n    \n    if (!isDemoMode) {\n      try {\n        // Try to fetch agent details to get the project name\n        const client = getClient();\n        const agentsResponse = await client.getAgents();\n        const agents = Array.isArray(agentsResponse) ? agentsResponse : (agentsResponse as any).data || [];\n        const agent = agents.find((a: any) => a.id === agentId);\n        \n        if (agent) {\n          // Use custom agent name if provided\n          if (this.config.agentName) {\n            agent.project_name = this.config.agentName;\n          }\n          \n          // Use the actual agent with proper project name\n          useAgentStore.getState().selectAgent(agent);\n          // Clear other agents to ensure only this one is available\n          useAgentStore.getState().setAgents([agent]);\n        } else {\n          // Fallback if agent not found\n          const fallbackAgent: any = {\n            id: agentId,\n            project_name: this.config.agentName || `Project ${agentId}`,\n            is_chat_active: true,\n          };\n          useAgentStore.getState().selectAgent(fallbackAgent);\n          useAgentStore.getState().setAgents([fallbackAgent]);\n        }\n      } catch (error) {\n        // Use fallback on error\n        const fallbackAgent: any = {\n          id: agentId,\n          project_name: this.config.agentName || `Project ${agentId}`,\n          is_chat_active: true,\n        };\n        useAgentStore.getState().selectAgent(fallbackAgent);\n        useAgentStore.getState().setAgents([fallbackAgent]);\n      }\n    } else {\n      // For demo mode, always use fallback agent\n      const fallbackAgent: any = {\n        id: agentId,\n        project_name: this.config.agentName || `Demo Assistant`,\n        is_chat_active: true,\n      };\n      useAgentStore.getState().selectAgent(fallbackAgent);\n      useAgentStore.getState().setAgents([fallbackAgent]);\n    }\n\n    // Create container based on mode\n    this.createContainer();\n    \n    // Render the widget first\n    this.render();\n    \n    // Initialize conversation after render to ensure ConversationManager is mounted\n    if (this.config.enableConversationManagement) {\n      const conversations = this.getConversations();\n      \n      if (conversations.length === 0) {\n        // Create initial conversation after a small delay to ensure components are mounted\n        setTimeout(() => {\n          this.createConversation('New Chat');\n        }, 100);\n      } else {\n        // Set current conversation to the first one\n        this.currentConversationId = conversations[0].id;\n        \n        // Only sync with global store if explicitly not isolated\n        if (this.config.isolateConversations === false && typeof window !== 'undefined') {\n          const { useConversationStore } = require('../store');\n          const currentConv = conversations[0];\n          const fullConversation = {\n            ...currentConv,\n            project_id: parseInt(this.config.agentId as string) || 0,\n            session_id: this.sessionId,\n            name: currentConv.title\n          };\n          \n          // Set only the current conversation\n          useConversationStore.setState({\n            conversations: [fullConversation as any],\n            currentConversation: fullConversation as any\n          });\n        }\n      }\n    }\n    \n    // For isolated widgets, we need to prevent the global store from being used\n    if (this.config.isolateConversations !== false && typeof window !== 'undefined') {\n      // Store the widget instance globally so components can access it\n      (window as any).__customgpt_widget_instances = (window as any).__customgpt_widget_instances || {};\n      (window as any).__customgpt_widget_instances[this.sessionId] = this;\n      \n      // Set the current active widget session\n      (window as any).__customgpt_active_widget_session = this.sessionId;\n    }\n  }\n\n  private createContainer() {\n    const { mode, containerId } = this.config;\n\n    if (mode === 'embedded' && containerId) {\n      // Use provided container\n      this.container = document.getElementById(containerId);\n      if (!this.container) {\n        throw new Error(`Container with id \"${containerId}\" not found`);\n      }\n    } else if (mode === 'floating') {\n      // Create floating container\n      this.container = document.createElement('div');\n      this.container.id = 'customgpt-floating-widget';\n      this.setupFloatingStyles();\n      document.body.appendChild(this.container);\n    } else {\n      // Create default container\n      this.container = document.createElement('div');\n      this.container.id = 'customgpt-widget';\n      document.body.appendChild(this.container);\n    }\n  }\n\n  private setupFloatingStyles() {\n    if (!this.container || this.config.mode !== 'floating') return;\n\n    const { position, width, height } = this.config;\n    \n    // Base floating styles\n    Object.assign(this.container.style, {\n      position: 'fixed',\n      zIndex: '9999',\n      width: width || '400px',\n      height: height || '600px',\n      boxShadow: '0 10px 25px rgba(0, 0, 0, 0.2)',\n      borderRadius: '12px',\n      overflow: 'hidden',\n      transition: 'all 0.3s ease',\n      backgroundColor: 'white', // Ensure background is set\n    });\n    \n    // Add class for styling\n    this.container.classList.add('floating-mode');\n    this.container.classList.add('customgpt-floating-container');\n\n    // Position-specific styles\n    switch (position) {\n      case 'bottom-right':\n        Object.assign(this.container.style, {\n          bottom: '20px',\n          right: '20px',\n        });\n        break;\n      case 'bottom-left':\n        Object.assign(this.container.style, {\n          bottom: '20px',\n          left: '20px',\n        });\n        break;\n      case 'top-right':\n        Object.assign(this.container.style, {\n          top: '20px',\n          right: '20px',\n        });\n        break;\n      case 'top-left':\n        Object.assign(this.container.style, {\n          top: '20px',\n          left: '20px',\n        });\n        break;\n    }\n\n    // Initially hidden for floating mode with proper initial state\n    this.container.style.display = 'none';\n    this.container.style.opacity = '0';\n    this.container.style.transform = 'translateY(20px)';\n  }\n\n  private render() {\n    if (!this.container) return;\n\n    // Apply proper styling based on mode\n    if (this.config.mode === 'embedded') {\n      this.container.classList.add('customgpt-embedded-widget');\n      // Apply width and height styles directly to container\n      Object.assign(this.container.style, {\n        width: this.config.width || '400px',\n        height: this.config.height || '600px',\n        margin: '0 auto', // Center by default\n        display: 'block',\n      });\n    }\n\n    // Only create root once\n    if (!this.root) {\n      this.root = createRoot(this.container);\n    }\n    \n    const WidgetApp = () => {\n      // DEPRECATED: This global reference is kept for backward compatibility\n      // New code should use WidgetContext instead\n      // Only set if not already set to avoid overwriting first widget\n      if (typeof window !== 'undefined' && !(window as any).__customgpt_widget_instance) {\n        (window as any).__customgpt_widget_instance = this;\n      }\n      \n      const handleClose = () => {\n        this.close();\n        this.config.onClose?.();\n      };\n\n      // Get current conversation ID or use thread ID\n      const currentConvId = this.currentConversationId || this.config.threadId;\n      \n      // For isolated mode, pass the widget instance to manage conversations locally\n      const widgetRef = this;\n      \n      // Create a unique key for this widget's conversations\n      const widgetKey = `widget_${this.sessionId}`;\n\n      return (\n        <WidgetStoreProvider sessionId={this.sessionId}>\n          <WidgetProvider widgetInstance={widgetRef}>\n            <div className={`customgpt-widget-wrapper widget-mode ${this.config.mode}-mode`}>\n              <ChatLayout\n                mode={this.config.mode === 'embedded' ? 'widget' : 'floating'}\n                onClose={this.config.mode === 'floating' ? handleClose : undefined}\n                showSidebar={false} // Disable sidebar for widget mode\n                className=\"w-full h-full\"\n                // Pass conversation management configuration\n                enableConversationManagement={this.config.enableConversationManagement}\n                maxConversations={this.config.maxConversations}\n                sessionId={this.sessionId}\n                threadId={currentConvId} // Pass current conversation ID\n                onConversationChange={this.config.onConversationChange}\n                onMessage={this.config.onMessage}\n                // Pass widget instance for isolated conversation management\n                widgetInstance={this.config.isolateConversations !== false ? widgetRef : undefined}\n                // Pass current conversations for isolated mode\n                conversations={this.config.isolateConversations !== false ? this.getConversations() : undefined}\n                currentConversation={this.config.isolateConversations !== false && this.currentConversationId ? \n                  this.getConversations().find(c => c.id === this.currentConversationId) : undefined}\n                // Pass refresh key to trigger ConversationManager updates\n                conversationRefreshKey={this.conversationRefreshKey}\n              />\n              <Toaster \n                position=\"top-center\" \n                toastOptions={{\n                  style: { zIndex: 10000 }\n                }}\n              />\n            </div>\n          </WidgetProvider>\n        </WidgetStoreProvider>\n      );\n    };\n\n    this.root.render(<WidgetApp />);\n\n    // Auto-open for embedded mode\n    if (this.config.mode === 'embedded') {\n      this.open();\n    }\n  }\n\n  /**\n   * Get all conversations for current session\n   * @returns Array of conversations\n   */\n  public getConversations(): any[] {\n    const stored = localStorage.getItem(`customgpt_conversations_${this.sessionId}`);\n    if (stored) {\n      try {\n        return JSON.parse(stored);\n      } catch (e) {\n        console.error('Failed to parse conversations:', e);\n      }\n    }\n    return [];\n  }\n\n  /**\n   * Switch to a different conversation\n   * @param conversationId - ID of conversation to switch to\n   */\n  public switchConversation(conversationId: string): void {\n    const conversations = this.getConversations();\n    const conversation = conversations.find(c => c.id === conversationId);\n    \n    if (conversation) {\n      this.currentConversationId = conversationId;\n      \n      // Increment refresh key to trigger ConversationManager update\n      this.conversationRefreshKey++;\n      \n      // Don't update the global store if we're in isolated mode\n      // The render() method will handle passing the correct conversation\n      if (!this.config.isolateConversations) {\n        // Only update global store if sharing conversations\n        if (typeof window !== 'undefined') {\n          const { useConversationStore } = require('../store');\n          \n          // Get all widget conversations\n          const allWidgetConversations = this.getConversations();\n          \n          // Convert all widget conversations to store format\n          const storeConversations = allWidgetConversations.map(conv => ({\n            ...conv,\n            project_id: parseInt(this.config.agentId as string) || 0,\n            session_id: this.sessionId,\n            name: conv.title\n          }));\n          \n          // Find the selected conversation with proper format\n          const fullConversation = storeConversations.find(c => c.id === conversationId);\n          \n          // Update store with all widget conversations\n          useConversationStore.setState({\n            conversations: storeConversations as any,\n            currentConversation: fullConversation as any\n          });\n        }\n      }\n      \n      // Trigger re-render with new conversation\n      this.render();\n      this.config.onConversationChange?.(conversation);\n    }\n  }\n\n  /**\n   * Create a new conversation\n   * @param title - Optional title for the conversation\n   * @returns The new conversation object\n   */\n  public createConversation(title?: string): any {\n    const conversations = this.getConversations();\n    \n    // Check max conversations limit (only if specified by user)\n    if (this.config.maxConversations && conversations.length >= this.config.maxConversations) {\n      console.warn(`Maximum conversation limit (${this.config.maxConversations}) reached`);\n      return null; // Return null instead of throwing error\n    }\n    \n    const newConversation = {\n      id: `conv_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,\n      title: title || `Conversation ${conversations.length + 1}`,\n      createdAt: new Date().toISOString(),\n      messages: [],\n      // Add required fields for conversation store compatibility\n      project_id: parseInt(this.config.agentId as string) || 0,\n      session_id: this.sessionId,\n      name: title || `Conversation ${conversations.length + 1}`\n    };\n    \n    conversations.unshift(newConversation);\n    this.saveConversations(conversations);\n    this.currentConversationId = newConversation.id;\n    \n    // Don't update the global store if we're in isolated mode\n    if (!this.config.isolateConversations) {\n      // Only update global store if sharing conversations\n      if (typeof window !== 'undefined') {\n        const { useConversationStore, useMessageStore } = require('../store');\n        const messageStore = useMessageStore.getState();\n        \n        // Get all widget conversations (local storage)\n        const allWidgetConversations = this.getConversations();\n        \n        // Convert all widget conversations to store format\n        const storeConversations = allWidgetConversations.map(conv => ({\n          ...conv,\n          project_id: parseInt(this.config.agentId as string) || 0,\n          session_id: this.sessionId,\n          name: conv.title\n        }));\n        \n        // Update store with all widget conversations, with new one as current\n        useConversationStore.setState({\n          conversations: storeConversations as any,\n          currentConversation: newConversation as any\n        });\n        \n        // Clear any existing messages for this conversation ID to ensure welcome message shows\n        messageStore.clearMessages(newConversation.id);\n      }\n    }\n    \n    // Increment refresh key to trigger ConversationManager update\n    this.conversationRefreshKey++;\n    \n    // Trigger re-render with new conversation\n    this.render();\n    \n    return newConversation;\n  }\n\n  /**\n   * Update conversation title\n   * @param conversationId - ID of conversation to update\n   * @param newTitle - New title for the conversation\n   */\n  public updateConversationTitle(conversationId: string, newTitle: string): void {\n    const conversations = this.getConversations();\n    const conversation = conversations.find(c => c.id === conversationId);\n    \n    if (conversation) {\n      conversation.title = newTitle;\n      this.saveConversations(conversations);\n      // Increment refresh key to trigger ConversationManager update\n      this.conversationRefreshKey++;\n      this.render();\n    }\n  }\n\n  /**\n   * Delete a conversation\n   * @param conversationId - ID of conversation to delete\n   */\n  public deleteConversation(conversationId: string): void {\n    const conversations = this.getConversations();\n    const filtered = conversations.filter(c => c.id !== conversationId);\n    \n    this.saveConversations(filtered);\n    \n    // Increment refresh key to trigger ConversationManager update\n    this.conversationRefreshKey++;\n    \n    // If deleting current conversation, switch to another or create new\n    if (this.currentConversationId === conversationId) {\n      if (filtered.length > 0) {\n        this.switchConversation(filtered[0].id);\n      } else {\n        this.createConversation();\n      }\n    } else {\n      // Still need to re-render to update the conversation list\n      this.render();\n    }\n  }\n\n  /**\n   * Save conversations to localStorage\n   * @param conversations - Array of conversations to save\n   */\n  private saveConversations(conversations: any[]): void {\n    try {\n      localStorage.setItem(\n        `customgpt_conversations_${this.sessionId}`,\n        JSON.stringify(conversations)\n      );\n    } catch (e) {\n      console.error('Failed to save conversations:', e);\n      // Handle quota exceeded error\n      if (e instanceof DOMException && e.name === 'QuotaExceededError') {\n        // Try to clean up old conversations\n        this.cleanupOldConversations();\n      }\n    }\n  }\n\n  /**\n   * Clean up old conversations to free up localStorage space\n   */\n  private cleanupOldConversations(): void {\n    const conversations = this.getConversations();\n    // Keep only the 3 most recent conversations\n    const recent = conversations.slice(0, 3);\n    this.saveConversations(recent);\n  }\n\n  // Public methods\n  public open() {\n    if (!this.container) return;\n\n    this.isOpen = true;\n    \n    if (this.config.mode === 'floating') {\n      this.container.style.display = 'block';\n      // Trigger animation\n      setTimeout(() => {\n        if (this.container) {\n          this.container.style.transform = 'translateY(0)';\n          this.container.style.opacity = '1';\n        }\n      }, 10);\n    }\n\n    this.config.onOpen?.();\n  }\n\n  public close() {\n    if (!this.container) return;\n\n    this.isOpen = false;\n\n    if (this.config.mode === 'floating') {\n      this.container.style.transform = 'translateY(20px)';\n      this.container.style.opacity = '0';\n      \n      setTimeout(() => {\n        if (this.container) {\n          this.container.style.display = 'none';\n        }\n      }, 300);\n    }\n  }\n\n  public toggle() {\n    if (this.isOpen) {\n      this.close();\n    } else {\n      this.open();\n    }\n  }\n\n  public destroy() {\n    if (this.root) {\n      this.root.unmount();\n    }\n    \n    if (this.container && this.container.parentNode) {\n      this.container.parentNode.removeChild(this.container);\n    }\n    \n    this.container = null;\n    this.root = null;\n  }\n\n  public updateConfig(newConfig: Partial<CustomGPTWidgetConfig>) {\n    this.config = { ...this.config, ...newConfig };\n    \n    // Re-render with new config\n    this.render();\n  }\n  \n  /**\n   * Force a re-render of the widget\n   * Useful for updating the UI after state changes\n   */\n  public refresh() {\n    this.render();\n  }\n\n  // Getters\n  public get isOpened() {\n    return this.isOpen;\n  }\n\n  public get configuration() {\n    return { ...this.config };\n  }\n}\n\n// Global API for the widget\ndeclare global {\n  interface Window {\n    CustomGPTWidget: {\n      init: (config: CustomGPTWidgetConfig) => CustomGPTWidget;\n      create: (config: CustomGPTWidgetConfig) => CustomGPTWidget;\n    };\n  }\n}\n\n// Export for UMD build\nconst CustomGPTWidgetAPI = {\n  init: (config: CustomGPTWidgetConfig): CustomGPTWidget => {\n    return new CustomGPTWidget(config);\n  },\n  \n  create: (config: CustomGPTWidgetConfig): CustomGPTWidget => {\n    return new CustomGPTWidget(config);\n  },\n};\n\n// Global assignment for browser usage\nif (typeof window !== 'undefined') {\n  window.CustomGPTWidget = CustomGPTWidgetAPI;\n}\n\n// For module usage\nexport { CustomGPTWidget, CustomGPTWidgetAPI };\nexport default CustomGPTWidgetAPI;","/**\n * CustomGPT API Client\n * \n * Central API client for all CustomGPT.ai backend communication.\n * This client handles:\n * - Authentication via API key\n * - Request/response formatting\n * - Error handling and retries\n * - Streaming responses for real-time chat\n * - File uploads for agent training\n * \n * Architecture:\n * - Uses native fetch API\n * - Supports both REST and streaming endpoints\n * - Implements exponential backoff for retries\n * - Manages abort controllers for cancellation\n * \n * Key Features:\n * - Type-safe API methods\n * - Automatic retry with backoff\n * - Request timeout handling\n * - Stream parsing for chat responses\n * - Comprehensive error logging\n * \n * For contributors:\n * - All API methods should be type-safe\n * - Handle both successful and error responses\n * - Use logger for debugging\n * - Support request cancellation\n * - Document any API quirks or workarounds\n */\n\nimport type {\n  Agent,\n  AgentStats,\n  AgentSettings,\n  Conversation,\n  ChatMessage,\n  Citation,\n  APIResponse,\n  AgentsResponse,\n  ConversationsResponse,\n  MessagesResponse,\n  MessageResponse,\n  CitationResponse,\n  StreamChunk,\n  LimitsResponse,\n  UserProfile,\n} from '@/types';\nimport type { APIMessageResponse } from '@/types/message.types';\nimport type { \n  PagesListResponse, \n  DeletePageResponse, \n  ReindexPageResponse, \n  PagesQueryParams,\n  PageMetadata,\n  PageMetadataResponse\n} from '@/types/pages.types';\nimport type { \n  TrafficReportResponse, \n  QueriesReportResponse, \n  ConversationsReportResponse, \n  AnalysisReportResponse,\n  AnalysisInterval\n} from '@/types/reports.types';\nimport type { \n  SourcesListResponse, \n  SourceResponse, \n  DeleteSourceResponse,\n  UpdateSourceSettingsRequest,\n  CreateSitemapSourceRequest\n} from '@/types/sources.types';\nimport { parseStreamChunk, retryWithBackoff, delay } from '@/lib/utils';\nimport { logger } from '@/lib/logger';\n\n/**\n * User profile API response format\n */\ninterface UserProfileResponse {\n  status: 'success' | 'error';\n  data: UserProfile;\n}\n\n/**\n * Configuration options for the API client\n */\nexport interface CustomGPTClientConfig {\n  /** CustomGPT.ai API key for authentication */\n  apiKey: string;\n  /** Base URL for API calls (defaults to production) */\n  baseURL?: string;\n  /** Request timeout in milliseconds (default: 30000) */\n  timeout?: number;\n  /** Number of retry attempts for failed requests (default: 3) */\n  retryAttempts?: number;\n  /** Delay between retries in milliseconds (default: 1000) */\n  retryDelay?: number;\n}\n\n/**\n * Extended fetch options with additional features\n */\nexport interface RequestOptions extends RequestInit {\n  /** Request timeout override */\n  timeout?: number;\n  /** Retry attempts override */\n  retryAttempts?: number;\n  /** Query parameters to append to URL */\n  params?: Record<string, string | number | boolean>;\n}\n\n/**\n * Options for handling streaming responses\n */\nexport interface StreamOptions {\n  /** Called for each chunk of streaming data */\n  onChunk?: (chunk: StreamChunk) => void;\n  /** Called when streaming completes successfully */\n  onComplete?: () => void;\n  /** Called if streaming encounters an error */\n  onError?: (error: Error) => void;\n  /** Timeout for the stream */\n  timeout?: number;\n}\n\n/**\n * Main API client class\n * \n * Usage:\n * ```typescript\n * const client = new CustomGPTAPIClient({\n *   apiKey: 'your-api-key',\n *   baseURL: 'https://app.customgpt.ai/api/v1'\n * });\n * \n * // Get agents\n * const agents = await client.getAgents();\n * \n * // Send message with streaming\n * await client.sendMessageStream(agentId, sessionId, message, {\n *   onChunk: (chunk) => console.log(chunk),\n *   onComplete: () => console.log('Done')\n * });\n * ```\n */\nexport class CustomGPTAPIClient {\n  private baseURL: string;\n  private apiKey: string;\n  private timeout: number;\n  private retryAttempts: number;\n  private retryDelay: number;\n  /** Map of request IDs to abort controllers for cancellation */\n  private abortControllers: Map<string, AbortController> = new Map();\n\n  constructor(config: CustomGPTClientConfig) {\n    this.apiKey = config.apiKey;\n    this.baseURL = config.baseURL || 'https://app.customgpt.ai/api/v1';\n    this.timeout = config.timeout || 30000;\n    this.retryAttempts = config.retryAttempts || 3;\n    this.retryDelay = config.retryDelay || 1000;\n    \n    // Log initialization for debugging\n    logger.info('API_CLIENT', 'CustomGPT API Client initialized', {\n      baseURL: this.baseURL,\n      timeout: this.timeout,\n      hasApiKey: !!this.apiKey,\n      apiKeyPreview: this.apiKey ? `${this.apiKey.substring(0, 10)}...` : 'none'\n    });\n  }\n\n  /**\n   * Generic request method with retry logic and error handling\n   * \n   * Features:\n   * - Automatic retry with exponential backoff\n   * - Request timeout handling\n   * - Proper error messages for debugging\n   * - Request cancellation support\n   * \n   * @param endpoint - API endpoint path (e.g., '/projects')\n   * @param options - Request options including method, body, etc.\n   * @returns Promise resolving to the API response\n   * @throws Error if request fails after all retries\n   */\n  private async request<T>(\n    endpoint: string,\n    options: RequestOptions = {}\n  ): Promise<T> {\n    const {\n      timeout = this.timeout,\n      retryAttempts = this.retryAttempts,\n      params,\n      ...fetchOptions\n    } = options;\n\n    // Build URL with query parameters\n    const url = new URL(`${this.baseURL}${endpoint}`);\n    if (params) {\n      Object.entries(params).forEach(([key, value]) => {\n        if (value !== undefined && value !== null) {\n          url.searchParams.append(key, value.toString());\n        }\n      });\n    }\n\n    const headers: Record<string, string> = {\n      'Authorization': `Bearer ${this.apiKey}`,\n      'Accept': 'application/json',\n      ...(fetchOptions.headers as Record<string, string>),\n    };\n\n    // Only set Content-Type if body is not FormData\n    if (!(fetchOptions.body instanceof FormData)) {\n      headers['Content-Type'] = 'application/json';\n    }\n\n    const requestOptions: RequestInit = {\n      ...fetchOptions,\n      headers,\n    };\n\n    // Log the request\n    logger.apiRequest(endpoint, fetchOptions.method || 'GET', {\n      url: url.toString(),\n      headers: {\n        ...headers,\n        'Authorization': `Bearer ${this.apiKey.substring(0, 10)}...` // Mask API key\n      },\n      body: fetchOptions.body ? \n        (typeof fetchOptions.body === 'string' ? JSON.parse(fetchOptions.body) : 'FormData') \n        : undefined\n    });\n\n    return retryWithBackoff(\n      async () => {\n        const abortController = new AbortController();\n        const requestId = this.generateRequestId();\n        this.abortControllers.set(requestId, abortController);\n\n        // Set timeout\n        const timeoutId = setTimeout(() => {\n          abortController.abort();\n        }, timeout);\n\n        try {\n          const response = await fetch(url.toString(), {\n            ...requestOptions,\n            signal: abortController.signal,\n          });\n\n          clearTimeout(timeoutId);\n          this.abortControllers.delete(requestId);\n\n          if (!response.ok) {\n            const errorText = await response.text();\n            let errorMessage: string;\n            let errorCode: string | undefined;\n            \n            try {\n              const errorData = JSON.parse(errorText);\n              // Handle both direct error format and nested data format\n              if (errorData.data && errorData.data.code && errorData.data.message) {\n                errorMessage = errorData.data.message;\n                errorCode = errorData.data.code.toString();\n              } else {\n                errorMessage = errorData.message || errorData.error || 'Unknown error';\n                errorCode = errorData.code?.toString();\n              }\n            } catch {\n              errorMessage = errorText || `HTTP ${response.status}`;\n            }\n\n            // Enhance error messages based on status codes and API documentation\n            const enhancedMessage = this.getEnhancedErrorMessage(response.status, errorMessage, errorCode);\n\n            logger.apiError(endpoint, {\n              status: response.status,\n              message: enhancedMessage,\n              originalMessage: errorMessage,\n              errorCode,\n              headers: Object.fromEntries(response.headers.entries())\n            });\n\n            throw new APIError(response.status, enhancedMessage, errorCode);\n          }\n\n          const data = await response.json();\n          \n          logger.apiResponse(endpoint, response.status, {\n            headers: Object.fromEntries(response.headers.entries()),\n            dataPreview: JSON.stringify(data).substring(0, 200) + '...'\n          });\n\n          return data;\n        } catch (error) {\n          clearTimeout(timeoutId);\n          this.abortControllers.delete(requestId);\n          \n          if (error instanceof APIError) {\n            throw error;\n          }\n          \n          if (error instanceof Error && error.name === 'AbortError') {\n            throw new APIError(408, 'Request timeout');\n          }\n          \n          throw new APIError(0, error instanceof Error ? error.message : 'Network error');\n        }\n      },\n      retryAttempts,\n      this.retryDelay\n    );\n  }\n\n  /**\n   * Streaming request method for real-time responses\n   */\n  private async streamRequest(\n    endpoint: string,\n    options: RequestOptions = {},\n    streamOptions: StreamOptions = {}\n  ): Promise<void> {\n    const {\n      timeout = 60000, // Longer timeout for streaming\n      params,\n      ...fetchOptions\n    } = options;\n\n    const { onChunk, onComplete, onError } = streamOptions;\n    \n    logger.info('API_CLIENT', 'Starting stream request', {\n      endpoint,\n      method: options.method || 'GET',\n      hasBody: !!fetchOptions.body,\n      bodyContent: fetchOptions.body ? (typeof fetchOptions.body === 'string' ? JSON.parse(fetchOptions.body) : 'FormData') : undefined\n    });\n\n    // Build URL with stream parameter - CustomGPT requires stream=1 in query params\n    const url = new URL(`${this.baseURL}${endpoint}`);\n    url.searchParams.append('stream', '1');\n    url.searchParams.append('lang', 'en'); // Add required lang parameter\n    \n    if (params) {\n      Object.entries(params).forEach(([key, value]) => {\n        if (value !== undefined && value !== null) {\n          url.searchParams.append(key, value.toString());\n        }\n      });\n    }\n\n    const abortController = new AbortController();\n    const requestId = this.generateRequestId();\n    this.abortControllers.set(requestId, abortController);\n\n    // Set timeout\n    const timeoutId = setTimeout(() => {\n      abortController.abort();\n    }, timeout);\n\n    try {\n      logger.apiRequest(endpoint, fetchOptions.method || 'POST', {\n        url: url.toString(),\n        headers: {\n          'Authorization': `Bearer ${this.apiKey.substring(0, 10)}...`,\n          'Content-Type': 'application/json',\n          'Accept': 'text/event-stream',\n        },\n        body: fetchOptions.body ? JSON.parse(fetchOptions.body as string) : undefined\n      });\n      \n      const response = await fetch(url.toString(), {\n        ...fetchOptions,\n        headers: {\n          'Authorization': `Bearer ${this.apiKey}`,\n          'Content-Type': 'application/json',\n          'Accept': 'text/event-stream',\n          ...fetchOptions.headers,\n        },\n        signal: abortController.signal,\n      });\n\n      if (!response.ok) {\n        const errorText = await response.text();\n        let errorMessage: string;\n        let errorCode: string | undefined;\n        \n        try {\n          const errorData = JSON.parse(errorText);\n          // Handle both direct error format and nested data format\n          if (errorData.data && errorData.data.code && errorData.data.message) {\n            errorMessage = errorData.data.message;\n            errorCode = errorData.data.code.toString();\n          } else {\n            errorMessage = errorData.message || errorData.error || 'Unknown error';\n            errorCode = errorData.code?.toString();\n          }\n        } catch {\n          errorMessage = errorText || `HTTP ${response.status}`;\n        }\n\n        // Enhance error messages\n        const enhancedMessage = this.getEnhancedErrorMessage(response.status, errorMessage, errorCode);\n\n        logger.apiError(endpoint, {\n          status: response.status,\n          message: enhancedMessage,\n          originalMessage: errorMessage,\n          errorCode,\n          headers: Object.fromEntries(response.headers.entries())\n        });\n        \n        throw new APIError(response.status, enhancedMessage, errorCode);\n      }\n      \n      logger.apiResponse(endpoint, response.status, {\n        headers: Object.fromEntries(response.headers.entries()),\n        contentType: response.headers.get('content-type'),\n        isEventStream: response.headers.get('content-type')?.includes('text/event-stream')\n      });\n\n      const reader = response.body?.getReader();\n      if (!reader) {\n        throw new APIError(500, 'No response body');\n      }\n\n      const decoder = new TextDecoder();\n      let buffer = '';\n\n      try {\n        let hasReceivedData = false;\n        \n        while (true) {\n          const { done, value } = await reader.read();\n          \n          if (done) {\n            logger.info('STREAM', 'Stream ended', { hasReceivedData });\n            \n            // If we haven't received any data, this might indicate an issue\n            if (!hasReceivedData) {\n              logger.warn('STREAM', 'Stream ended without receiving any data - possible API issue');\n              onError?.(new Error('No data received from stream - the API may not support streaming or there was a connection issue'));\n              return;\n            }\n            \n            onComplete?.();\n            break;\n          }\n\n          buffer += decoder.decode(value, { stream: true });\n          const lines = buffer.split('\\n');\n          buffer = lines.pop() || ''; // Keep incomplete line in buffer\n\n          for (const line of lines) {\n            if (line.trim()) {\n              hasReceivedData = true;\n              \n              logger.debug('STREAM', 'Raw SSE line received', { \n                line: line.substring(0, 200),\n                fullLine: line,\n                lineLength: line.length \n              });\n              \n              const chunk = parseStreamChunk(line);\n              if (chunk) {\n                logger.debug('STREAM', 'Successfully parsed chunk', { \n                  type: chunk.type, \n                  hasContent: !!chunk.content,\n                  contentPreview: chunk.content?.substring(0, 100),\n                  hasCitations: !!chunk.citations\n                });\n                \n                if (chunk.type === 'done') {\n                  logger.info('STREAM', 'Stream completed with done signal');\n                  onComplete?.();\n                  return;\n                } else if (chunk.type === 'error') {\n                  logger.error('STREAM', 'Stream error received', { error: chunk.error });\n                  onError?.(new Error(chunk.error || 'Stream error'));\n                  return;\n                } else {\n                  onChunk?.(chunk);\n                }\n              } else {\n                logger.warn('STREAM', 'Failed to parse chunk or chunk was null', { \n                  originalLine: line.substring(0, 200) \n                });\n              }\n            }\n          }\n        }\n      } finally {\n        reader.releaseLock();\n      }\n    } catch (error) {\n      if (error instanceof APIError) {\n        onError?.(error);\n      } else if (error instanceof Error && error.name === 'AbortError') {\n        onError?.(new APIError(408, 'Request timeout'));\n      } else {\n        onError?.(new APIError(0, error instanceof Error ? error.message : 'Network error'));\n      }\n    } finally {\n      clearTimeout(timeoutId);\n      this.abortControllers.delete(requestId);\n    }\n  }\n\n  /**\n   * Cancel a request by ID\n   */\n  public cancelRequest(requestId: string): void {\n    const controller = this.abortControllers.get(requestId);\n    if (controller) {\n      controller.abort();\n      this.abortControllers.delete(requestId);\n    }\n  }\n\n  /**\n   * Cancel all active requests\n   */\n  public cancelAllRequests(): void {\n    this.abortControllers.forEach(controller => controller.abort());\n    this.abortControllers.clear();\n  }\n\n  private generateRequestId(): string {\n    return Math.random().toString(36).substring(2) + Date.now().toString(36);\n  }\n\n  /**\n   * Enhance error messages based on API documentation and status codes\n   */\n  private getEnhancedErrorMessage(status: number, originalMessage: string, errorCode?: string): string {\n    // Handle specific error codes from API documentation\n    switch (status) {\n      case 400:\n        if (originalMessage.includes('Agent id must be integer')) {\n          return 'Invalid agent ID provided. Please ensure you have selected a valid agent.';\n        }\n        if (originalMessage.includes('Agent name can\\'t be empty')) {\n          return 'Agent name cannot be empty. Please provide a valid agent name.';\n        }\n        return 'Invalid request data. Please check your input and try again.';\n      \n      case 401:\n        if (originalMessage.includes('API Token is either missing or invalid')) {\n          return 'Authentication failed. Your API key is missing or invalid. Please check your API key in settings and ensure it has proper permissions.';\n        }\n        return 'Authentication failed. Please check your API key and try again.';\n      \n      case 403:\n        if (originalMessage.includes('license')) {\n          return 'You do not have permission to manage licenses for this agent. Please ensure your API key has the necessary permissions or you are the owner of this agent.';\n        }\n        if (originalMessage.includes('Licenses are not allowed')) {\n          return 'License management is not enabled for this agent. Please enable licenses in the agent settings first.';\n        }\n        return 'Access denied. You do not have permission to perform this action. Please check your API key permissions.';\n      \n      case 404:\n        if (originalMessage.includes('Agent with id')) {\n          return 'The selected agent was not found or you don\\'t have access to it. Please select a different agent or check your permissions.';\n        }\n        if (originalMessage.includes('Agent license with id')) {\n          return 'The specified license was not found. It may have been deleted or you may not have access to it.';\n        }\n        if (originalMessage.includes('Conversation message with id') || originalMessage.includes('not found')) {\n          return 'The requested conversation or message was not found. It may have been deleted or you may not have access to it.';\n        }\n        return 'The requested resource was not found. Please check if it exists and you have access to it.';\n      \n      case 429:\n        if (originalMessage.includes('exhausted your current query credits')) {\n          return 'You have reached your query limit. Please upgrade your plan or contact customer support at https://customgpt.freshdesk.com/support/home for assistance.';\n        }\n        return 'Rate limit exceeded. Please wait a moment and try again, or contact support if you need higher limits.';\n      \n      case 500:\n        if (originalMessage.includes('Internal Server Error')) {\n          return 'Server error occurred. Please try again in a few moments. If the problem persists, contact customer support.';\n        }\n        return 'An unexpected server error occurred. Please try again later.';\n      \n      case 501:\n        if (originalMessage.includes('audio is not yet supported')) {\n          return 'Audio files are not currently supported. Please remove any audio files from your request and try again with text or other supported file types.';\n        }\n        return 'This feature is not yet implemented. Please try a different approach.';\n      \n      case 408:\n        return 'Request timed out. Please check your internet connection and try again.';\n      \n      case 422:\n        // Unprocessable Entity - often used for validation errors\n        if (originalMessage.includes('Agent id must be integer')) {\n          return 'Invalid agent ID format. Please ensure the agent ID is a valid number.';\n        }\n        return 'Invalid data provided. Please check your input and ensure all required fields are correctly formatted.';\n      \n      default:\n        // For other status codes, return the original message with context\n        if (status >= 500) {\n          return `Server error (${status}): ${originalMessage}. Please try again later.`;\n        } else if (status >= 400) {\n          return `Request error (${status}): ${originalMessage}. Please check your input and try again.`;\n        }\n        return originalMessage;\n    }\n  }\n\n  // AGENTS/PROJECTS API METHODS\n\n  /**\n   * Get list of agents\n   */\n  async getAgents(params?: {\n    page?: number;\n    duration?: number;\n    order?: 'asc' | 'desc';\n    orderBy?: 'id' | 'created_at';\n    name?: string;\n  }): Promise<AgentsResponse> {\n    return this.request<AgentsResponse>('/projects', { params });\n  }\n\n  /**\n   * Create new agent/project\n   */\n  async createAgent(data: {\n    project_name: string;\n    sitemap_path?: string;\n    files?: File[];\n    is_shared?: boolean;\n  }): Promise<APIResponse<Agent>> {\n    // API requires multipart/form-data\n    const formData = new FormData();\n    formData.append('project_name', data.project_name);\n    \n    if (data.sitemap_path) {\n      formData.append('sitemap_path', data.sitemap_path);\n    }\n    \n    if (data.files && data.files.length > 0) {\n      data.files.forEach((file, index) => {\n        formData.append(`files[${index}]`, file);\n      });\n    }\n    \n    if (data.is_shared !== undefined) {\n      formData.append('is_shared', data.is_shared.toString());\n    }\n    \n    return this.request<APIResponse<Agent>>('/projects', {\n      method: 'POST',\n      body: formData,\n    });\n  }\n\n  /**\n   * Get single agent by ID\n   */\n  async getAgent(id: number): Promise<APIResponse<Agent>> {\n    return this.request<APIResponse<Agent>>(`/projects/${id}`);\n  }\n\n\n  /**\n   * Update agent - API only supports updating are_licenses_allowed\n   */\n  async updateAgent(id: number, data: { are_licenses_allowed?: boolean }): Promise<APIResponse<Agent>> {\n    const formData = new FormData();\n    if (data.are_licenses_allowed !== undefined) {\n      formData.append('are_licenses_allowed', data.are_licenses_allowed.toString());\n    }\n    \n    return this.request<APIResponse<Agent>>(`/projects/${id}`, {\n      method: 'POST',\n      body: formData,\n    });\n  }\n\n  /**\n   * Delete agent\n   */\n  async deleteAgent(id: number): Promise<APIResponse<{ deleted: boolean }>> {\n    return this.request<APIResponse<{ deleted: boolean }>>(`/projects/${id}`, {\n      method: 'DELETE',\n    });\n  }\n  \n  /**\n   * Replicate agent\n   */\n  async replicateAgent(id: number): Promise<APIResponse<Agent>> {\n    return this.request<APIResponse<Agent>>(`/projects/${id}/replicate`, {\n      method: 'POST',\n    });\n  }\n  \n  /**\n   * Get agent stats\n   */\n  async getAgentStats(id: number): Promise<APIResponse<AgentStats>> {\n    return this.request<APIResponse<AgentStats>>(`/projects/${id}/stats`);\n  }\n\n  /**\n   * Get agent settings\n   */\n  async getAgentSettings(id: number): Promise<APIResponse<AgentSettings>> {\n    return this.request<APIResponse<AgentSettings>>(`/projects/${id}/settings`);\n  }\n\n  /**\n   * Update agent settings\n   */\n  async updateAgentSettings(id: number, settings: Partial<AgentSettings> | FormData): Promise<APIResponse<AgentSettings>> {\n    const isFormData = settings instanceof FormData;\n    \n    return this.request<APIResponse<AgentSettings>>(`/projects/${id}/settings`, {\n      method: 'POST',\n      body: isFormData ? settings : JSON.stringify(settings),\n    });\n  }\n\n  // CONVERSATIONS API METHODS\n\n  /**\n   * Get conversations for a project\n   */\n  async getConversations(projectId: number, params?: {\n    page?: number;\n    order?: 'asc' | 'desc';\n    orderBy?: 'id' | 'created_at';\n    name?: string;\n    userFilter?: 'all' | string;\n  }): Promise<ConversationsResponse> {\n    const enhancedParams = {\n      ...params,\n      userFilter: params?.userFilter || 'all'\n    };\n    return this.request<ConversationsResponse>(`/projects/${projectId}/conversations`, { params: enhancedParams });\n  }\n\n  /**\n   * Create new conversation\n   */\n  async createConversation(projectId: number, data?: { name?: string }): Promise<APIResponse<Conversation>> {\n    return this.request<APIResponse<Conversation>>(`/projects/${projectId}/conversations`, {\n      method: 'POST',\n      body: data ? JSON.stringify(data) : JSON.stringify({}),\n    });\n  }\n\n  /**\n   * Update conversation\n   */\n  async updateConversation(\n    projectId: number,\n    sessionId: string,\n    data: { name: string }\n  ): Promise<APIResponse<Conversation>> {\n    return this.request<APIResponse<Conversation>>(`/projects/${projectId}/conversations/${sessionId}`, {\n      method: 'PUT',\n      body: JSON.stringify(data),\n    });\n  }\n\n  /**\n   * Delete conversation\n   */\n  async deleteConversation(projectId: number, sessionId: string): Promise<APIResponse<{ deleted: boolean }>> {\n    return this.request<APIResponse<{ deleted: boolean }>>(`/projects/${projectId}/conversations/${sessionId}`, {\n      method: 'DELETE',\n    });\n  }\n\n  // MESSAGES API METHODS\n\n  /**\n   * Get messages for a conversation\n   * Note: sessionId here is actually the session_id from the conversation, not the conversation id\n   */\n  async getMessages(\n    projectId: number,\n    sessionId: string,\n    params?: { page?: number; order?: 'asc' | 'desc' }\n  ): Promise<MessagesResponse> {\n    // Add required parameters for message retrieval\n    const enhancedParams = {\n      ...params,\n      stream: false,\n      lang: 'en'\n    };\n    return this.request<MessagesResponse>(`/projects/${projectId}/conversations/${sessionId}/messages`, { params: enhancedParams });\n  }\n\n  /**\n   * Send message (non-streaming)\n   * Note: sessionId here is actually the session_id from the conversation, not the conversation id\n   */\n  async sendMessage(\n    projectId: number,\n    sessionId: string,\n    data: {\n      prompt: string;\n      custom_persona?: string;\n      chatbot_model?: string;\n      response_source?: 'default' | 'own_content' | 'openai_content';\n      stream?: number;\n    }\n  ): Promise<MessageResponse> {\n    // Include required fields as per API documentation\n    const payload = {\n      prompt: data.prompt,\n      response_source: data.response_source || 'default',\n      custom_persona: data.custom_persona,\n      chatbot_model: data.chatbot_model,\n      stream: 0\n    };\n    \n    // Remove undefined values\n    Object.keys(payload).forEach(key => {\n      if (payload[key as keyof typeof payload] === undefined) {\n        delete payload[key as keyof typeof payload];\n      }\n    });\n    \n    return this.request<MessageResponse>(`/projects/${projectId}/conversations/${sessionId}/messages`, {\n      method: 'POST',\n      body: JSON.stringify(payload),\n      params: { \n        stream: false, \n        lang: 'en' \n      }\n    });\n  }\n\n  /**\n   * Send message with streaming\n   * Note: sessionId here is actually the session_id from the conversation, not the conversation id\n   */\n  async sendMessageStream(\n    projectId: number,\n    sessionId: string,\n    data: {\n      prompt: string;\n      custom_persona?: string;\n      chatbot_model?: string;\n      response_source?: 'default' | 'own_content' | 'openai_content';\n      stream?: number;\n    },\n    streamOptions: StreamOptions\n  ): Promise<void> {\n    // Include required fields as per API documentation\n    const payload = {\n      prompt: data.prompt,\n      response_source: data.response_source || 'default',\n      custom_persona: data.custom_persona,\n      chatbot_model: data.chatbot_model,\n      stream: 1\n    };\n    \n    // Remove undefined values\n    Object.keys(payload).forEach(key => {\n      if (payload[key as keyof typeof payload] === undefined) {\n        delete payload[key as keyof typeof payload];\n      }\n    });\n    \n    logger.info('API_CLIENT', 'Sending streaming message', {\n      projectId,\n      sessionId,\n      prompt: data.prompt.substring(0, 50),\n      hasCustomPersona: !!data.custom_persona,\n      responseSource: payload.response_source,\n      streamParam: payload.stream\n    });\n    \n    return this.streamRequest(\n      `/projects/${projectId}/conversations/${sessionId}/messages`,\n      {\n        method: 'POST',\n        body: JSON.stringify(payload),\n        params: {\n          stream: 1, // Also include in query params\n          lang: 'en'\n        }\n      },\n      streamOptions\n    );\n  }\n\n  /**\n   * Get a message by ID\n   */\n  async getMessageById(\n    projectId: number,\n    sessionId: string,\n    promptId: number\n  ): Promise<APIMessageResponse> {\n    return this.request<APIMessageResponse>(\n      `/projects/${projectId}/conversations/${sessionId}/messages/${promptId}`\n    );\n  }\n\n  /**\n   * Update message feedback\n   */\n  async updateMessageFeedback(\n    projectId: number,\n    sessionId: string,\n    promptId: number,\n    data: { reaction: 'neutral' | 'disliked' | 'liked' }\n  ): Promise<APIMessageResponse> {\n    return this.request<APIMessageResponse>(\n      `/projects/${projectId}/conversations/${sessionId}/messages/${promptId}/feedback`,\n      {\n        method: 'PUT',\n        body: JSON.stringify(data),\n      }\n    );\n  }\n\n  /**\n   * Send message in OpenAI format\n   */\n  async sendMessageOpenAIFormat(\n    projectId: number,\n    data: {\n      messages?: Array<{ role: string; content: string }>;\n      stream?: boolean;\n      lang?: string;\n      is_inline_citation?: boolean;\n    }\n  ): Promise<any> {\n    return this.request<any>(`/projects/${projectId}/chat/completions`, {\n      method: 'POST',\n      body: JSON.stringify({\n        ...data,\n        stream: data.stream ?? false,\n        lang: data.lang || 'en',\n        is_inline_citation: data.is_inline_citation ?? false\n      }),\n    });\n  }\n\n  // CITATIONS API METHODS\n\n  /**\n   * Get citation details\n   */\n  async getCitation(projectId: number, citationId: number): Promise<CitationResponse> {\n    return this.request<CitationResponse>(`/projects/${projectId}/citations/${citationId}`);\n  }\n\n  // SOURCES API METHODS\n\n\n  /**\n   * Upload file to project\n   */\n  async uploadFile(projectId: number, file: File, options?: {\n    file_data_retension?: boolean;\n    is_ocr_enabled?: boolean;\n    is_anonymized?: boolean;\n  }): Promise<APIResponse<any>> {\n    const formData = new FormData();\n    formData.append('file', file);\n    \n    if (options) {\n      Object.entries(options).forEach(([key, value]) => {\n        if (value !== undefined) {\n          formData.append(key, value.toString());\n        }\n      });\n    }\n\n    return this.request<APIResponse<any>>(`/projects/${projectId}/sources`, {\n      method: 'POST',\n      body: formData,\n    });\n  }\n\n  /**\n   * Analytics APIs\n   */\n  async getConversationAnalytics(\n    projectId: number, \n    params?: {\n      start_date?: string;\n      end_date?: string;\n      limit?: number;\n    }\n  ): Promise<APIResponse<any>> {\n    const queryParams = new URLSearchParams();\n    if (params?.start_date) queryParams.append('start_date', params.start_date);\n    if (params?.end_date) queryParams.append('end_date', params.end_date);\n    if (params?.limit) queryParams.append('limit', params.limit.toString());\n    \n    return this.request<APIResponse<any>>(`/projects/${projectId}/analytics/conversations${queryParams.toString() ? `?${queryParams}` : ''}`);\n  }\n\n  async getQueryAnalytics(\n    projectId: number,\n    params?: {\n      start_date?: string;\n      end_date?: string;\n      limit?: number;\n    }\n  ): Promise<APIResponse<any>> {\n    const queryParams = new URLSearchParams();\n    if (params?.start_date) queryParams.append('start_date', params.start_date);\n    if (params?.end_date) queryParams.append('end_date', params.end_date);\n    if (params?.limit) queryParams.append('limit', params.limit.toString());\n    \n    return this.request<APIResponse<any>>(`/projects/${projectId}/analytics/queries${queryParams.toString() ? `?${queryParams}` : ''}`);\n  }\n\n  async getTrafficAnalytics(\n    projectId: number,\n    params?: {\n      start_date?: string;\n      end_date?: string;\n      period?: 'hour' | 'day' | 'week' | 'month';\n    }\n  ): Promise<APIResponse<any>> {\n    const queryParams = new URLSearchParams();\n    if (params?.start_date) queryParams.append('start_date', params.start_date);\n    if (params?.end_date) queryParams.append('end_date', params.end_date);\n    if (params?.period) queryParams.append('period', params.period);\n    \n    return this.request<APIResponse<any>>(`/projects/${projectId}/analytics/traffic${queryParams.toString() ? `?${queryParams}` : ''}`);\n  }\n\n  async getStatistics(projectId: number): Promise<APIResponse<any>> {\n    return this.request<APIResponse<any>>(`/projects/${projectId}/analytics/statistics`);\n  }\n\n  // Reports and Analytics methods\n  async getTrafficReport(projectId: number): Promise<TrafficReportResponse> {\n    return this.request<TrafficReportResponse>(`/projects/${projectId}/reports/traffic`, {\n      method: 'GET',\n    });\n  }\n\n  async getQueriesReport(projectId: number): Promise<QueriesReportResponse> {\n    return this.request<QueriesReportResponse>(`/projects/${projectId}/reports/queries`, {\n      method: 'GET',\n    });\n  }\n\n  async getConversationsReport(projectId: number): Promise<ConversationsReportResponse> {\n    return this.request<ConversationsReportResponse>(`/projects/${projectId}/reports/conversations`, {\n      method: 'GET',\n    });\n  }\n\n  async getAnalysisReport(projectId: number, interval?: AnalysisInterval): Promise<AnalysisReportResponse> {\n    const queryParams = new URLSearchParams();\n    if (interval) {\n      queryParams.append('interval', interval);\n    }\n    \n    return this.request<AnalysisReportResponse>(\n      `/projects/${projectId}/reports/analysis${queryParams.toString() ? `?${queryParams}` : ''}`,\n      {\n        method: 'GET',\n      }\n    );\n  }\n\n  /**\n   * Page Management APIs\n   */\n  async getPages(\n    projectId: number,\n    params?: PagesQueryParams\n  ): Promise<PagesListResponse> {\n    const queryParams = new URLSearchParams();\n    if (params?.page) queryParams.append('page', params.page.toString());\n    if (params?.limit) queryParams.append('limit', params.limit.toString());\n    if (params?.order) queryParams.append('order', params.order);\n    if (params?.crawl_status) queryParams.append('crawl_status', params.crawl_status);\n    if (params?.index_status) queryParams.append('index_status', params.index_status);\n    \n    return this.request<PagesListResponse>(\n      `/projects/${projectId}/pages${queryParams.toString() ? `?${queryParams}` : ''}`\n    );\n  }\n\n  async deletePage(projectId: number, pageId: number): Promise<DeletePageResponse> {\n    return this.request<DeletePageResponse>(`/projects/${projectId}/pages/${pageId}`, {\n      method: 'DELETE',\n    });\n  }\n\n  async reindexPage(projectId: number, pageId: number): Promise<ReindexPageResponse> {\n    return this.request<ReindexPageResponse>(`/projects/${projectId}/pages/${pageId}/reindex`, {\n      method: 'POST',\n    });\n  }\n\n  // Page Metadata methods\n  async getPageMetadata(projectId: number, pageId: number): Promise<PageMetadataResponse> {\n    return this.request<PageMetadataResponse>(`/projects/${projectId}/pages/${pageId}/metadata`, {\n      method: 'GET',\n    });\n  }\n\n  async updatePageMetadata(\n    projectId: number, \n    pageId: number,\n    metadata: Partial<PageMetadata>\n  ): Promise<PageMetadataResponse> {\n    return this.request<PageMetadataResponse>(`/projects/${projectId}/pages/${pageId}/metadata`, {\n      method: 'PUT',\n      body: JSON.stringify(metadata),\n    });\n  }\n\n  async previewFile(pageId: number): Promise<any> {\n    return this.request<any>(`/preview/${pageId}`);\n  }\n\n\n  /**\n   * Agent License Management APIs\n   */\n  \n  /**\n   * Get all licenses for an agent\n   */\n  async getLicenses(projectId: number): Promise<APIResponse<any[]>> {\n    return this.request<APIResponse<any[]>>(`/projects/${projectId}/licenses`);\n  }\n\n  /**\n   * Create a new license for an agent\n   */\n  async createLicense(projectId: number, data: { name: string }): Promise<APIResponse<any>> {\n    return this.request<APIResponse<any>>(`/projects/${projectId}/licenses`, {\n      method: 'POST',\n      body: JSON.stringify(data),\n    });\n  }\n\n  /**\n   * Get a specific license for an agent\n   */\n  async getLicense(projectId: number, licenseId: string): Promise<APIResponse<any>> {\n    return this.request<APIResponse<any>>(`/projects/${projectId}/licenses/${licenseId}`);\n  }\n\n  /**\n   * Update a license for an agent\n   */\n  async updateLicense(\n    projectId: number,\n    licenseId: string,\n    data: { name: string }\n  ): Promise<APIResponse<any>> {\n    return this.request<APIResponse<any>>(`/projects/${projectId}/licenses/${licenseId}`, {\n      method: 'PUT',\n      body: JSON.stringify(data),\n    });\n  }\n\n  /**\n   * Delete a license for an agent\n   */\n  async deleteLicense(projectId: number, licenseId: string): Promise<APIResponse<any>> {\n    return this.request<APIResponse<any>>(`/projects/${projectId}/licenses/${licenseId}`, {\n      method: 'DELETE',\n    });\n  }\n\n  /**\n   * Sources Management APIs\n   */\n  async getSources(projectId: number): Promise<SourcesListResponse> {\n    return this.request<SourcesListResponse>(`/projects/${projectId}/sources`);\n  }\n\n  async createSitemapSource(\n    projectId: number,\n    data: CreateSitemapSourceRequest\n  ): Promise<SourceResponse> {\n    return this.request<SourceResponse>(`/projects/${projectId}/sources`, {\n      method: 'POST',\n      body: JSON.stringify(data),\n    });\n  }\n\n  async uploadFileSource(projectId: number, formData: FormData): Promise<SourceResponse> {\n    return this.request<SourceResponse>(`/projects/${projectId}/sources`, {\n      method: 'POST',\n      body: formData,\n    });\n  }\n\n  async updateSourceSettings(\n    projectId: number,\n    sourceId: number,\n    settings: UpdateSourceSettingsRequest\n  ): Promise<SourceResponse> {\n    return this.request<SourceResponse>(`/projects/${projectId}/sources/${sourceId}`, {\n      method: 'PUT',\n      body: JSON.stringify(settings),\n    });\n  }\n\n  async deleteSource(projectId: number, sourceId: number): Promise<DeleteSourceResponse> {\n    return this.request<DeleteSourceResponse>(`/projects/${projectId}/sources/${sourceId}`, {\n      method: 'DELETE',\n    });\n  }\n\n  async instantSyncSource(projectId: number, sourceId: number): Promise<SourceResponse> {\n    return this.request<SourceResponse>(`/projects/${projectId}/sources/${sourceId}/instant-sync`, {\n      method: 'PUT',\n    });\n  }\n\n  // LIMITS API METHODS\n  \n  /**\n   * Get user's agents, words and queries limit\n   */\n  async getUserLimits(): Promise<LimitsResponse> {\n    return this.request<LimitsResponse>('/limits/usage');\n  }\n\n  // User Profile API Methods\n  async getUserProfile(): Promise<UserProfileResponse> {\n    return this.request<UserProfileResponse>('/user');\n  }\n\n  async updateUserProfile(formData: FormData): Promise<UserProfileResponse> {\n    return this.request<UserProfileResponse>('/user', {\n      method: 'POST',\n      body: formData,\n    });\n  }\n\n\n  // Generic request methods for use by stores\n  async get<T>(endpoint: string): Promise<T> {\n    return this.request<T>(endpoint);\n  }\n\n  async post<T>(endpoint: string, data?: any): Promise<T> {\n    return this.request<T>(endpoint, {\n      method: 'POST',\n      body: data instanceof FormData ? data : (data ? JSON.stringify(data) : undefined),\n    });\n  }\n\n  async put<T>(endpoint: string, data?: any): Promise<T> {\n    return this.request<T>(endpoint, {\n      method: 'PUT',\n      body: data ? JSON.stringify(data) : undefined,\n    });\n  }\n\n  async delete<T>(endpoint: string): Promise<T> {\n    return this.request<T>(endpoint, {\n      method: 'DELETE',\n    });\n  }\n}\n\nexport class APIError extends Error {\n  constructor(\n    public status: number,\n    message: string,\n    public code?: string,\n    public details?: any\n  ) {\n    super(message);\n    this.name = 'APIError';\n  }\n}\n\n// Default client instance (will be initialized with API key)\nlet defaultClient: CustomGPTAPIClient | null = null;\n\nexport function getClient(): CustomGPTAPIClient {\n  if (!defaultClient) {\n    throw new Error('API client not initialized. Call initializeClient() first.');\n  }\n  return defaultClient;\n}\n\nexport function initializeClient(config: CustomGPTClientConfig): CustomGPTAPIClient {\n  defaultClient = new CustomGPTAPIClient(config);\n  return defaultClient;\n}\n\nexport function isClientInitialized(): boolean {\n  return defaultClient !== null;\n}","export type LogLevel = 'debug' | 'info' | 'warn' | 'error';\n\nexport interface LogEntry {\n  timestamp: string;\n  level: LogLevel;\n  category: string;\n  message: string;\n  data?: any;\n  error?: any;\n  stack?: string;\n}\n\nclass Logger {\n  private static instance: Logger;\n  private isClient: boolean;\n  private logs: LogEntry[] = [];\n\n  private constructor() {\n    this.isClient = typeof window !== 'undefined';\n  }\n\n  static getInstance(): Logger {\n    if (!Logger.instance) {\n      Logger.instance = new Logger();\n    }\n    return Logger.instance;\n  }\n\n  private formatMessage(entry: LogEntry): string {\n    const { timestamp, level, category, message, data, error, stack } = entry;\n    let formatted = `[${timestamp}] [${level.toUpperCase()}] [${category}] ${message}`;\n    \n    if (data) {\n      formatted += `\\nData: ${JSON.stringify(data, null, 2)}`;\n    }\n    \n    if (error) {\n      formatted += `\\nError: ${error.message || error}`;\n      if (stack) {\n        formatted += `\\nStack: ${stack}`;\n      }\n    }\n    \n    return formatted;\n  }\n\n  private writeToFile(entry: LogEntry) {\n    // File writing is handled by the API route\n    // This method is kept for compatibility\n  }\n\n  private log(level: LogLevel, category: string, message: string, data?: any, error?: any) {\n    const entry: LogEntry = {\n      timestamp: new Date().toISOString(),\n      level,\n      category,\n      message,\n      data,\n      error: error ? { message: error.message, code: error.code, status: error.status } : undefined,\n      stack: error?.stack,\n    };\n\n    // Store in memory for client access\n    this.logs.push(entry);\n    if (this.logs.length > 1000) {\n      this.logs = this.logs.slice(-500); // Keep last 500 entries\n    }\n\n    // Console output with styling\n    const styles = {\n      debug: 'color: #6B7280; font-weight: normal;',\n      info: 'color: #3B82F6; font-weight: normal;',\n      warn: 'color: #F59E0B; font-weight: bold;',\n      error: 'color: #EF4444; font-weight: bold;',\n    };\n\n    const prefix = `[${entry.timestamp.split('T')[1].split('.')[0]}] [${category}]`;\n    \n    if (this.isClient) {\n      console.log(`%c${prefix} ${message}`, styles[level]);\n      if (data) console.log('Data:', data);\n      if (error) console.error('Error:', error);\n    } else {\n      const colorCodes = {\n        debug: '\\x1b[90m',\n        info: '\\x1b[36m',\n        warn: '\\x1b[33m',\n        error: '\\x1b[31m',\n      };\n      const reset = '\\x1b[0m';\n      console.log(`${colorCodes[level]}${prefix}${reset} ${message}`);\n      if (data) console.log('Data:', data);\n      if (error) console.error('Error:', error);\n    }\n\n    // Send to server for file logging\n    if (level !== 'debug' || !this.isClient) {\n      this.sendToServer(entry);\n    }\n  }\n\n  private async sendToServer(entry: LogEntry) {\n    try {\n      await fetch('/api/log', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify(entry),\n      });\n    } catch (error) {\n      // Silently fail to avoid infinite loop\n    }\n  }\n\n  debug(category: string, message: string, data?: any) {\n    this.log('debug', category, message, data);\n  }\n\n  info(category: string, message: string, data?: any) {\n    this.log('info', category, message, data);\n  }\n\n  warn(category: string, message: string, data?: any) {\n    this.log('warn', category, message, data);\n  }\n\n  error(category: string, message: string, error?: any, data?: any) {\n    this.log('error', category, message, data, error);\n  }\n\n  getLogs(): LogEntry[] {\n    return this.logs;\n  }\n\n  clearLogs() {\n    this.logs = [];\n  }\n\n  // API-specific logging helpers\n  apiRequest(endpoint: string, method: string, data?: any) {\n    this.info('API_REQUEST', `${method} ${endpoint}`, data);\n  }\n\n  apiResponse(endpoint: string, status: number, data?: any) {\n    const level = status >= 400 ? 'error' : 'info';\n    this.log(level, 'API_RESPONSE', `${endpoint} - Status: ${status}`, data);\n  }\n\n  apiError(endpoint: string, error: any) {\n    this.error('API_ERROR', `Failed request to ${endpoint}`, error);\n  }\n\n  // Auth-specific logging\n  authCheck(message: string, data?: any) {\n    this.info('AUTH', message, data);\n  }\n\n  authError(message: string, error?: any) {\n    this.error('AUTH_ERROR', message, error);\n  }\n\n  // Navigation logging\n  navigation(route: string, params?: any) {\n    this.info('NAVIGATION', `Navigating to ${route}`, params);\n  }\n\n  // Store operation logging\n  storeAction(store: string, action: string, data?: any) {\n    this.debug('STORE', `${store}.${action}`, data);\n  }\n}\n\nexport const logger = Logger.getInstance();","/**\n * Utility Functions Library\n * \n * Common utility functions used throughout the application.\n * These utilities handle:\n * - CSS class merging for Tailwind\n * - ID generation\n * - File operations\n * - Date/time formatting\n * - Clipboard operations\n * - HTML sanitization\n * - API helpers\n * \n * For contributors:\n * - Keep utilities pure and reusable\n * - Add JSDoc comments for all functions\n * - Include examples in comments\n * - Handle edge cases gracefully\n * - Export constants for configuration\n */\n\nimport { type ClassValue, clsx } from 'clsx';\nimport { twMerge } from 'tailwind-merge';\nimport DOMPurify from 'dompurify';\n\n/**\n * Utility function for combining Tailwind CSS classes\n * \n * This function combines clsx and tailwind-merge to:\n * 1. Support conditional classes (clsx)\n * 2. Properly merge Tailwind classes (tailwind-merge)\n * \n * @example\n * cn('px-2 py-1', 'px-4') // Returns: 'py-1 px-4'\n * cn('text-red-500', condition && 'text-blue-500')\n * cn(['text-sm', 'font-bold'], { 'opacity-50': isDisabled })\n * \n * @param inputs - Class strings, conditionals, arrays, or objects\n * @returns Merged class string\n */\nexport function cn(...inputs: ClassValue[]) {\n  return twMerge(clsx(inputs));\n}\n\n/**\n * Generate a unique ID\n * \n * Creates a unique identifier using random string and timestamp.\n * Suitable for temporary IDs, not cryptographically secure.\n * \n * @example\n * generateId() // Returns: 'a1b2c3d41234567890'\n * \n * @returns Unique string ID\n */\nexport function generateId(): string {\n  return Math.random().toString(36).substring(2) + Date.now().toString(36);\n}\n\n/**\n * Format file size in bytes to human readable format\n * \n * Converts byte values to appropriate units (KB, MB, GB).\n * Always shows 2 decimal places except for bytes.\n * \n * @example\n * formatFileSize(0) // Returns: '0 Bytes'\n * formatFileSize(1024) // Returns: '1 KB'\n * formatFileSize(1536) // Returns: '1.5 KB'\n * formatFileSize(1048576) // Returns: '1 MB'\n * \n * @param bytes - File size in bytes\n * @returns Formatted string with appropriate unit\n */\nexport function formatFileSize(bytes: number): string {\n  if (bytes === 0) return '0 Bytes';\n  \n  const k = 1024;\n  const sizes = ['Bytes', 'KB', 'MB', 'GB'];\n  const i = Math.floor(Math.log(bytes) / Math.log(k));\n  \n  return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];\n}\n\n/**\n * Get file icon based on file type\n * \n * Returns an emoji icon based on the MIME type or file extension.\n * Used in file upload UI components.\n * \n * @example\n * getFileIcon('application/pdf') // Returns: '📄'\n * getFileIcon('image/png') // Returns: '🖼️'\n * getFileIcon('text/plain') // Returns: '📝'\n * getFileIcon('unknown/type') // Returns: '📎' (default)\n * \n * @param fileType - MIME type or file extension\n * @returns Emoji icon representing the file type\n */\nexport function getFileIcon(fileType: string): string {\n  const type = fileType.toLowerCase();\n  \n  // Document types\n  if (type.includes('pdf')) return '📄';\n  if (type.includes('word') || type.includes('doc')) return '📄';\n  if (type.includes('text') || type.includes('txt')) return '📝';\n  \n  // Media types\n  if (type.includes('image')) return '🖼️';\n  if (type.includes('video')) return '🎥';\n  if (type.includes('audio')) return '🎵';\n  \n  // Data types\n  if (type.includes('excel') || type.includes('sheet')) return '📊';\n  if (type.includes('powerpoint') || type.includes('presentation')) return '📈';\n  if (type.includes('json')) return '📋';\n  if (type.includes('csv')) return '📊';\n  \n  // Archive types\n  if (type.includes('zip') || type.includes('rar')) return '🗜️';\n  \n  // Default icon\n  return '📎';\n}\n\n/**\n * Validate file type against allowed types\n * \n * Checks if a file type is in the allowed list.\n * Case-insensitive partial matching.\n * \n * @example\n * const allowed = ['image/', 'application/pdf'];\n * isFileTypeAllowed('image/png', allowed) // Returns: true\n * isFileTypeAllowed('IMAGE/JPEG', allowed) // Returns: true (case-insensitive)\n * isFileTypeAllowed('text/plain', allowed) // Returns: false\n * \n * @param fileType - MIME type to check\n * @param allowedTypes - List of allowed MIME types or patterns\n * @returns Whether the file type is allowed\n */\nexport function isFileTypeAllowed(fileType: string, allowedTypes: readonly string[]): boolean {\n  return allowedTypes.some(type => fileType.toLowerCase().includes(type.toLowerCase()));\n}\n\n/**\n * Format timestamp to human readable format\n * \n * Converts ISO timestamps to relative time strings.\n * Shows relative time for recent dates, absolute date for older.\n * \n * @example\n * // Assuming current time is 2024-01-01 12:00:00\n * formatTimestamp('2024-01-01T11:59:30Z') // Returns: 'Just now'\n * formatTimestamp('2024-01-01T11:30:00Z') // Returns: '30m ago'\n * formatTimestamp('2024-01-01T08:00:00Z') // Returns: '4h ago'\n * formatTimestamp('2023-12-25T12:00:00Z') // Returns: '7d ago'\n * formatTimestamp('2023-11-01T12:00:00Z') // Returns: '11/1/2023'\n * \n * @param timestamp - ISO date string\n * @returns Human-readable time difference or date\n */\nexport function formatTimestamp(timestamp: string): string {\n  const date = new Date(timestamp);\n  const now = new Date();\n  const diffInMs = now.getTime() - date.getTime();\n  const diffInMinutes = Math.floor(diffInMs / (1000 * 60));\n  const diffInHours = Math.floor(diffInMs / (1000 * 60 * 60));\n  const diffInDays = Math.floor(diffInMs / (1000 * 60 * 60 * 24));\n  \n  // Recent times shown as relative\n  if (diffInMinutes < 1) return 'Just now';\n  if (diffInMinutes < 60) return `${diffInMinutes}m ago`;\n  if (diffInHours < 24) return `${diffInHours}h ago`;\n  if (diffInDays < 7) return `${diffInDays}d ago`;\n  \n  // Older times shown as absolute date\n  return date.toLocaleDateString();\n}\n\n/**\n * Copy text to clipboard\n * \n * Uses the modern Clipboard API with fallback error handling.\n * Returns success/failure for UI feedback.\n * \n * @example\n * const success = await copyToClipboard('Hello, world!');\n * if (success) {\n *   toast.success('Copied to clipboard');\n * } else {\n *   toast.error('Failed to copy');\n * }\n * \n * @param text - Text to copy to clipboard\n * @returns Promise resolving to success boolean\n */\nexport async function copyToClipboard(text: string): Promise<boolean> {\n  try {\n    await navigator.clipboard.writeText(text);\n    return true;\n  } catch (error) {\n    // Fail silently but log for debugging\n    console.error('Failed to copy to clipboard:', error);\n    return false;\n  }\n}\n\n/**\n * Sanitize HTML content\n * \n * Removes dangerous HTML/JS to prevent XSS attacks.\n * Safe for rendering user-generated content.\n * Skips sanitization on server-side (SSR).\n * \n * @example\n * const dirty = '<script>alert(\"XSS\")</script><p>Hello</p>';\n * sanitizeHtml(dirty) // Returns: '<p>Hello</p>'\n * \n * const safe = '<p>Hello <strong>world</strong></p>';\n * sanitizeHtml(safe) // Returns: '<p>Hello <strong>world</strong></p>'\n * \n * @param html - Raw HTML string\n * @returns Sanitized HTML safe for rendering\n */\nexport function sanitizeHtml(html: string): string {\n  if (typeof window === 'undefined') {\n    return html; // Skip sanitization on server side (no DOM)\n  }\n  \n  return DOMPurify.sanitize(html, {\n    ALLOWED_TAGS: ['p', 'br', 'strong', 'em', 'code', 'pre', 'a', 'ul', 'ol', 'li', 'h1', 'h2', 'h3', 'h4', 'h5', 'h6'],\n    ALLOWED_ATTR: ['href', 'target', 'rel', 'class'],\n  });\n}\n\n/**\n * Debounce function\n * \n * Delays function execution until after wait milliseconds have\n * elapsed since the last time it was invoked. Useful for search\n * inputs, window resize handlers, etc.\n * \n * @example\n * const debouncedSearch = debounce((query: string) => {\n *   console.log('Searching for:', query);\n * }, 300);\n * \n * // Rapid calls...\n * debouncedSearch('a');    // Won't execute\n * debouncedSearch('ab');   // Won't execute\n * debouncedSearch('abc');  // Will execute after 300ms\n * \n * @param func - Function to debounce\n * @param wait - Milliseconds to delay\n * @returns Debounced function\n */\nexport function debounce<T extends (...args: any[]) => any>(\n  func: T,\n  wait: number\n): (...args: Parameters<T>) => void {\n  let timeout: NodeJS.Timeout;\n  \n  return (...args: Parameters<T>) => {\n    clearTimeout(timeout);\n    timeout = setTimeout(() => func.apply(null, args), wait);\n  };\n}\n\n/**\n * Throttle function\n * \n * Ensures function is called at most once per specified time period.\n * First call executes immediately, subsequent calls are ignored until\n * the time period expires.\n * \n * @example\n * const throttledScroll = throttle(() => {\n *   console.log('Scroll position:', window.scrollY);\n * }, 100);\n * \n * // During rapid scrolling:\n * // t=0ms: executes immediately\n * // t=50ms: ignored (still in throttle period)\n * // t=100ms: executes (throttle period expired)\n * \n * @param func - Function to throttle\n * @param limit - Minimum milliseconds between calls\n * @returns Throttled function\n */\nexport function throttle<T extends (...args: any[]) => any>(\n  func: T,\n  limit: number\n): (...args: Parameters<T>) => void {\n  let inThrottle: boolean;\n  \n  return (...args: Parameters<T>) => {\n    if (!inThrottle) {\n      func.apply(null, args);\n      inThrottle = true;\n      setTimeout(() => (inThrottle = false), limit);\n    }\n  };\n}\n\n/**\n * Truncate text to specified length\n * \n * Cuts text at the specified length and adds ellipsis.\n * Trims whitespace from the cut point.\n * \n * @example\n * truncateText('Hello, world!', 5) // Returns: 'Hello...'\n * truncateText('Short', 10) // Returns: 'Short'\n * truncateText('Hello   ', 5) // Returns: 'Hello...' (trimmed)\n * \n * @param text - Text to truncate\n * @param maxLength - Maximum length before truncation\n * @returns Truncated text with ellipsis if needed\n */\nexport function truncateText(text: string, maxLength: number): string {\n  if (text.length <= maxLength) return text;\n  return text.substring(0, maxLength).trim() + '...';\n}\n\n/**\n * Validate CustomGPT API key format\n * \n * Checks if the provided string matches the CustomGPT API key format.\n * Format: {digits}|{alphanumeric_string}\n * - At least 3 digits before the pipe\n * - At least 20 alphanumeric characters after the pipe\n * \n * @example\n * isValidApiKey('123|abcdefghijklmnopqrst') // Returns: true\n * isValidApiKey('7727|QxxxpM5Dxxxxz9CI3lGwyOBNoRav7oMdgFMxxxxefded9d9x') // Returns: true\n * isValidApiKey('12|short') // Returns: false (too few digits/chars)\n * isValidApiKey('no-pipe') // Returns: false (wrong format)\n * isValidApiKey('') // Returns: false (empty)\n * \n * @param apiKey - API key string to validate\n * @returns Whether the API key is valid\n */\nexport function isValidApiKey(apiKey: string): boolean {\n  if (!apiKey || typeof apiKey !== 'string') {\n    return false;\n  }\n  \n  // Trim whitespace\n  apiKey = apiKey.trim();\n  \n  // CustomGPT API key format: starts with digits followed by | then alphanumeric string\n  // Example: 7727|QxxxpM5Dxxxxz9CI3lGwyOBNoRav7oMdgFMxxxxefded9d9x\n  // Must have at least 3 digits, pipe, and at least 20 characters after pipe\n  return /^\\d{3,}\\|[a-zA-Z0-9]{20,}$/.test(apiKey);\n}\n\n/**\n * Parse streaming response chunk\n * \n * Handles various SSE (Server-Sent Events) formats from the CustomGPT API.\n * Supports both standard SSE format and raw JSON lines.\n * \n * Formats handled:\n * - SSE events: \"event: progress\", \"event: finish\"\n * - SSE data: \"data: {json}\", \"data: [DONE]\"\n * - Raw JSON: {\"content\": \"...\", \"citations\": [...]}\n * - Plain text: \"data: plain text content\"\n * \n * @example\n * parseStreamChunk('data: {\"content\": \"Hello\"}') \n * // Returns: { type: 'content', content: 'Hello' }\n * \n * parseStreamChunk('data: [DONE]')\n * // Returns: { type: 'done' }\n * \n * parseStreamChunk('event: finish')\n * // Returns: { type: 'done' }\n * \n * @param chunk - Raw chunk from SSE stream\n * @returns Parsed chunk object or null if should be skipped\n */\nexport function parseStreamChunk(chunk: string): any | null {\n  try {\n    console.log('🔍 Parsing stream chunk:', chunk);\n    \n    // Skip event lines - CustomGPT sends \"event: progress\" etc.\n    if (chunk.startsWith('event: ')) {\n      const eventType = chunk.slice(7).trim();\n      console.log('📌 SSE event:', eventType);\n      \n      // Handle specific events if needed\n      if (eventType === 'finish') {\n        return { type: 'done' };\n      }\n      \n      // Skip other event types\n      return null;\n    }\n    \n    // Handle SSE format\n    if (chunk.startsWith('data: ')) {\n      const data = chunk.slice(6).trim();\n      console.log('📦 SSE data:', data);\n      \n      if (data === '[DONE]' || data === 'DONE') return { type: 'done' };\n      \n      // CustomGPT might send plain text data instead of JSON\n      // Try to parse as JSON first\n      try {\n        const parsed = JSON.parse(data);\n        console.log('🎯 Parsed SSE JSON:', parsed);\n        \n        // Handle different response formats\n        if (typeof parsed === 'object') {\n          // If it already has a type, return as is\n          if (parsed.type) {\n            return parsed;\n          }\n          \n          // Handle CustomGPT format where content might be a direct property\n          if (parsed.content !== undefined) {\n            return { type: 'content', content: parsed.content, citations: parsed.citations };\n          }\n          \n          // Handle citation-only responses\n          if (parsed.citations && !parsed.content) {\n            return { type: 'citation', citations: parsed.citations };\n          }\n          \n          // Handle message field (some APIs use 'message' instead of 'content')\n          if (parsed.message !== undefined) {\n            return { type: 'content', content: parsed.message, citations: parsed.citations };\n          }\n          \n          // Handle delta format (some streaming APIs use delta.content)\n          if (parsed.delta && parsed.delta.content !== undefined) {\n            return { type: 'content', content: parsed.delta.content, citations: parsed.citations };\n          }\n          \n          // Handle choices format (OpenAI-style streaming)\n          if (parsed.choices && parsed.choices[0] && parsed.choices[0].delta) {\n            const delta = parsed.choices[0].delta;\n            if (delta.content !== undefined) {\n              return { type: 'content', content: delta.content, citations: parsed.citations };\n            }\n          }\n        }\n        \n        // Return the parsed data as is if we can't determine the format\n        return parsed;\n      } catch (jsonError) {\n        // If JSON parsing fails, treat it as plain text content\n        console.log('📝 Plain text data:', data);\n        return { type: 'content', content: data };\n      }\n    }\n    \n    // Handle raw JSON lines (no \"data: \" prefix)\n    if (chunk.trim().startsWith('{')) {\n      try {\n        const parsed = JSON.parse(chunk.trim());\n        console.log('🎯 Parsed raw JSON:', parsed);\n        \n        if (parsed.content !== undefined || parsed.citations !== undefined) {\n          return { \n            type: parsed.content ? 'content' : 'citation', \n            content: parsed.content,\n            citations: parsed.citations \n          };\n        }\n        \n        // Handle message field\n        if (parsed.message !== undefined) {\n          return { type: 'content', content: parsed.message, citations: parsed.citations };\n        }\n        \n        return parsed;\n      } catch (parseError) {\n        console.warn('Failed to parse raw JSON chunk:', parseError);\n      }\n    }\n    \n    // Handle plain text responses (fallback)\n    if (chunk.trim() && !chunk.includes('data:') && !chunk.startsWith('{')) {\n      console.log('📝 Plain text chunk:', chunk.trim());\n      return { type: 'content', content: chunk.trim() };\n    }\n    \n    return null;\n  } catch (error) {\n    console.error('Failed to parse stream chunk:', chunk, error);\n    return null;\n  }\n}\n\n/**\n * Extract inline citations from text\n * \n * Finds all citation references in format [1], [2], etc.\n * Returns the original text and array of citation numbers.\n * \n * @example\n * extractInlineCitations('Hello [1] world [2]!')\n * // Returns: { text: 'Hello [1] world [2]!', citations: [1, 2] }\n * \n * extractInlineCitations('No citations here')\n * // Returns: { text: 'No citations here', citations: [] }\n * \n * @param text - Text potentially containing citations\n * @returns Object with text and citation numbers\n */\nexport function extractInlineCitations(text: string): { text: string; citations: number[] } {\n  const citationRegex = /\\[(\\d+)\\]/g;\n  const citations: number[] = [];\n  let match;\n  \n  while ((match = citationRegex.exec(text)) !== null) {\n    citations.push(parseInt(match[1]));\n  }\n  \n  return { text, citations };\n}\n\n/**\n * Create a delay promise\n * \n * Utility for adding delays in async functions.\n * Useful for retries, animations, or testing.\n * \n * @example\n * async function slowOperation() {\n *   console.log('Starting...');\n *   await delay(1000); // Wait 1 second\n *   console.log('Done!');\n * }\n * \n * @param ms - Milliseconds to delay\n * @returns Promise that resolves after delay\n */\nexport function delay(ms: number): Promise<void> {\n  return new Promise(resolve => setTimeout(resolve, ms));\n}\n\n/**\n * Retry a function with exponential backoff\n * \n * Retries a failing async function with increasing delays.\n * Delays: 1s, 2s, 4s, 8s, etc. (exponential)\n * \n * @example\n * // Retry API call up to 3 times\n * const data = await retryWithBackoff(\n *   () => fetch('/api/data').then(r => r.json()),\n *   3,    // max attempts\n *   1000  // base delay (1s)\n * );\n * \n * // Delays: attempt 1 = immediate, attempt 2 = 1s, attempt 3 = 2s\n * \n * @param fn - Async function to retry\n * @param maxAttempts - Maximum retry attempts (default: 3)\n * @param baseDelay - Base delay in ms (default: 1000)\n * @returns Result from successful function call\n * @throws Last error if all attempts fail\n */\nexport async function retryWithBackoff<T>(\n  fn: () => Promise<T>,\n  maxAttempts: number = 3,\n  baseDelay: number = 1000\n): Promise<T> {\n  let lastError: Error;\n  \n  for (let attempt = 1; attempt <= maxAttempts; attempt++) {\n    try {\n      return await fn();\n    } catch (error) {\n      lastError = error as Error;\n      \n      if (attempt === maxAttempts) {\n        throw lastError;\n      }\n      \n      // Exponential backoff: 1s, 2s, 4s, etc.\n      const delayTime = baseDelay * Math.pow(2, attempt - 1);\n      await delay(delayTime);\n    }\n  }\n  \n  throw lastError!;\n}\n\n/**\n * Check if device is mobile\n * \n * Based on viewport width (<768px).\n * Returns false during SSR.\n * \n * @returns Whether viewport is mobile-sized\n */\nexport function isMobile(): boolean {\n  if (typeof window === 'undefined') return false;\n  return window.innerWidth < 768;\n}\n\n/**\n * Check if device is tablet\n * \n * Based on viewport width (768px-1023px).\n * Returns false during SSR.\n * \n * @returns Whether viewport is tablet-sized\n */\nexport function isTablet(): boolean {\n  if (typeof window === 'undefined') return false;\n  return window.innerWidth >= 768 && window.innerWidth < 1024;\n}\n\n/**\n * Check if device is desktop\n * \n * Based on viewport width (≥1024px).\n * Returns false during SSR.\n * \n * @returns Whether viewport is desktop-sized\n */\nexport function isDesktop(): boolean {\n  if (typeof window === 'undefined') return false;\n  return window.innerWidth >= 1024;\n}\n\n/**\n * Get responsive container class\n * \n * Returns Tailwind classes for responsive container sizing.\n * - Mobile: Full width/height\n * - Tablet: Max 2xl width, centered\n * - Desktop: Max 4xl width, centered\n * \n * @returns Tailwind class string for container\n */\nexport function getResponsiveContainer(): string {\n  if (isMobile()) return 'w-full h-full';\n  if (isTablet()) return 'w-full max-w-2xl mx-auto';\n  return 'w-full max-w-4xl mx-auto';\n}\n\n/**\n * Format conversation name from first message\n * \n * Creates a conversation title from the first message.\n * Takes first 6 words, max 50 characters.\n * \n * @example\n * generateConversationName('Hello, can you help me with JavaScript?')\n * // Returns: 'Hello, can you help me with'\n * \n * generateConversationName('Short')\n * // Returns: 'Short'\n * \n * @param firstMessage - The first message in conversation\n * @returns Formatted conversation name\n */\nexport function generateConversationName(firstMessage: string): string {\n  const words = firstMessage.trim().split(/\\s+/);\n  const title = words.slice(0, 6).join(' ');\n  return title.length > 50 ? title.substring(0, 50).trim() + '...' : title;\n}\n\n/**\n * Validate URL format\n * \n * Checks if string is a valid URL using URL constructor.\n * \n * @example\n * isValidUrl('https://example.com') // Returns: true\n * isValidUrl('http://localhost:3000/path') // Returns: true\n * isValidUrl('not a url') // Returns: false\n * isValidUrl('') // Returns: false\n * \n * @param url - String to validate\n * @returns Whether string is a valid URL\n */\nexport function isValidUrl(url: string): boolean {\n  try {\n    new URL(url);\n    return true;\n  } catch {\n    return false;\n  }\n}\n\n/**\n * Get file extension from filename\n * \n * Extracts the file extension in lowercase.\n * \n * @example\n * getFileExtension('document.pdf') // Returns: 'pdf'\n * getFileExtension('image.PNG') // Returns: 'png'\n * getFileExtension('no-extension') // Returns: ''\n * getFileExtension('multi.part.name.txt') // Returns: 'txt'\n * \n * @param filename - Filename to extract extension from\n * @returns Lowercase extension or empty string\n */\nexport function getFileExtension(filename: string): string {\n  return filename.split('.').pop()?.toLowerCase() || '';\n}\n\n/**\n * Check if file is an image\n * \n * Checks MIME type for image/ prefix.\n * \n * @example\n * isImageFile('image/png') // Returns: true\n * isImageFile('image/jpeg') // Returns: true\n * isImageFile('application/pdf') // Returns: false\n * \n * @param fileType - MIME type to check\n * @returns Whether file is an image\n */\nexport function isImageFile(fileType: string): boolean {\n  return fileType.startsWith('image/');\n}\n\n/**\n * Check if file is a document\n * \n * Checks against common document MIME types including:\n * - PDF files\n * - Microsoft Word documents\n * - Plain text files\n * - CSV spreadsheets\n * - JSON/XML data files\n * \n * @example\n * isDocumentFile('application/pdf') // Returns: true\n * isDocumentFile('text/plain') // Returns: true\n * isDocumentFile('image/png') // Returns: false\n * \n * @param fileType - MIME type to check\n * @returns Whether file is a supported document type\n */\nexport function isDocumentFile(fileType: string): boolean {\n  const documentTypes = [\n    'application/pdf',\n    'application/msword',\n    'application/vnd.openxmlformats-officedocument.wordprocessingml.document',\n    'text/plain',\n    'text/csv',\n    'application/json',\n    'application/xml',\n  ];\n  return documentTypes.includes(fileType);\n}\n\n/**\n * Create download link for file\n * \n * Programmatically downloads content as a file.\n * Creates a temporary blob URL and triggers download.\n * \n * @example\n * // Download text file\n * downloadFile('Hello, world!', 'greeting.txt');\n * \n * // Download JSON file\n * const data = { name: 'John', age: 30 };\n * downloadFile(\n *   JSON.stringify(data, null, 2),\n *   'data.json',\n *   'application/json'\n * );\n * \n * @param content - File content as string\n * @param filename - Name for downloaded file\n * @param mimeType - MIME type (default: 'text/plain')\n */\nexport function downloadFile(content: string, filename: string, mimeType: string = 'text/plain'): void {\n  const blob = new Blob([content], { type: mimeType });\n  const url = URL.createObjectURL(blob);\n  const link = document.createElement('a');\n  link.href = url;\n  link.download = filename;\n  document.body.appendChild(link);\n  link.click();\n  document.body.removeChild(link);\n  URL.revokeObjectURL(url);\n}\n\n/**\n * Escape HTML entities\n * \n * Prevents XSS by escaping HTML special characters.\n * Use when displaying user input as HTML.\n * \n * @example\n * escapeHtml('<script>alert(\"XSS\")</script>')\n * // Returns: '&lt;script&gt;alert(&quot;XSS&quot;)&lt;/script&gt;'\n * \n * escapeHtml('Hello & \"world\"')\n * // Returns: 'Hello &amp; &quot;world&quot;'\n * \n * @param unsafe - Raw string that may contain HTML\n * @returns HTML-escaped string\n */\nexport function escapeHtml(unsafe: string): string {\n  return unsafe\n    .replace(/&/g, '&amp;')\n    .replace(/</g, '&lt;')\n    .replace(/>/g, '&gt;')\n    .replace(/\"/g, '&quot;')\n    .replace(/'/g, '&#039;');\n}\n\n/**\n * Handle API errors and extract error message\n * \n * Normalizes various error formats into consistent structure.\n * Handles:\n * - API response errors (4xx, 5xx)\n * - Network/connection errors\n * - Client-side errors\n * \n * @example\n * try {\n *   await apiCall();\n * } catch (error) {\n *   const { message, code } = handleApiError(error);\n *   toast.error(message);\n *   if (code === 401) {\n *     // Handle unauthorized\n *   }\n * }\n * \n * @param error - Error object from API call\n * @returns Normalized error with message and optional code\n */\nexport function handleApiError(error: any): { message: string; code?: number } {\n  console.error('API Error:', error);\n  \n  if (error.response) {\n    // API responded with an error\n    const data = error.response.data;\n    // Handle nested error formats\n    if (data && data.data && data.data.message) {\n      return {\n        message: data.data.message,\n        code: data.data.code || error.response.status\n      };\n    }\n    // Handle direct message format\n    if (data && data.message) {\n      return {\n        message: data.message,\n        code: error.response.status\n      };\n    }\n    // Fallback to status code\n    return {\n      message: `API Error: ${error.response.status}`,\n      code: error.response.status\n    };\n  } else if (error.request) {\n    // Request was made but no response received\n    return {\n      message: 'No response from server. Please check your connection.',\n      code: 0\n    };\n  } else {\n    // Something else happened (e.g., request setup error)\n    return {\n      message: error.message || 'An unexpected error occurred',\n      code: 0\n    };\n  }\n}\n\n/**\n * Constants for file uploads and API\n * \n * Central configuration for limits and constraints.\n * Modify these values to customize behavior:\n * \n * - MAX_FILE_SIZE: Maximum upload size per file\n * - ACCEPTED_FILE_TYPES: MIME types allowed for upload\n * - MAX_MESSAGE_LENGTH: Character limit for messages\n * - API_TIMEOUT: Request timeout for regular API calls\n * - STREAM_TIMEOUT: Timeout for streaming responses\n * - RETRY_ATTEMPTS: Number of retries on failure\n * - RETRY_DELAY: Base delay between retries\n * \n * @example\n * // Check file size\n * if (file.size > CONSTANTS.MAX_FILE_SIZE) {\n *   throw new Error('File too large');\n * }\n * \n * // Configure retry\n * await retryWithBackoff(\n *   apiCall,\n *   CONSTANTS.RETRY_ATTEMPTS,\n *   CONSTANTS.RETRY_DELAY\n * );\n */\nexport const CONSTANTS = {\n  /** Maximum file size in bytes (10MB) */\n  MAX_FILE_SIZE: 10 * 1024 * 1024,\n  \n  /** Accepted MIME types for file uploads */\n  ACCEPTED_FILE_TYPES: [\n    // Documents\n    'application/pdf',\n    'application/msword',\n    'application/vnd.openxmlformats-officedocument.wordprocessingml.document',\n    'text/plain',\n    'text/csv',\n    'application/json',\n    'application/xml',\n    // Images\n    'image/jpeg',\n    'image/png',\n    'image/gif',\n    'image/webp',\n  ],\n  \n  /** Maximum characters per message */\n  MAX_MESSAGE_LENGTH: 4000,\n  \n  /** API request timeout in milliseconds (30s) */\n  API_TIMEOUT: 30000,\n  \n  /** Streaming request timeout in milliseconds (60s) */\n  STREAM_TIMEOUT: 60000,\n  \n  /** Number of retry attempts for failed requests */\n  RETRY_ATTEMPTS: 3,\n  \n  /** Base delay between retries in milliseconds (1s) */\n  RETRY_DELAY: 1000,\n} as const;","/**\n * Agent Store - Chatbot Management\n * \n * This store manages all agent (chatbot) related state and operations.\n * Agents are the core entities in CustomGPT - each agent is a trained\n * chatbot with its own knowledge base and settings.\n * \n * Features:\n * - CRUD operations for agents\n * - Persistent state using localStorage\n * - Auto-selection of first agent\n * - Agent statistics fetching\n * - License management support\n * \n * State Persistence:\n * - Uses Zustand persist middleware\n * - Stores: agents list and current selection\n * - Survives page refreshes\n * \n * For contributors:\n * - Always handle multiple API response formats\n * - Update currentAgent when agents list changes\n * - Use optimistic updates for better UX\n * - Log errors for debugging\n */\n\nimport { create } from 'zustand';\nimport { persist } from 'zustand/middleware';\nimport type { AgentStore, Agent } from '@/types';\nimport { getClient } from '@/lib/api/client';\n\n/**\n * Agent Store Implementation\n * \n * Persisted to localStorage with key 'customgpt-agent-store'\n * Automatically hydrates on app load\n */\nexport const useAgentStore = create<AgentStore>()(\n  persist(\n    (set, get) => ({\n      // Initial state\n      agents: [],\n      currentAgent: null,\n      loading: false,\n      error: null,\n\n      /**\n       * Fetch all agents from the API\n       * \n       * Behavior:\n       * - Shows loading state during fetch\n       * - Auto-selects first agent if none selected\n       * - Handles multiple API response formats\n       * - Clears error state on success\n       */\n      fetchAgents: async () => {\n        set({ loading: true, error: null });\n        \n        try {\n          const client = getClient();\n          const response = await client.getAgents();\n          \n          // Handle different response formats from the API\n          // API can return: { data: [...] }, [...], or { data: { data: [...] } }\n          let agents: Agent[] = [];\n          if (response && typeof response === 'object') {\n            if (Array.isArray((response as any).data)) {\n              agents = (response as any).data;\n            } else if (Array.isArray(response)) {\n              agents = response as Agent[];\n            } else if ((response as any).data && Array.isArray((response as any).data.data)) {\n              // Paginated response format\n              agents = (response as any).data.data;\n            }\n          }\n          \n          console.log('Fetched agents:', agents);\n          \n          set({ \n            agents, \n            loading: false,\n            // Auto-select first agent if none selected\n            currentAgent: get().currentAgent || (agents.length > 0 ? agents[0] : null)\n          });\n        } catch (error) {\n          console.error('Failed to fetch agents:', error);\n          set({ \n            agents: [], // Ensure agents is always an array even on error\n            error: error instanceof Error ? error.message : 'Failed to fetch agents',\n            loading: false \n          });\n        }\n      },\n\n      /**\n       * Create a new agent\n       * \n       * @param data - Agent creation data\n       * @param data.project_name - Display name for the agent\n       * @param data.sitemap_path - URL for sitemap-based training\n       * @param data.files - Files for file-based training\n       * @param data.is_shared - Whether agent is publicly accessible\n       * \n       * Behavior:\n       * - Adds new agent to beginning of list\n       * - Auto-selects the new agent\n       * - Returns the created agent\n       * - Throws error on failure\n       */\n      createAgent: async (data: {\n        project_name: string;\n        sitemap_path?: string;\n        files?: File[];\n        is_shared?: boolean;\n      }) => {\n        set({ loading: true, error: null });\n        \n        try {\n          const client = getClient();\n          const response = await client.createAgent(data);\n          const newAgent = response.data;\n          \n          // Optimistic update - add to list and select immediately\n          set(state => ({ \n            agents: [newAgent, ...state.agents],\n            currentAgent: newAgent,\n            loading: false,\n          }));\n          \n          return newAgent;\n        } catch (error) {\n          console.error('Failed to create agent:', error);\n          set({ \n            error: error instanceof Error ? error.message : 'Failed to create agent',\n            loading: false \n          });\n          throw error; // Re-throw for component error handling\n        }\n      },\n\n      /**\n       * Select an agent as the current active agent\n       * This agent will be used for all chat operations\n       * \n       * @param agent - The agent to select\n       */\n      selectAgent: (agent: Agent) => {\n        set({ currentAgent: agent });\n      },\n\n      /**\n       * Manually set the agents list\n       * Used for optimistic updates or manual state management\n       * \n       * Features:\n       * - Validates current agent still exists\n       * - Auto-selects first agent if current is removed\n       * - Maintains agent selection when possible\n       * \n       * @param agents - New list of agents\n       */\n      setAgents: (agents: Agent[]) => {\n        set({ \n          agents,\n          // Update current agent if it's no longer in the list\n          currentAgent: (() => {\n            const current = get().currentAgent;\n            if (!current) return agents.length > 0 ? agents[0] : null;\n            \n            // Check if current agent still exists in new list\n            const stillExists = agents.find(a => a.id === current.id);\n            return stillExists || (agents.length > 0 ? agents[0] : null);\n          })()\n        });\n      },\n      \n      updateAgent: async (id: number, data: { are_licenses_allowed?: boolean }) => {\n        set({ loading: true, error: null });\n        \n        try {\n          const client = getClient();\n          const response = await client.updateAgent(id, data);\n          const updatedAgent = response.data;\n          \n          set(state => ({\n            agents: state.agents.map(a => a.id === id ? updatedAgent : a),\n            currentAgent: state.currentAgent?.id === id ? updatedAgent : state.currentAgent,\n            loading: false,\n          }));\n          \n          return updatedAgent;\n        } catch (error) {\n          console.error('Failed to update agent:', error);\n          set({ \n            error: error instanceof Error ? error.message : 'Failed to update agent',\n            loading: false \n          });\n          throw error;\n        }\n      },\n      \n      deleteAgent: async (id: number) => {\n        set({ loading: true, error: null });\n        \n        try {\n          const client = getClient();\n          await client.deleteAgent(id);\n          \n          set(state => {\n            const filteredAgents = state.agents.filter(a => a.id !== id);\n            return {\n              agents: filteredAgents,\n              currentAgent: state.currentAgent?.id === id \n                ? (filteredAgents.length > 0 ? filteredAgents[0] : null)\n                : state.currentAgent,\n              loading: false,\n            };\n          });\n        } catch (error) {\n          console.error('Failed to delete agent:', error);\n          set({ \n            error: error instanceof Error ? error.message : 'Failed to delete agent',\n            loading: false \n          });\n          throw error;\n        }\n      },\n      \n      replicateAgent: async (id: number) => {\n        set({ loading: true, error: null });\n        \n        try {\n          const client = getClient();\n          const response = await client.replicateAgent(id);\n          const newAgent = response.data;\n          \n          set(state => ({ \n            agents: [newAgent, ...state.agents],\n            currentAgent: newAgent,\n            loading: false,\n          }));\n          \n          return newAgent;\n        } catch (error) {\n          console.error('Failed to replicate agent:', error);\n          set({ \n            error: error instanceof Error ? error.message : 'Failed to replicate agent',\n            loading: false \n          });\n          throw error;\n        }\n      },\n      \n      getAgentStats: async (id: number) => {\n        try {\n          const client = getClient();\n          const response = await client.getAgentStats(id);\n          return response.data;\n        } catch (error) {\n          console.error('Failed to get agent stats:', error);\n          throw error;\n        }\n      },\n    }),\n    {\n      name: 'customgpt-agents',\n      partialize: (state) => ({\n        currentAgent: state.currentAgent,\n      }),\n    }\n  )\n);","import { create } from 'zustand';\nimport { persist } from 'zustand/middleware';\nimport type { ConfigStore } from '@/types';\nimport { initializeClient, isClientInitialized } from '@/lib/api/client';\n\nexport const useConfigStore = create<ConfigStore>()(\n  persist(\n    (set, get) => ({\n      apiKey: null,\n      baseURL: 'https://app.customgpt.ai/api/v1',\n      theme: 'light',\n\n      setApiKey: (key: string) => {\n        set({ apiKey: key });\n        \n        // Initialize API client with new key\n        if (key) {\n          initializeClient({\n            apiKey: key,\n            baseURL: get().baseURL,\n          });\n        }\n      },\n\n      setBaseURL: (url: string) => {\n        set({ baseURL: url });\n        \n        // Re-initialize client if API key exists\n        const { apiKey } = get();\n        if (apiKey) {\n          initializeClient({\n            apiKey,\n            baseURL: url,\n          });\n        }\n      },\n\n      setTheme: (theme: 'light' | 'dark') => {\n        set({ theme });\n        \n        // Update document class for theme\n        if (typeof window !== 'undefined') {\n          document.documentElement.className = theme;\n        }\n      },\n    }),\n    {\n      name: 'customgpt-config',\n      partialize: (state) => ({\n        apiKey: state.apiKey,\n        baseURL: state.baseURL,\n        theme: state.theme,\n      }),\n      onRehydrateStorage: () => (state) => {\n        // Initialize API client on rehydration if API key exists\n        if (state?.apiKey && !isClientInitialized()) {\n          initializeClient({\n            apiKey: state.apiKey,\n            baseURL: state.baseURL,\n          });\n        }\n        \n        // Apply theme on rehydration\n        if (state?.theme && typeof window !== 'undefined') {\n          document.documentElement.className = state.theme;\n        }\n      },\n    }\n  )\n);","import { create } from 'zustand';\nimport { persist } from 'zustand/middleware';\nimport type { ConversationStore, Conversation } from '@/types';\nimport { getClient } from '@/lib/api/client';\nimport { generateConversationName } from '@/lib/utils';\nimport { logger } from '@/lib/logger';\n\n// Session-based conversation isolation\nconst getSessionId = (): string => {\n  // Check if we're running on the server\n  if (typeof window === 'undefined') {\n    return 'server-session';\n  }\n  \n  // Use the current widget session if available\n  if ((window as any).__customgpt_current_session) {\n    return (window as any).__customgpt_current_session;\n  }\n  \n  // Check if we're in widget mode with session configuration\n  if ((window as any).__customgpt_session) {\n    return (window as any).__customgpt_session.sessionId;\n  }\n  \n  // Check for instance-specific sessions (for isolated widgets)\n  if ((window as any).__customgpt_sessions) {\n    // For isolated widgets, we need to determine which session to use\n    // This is tricky since stores are global - we'll use the most recent session\n    const sessions = (window as any).__customgpt_sessions;\n    const sessionIds = Object.keys(sessions);\n    if (sessionIds.length > 0) {\n      // Return the most recently created session\n      return sessionIds[sessionIds.length - 1];\n    }\n  }\n  \n  // Fallback to browser-based session ID\n  try {\n    let sessionId = sessionStorage.getItem('customgpt_session_id');\n    if (!sessionId) {\n      sessionId = `session_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\n      sessionStorage.setItem('customgpt_session_id', sessionId);\n    }\n    return sessionId;\n  } catch (e) {\n    // Fallback if sessionStorage is not available\n    return `session_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\n  }\n};\n\nexport const useConversationStore = create<ConversationStore>()(\n  persist(\n    (set, get) => ({\n      conversations: [],\n      currentConversation: null,\n      loading: false,\n      error: null,\n\n      fetchConversations: async (projectId: number) => {\n        logger.info('CONVERSATIONS', 'Fetching conversations', { projectId });\n        set({ loading: true, error: null });\n        \n        try {\n          const client = getClient();\n          const response = await client.getConversations(projectId);\n          logger.info('CONVERSATIONS', 'API response received', { \n            projectId,\n            responseType: typeof response,\n            hasData: !!(response as any)?.data,\n            dataLength: Array.isArray((response as any)?.data) ? (response as any).data.length : 0\n          });\n          \n          // Handle different response formats\n          let conversations = [];\n          if (response && typeof response === 'object') {\n            if (Array.isArray((response as any).data)) {\n              conversations = (response as any).data;\n            } else if (Array.isArray(response)) {\n              conversations = response;\n            } else if ((response as any).data && Array.isArray((response as any).data.data)) {\n              conversations = (response as any).data.data;\n            }\n          }\n          \n          logger.info('CONVERSATIONS', 'Processed conversations', {\n            count: conversations.length,\n            conversations: conversations.map((c: any) => ({ \n              id: c.id, \n              name: c.name,\n              messagesCount: c.messages?.length || 0 \n            }))\n          });\n          \n          set({ \n            conversations, \n            loading: false,\n          });\n        } catch (error) {\n          logger.error('CONVERSATIONS', 'Failed to fetch conversations', error, {\n            projectId,\n            errorType: error instanceof Error ? error.constructor.name : typeof error,\n            status: (error as any)?.status,\n            message: (error as any)?.message\n          });\n          // Don't clear existing conversations on error - preserve local state\n          set({ \n            error: error instanceof Error ? error.message : 'Failed to fetch conversations',\n            loading: false,\n            // Keep existing conversations instead of clearing them\n          });\n        }\n      },\n\n      createConversation: async (projectId: number, name?: string) => {\n        set({ loading: true, error: null });\n        \n        try {\n          const client = getClient();\n          const response = await client.createConversation(projectId, name ? { name } : undefined);\n          const newConversation = response.data;\n          \n          set(state => ({ \n            conversations: [newConversation, ...state.conversations],\n            currentConversation: newConversation,\n            loading: false,\n          }));\n        } catch (error) {\n          console.error('Failed to create conversation:', error);\n          set({ \n            error: error instanceof Error ? error.message : 'Failed to create conversation',\n            loading: false \n          });\n          throw error;\n        }\n      },\n\n      selectConversation: (conversation: Conversation) => {\n        set({ currentConversation: conversation });\n      },\n\n      deleteConversation: async (conversationId: string | number) => {\n        const { conversations, currentConversation } = get();\n        const conversation = conversations.find(c => c.id.toString() === conversationId.toString());\n        \n        if (!conversation) return;\n\n        set({ loading: true, error: null });\n        \n        try {\n          const client = getClient();\n          await client.deleteConversation(conversation.project_id, conversation.session_id);\n          \n          const updatedConversations = conversations.filter(c => c.id.toString() !== conversationId.toString());\n          \n          set({ \n            conversations: updatedConversations,\n            currentConversation: currentConversation?.id.toString() === conversationId.toString() \n              ? (updatedConversations.length > 0 ? updatedConversations[0] : null)\n              : currentConversation,\n            loading: false,\n          });\n        } catch (error) {\n          console.error('Failed to delete conversation:', error);\n          set({ \n            error: error instanceof Error ? error.message : 'Failed to delete conversation',\n            loading: false \n          });\n          throw error;\n        }\n      },\n\n      updateConversation: async (conversationId: number, sessionId: string, data: { name: string }) => {\n        set({ loading: true, error: null });\n        \n        try {\n          const client = getClient();\n          const response = await client.updateConversation(conversationId, sessionId, data);\n          const updatedConversation = response.data;\n          \n          set(state => ({ \n            conversations: state.conversations.map(c => \n              c.id === conversationId ? updatedConversation : c\n            ),\n            currentConversation: state.currentConversation?.id === conversationId \n              ? updatedConversation \n              : state.currentConversation,\n            loading: false,\n          }));\n        } catch (error) {\n          console.error('Failed to update conversation:', error);\n          set({ \n            error: error instanceof Error ? error.message : 'Failed to update conversation',\n            loading: false \n          });\n          throw error;\n        }\n      },\n\n      // Auto-create conversation if none exists\n      ensureConversation: async (projectId: number, firstMessage?: string) => {\n        const { currentConversation, conversations } = get();\n        \n        // If we have a current conversation for this project, use it\n        if (currentConversation && currentConversation.project_id === projectId) {\n          return currentConversation;\n        }\n        \n        // Look for existing conversations for this project\n        const projectConversations = conversations.filter(c => c.project_id === projectId);\n        if (projectConversations.length > 0) {\n          const conversation = projectConversations[0];\n          set({ currentConversation: conversation });\n          return conversation;\n        }\n        \n        // Create new conversation\n        const name = firstMessage \n          ? generateConversationName(firstMessage)\n          : `Chat ${new Date().toLocaleDateString()}`;\n          \n        await get().createConversation(projectId, name);\n        return get().currentConversation!;\n      },\n    }),\n    {\n      name: `customgpt-conversations-${getSessionId()}`,\n      partialize: (state) => ({\n        conversations: state.conversations,\n        currentConversation: state.currentConversation,\n      }),\n      onRehydrateStorage: () => (state) => {\n        if (state && !Array.isArray(state.conversations)) {\n          state.conversations = [];\n        }\n      },\n    }\n  )\n);","/**\n * Message Store - Core Chat Functionality\n * \n * This store manages all message-related state and operations.\n * It's the heart of the chat system, handling:\n * - Message sending and receiving\n * - Real-time streaming responses\n * - Message history management\n * - Local storage fallback\n * - Error handling and retries\n * \n * Architecture:\n * - Uses Map for efficient conversation-based message storage\n * - Integrates with agent and conversation stores\n * - Handles both streaming and non-streaming API responses\n * - Provides local storage backup for offline access\n * \n * Key Features:\n * - Automatic conversation creation if needed\n * - Streaming with fallback to non-streaming\n * - Optimistic UI updates\n * - Message feedback tracking\n * - File upload support\n * \n * For contributors:\n * - Always update both local state and storage\n * - Handle API errors gracefully with fallbacks\n * - Use logger for debugging\n * - Maintain message order and IDs\n */\n\nimport { create } from 'zustand';\nimport type { MessageStore, ChatMessage, Citation, FeedbackType } from '@/types';\nimport { getClient } from '@/lib/api/client';\nimport { useAgentStore } from './agents';\nimport { useConversationStore } from './conversations';\nimport { generateId } from '@/lib/utils';\nimport { globalStreamManager } from '@/lib/streaming/handler';\nimport { logger } from '@/lib/logger';\n\n/**\n * Local storage configuration\n * Provides offline access and caching for better UX\n */\nconst MESSAGES_STORAGE_KEY = 'customgpt-messages-cache';\n\n/**\n * Save messages to local storage\n * Provides a fallback when API is unavailable\n * @param conversationId - The conversation to save messages for\n * @param messages - Array of messages to save\n */\nfunction saveMessagesToStorage(conversationId: string, messages: ChatMessage[]) {\n  try {\n    const stored = localStorage.getItem(MESSAGES_STORAGE_KEY);\n    const cache = stored ? JSON.parse(stored) : {};\n    cache[conversationId] = messages;\n    localStorage.setItem(MESSAGES_STORAGE_KEY, JSON.stringify(cache));\n  } catch (error) {\n    // Silent fail - storage is optional\n    console.error('Failed to save messages to local storage:', error);\n  }\n}\n\n/**\n * Load messages from local storage\n * Used as fallback when API is unavailable\n * @param conversationId - The conversation to load messages for\n * @returns Array of messages or null if not found\n */\nfunction loadMessagesFromStorage(conversationId: string): ChatMessage[] | null {\n  try {\n    const stored = localStorage.getItem(MESSAGES_STORAGE_KEY);\n    if (!stored) return null;\n    const cache = JSON.parse(stored);\n    return cache[conversationId] || null;\n  } catch (error) {\n    // Silent fail - storage is optional\n    console.error('Failed to load messages from local storage:', error);\n    return null;\n  }\n}\n\n/**\n * Message Store Implementation\n * \n * State Structure:\n * - messages: Map<conversationId, ChatMessage[]> - All messages grouped by conversation\n * - streamingMessage: Current message being streamed (null when not streaming)\n * - isStreaming: Whether a message is currently being streamed\n * - loading: General loading state for message operations\n * - error: Current error message if any\n */\nexport const useMessageStore = create<MessageStore>((set, get) => ({\n  // Initialize with empty state\n  messages: new Map(),\n  streamingMessage: null,\n  isStreaming: false,\n  loading: false,\n  error: null,\n\n  /**\n   * Send a message to the current agent\n   * \n   * Flow:\n   * 1. Validate agent selection\n   * 2. Ensure conversation exists (create if needed)\n   * 3. Create and add user message (optimistic update)\n   * 4. Upload files if present\n   * 5. Start streaming response\n   * 6. Fall back to non-streaming if streaming fails\n   * 7. Handle errors gracefully\n   * \n   * @param content - Message text\n   * @param files - Optional file attachments\n   */\n  sendMessage: async (content: string, files?: File[]) => {\n    // Check if in demo mode\n    const isDemoMode = typeof window !== 'undefined' && (window as any).__customgpt_demo_mode;\n    \n    const agentStore = useAgentStore.getState();\n    const conversationStore = useConversationStore.getState();\n    \n    const { currentAgent } = agentStore;\n    if (!currentAgent) {\n      logger.error('MESSAGES', 'No agent selected when trying to send message');\n      throw new Error('No agent selected');\n    }\n\n    logger.info('MESSAGES', 'Sending message', {\n      agentId: currentAgent.id,\n      agentName: currentAgent.project_name,\n      messageLength: content.length,\n      hasFiles: files && files.length > 0\n    });\n\n    // Ensure we have a conversation\n    const conversation = await conversationStore.ensureConversation(\n      currentAgent.id,\n      content\n    );\n\n    logger.info('MESSAGES', 'Conversation ensured', {\n      conversationId: conversation.id,\n      sessionId: conversation.session_id,\n      hasSessionId: !!conversation.session_id,\n      isNew: !conversation.message_count || conversation.message_count === 0\n    });\n\n    if (!conversation.session_id) {\n      logger.error('MESSAGES', 'Conversation missing session_id', { conversation });\n      throw new Error('Conversation missing session_id');\n    }\n\n    set({ loading: true, error: null });\n\n    // Create user message\n    const userMessage: ChatMessage = {\n      id: generateId(),\n      role: 'user',\n      content,\n      timestamp: new Date().toISOString(),\n      status: 'sending',\n    };\n\n    // Add user message to store\n    get().addMessage(conversation.id.toString(), userMessage);\n\n    // Create assistant message placeholder\n    const assistantMessage: ChatMessage = {\n      id: generateId(),\n      role: 'assistant',\n      content: '',\n      timestamp: new Date().toISOString(),\n      citations: [],\n    };\n\n    set({ \n      streamingMessage: assistantMessage,\n      isStreaming: true,\n      loading: false,\n    });\n\n    try {\n      // Handle file uploads if present\n      if (files && files.length > 0) {\n        const client = getClient();\n        await Promise.all(\n          files.map(file => client.uploadFile(currentAgent.id, file))\n        );\n      }\n\n      // Update user message status\n      userMessage.status = 'sent';\n      get().addMessage(conversation.id.toString(), userMessage);\n\n      // Start streaming with correct parameters\n      const client = getClient();\n      \n      logger.info('MESSAGES', 'Starting message stream', {\n        agentId: currentAgent.id,\n        sessionId: conversation.session_id,\n        messageContent: content.substring(0, 50)\n      });\n      \n      try {\n        await client.sendMessageStream(\n          currentAgent.id,\n          conversation.session_id,  // Use session_id instead of id\n          { \n            prompt: content,\n            response_source: 'default',  // Required field as per API documentation\n            stream: 1  // Include stream parameter in body as per SDK examples\n          },\n          {\n            onChunk: (chunk) => {\n              logger.debug('MESSAGES', 'Received stream chunk', { \n                type: chunk.type, \n                hasContent: !!chunk.content,\n                contentLength: chunk.content?.length,\n                contentPreview: chunk.content?.substring(0, 50)\n              });\n              \n              if (chunk.type === 'content' && chunk.content) {\n                get().updateStreamingMessage(chunk.content, chunk.citations);\n              } else if (chunk.type === 'citation' && chunk.citations) {\n                // Handle citation-only chunks\n                const current = get().streamingMessage;\n                if (current) {\n                  set({\n                    streamingMessage: {\n                      ...current,\n                      citations: chunk.citations\n                    }\n                  });\n                }\n              }\n            },\n            onComplete: () => {\n              const finalMessage = get().streamingMessage;\n              if (finalMessage) {\n                finalMessage.status = 'sent';\n                get().addMessage(conversation.id.toString(), finalMessage);\n              }\n              \n              set({ \n                streamingMessage: null,\n                isStreaming: false,\n              });\n            },\n            onError: async (streamError) => {\n              logger.error('MESSAGES', 'Streaming failed, attempting fallback to non-streaming', streamError, {\n                errorMessage: streamError.message,\n                agentId: currentAgent.id,\n                sessionId: conversation.session_id\n              });\n              \n              // Try fallback to non-streaming API\n              try {\n                logger.info('MESSAGES', 'Using non-streaming fallback');\n                \n                const response = await client.sendMessage(\n                  currentAgent.id,\n                  conversation.session_id,\n                  { \n                    prompt: content,\n                    response_source: 'default',  // Required field as per API documentation\n                    stream: 0  // Explicitly disable streaming\n                  }\n                );\n                \n                // Update streaming message with the complete response\n                const finalMessage = get().streamingMessage;\n                if (finalMessage && response) {\n                  // Handle different response formats from API\n                  let messageData: any;\n                  if (response.data) {\n                    messageData = response.data;\n                  } else {\n                    // Direct response format - cast to any to handle the actual API structure\n                    messageData = response as any;\n                  }\n                  \n                  finalMessage.content = messageData?.openai_response || messageData?.content || 'No response received';\n                  finalMessage.citations = messageData?.citations || [];\n                  finalMessage.status = 'sent';\n                  get().addMessage(conversation.id.toString(), finalMessage);\n                }\n                \n                set({ \n                  streamingMessage: null,\n                  isStreaming: false,\n                });\n                \n                logger.info('MESSAGES', 'Fallback to non-streaming successful');\n                \n              } catch (fallbackError) {\n                logger.error('MESSAGES', 'Both streaming and non-streaming failed', fallbackError);\n                console.error('Both streaming and fallback failed:', fallbackError);\n                \n                // Update assistant message with error\n                const errorMessage = get().streamingMessage;\n                if (errorMessage) {\n                  errorMessage.content = 'Sorry, I encountered an error while processing your message. Please try again.';\n                  errorMessage.status = 'error';\n                  get().addMessage(conversation.id.toString(), errorMessage);\n                }\n                \n                set({ \n                  streamingMessage: null,\n                  isStreaming: false,\n                  error: `Communication error: ${fallbackError instanceof Error ? fallbackError.message : 'Unknown error'}`,\n                });\n              }\n            },\n          }\n        );\n      } catch (setupError) {\n        logger.error('MESSAGES', 'Failed to setup streaming', setupError);\n        throw setupError;\n      }\n    } catch (error) {\n      logger.error('MESSAGES', 'Failed to send message', error, {\n        errorType: error instanceof Error ? error.constructor.name : typeof error,\n        errorMessage: error instanceof Error ? error.message : String(error),\n        stack: error instanceof Error ? error.stack : undefined,\n        agentId: currentAgent.id,\n        conversationId: conversation.id,\n        sessionId: conversation.session_id\n      });\n      console.error('Failed to send message:', error);\n      \n      // Update user message status\n      userMessage.status = 'error';\n      get().addMessage(conversation.id.toString(), userMessage);\n      \n      set({ \n        streamingMessage: null,\n        isStreaming: false,\n        error: error instanceof Error ? error.message : 'Failed to send message',\n        loading: false,\n      });\n      \n      throw error;\n    }\n  },\n\n  /**\n   * Add or update a message in the store\n   * \n   * Features:\n   * - Handles both new messages and updates\n   * - Maintains message order\n   * - Automatically saves to local storage\n   * - Efficient update using message ID lookup\n   * \n   * @param conversationId - The conversation to add the message to\n   * @param message - The message to add or update\n   */\n  addMessage: (conversationId: string, message: ChatMessage) => {\n    set(state => {\n      const newMessages = new Map(state.messages);\n      const conversationMessages = newMessages.get(conversationId) || [];\n      \n      // Check if message already exists and update it\n      const existingIndex = conversationMessages.findIndex(m => m.id === message.id);\n      if (existingIndex >= 0) {\n        // Update existing message\n        conversationMessages[existingIndex] = message;\n      } else {\n        // Add new message\n        conversationMessages.push(message);\n      }\n      \n      newMessages.set(conversationId, conversationMessages);\n      \n      // Save to local storage as fallback\n      saveMessagesToStorage(conversationId, conversationMessages);\n      \n      return { messages: newMessages };\n    });\n  },\n\n  /**\n   * Update the currently streaming message\n   * \n   * Used during streaming to append content chunks\n   * and update citations as they arrive\n   * \n   * @param content - Content chunk to append\n   * @param citations - Updated citations (optional)\n   */\n  updateStreamingMessage: (content: string, citations?: Citation[]) => {\n    set(state => {\n      if (!state.streamingMessage) return state;\n      \n      return {\n        streamingMessage: {\n          ...state.streamingMessage,\n          content: state.streamingMessage.content + content, // Append content\n          citations: citations || state.streamingMessage.citations, // Update citations if provided\n        },\n      };\n    });\n  },\n\n  clearMessages: (conversationId?: string) => {\n    set(state => {\n      if (conversationId) {\n        const newMessages = new Map(state.messages);\n        newMessages.delete(conversationId);\n        return { messages: newMessages };\n      } else {\n        // Clear all messages\n        return { messages: new Map() };\n      }\n    });\n  },\n\n  updateMessageFeedback: async (messageId: string, feedback: FeedbackType) => {\n    const agentStore = useAgentStore.getState();\n    const conversationStore = useConversationStore.getState();\n    \n    const { currentAgent } = agentStore;\n    const { currentConversation } = conversationStore;\n    \n    if (!currentAgent || !currentConversation) return;\n\n    // Find the message\n    const conversationMessages = get().messages.get(currentConversation.id.toString()) || [];\n    const message = conversationMessages.find(m => m.id === messageId);\n    \n    if (!message) return;\n\n    try {\n      // Update local state immediately\n      const updatedMessage = { ...message, feedback };\n      get().addMessage(currentConversation.id.toString(), updatedMessage);\n\n      // Send to API (assuming we have the prompt ID)\n      // Note: This would need to be adjusted based on the actual API structure\n      // const client = getClient();\n      // await client.updateMessageFeedback(currentAgent.id, currentConversation.id, promptId, {\n      //   reaction: feedback === 'like' ? 'liked' : 'disliked'\n      // });\n    } catch (error) {\n      console.error('Failed to update message feedback:', error);\n      // Revert local state on error\n      get().addMessage(currentConversation.id.toString(), message);\n    }\n  },\n\n  // Utility methods\n  getMessagesForConversation: (conversationId: string): ChatMessage[] => {\n    return get().messages.get(conversationId) || [];\n  },\n\n  cancelStreaming: () => {\n    globalStreamManager.cancelAllStreams();\n    set({ \n      streamingMessage: null,\n      isStreaming: false,\n    });\n  },\n\n  /**\n   * Load message history for a conversation\n   * \n   * API Response Handling:\n   * - Supports multiple response formats from the API\n   * - Converts API format to internal ChatMessage format\n   * - Falls back to local storage if API fails\n   * - Handles both user_query and openai_response fields\n   * \n   * @param conversationId - The conversation to load messages for\n   */\n  loadMessages: async (conversationId: string) => {\n    // Skip API calls in demo mode\n    const isDemoMode = typeof window !== 'undefined' && (window as any).__customgpt_demo_mode;\n    if (isDemoMode) {\n      logger.info('MESSAGES', 'Skipping message load in demo mode', { conversationId });\n      // Just ensure the conversation has an entry in the messages map\n      set(state => {\n        const newMessages = new Map(state.messages);\n        if (!newMessages.has(conversationId)) {\n          newMessages.set(conversationId, []);\n        }\n        return { messages: newMessages, loading: false };\n      });\n      return;\n    }\n    \n    // Skip API calls for locally created conversations (they don't exist on server)\n    if (conversationId.startsWith('conv_')) {\n      logger.info('MESSAGES', 'Skipping API load for local conversation', { conversationId });\n      set(state => {\n        const newMessages = new Map(state.messages);\n        if (!newMessages.has(conversationId)) {\n          newMessages.set(conversationId, []);\n        }\n        return { messages: newMessages, loading: false };\n      });\n      return;\n    }\n    \n    const agentStore = useAgentStore.getState();\n    const conversationStore = useConversationStore.getState();\n    const { currentAgent } = agentStore;\n    const { conversations } = conversationStore;\n    \n    if (!currentAgent) {\n      logger.warn('MESSAGES', 'No current agent when loading messages', { conversationId });\n      return;\n    }\n\n    // Find the conversation to get its session_id\n    const conversation = conversations.find(c => c.id.toString() === conversationId);\n    if (!conversation) {\n      logger.error('MESSAGES', 'Conversation not found in store', { \n        conversationId,\n        availableConversations: conversations.map(c => c.id)\n      });\n      // Don't set error, just ensure empty message array exists\n      set(state => {\n        const newMessages = new Map(state.messages);\n        if (!newMessages.has(conversationId)) {\n          newMessages.set(conversationId, []);\n        }\n        return { messages: newMessages, loading: false };\n      });\n      return;\n    }\n\n    logger.info('MESSAGES', 'Loading messages for conversation', {\n      conversationId,\n      sessionId: conversation.session_id,\n      agentId: currentAgent.id,\n      agentName: currentAgent.project_name\n    });\n\n    set({ loading: true, error: null });\n\n    try {\n      const client = getClient();\n      const response = await client.getMessages(currentAgent.id, conversation.session_id);\n      logger.info('MESSAGES', 'Messages API response received', {\n        conversationId,\n        responseType: typeof response,\n        hasData: !!(response as any)?.data,\n        dataLength: Array.isArray((response as any)?.data) ? (response as any).data.length : 0\n      });\n      \n      // Handle different response formats from the API\n      let messages = [];\n      if (response && typeof response === 'object') {\n        // API documentation shows response format: { status: \"success\", data: { conversation: {...}, messages: { data: [...] } } }\n        if ((response as any).data && (response as any).data.messages && Array.isArray((response as any).data.messages.data)) {\n          messages = (response as any).data.messages.data;\n        } else if (Array.isArray((response as any).data)) {\n          messages = (response as any).data;\n        } else if (Array.isArray(response)) {\n          messages = response;\n        } else if ((response as any).data && Array.isArray((response as any).data.data)) {\n          messages = (response as any).data.data;\n        }\n      }\n      \n      logger.info('MESSAGES', 'Processing messages', {\n        conversationId,\n        messagesCount: messages.length,\n        messageTypes: messages.map((m: any) => m.role || 'unknown')\n      });\n      \n      // Convert API messages to our format\n      // Each API message contains both user_query and openai_response, so we need to create two ChatMessage objects\n      const formattedMessages: ChatMessage[] = [];\n      \n      if (Array.isArray(messages)) {\n        messages.forEach(msg => {\n          const baseTimestamp = msg.created_at || msg.timestamp || new Date().toISOString();\n          \n          // Add user message\n          if (msg.user_query) {\n            formattedMessages.push({\n              id: `${msg.id}-user` || `user-${Math.random()}`,\n              role: 'user',\n              content: msg.user_query,\n              timestamp: baseTimestamp,\n              status: 'sent' as const,\n            });\n          }\n          \n          // Add assistant message\n          if (msg.openai_response) {\n            formattedMessages.push({\n              id: `${msg.id}-assistant` || `assistant-${Math.random()}`,\n              role: 'assistant',\n              content: msg.openai_response,\n              citations: msg.citations || [],\n              timestamp: baseTimestamp,\n              status: 'sent' as const,\n              feedback: msg.response_feedback?.reaction || msg.feedback,\n            });\n          }\n        });\n      }\n\n      logger.info('MESSAGES', 'Messages formatted successfully', {\n        conversationId,\n        formattedCount: formattedMessages.length\n      });\n\n      set(state => {\n        const newMessages = new Map(state.messages);\n        newMessages.set(conversationId, formattedMessages);\n        \n        // Save to local storage as fallback\n        saveMessagesToStorage(conversationId, formattedMessages);\n        \n        return { \n          messages: newMessages,\n          loading: false,\n        };\n      });\n    } catch (error) {\n      logger.error('MESSAGES', 'Failed to load messages', error, {\n        conversationId,\n        agentId: currentAgent.id,\n        errorType: error instanceof Error ? error.constructor.name : typeof error,\n        status: (error as any)?.status,\n        message: (error as any)?.message\n      });\n      \n      // Try to load from local storage as fallback\n      const cachedMessages = loadMessagesFromStorage(conversationId);\n      if (cachedMessages && cachedMessages.length > 0) {\n        logger.info('MESSAGES', 'Using cached messages as fallback', {\n          conversationId,\n          messageCount: cachedMessages.length\n        });\n        \n        set(state => {\n          const newMessages = new Map(state.messages);\n          newMessages.set(conversationId, cachedMessages);\n          return { \n            messages: newMessages,\n            loading: false,\n            error: 'Using cached messages (API unavailable)'\n          };\n        });\n      } else {\n        set({ \n          error: error instanceof Error ? error.message : 'Failed to load messages',\n          loading: false,\n        });\n      }\n    }\n  },\n}));","import { create } from 'zustand';\nimport { persist } from 'zustand/middleware';\nimport type { UIStore } from '@/types';\n\nexport const useUIStore = create<UIStore>()(\n  persist(\n    (set) => ({\n      sidebarOpen: true,\n      settingsOpen: false,\n      theme: 'light',\n      fontSize: 'md',\n\n      setSidebarOpen: (open: boolean) => {\n        set({ sidebarOpen: open });\n      },\n\n      setSettingsOpen: (open: boolean) => {\n        set({ settingsOpen: open });\n      },\n\n      setTheme: (theme: 'light' | 'dark') => {\n        set({ theme });\n        \n        // Apply theme to document\n        if (typeof window !== 'undefined') {\n          document.documentElement.className = theme;\n        }\n      },\n\n      setFontSize: (size: 'sm' | 'md' | 'lg') => {\n        set({ fontSize: size });\n        \n        // Apply font size to document\n        if (typeof window !== 'undefined') {\n          const root = document.documentElement;\n          root.classList.remove('text-sm', 'text-base', 'text-lg');\n          \n          switch (size) {\n            case 'sm':\n              root.classList.add('text-sm');\n              break;\n            case 'lg':\n              root.classList.add('text-lg');\n              break;\n            default:\n              root.classList.add('text-base');\n          }\n        }\n      },\n    }),\n    {\n      name: 'customgpt-ui',\n      partialize: (state) => ({\n        sidebarOpen: state.sidebarOpen,\n        theme: state.theme,\n        fontSize: state.fontSize,\n      }),\n      onRehydrateStorage: () => (state) => {\n        // Apply theme and font size on rehydration\n        if (typeof window !== 'undefined' && state) {\n          document.documentElement.className = state.theme;\n          \n          const root = document.documentElement;\n          root.classList.remove('text-sm', 'text-base', 'text-lg');\n          \n          switch (state.fontSize) {\n            case 'sm':\n              root.classList.add('text-sm');\n              break;\n            case 'lg':\n              root.classList.add('text-lg');\n              break;\n            default:\n              root.classList.add('text-base');\n          }\n        }\n      },\n    }\n  )\n);","import { create } from 'zustand';\nimport { getClient } from '@/lib/api/client';\nimport { toast } from 'sonner';\n\nexport interface AnalyticsData {\n  conversations: {\n    total: number;\n    active: number;\n    trend: number;\n    data: Array<{\n      date: string;\n      count: number;\n    }>;\n  };\n  queries: {\n    total: number;\n    successful: number;\n    failed: number;\n    avgResponseTime: number;\n    topQueries: Array<{\n      query: string;\n      count: number;\n    }>;\n    data: Array<{\n      date: string;\n      count: number;\n    }>;\n  };\n  traffic: {\n    uniqueUsers: number;\n    pageViews: number;\n    avgSessionDuration: number;\n    bounceRate: number;\n    data: Array<{\n      date: string;\n      users: number;\n      pageViews: number;\n    }>;\n  };\n  statistics: {\n    totalMessages: number;\n    totalConversations: number;\n    avgMessagesPerConversation: number;\n    satisfactionRate: number;\n    responseAccuracy: number;\n  };\n}\n\ninterface AnalyticsState {\n  analytics: AnalyticsData | null;\n  loading: boolean;\n  error: string | null;\n  dateRange: {\n    startDate: string;\n    endDate: string;\n  };\n  \n  // Actions\n  fetchAnalytics: (projectId: number) => Promise<void>;\n  setDateRange: (startDate: string, endDate: string) => void;\n  exportAnalytics: (format: 'csv' | 'json' | 'pdf') => Promise<void>;\n  reset: () => void;\n}\n\n// Helper function to format dates for API\nconst formatDate = (date: Date): string => {\n  return date.toISOString().split('T')[0];\n};\n\n// Get default date range (last 30 days)\nconst getDefaultDateRange = () => {\n  const endDate = new Date();\n  const startDate = new Date();\n  startDate.setDate(startDate.getDate() - 30);\n  \n  return {\n    startDate: formatDate(startDate),\n    endDate: formatDate(endDate),\n  };\n};\n\nexport const useAnalyticsStore = create<AnalyticsState>((set, get) => ({\n  analytics: null,\n  loading: false,\n  error: null,\n  dateRange: getDefaultDateRange(),\n\n  fetchAnalytics: async (projectId: number) => {\n    set({ loading: true, error: null });\n    \n    try {\n      const client = getClient();\n      const { startDate, endDate } = get().dateRange;\n      \n      // Fetch all analytics data in parallel\n      const [conversations, queries, traffic, statistics, reports] = await Promise.all([\n        client.getConversationAnalytics(projectId, {\n          start_date: startDate,\n          end_date: endDate,\n        }),\n        client.getQueryAnalytics(projectId, {\n          start_date: startDate,\n          end_date: endDate,\n        }),\n        client.getTrafficAnalytics(projectId, {\n          start_date: startDate,\n          end_date: endDate,\n          period: 'day',\n        }),\n        client.getStatistics(projectId),\n        client.getAnalysisReport(projectId, 'weekly'),\n      ]);\n\n      // Transform the data to match our interface\n      const analyticsData: AnalyticsData = {\n        conversations: {\n          total: conversations.data?.total || 0,\n          active: conversations.data?.active || 0,\n          trend: conversations.data?.trend || 0,\n          data: conversations.data?.timeline || [],\n        },\n        queries: {\n          total: queries.data?.total || 0,\n          successful: queries.data?.successful || 0,\n          failed: queries.data?.failed || 0,\n          avgResponseTime: queries.data?.avg_response_time || 0,\n          topQueries: queries.data?.top_queries || [],\n          data: queries.data?.timeline || [],\n        },\n        traffic: {\n          uniqueUsers: traffic.data?.unique_users || 0,\n          pageViews: traffic.data?.page_views || 0,\n          avgSessionDuration: traffic.data?.avg_session_duration || 0,\n          bounceRate: traffic.data?.bounce_rate || 0,\n          data: traffic.data?.timeline || [],\n        },\n        statistics: {\n          totalMessages: statistics.data?.total_messages || 0,\n          totalConversations: statistics.data?.total_conversations || 0,\n          avgMessagesPerConversation: statistics.data?.avg_messages_per_conversation || 0,\n          satisfactionRate: statistics.data?.satisfaction_rate || 0,\n          responseAccuracy: statistics.data?.response_accuracy || 0,\n        },\n      };\n\n      set({ analytics: analyticsData, loading: false });\n    } catch (error) {\n      console.error('Failed to fetch analytics:', error);\n      set({ \n        analytics: null,\n        error: error instanceof Error ? error.message : 'Failed to fetch analytics',\n        loading: false,\n      });\n      toast.error('Failed to fetch analytics data');\n    }\n  },\n\n  setDateRange: (startDate: string, endDate: string) => {\n    set({ dateRange: { startDate, endDate } });\n  },\n\n  exportAnalytics: async (format: 'csv' | 'json' | 'pdf') => {\n    const analytics = get().analytics;\n    if (!analytics) {\n      toast.error('No analytics data to export');\n      return;\n    }\n\n    try {\n      // Implementation would depend on the format\n      switch (format) {\n        case 'json':\n          const jsonData = JSON.stringify(analytics, null, 2);\n          const blob = new Blob([jsonData], { type: 'application/json' });\n          const url = URL.createObjectURL(blob);\n          const a = document.createElement('a');\n          a.href = url;\n          a.download = `analytics-${new Date().toISOString()}.json`;\n          document.body.appendChild(a);\n          a.click();\n          document.body.removeChild(a);\n          URL.revokeObjectURL(url);\n          toast.success('Analytics exported successfully');\n          break;\n          \n        case 'csv':\n          // Would need a CSV conversion library or custom implementation\n          toast.info('CSV export not yet implemented');\n          break;\n          \n        case 'pdf':\n          // Would need a PDF generation library\n          toast.info('PDF export not yet implemented');\n          break;\n      }\n    } catch (error) {\n      console.error('Failed to export analytics:', error);\n      toast.error('Failed to export analytics');\n    }\n  },\n\n  reset: () => {\n    set({\n      analytics: null,\n      loading: false,\n      error: null,\n      dateRange: getDefaultDateRange(),\n    });\n  },\n}));","import { create } from 'zustand';\nimport { getClient, isClientInitialized } from '@/lib/api/client';\nimport { toast } from 'sonner';\nimport type { Page, PagesQueryParams } from '@/types/pages.types';\n\ninterface PagesState {\n  pages: Page[];\n  loading: boolean;\n  error: string | null;\n  paginationInfo: {\n    current_page: number;\n    total: number;\n    per_page: number;\n    last_page: number;\n  };\n  queryParams: PagesQueryParams;\n  \n  // Actions\n  fetchPages: (projectId: number) => Promise<void>;\n  deletePage: (projectId: number, pageId: number) => Promise<void>;\n  reindexPage: (projectId: number, pageId: number) => Promise<void>;\n  \n  // UI State\n  setQueryParams: (params: Partial<PagesQueryParams>) => void;\n  reset: () => void;\n}\n\nexport const usePageStore = create<PagesState>((set, get) => ({\n  pages: [],\n  loading: false,\n  error: null,\n  paginationInfo: {\n    current_page: 1,\n    total: 0,\n    per_page: 20,\n    last_page: 1\n  },\n  queryParams: {\n    page: 1,\n    limit: 20,\n    order: 'desc',\n    crawl_status: 'all',\n    index_status: 'all'\n  },\n\n  fetchPages: async (projectId: number) => {\n    if (!isClientInitialized()) {\n      set({ error: 'API client not initialized' });\n      return;\n    }\n\n    set({ loading: true, error: null });\n    \n    try {\n      const client = getClient();\n      const { queryParams } = get();\n      const response = await client.getPages(projectId, queryParams);\n      \n      set({ \n        pages: response.data.pages.data,\n        paginationInfo: {\n          current_page: response.data.pages.current_page,\n          total: response.data.pages.total,\n          per_page: response.data.pages.per_page,\n          last_page: response.data.pages.last_page\n        },\n        loading: false \n      });\n    } catch (error: any) {\n      console.error('Failed to fetch pages:', error);\n      \n      let errorMessage = 'Failed to fetch pages';\n      if (error.status === 400) {\n        errorMessage = 'Invalid request. Please check the project ID.';\n      } else if (error.status === 401) {\n        errorMessage = 'Authentication failed. Please log in again.';\n      } else if (error.status === 404) {\n        errorMessage = 'Project not found.';\n      } else if (error.status === 500) {\n        errorMessage = 'Server error. Please try again later.';\n      }\n      \n      set({ \n        error: errorMessage,\n        loading: false,\n      });\n      toast.error(errorMessage);\n    }\n  },\n\n  deletePage: async (projectId: number, pageId: number) => {\n    if (!isClientInitialized()) {\n      toast.error('API client not initialized');\n      return;\n    }\n\n    set({ loading: true, error: null });\n    \n    try {\n      const client = getClient();\n      await client.deletePage(projectId, pageId);\n      \n      set(state => ({\n        pages: state.pages.filter(page => page.id !== pageId),\n        loading: false,\n      }));\n      \n      toast.success('Page deleted successfully');\n    } catch (error: any) {\n      console.error('Failed to delete page:', error);\n      \n      let errorMessage = 'Failed to delete page';\n      if (error.status === 401) {\n        errorMessage = 'Authentication failed. Please log in again.';\n      } else if (error.status === 404) {\n        errorMessage = 'Page not found.';\n      }\n      \n      set({ \n        error: errorMessage,\n        loading: false,\n      });\n      toast.error(errorMessage);\n    }\n  },\n\n  reindexPage: async (projectId: number, pageId: number) => {\n    if (!isClientInitialized()) {\n      toast.error('API client not initialized');\n      return;\n    }\n\n    set({ loading: true, error: null });\n    \n    try {\n      const client = getClient();\n      await client.reindexPage(projectId, pageId);\n      \n      // Update local state to show queued status\n      set(state => ({\n        pages: state.pages.map(page => \n          page.id === pageId \n            ? { ...page, crawl_status: 'queued', index_status: 'queued' }\n            : page\n        ),\n        loading: false,\n      }));\n      \n      toast.success('Page reindexing started');\n    } catch (error: any) {\n      console.error('Failed to reindex page:', error);\n      \n      let errorMessage = 'Failed to reindex page';\n      if (error.status === 401) {\n        errorMessage = 'Authentication failed. Please log in again.';\n      } else if (error.status === 403) {\n        errorMessage = 'The page could not be reindexed.';\n      }\n      \n      set({ \n        error: errorMessage,\n        loading: false,\n      });\n      toast.error(errorMessage);\n    }\n  },\n\n  setQueryParams: (params: Partial<PagesQueryParams>) => {\n    set(state => ({\n      queryParams: { ...state.queryParams, ...params },\n    }));\n  },\n\n  reset: () => {\n    set({\n      pages: [],\n      loading: false,\n      error: null,\n      paginationInfo: {\n        current_page: 1,\n        total: 0,\n        per_page: 20,\n        last_page: 1\n      },\n      queryParams: {\n        page: 1,\n        limit: 20,\n        order: 'desc',\n        crawl_status: 'all',\n        index_status: 'all'\n      },\n    });\n  },\n}));","// Temporarily disabled - sources are now managed directly in components using the API\n// This store will be removed or updated to match the new API structure\n\nimport { create } from 'zustand';\nimport { getClient } from '@/lib/api/client';\nimport { toast } from 'sonner';\n\nexport interface Source {\n  id: string;\n  project_id: number;\n  name: string;\n  type: 'file' | 'url' | 'text' | 'api';\n  status: 'active' | 'inactive' | 'processing' | 'error';\n  size?: number;\n  file_type?: string;\n  url?: string;\n  content?: string;\n  metadata?: {\n    description?: string;\n    tags?: string[];\n    author?: string;\n    lastIndexed?: string;\n    [key: string]: any;\n  };\n  created_at: string;\n  updated_at: string;\n  indexed_at?: string;\n  error_message?: string;\n}\n\ninterface SourcesState {\n  sources: Source[];\n  currentSource: Source | null;\n  loading: boolean;\n  error: string | null;\n  searchQuery: string;\n  filter: {\n    status?: 'active' | 'inactive' | 'processing' | 'error' | 'all';\n    type?: 'file' | 'url' | 'text' | 'api' | 'all';\n    sortBy?: 'name' | 'created_at' | 'updated_at' | 'size';\n    sortOrder?: 'asc' | 'desc';\n  };\n  syncStatus: {\n    syncing: boolean;\n    lastSync?: string;\n    progress?: number;\n  };\n  \n  // Actions\n  fetchSources: (projectId: number) => Promise<void>;\n  fetchSource: (projectId: number, sourceId: string) => Promise<void>;\n  uploadSources: (projectId: number, files: File[]) => Promise<void>;\n  updateSource: (projectId: number, sourceId: string, updates: Partial<Source>) => Promise<void>;\n  deleteSource: (projectId: number, sourceId: string) => Promise<void>;\n  bulkDelete: (projectId: number, sourceIds: string[]) => Promise<void>;\n  syncSources: (projectId: number) => Promise<void>;\n  \n  // UI State\n  setSearchQuery: (query: string) => void;\n  setFilter: (filter: Partial<SourcesState['filter']>) => void;\n  selectSource: (source: Source | null) => void;\n  reset: () => void;\n}\n\n// Mock implementation to avoid breaking imports\nexport const useSourceStore = create<SourcesState>((set, get) => ({\n  sources: [],\n  currentSource: null,\n  loading: false,\n  error: null,\n  searchQuery: '',\n  filter: {\n    status: 'all',\n    type: 'all',\n    sortBy: 'updated_at',\n    sortOrder: 'desc',\n  },\n  syncStatus: {\n    syncing: false,\n  },\n\n  fetchSources: async (projectId: number) => {\n    set({ loading: true, error: null });\n    \n    try {\n      const client = getClient();\n      // const response = await client.getSources(projectId);\n      \n      const sources: Source[] = []; // Array.isArray(response.data) ? response.data : [];\n      set({ sources, loading: false });\n      throw new Error('Sources API integration needs update');\n    } catch (error) {\n      console.error('Failed to fetch sources:', error);\n      set({ \n        error: error instanceof Error ? error.message : 'Failed to fetch sources',\n        loading: false,\n      });\n      toast.error('Failed to load sources');\n    }\n  },\n\n  fetchSource: async (projectId: number, sourceId: string) => {\n    set({ loading: true, error: null });\n    \n    try {\n      // const client = getClient();\n      // const response = await client.getSource(projectId, sourceId);\n      \n      // const source = response.data;\n      // set({ currentSource: source, loading: false });\n      throw new Error('getSource API method not available');\n      \n      // Update in the list as well\n      // set(state => ({\n      //   sources: state.sources.map(s => s.id === sourceId ? source : s),\n      // }));\n    } catch (error) {\n      console.error('Failed to fetch source:', error);\n      set({ \n        error: error instanceof Error ? error.message : 'Failed to fetch source',\n        loading: false,\n      });\n      toast.error('Failed to load source details');\n    }\n  },\n\n  uploadSources: async (projectId: number, files: File[]) => {\n    set({ loading: true, error: null });\n    \n    try {\n      const client = getClient();\n      \n      // Upload files one by one for better progress tracking\n      const uploadPromises = files.map(file => \n        Promise.reject(new Error('uploadFile API method not available'))\n      );\n      \n      const responses = await Promise.all(uploadPromises);\n      \n      // Refresh sources list\n      await get().fetchSources(projectId);\n      \n      toast.success(`Successfully uploaded ${files.length} file(s)`);\n      set({ loading: false });\n    } catch (error) {\n      console.error('Failed to upload sources:', error);\n      set({ \n        error: error instanceof Error ? error.message : 'Failed to upload sources',\n        loading: false,\n      });\n      toast.error('Failed to upload files');\n      throw error;\n    }\n  },\n\n  updateSource: async (projectId: number, sourceId: string, updates: Partial<Source>) => {\n    set({ loading: true, error: null });\n    \n    try {\n      const client = getClient();\n      // await client.updateSource(projectId, sourceId, {\n      throw new Error('updateSource API method not available');\n      /*\n        name: updates.name,\n        metadata: updates.metadata,\n        status: updates.status,\n      }); */\n      \n      set(state => ({\n        sources: state.sources.map(source => \n          source.id === sourceId \n            ? { ...source, ...updates, updated_at: new Date().toISOString() } \n            : source\n        ),\n        currentSource: state.currentSource?.id === sourceId \n          ? { ...state.currentSource, ...updates, updated_at: new Date().toISOString() }\n          : state.currentSource,\n        loading: false,\n      }));\n      \n      toast.success('Source updated successfully');\n    } catch (error) {\n      console.error('Failed to update source:', error);\n      set({ \n        error: error instanceof Error ? error.message : 'Failed to update source',\n        loading: false,\n      });\n      toast.error('Failed to update source');\n      throw error;\n    }\n  },\n\n  deleteSource: async (projectId: number, sourceId: string) => {\n    set({ loading: true, error: null });\n    \n    try {\n      const client = getClient();\n      await client.deleteSource(projectId, parseInt(sourceId));\n      \n      set(state => ({\n        sources: state.sources.filter(source => source.id !== sourceId),\n        currentSource: state.currentSource?.id === sourceId ? null : state.currentSource,\n        loading: false,\n      }));\n      \n      toast.success('Source deleted successfully');\n    } catch (error) {\n      console.error('Failed to delete source:', error);\n      set({ \n        error: error instanceof Error ? error.message : 'Failed to delete source',\n        loading: false,\n      });\n      toast.error('Failed to delete source');\n      throw error;\n    }\n  },\n\n  bulkDelete: async (projectId: number, sourceIds: string[]) => {\n    set({ loading: true, error: null });\n    \n    try {\n      const client = getClient();\n      \n      // Delete sources in parallel\n      await Promise.all(\n        sourceIds.map(sourceId => client.deleteSource(projectId, parseInt(sourceId)))\n      );\n      \n      set(state => ({\n        sources: state.sources.filter(source => !sourceIds.includes(source.id)),\n        currentSource: sourceIds.includes(state.currentSource?.id || '') \n          ? null \n          : state.currentSource,\n        loading: false,\n      }));\n      \n      toast.success(`Successfully deleted ${sourceIds.length} source(s)`);\n    } catch (error) {\n      console.error('Failed to delete sources:', error);\n      set({ \n        error: error instanceof Error ? error.message : 'Failed to delete sources',\n        loading: false,\n      });\n      toast.error('Failed to delete sources');\n      throw error;\n    }\n  },\n\n  syncSources: async (projectId: number) => {\n    set(state => ({\n      syncStatus: { ...state.syncStatus, syncing: true, progress: 0 }\n    }));\n    \n    try {\n      const client = getClient();\n      // await client.syncSources(projectId);\n      throw new Error('syncSources API method not available');\n      \n      // Refresh sources after sync\n      await get().fetchSources(projectId);\n      \n      set(state => ({\n        syncStatus: {\n          syncing: false,\n          lastSync: new Date().toISOString(),\n          progress: 100,\n        }\n      }));\n      \n      toast.success('Sources synchronized successfully');\n    } catch (error) {\n      console.error('Failed to sync sources:', error);\n      set(state => ({\n        syncStatus: { ...state.syncStatus, syncing: false },\n        error: error instanceof Error ? error.message : 'Failed to sync sources',\n      }));\n      toast.error('Failed to sync sources');\n      throw error;\n    }\n  },\n\n  setSearchQuery: (query: string) => {\n    set({ searchQuery: query });\n  },\n\n  setFilter: (filter: Partial<SourcesState['filter']>) => {\n    set(state => ({\n      filter: { ...state.filter, ...filter },\n    }));\n  },\n\n  selectSource: (source: Source | null) => {\n    set({ currentSource: source });\n  },\n\n  reset: () => {\n    set({\n      sources: [],\n      currentSource: null,\n      loading: false,\n      error: null,\n      searchQuery: '',\n      filter: {\n        status: 'all',\n        type: 'all',\n        sortBy: 'updated_at',\n        sortOrder: 'desc',\n      },\n      syncStatus: {\n        syncing: false,\n      },\n    });\n  },\n}));","import { create } from 'zustand';\nimport { persist } from 'zustand/middleware';\nimport { getClient } from '@/lib/api/client';\nimport { toast } from 'sonner';\nimport type { UserProfileStore, UserProfile } from '@/types';\n\n// CustomGPT.ai API Response format\ninterface CustomGPTResponse<T> {\n  status: 'success' | 'error';\n  data: T;\n}\n\nexport const useProfileStore = create<UserProfileStore>()(\n  persist(\n    (set, get) => ({\n      // Initial State\n      profile: null,\n      loading: false,\n      error: null,\n\n      // Profile Management - GET /api/v1/user\n      fetchProfile: async () => {\n        set({ loading: true, error: null });\n        \n        try {\n          const client = getClient();\n          const response = await client.get<CustomGPTResponse<UserProfile>>('/user');\n          \n          if (response.status === 'success') {\n            set({ \n              profile: response.data,\n              loading: false \n            });\n          } else {\n            throw new Error('Failed to fetch profile');\n          }\n        } catch (error) {\n          console.error('Failed to fetch profile:', error);\n          set({ \n            error: `Failed to fetch profile: ${error instanceof Error ? error.message : 'Unknown error'}`,\n            loading: false \n          });\n          toast.error('Failed to load profile');\n        }\n      },\n\n      // Profile Update - POST /api/v1/user (multipart/form-data)\n      updateProfile: async (name: string, profilePhoto?: File) => {\n        set({ loading: true, error: null });\n        \n        try {\n          const client = getClient();\n          \n          // Create FormData for multipart request\n          const formData = new FormData();\n          formData.append('name', name);\n          \n          if (profilePhoto) {\n            formData.append('profile_photo', profilePhoto);\n          }\n          \n          const response = await client.post<CustomGPTResponse<UserProfile>>('/user', formData);\n          \n          if (response.status === 'success') {\n            set({ \n              profile: response.data,\n              loading: false \n            });\n            toast.success('Profile updated successfully');\n          } else {\n            throw new Error('Failed to update profile');\n          }\n        } catch (error) {\n          console.error('Failed to update profile:', error);\n          set({ \n            error: `Failed to update profile: ${error instanceof Error ? error.message : 'Unknown error'}`,\n            loading: false \n          });\n          toast.error('Failed to update profile');\n        }\n      },\n\n      // Utility\n      reset: () => {\n        set({\n          profile: null,\n          loading: false,\n          error: null,\n        });\n      },\n    }),\n    {\n      name: 'profile-store',\n      partialize: (state) => ({\n        profile: state.profile,\n      }),\n    }\n  )\n);","import { create } from 'zustand';\nimport { toast } from 'sonner';\nimport { getClient } from '@/lib/api/client';\nimport type { APIResponse } from '@/types';\n\nexport interface ProjectSettings {\n  chatbot_avatar?: string;\n  chatbot_background_type?: 'image' | 'color';\n  chatbot_background?: string;\n  chatbot_background_color?: string;\n  default_prompt?: string;\n  example_questions?: string[];\n  response_source?: 'default' | 'own_content' | 'openai_content';\n  chatbot_msg_lang?: string;\n  chatbot_color?: string;\n  chatbot_toolbar_color?: string;\n  persona_instructions?: string;\n  citations_answer_source_label_msg?: string;\n  citations_sources_label_msg?: string;\n  hang_in_there_msg?: string;\n  chatbot_siesta_msg?: string;\n}\n\nexport interface ProjectPlugin {\n  id: string;\n  name: string;\n  enabled: boolean;\n  description?: string;\n  category?: string;\n  settings?: Record<string, any>;\n}\n\nexport interface ProjectStats {\n  total_conversations: number;\n  total_messages: number;\n  total_sources: number;\n  total_pages: number;\n  last_activity: string;\n  created_at: string;\n  updated_at: string;\n}\n\nexport interface ProjectSettingsStore {\n  // Settings\n  settings: ProjectSettings | null;\n  settingsLoading: boolean;\n  settingsError: string | null;\n\n  // Plugins\n  plugins: ProjectPlugin[];\n  pluginsLoading: boolean;\n  pluginsError: string | null;\n\n  // Stats\n  stats: ProjectStats | null;\n  statsLoading: boolean;\n  statsError: string | null;\n\n  // Actions\n  fetchSettings: (projectId: number) => Promise<void>;\n  updateSettings: (projectId: number, settings: Partial<ProjectSettings>) => Promise<void>;\n  fetchPlugins: (projectId: number) => Promise<void>;\n  updatePlugin: (projectId: number, pluginId: string, enabled: boolean) => Promise<void>;\n  fetchStats: (projectId: number) => Promise<void>;\n  reset: () => void;\n}\n\n// Track active requests to prevent duplicates\nconst activeRequests = new Map<string, boolean>();\n\nexport const useProjectSettingsStore = create<ProjectSettingsStore>((set, get) => ({\n  // Initial state\n  settings: null,\n  settingsLoading: false,\n  settingsError: null,\n  plugins: [],\n  pluginsLoading: false,\n  pluginsError: null,\n  stats: null,\n  statsLoading: false,\n  statsError: null,\n\n  // Fetch project settings\n  fetchSettings: async (projectId: number) => {\n    const requestKey = `settings-${projectId}`;\n    \n    // Prevent duplicate requests\n    if (activeRequests.get(requestKey)) {\n      return;\n    }\n    \n    activeRequests.set(requestKey, true);\n    \n    // Clear previous errors and set loading state\n    set({ settingsLoading: true, settingsError: null });\n\n    try {\n      const response = await getClient().get<APIResponse<ProjectSettings>>(\n        `/projects/${projectId}/settings`\n      );\n\n      if (response.status === 200) {\n        set({ \n          settings: response.data, \n          settingsLoading: false,\n          settingsError: null // Explicitly clear error on success\n        });\n      } else {\n        throw new Error('Failed to fetch project settings');\n      }\n    } catch (error) {\n      const errorMessage = error instanceof Error ? error.message : 'Failed to fetch project settings';\n      set({ \n        settingsError: errorMessage, \n        settingsLoading: false \n      });\n      // Only show toast for actual errors, not for expected scenarios\n      if (error instanceof Error && !error.message.includes('404')) {\n        toast.error(errorMessage);\n      }\n    } finally {\n      activeRequests.delete(requestKey);\n    }\n  },\n\n  // Update project settings\n  updateSettings: async (projectId: number, settingsUpdate: Partial<ProjectSettings>) => {\n    set({ settingsLoading: true, settingsError: null });\n\n    try {\n      // Create FormData for multipart/form-data\n      const formData = new FormData();\n      \n      Object.entries(settingsUpdate).forEach(([key, value]) => {\n        if (value !== undefined && value !== null) {\n          if (key === 'example_questions' && Array.isArray(value)) {\n            // Handle array fields\n            value.forEach((question, index) => {\n              formData.append(`example_questions[${index}]`, question);\n            });\n          } else if (value instanceof File) {\n            // Handle file uploads\n            formData.append(key, value);\n          } else {\n            // Handle regular fields\n            formData.append(key, String(value));\n          }\n        }\n      });\n\n      const response = await getClient().post<APIResponse<{ updated: boolean }>>(\n        `/projects/${projectId}/settings`,\n        formData\n      );\n\n      if (response.status === 200 && response.data.updated) {\n        // Merge updated settings with current settings\n        const currentSettings = get().settings || {};\n        const newSettings = { ...currentSettings, ...settingsUpdate };\n        \n        set({ \n          settings: newSettings, \n          settingsLoading: false \n        });\n        \n        toast.success('Project settings updated successfully');\n      } else {\n        throw new Error('Failed to update project settings');\n      }\n    } catch (error) {\n      const errorMessage = error instanceof Error ? error.message : 'Failed to update project settings';\n      set({ \n        settingsError: errorMessage, \n        settingsLoading: false \n      });\n      toast.error(errorMessage);\n    }\n  },\n\n  // Fetch project plugins\n  fetchPlugins: async (projectId: number) => {\n    set({ pluginsLoading: true, pluginsError: null });\n\n    try {\n      const response = await getClient().get<APIResponse<ProjectPlugin[]>>(\n        `/projects/${projectId}/plugins`\n      );\n\n      if (response.status === 200) {\n        set({ \n          plugins: Array.isArray(response.data) ? response.data : [], \n          pluginsLoading: false \n        });\n      } else {\n        throw new Error('Failed to fetch project plugins');\n      }\n    } catch (error) {\n      const errorMessage = error instanceof Error ? error.message : 'Failed to fetch project plugins';\n      set({ \n        pluginsError: errorMessage, \n        pluginsLoading: false,\n        plugins: [] // Fallback to empty array\n      });\n      console.warn('Plugins not available:', errorMessage);\n    }\n  },\n\n  // Update project plugin\n  updatePlugin: async (projectId: number, pluginId: string, enabled: boolean) => {\n    try {\n      // This endpoint might not exist yet, so we'll implement it as a placeholder\n      const response = await getClient().put<APIResponse<{ updated: boolean }>>(\n        `/projects/${projectId}/plugins/${pluginId}`,\n        { enabled }\n      );\n\n      if (response.status === 200) {\n        // Update plugin in store\n        const plugins = get().plugins.map(plugin =>\n          plugin.id === pluginId ? { ...plugin, enabled } : plugin\n        );\n        \n        set({ plugins });\n        toast.success(`Plugin ${enabled ? 'enabled' : 'disabled'} successfully`);\n      } else {\n        throw new Error('Failed to update plugin');\n      }\n    } catch (error) {\n      const errorMessage = error instanceof Error ? error.message : 'Failed to update plugin';\n      toast.error(errorMessage);\n    }\n  },\n\n  // Fetch project stats\n  fetchStats: async (projectId: number) => {\n    set({ statsLoading: true, statsError: null });\n\n    try {\n      const response = await getClient().get<APIResponse<ProjectStats>>(\n        `/projects/${projectId}/stats`\n      );\n\n      if (response.status === 200) {\n        set({ \n          stats: response.data, \n          statsLoading: false \n        });\n      } else {\n        throw new Error('Failed to fetch project stats');\n      }\n    } catch (error) {\n      const errorMessage = error instanceof Error ? error.message : 'Failed to fetch project stats';\n      set({ \n        statsError: errorMessage, \n        statsLoading: false \n      });\n      toast.error(errorMessage);\n    }\n  },\n\n  // Reset store\n  reset: () => {\n    set({\n      settings: null,\n      settingsLoading: false,\n      settingsError: null,\n      plugins: [],\n      pluginsLoading: false,\n      pluginsError: null,\n      stats: null,\n      statsLoading: false,\n      statsError: null,\n    });\n  },\n}));","import { create } from 'zustand';\nimport { getClient } from '@/lib/api/client';\nimport { logger } from '@/lib/logger';\nimport type { AgentLicense } from '@/types';\n\ninterface LicenseStore {\n  licenses: AgentLicense[];\n  loading: boolean;\n  error: string | null;\n  \n  fetchLicenses: (projectId: number) => Promise<void>;\n  createLicense: (projectId: number, name: string) => Promise<AgentLicense>;\n  updateLicense: (projectId: number, licenseId: string, name: string) => Promise<void>;\n  deleteLicense: (projectId: number, licenseId: string) => Promise<void>;\n  clearError: () => void;\n}\n\nexport const useLicenseStore = create<LicenseStore>((set, get) => ({\n  licenses: [],\n  loading: false,\n  error: null,\n\n  fetchLicenses: async (projectId: number) => {\n    set({ loading: true, error: null });\n    \n    try {\n      const client = getClient();\n      const response = await client.getLicenses(projectId);\n      \n      logger.info('LICENSES', 'API Response', {\n        projectId,\n        status: 'success',\n        responseType: typeof response,\n        hasData: !!response?.data,\n        dataType: Array.isArray(response?.data) ? 'array' : typeof response?.data,\n        dataLength: Array.isArray(response?.data) ? response.data.length : 0,\n        fullResponse: response\n      });\n      \n      // Handle response format based on API documentation\n      const licenses = Array.isArray(response.data) ? response.data : [];\n      \n      logger.info('LICENSES', 'Processed licenses', {\n        count: licenses.length,\n        licenses: licenses.map((l: any) => ({ \n          name: l.name, \n          key: l.key?.substring(0, 8) + '...', \n          project_id: l.project_id \n        }))\n      });\n      \n      set({ \n        licenses,\n        loading: false \n      });\n    } catch (error: any) {\n      logger.error('LICENSES', 'Failed to fetch licenses', {\n        projectId,\n        errorType: error?.constructor?.name,\n        errorMessage: error?.message,\n        errorStatus: error?.status,\n        errorCode: error?.code,\n        fullError: error\n      });\n      \n      const errorMessage = error instanceof Error ? error.message : 'Failed to fetch licenses';\n      set({ \n        error: errorMessage,\n        loading: false,\n        licenses: []\n      });\n    }\n  },\n\n  createLicense: async (projectId: number, name: string) => {\n    set({ loading: true, error: null });\n    \n    logger.info('LICENSES', 'Creating license', {\n      projectId,\n      name\n    });\n    \n    try {\n      const client = getClient();\n      const response = await client.createLicense(projectId, { name });\n      \n      logger.info('LICENSES', 'Create license API response', {\n        projectId,\n        name,\n        status: 'success',\n        responseType: typeof response,\n        hasData: !!response?.data,\n        dataStructure: response?.data ? Object.keys(response.data) : [],\n        licenseKey: response.data?.licenseKey?.substring(0, 8) + '...',\n        fullResponse: response\n      });\n      \n      // Handle response format based on API documentation\n      // Response contains { license: {...}, licenseKey: \"...\" }\n      const newLicense = response.data?.license || response.data;\n      \n      if (newLicense) {\n        logger.info('LICENSES', 'New license created', {\n          licenseName: newLicense.name,\n          licenseKey: newLicense.key?.substring(0, 8) + '...',\n          project_id: newLicense.project_id\n        });\n        \n        set(state => ({\n          licenses: [...state.licenses, newLicense],\n          loading: false\n        }));\n      }\n      \n      return newLicense;\n    } catch (error: any) {\n      logger.error('LICENSES', 'Failed to create license', {\n        projectId,\n        name,\n        errorType: error?.constructor?.name,\n        errorMessage: error?.message,\n        errorStatus: error?.status,\n        errorCode: error?.code,\n        fullError: error\n      });\n      \n      const errorMessage = error instanceof Error ? error.message : 'Failed to create license';\n      set({ \n        error: errorMessage,\n        loading: false \n      });\n      \n      throw error;\n    }\n  },\n\n  updateLicense: async (projectId: number, licenseId: string, name: string) => {\n    set({ loading: true, error: null });\n    \n    try {\n      const client = getClient();\n      const response = await client.updateLicense(projectId, licenseId, { name });\n      \n      logger.info('LICENSES', 'Updated license', {\n        projectId,\n        licenseId,\n        name\n      });\n      \n      // Handle response format based on API documentation\n      const updatedLicense = (response as any).license || response.data;\n      \n      if (updatedLicense) {\n        set(state => ({\n          licenses: state.licenses.map(license => \n            license.key === licenseId ? { ...license, name, updated_at: new Date().toISOString() } : license\n          ),\n          loading: false\n        }));\n      }\n    } catch (error) {\n      logger.error('LICENSES', 'Failed to update license', error);\n      \n      const errorMessage = error instanceof Error ? error.message : 'Failed to update license';\n      set({ \n        error: errorMessage,\n        loading: false \n      });\n      \n      throw error;\n    }\n  },\n\n  deleteLicense: async (projectId: number, licenseId: string) => {\n    set({ loading: true, error: null });\n    \n    try {\n      const client = getClient();\n      await client.deleteLicense(projectId, licenseId);\n      \n      logger.info('LICENSES', 'Deleted license', {\n        projectId,\n        licenseId\n      });\n      \n      set(state => ({\n        licenses: state.licenses.filter(license => license.key !== licenseId),\n        loading: false\n      }));\n    } catch (error) {\n      logger.error('LICENSES', 'Failed to delete license', error);\n      \n      const errorMessage = error instanceof Error ? error.message : 'Failed to delete license';\n      set({ \n        error: errorMessage,\n        loading: false \n      });\n      \n      throw error;\n    }\n  },\n\n  clearError: () => {\n    set({ error: null });\n  }\n}));","/**\n * Store Index - Central State Management\n * \n * This file exports all Zustand stores used in the application.\n * Each store manages a specific domain of the application state.\n * \n * Architecture:\n * - Uses Zustand for lightweight state management\n * - Each store is independent but can interact via imports\n * - Stores handle both state and async operations (API calls)\n * - All stores use TypeScript for type safety\n * \n * Store Overview:\n * - config: API keys, base URLs, theme settings\n * - agents: Agent/chatbot management and CRUD operations\n * - conversations: Chat session management\n * - messages: Message handling, streaming, and history\n * - ui: UI preferences and layout state\n * - analytics: Usage tracking and metrics\n * - pages: Agent knowledge base pages\n * - sources: Citation sources and references\n * - profile: User profile and limits\n * - project-settings: Agent-specific settings\n * - licenses: License key management\n * \n * For contributors:\n * - Add new stores here when creating new features\n * - Keep stores focused on a single domain\n * - Use TypeScript interfaces from @/types\n * - Handle errors gracefully in async operations\n */\n\n// Export all stores from a single entry point\nexport { useConfigStore } from './config';\nexport { useAgentStore } from './agents';\nexport { useConversationStore } from './conversations';\nexport { useMessageStore } from './messages';\nexport { useUIStore } from './ui';\nexport { useAnalyticsStore } from './analytics';\nexport { usePageStore } from './pages';\nexport { useSourceStore } from './sources';\nexport { useProfileStore } from './profile';\nexport { useProjectSettingsStore } from './project-settings';\nexport { useLicenseStore } from './licenses';\n\n/**\n * Store initialization helper\n * \n * Currently, Zustand stores auto-initialize on first access.\n * This function is provided for future use cases where\n * manual initialization might be needed (e.g., SSR, testing).\n * \n * @example\n * // In your app initialization\n * initializeStores();\n */\nexport function initializeStores() {\n  // Stores will auto-initialize when first accessed\n  // This function can be used for any additional setup if needed\n}\n\n/**\n * Store cleanup helper\n * \n * Zustand automatically handles cleanup when components unmount.\n * This function is provided for manual cleanup scenarios\n * (e.g., user logout, testing teardown).\n * \n * To implement cleanup:\n * 1. Add a reset() method to each store\n * 2. Call each store's reset() method here\n * \n * @example\n * // On user logout\n * cleanupStores();\n */\nexport function cleanupStores() {\n  // Add any cleanup logic if needed\n  // Currently, Zustand handles cleanup automatically\n}","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n// expose the modules object (__webpack_modules__)\n__webpack_require__.m = __webpack_modules__;\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.g = (function() {\n\tif (typeof globalThis === 'object') return globalThis;\n\ttry {\n\t\treturn this || new Function('return this')();\n\t} catch (e) {\n\t\tif (typeof window === 'object') return window;\n\t}\n})();","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","// no baseURI\n\n// object to store loaded and loading chunks\n// undefined = chunk not loaded, null = chunk preloaded/prefetched\n// [resolve, reject, Promise] = chunk loading, 0 = chunk loaded\nvar installedChunks = {\n\t30: 0\n};\n\n// no chunk on demand loading\n\n// no prefetching\n\n// no preloaded\n\n// no HMR\n\n// no HMR manifest\n\n__webpack_require__.O.j = (chunkId) => (installedChunks[chunkId] === 0);\n\n// install a JSONP callback for chunk loading\nvar webpackJsonpCallback = (parentChunkLoadingFunction, data) => {\n\tvar [chunkIds, moreModules, runtime] = data;\n\t// add \"moreModules\" to the modules object,\n\t// then flag all \"chunkIds\" as loaded and fire callback\n\tvar moduleId, chunkId, i = 0;\n\tif(chunkIds.some((id) => (installedChunks[id] !== 0))) {\n\t\tfor(moduleId in moreModules) {\n\t\t\tif(__webpack_require__.o(moreModules, moduleId)) {\n\t\t\t\t__webpack_require__.m[moduleId] = moreModules[moduleId];\n\t\t\t}\n\t\t}\n\t\tif(runtime) var result = runtime(__webpack_require__);\n\t}\n\tif(parentChunkLoadingFunction) parentChunkLoadingFunction(data);\n\tfor(;i < chunkIds.length; i++) {\n\t\tchunkId = chunkIds[i];\n\t\tif(__webpack_require__.o(installedChunks, chunkId) && installedChunks[chunkId]) {\n\t\t\tinstalledChunks[chunkId][0]();\n\t\t}\n\t\tinstalledChunks[chunkId] = 0;\n\t}\n\treturn __webpack_require__.O(result);\n}\n\nvar chunkLoadingGlobal = Object(typeof self !== 'undefined' ? self : this)[\"webpackChunkCustomGPTWidget\"] = Object(typeof self !== 'undefined' ? self : this)[\"webpackChunkCustomGPTWidget\"] || [];\nchunkLoadingGlobal.forEach(webpackJsonpCallback.bind(null, 0));\nchunkLoadingGlobal.push = webpackJsonpCallback.bind(null, chunkLoadingGlobal.push.bind(chunkLoadingGlobal));","// startup\n// Load entry module and return exports\n// This entry module depends on other loaded chunks and execution need to be delayed\nvar __webpack_exports__ = __webpack_require__.O(undefined, [96], () => (__webpack_require__(4276)))\n__webpack_exports__ = __webpack_require__.O(__webpack_exports__);\n"],"names":["root","factory","exports","module","define","amd","self","this","deferred","StreamHandler","constructor","config","_defineProperty","timeout","retryAttempts","retryDelay","processStream","stream","callbacks","abortController","AbortController","currentMessage","id","generateId","content","citations","isComplete","reader","getReader","decoder","TextDecoder","buffer","timeoutId","setTimeout","cancel","onError","Error","done","value","read","onComplete","decode","lines","split","pop","line","trim","processLine","error","name","clearTimeout","releaseLock","chunk","parseStreamChunk","type","onChunk","push","forEach","citation","onCitation","abort","getCurrentMessage","isStreaming","Math","random","toString","substring","Date","now","globalStreamManager","maxConcurrentStreams","Map","startStream","streamId","streams","size","has","cancelStream","handler","set","delete","get","cancelAllStreams","clear","getActiveStreams","Array","from","keys","getStreamStatus","exists","message","getActiveStreamCount","buttonVariants","cva","variants","variant","default","destructive","outline","secondary","ghost","link","sm","lg","icon","defaultVariants","Button","React","className","asChild","props","ref","_jsx","cn","displayName","CitationCard","index","isExpanded","onToggle","onClick","_jsxs","children","title","source","url","ChevronDown","AnimatePresence","motion","div","initial","height","opacity","animate","exit","transition","duration","confidence","round","style","width","href","target","rel","ExternalLink","CitationList","onCitationClick","maxVisible","expanded","setExpanded","useState","Set","showAll","setShowAll","visibleCitations","slice","hasMore","length","BookOpen","map","idx","y","delay","citationId","newExpanded","add","toggleExpanded","CodeBlock","language","copied","setCopied","async","copyToClipboard","toast","success","SyntaxHighlighter","oneDark","customStyle","margin","borderRadius","fontSize","StreamingCursor","MessageContent","ReactMarkdown","remarkPlugins","remarkGfm","components","code","match","exec","String","replace","a","MessageActions","onFeedback","feedback","setFeedback","handleFeedback","Copy","ThumbsUp","ThumbsDown","handleRegenerate","info","RotateCw","Message","isLast","isUser","role","User","Bot","status","formatTimestamp","timestamp","FileChip","file","onRemove","fileIcon","getFileIcon","scale","formatFileSize","_Fragment","progress","AlertCircle","disabled","X","FileUploadButton","onUpload","fileInputRef","useRef","multiple","accept","CONSTANTS","ACCEPTED_FILE_TYPES","join","onChange","e","files","handleClick","current","click","Paperclip","ChatInput","onSend","placeholder","maxLength","MAX_MESSAGE_LENGTH","input","setInput","setFiles","isDragOver","setIsDragOver","textareaRef","adjustTextareaHeight","useCallback","textarea","scrollHeight","maxHeight","min","handleSubmit","preventDefault","fileObjects","filter","f","focus","handleFileUpload","newFiles","uploadFiles","MAX_FILE_SIZE","isFileTypeAllowed","prev","uploadFile","simulateUpload","interval","setInterval","clearInterval","getRootProps","getInputProps","isDragActive","useDropzone","onDrop","noClick","noKeyboard","reduce","acc","maxSize","onDragEnter","onDragLeave","canSend","some","Upload","removeFile","fileId","onSubmit","onKeyDown","key","shiftKey","rows","overflowY","Square","Send","TypingIndicator","createMessageStore","sessionId","agentStore","conversationStore","MESSAGES_STORAGE_KEY","saveMessagesToStorage","conversationId","messages","stored","localStorage","getItem","cache","JSON","parse","setItem","stringify","create","streamingMessage","loading","sendMessage","isDemoMode","window","__customgpt_demo_mode","logger","currentAgent","getState","agentId","agentName","project_name","messageLength","hasFiles","conversation","ensureConversation","parseInt","session_id","hasSessionId","isNew","message_count","userMessage","toISOString","addMessage","assistantMessage","client","getClient","Promise","all","messageContent","resolve","demoResponse","updateStreamingMessage","finalMessage","sendMessageStream","prompt","response_source","debug","hasContent","contentLength","contentPreview","updateConversation","streamError","response","messageData","data","openai_response","fallbackError","loadMessages","cachedMessages","loadMessagesFromStorage","state","newMessages","existingIndex","findIndex","m","clearMessages","removeItem","cancelStreaming","getMessagesForConversation","updateMessageFeedback","messageId","convId","messageIndex","updatedMessages","reset","createConversationStore","CONVERSATIONS_STORAGE_KEY","ACTIVITY_STORAGE_KEY","saveConversationsToStorage","conversations","loadConversationsFromStorage","loadActivityFromStorage","currentConversation","lastConversationActivity","fetchConversations","projectId","loadConversations","widgetConvKey","widgetConvIds","getConversations","allConversations","isArray","widgetConversations","conv","includes","totalFromAPI","widgetSpecific","cached","cachedConversations","sessionConversations","totalCached","sessionSpecific","createConversation","sessionIdForConv","floor","newConversation","project_id","created_at","updated_at","deleted_at","undefined","existingConvIds","widgetSessionId","find","c","deleteConversation","selectConversation","activity","saveActivityToStorage","firstMessage","existingConversation","createAgentStore","AGENTS_STORAGE_KEY","SELECTED_AGENT_KEY","saveAgentsToStorage","agents","saveSelectedAgentToStorage","fetchAgents","loadAgents","widgetKey","widget","hasWidget","configuredAgentId","singleAgent","is_chat_active","is_shared","user_id","team_id","getAgent","agent","cachedAgents","loadAgentsFromStorage","getAgents","count","selectedAgentId","loadSelectedAgentFromStorage","selectedAgent","demoAgents","selectAgent","setAgents","updateAgent","updatedAgent","deleteAgent","createAgent","replicateAgent","getAgentStats","messages_sent","users_interacted","last_message_at","WidgetStoreContext","createContext","WidgetStoreProvider","storesRef","messageStore","Provider","stores","useIsInWidgetContext","useContext","useWidgetStores","context","useMessageStore","isInWidget","widgetStores","useStore","useGlobalMessageStore","useConversationStore","useGlobalConversationStore","useAgentStore","useGlobalAgentStore","AgentItem","isSelected","onSelect","onSettingsClick","Check","settings","chatbot_model","stopPropagation","Settings","AgentSelector","showSettings","isOpen","setIsOpen","dropdownRef","useEffect","handleClickOutside","event","contains","document","addEventListener","removeEventListener","handleRefresh","handleSelectAgent","RefreshCw","willOpen","CitationDetailsModal","onClose","setLoading","setError","citationData","setCitationData","imageError","setImageError","effectiveProjectId","fetchCitationDetails","getCitation","hasImage","image","err","errorMessage","Loader","src","alt","Globe","description","ImageIcon","ConversationManager","maxConversations","currentConversationId","onConversationChange","onCreateConversation","refreshKey","setConversations","editingId","setEditingId","editTitle","setEditTitle","setIsExpanded","parsed","handleEditSave","updated","MessageCircle","fill","stroke","viewBox","strokeLinecap","strokeLinejoin","strokeWidth","d","handleCreateConversation","Plus","autoFocus","handleSelectConversation","createdAt","toLocaleDateString","handleEditStart","Edit2","filtered","handleDelete","Trash2","WidgetContext","WidgetProvider","widgetInstance","EXAMPLE_PROMPTS","ExamplePromptCard","WelcomeMessage","onPromptClick","Sparkles","MessageArea","scrollRef","selectedCitationId","setSelectedCitationId","citationModalOpen","setCitationModalOpen","conversationMessages","scrollTo","top","behavior","handleCitationClick","citationIndex","citationTitle","fillRule","clipRule","handleMessageFeedback","ChatHeader","mode","onAgentSettings","enableConversationManagement","conversationRefreshKey","ChatContainer","threadId","onMessage","setCurrentConversationId","agentCount","hasCurrentAgent","currentAgentName","initializeAgents","switchConversation","newConv","configuration","fileCount","isAuthError","ConversationItem","onDelete","onRename","isEditing","setIsEditing","editName","setEditName","showMenu","setShowMenu","inputRef","menuRef","select","handleSaveEdit","onBlur","Calendar","MoreHorizontal","Edit3","ConversationSidebar","isCollapsed","searchQuery","setSearchQuery","isCreating","setIsCreating","isActive","warn","filteredConversations","toLowerCase","conversationName","messageCount","errorType","handleRenameConversation","newName","MessageSquare","Search","Link","BarChart3","FileText","Database","Bug","handleDeleteConversation","_","i","ChatLayout","showSidebar","sidebarCollapsed","setSidebarCollapsed","storeCurrentConversation","handleToggleSidebar","CustomGPTWidget","apiKey","theme","position","enableCitations","enableFeedback","isolateConversations","modePrefix","containerId","uniqueId","performance","substr","generateSessionId","instanceKey","__customgpt_widget_instance","init","useConfigStore","setApiKey","__customgpt_sessions","__customgpt_session","startsWith","fallbackAgent","agentsResponse","createContainer","render","require","currentConv","fullConversation","setState","__customgpt_widget_instances","__customgpt_active_widget_session","container","getElementById","createElement","setupFloatingStyles","body","appendChild","Object","assign","zIndex","boxShadow","overflow","backgroundColor","classList","bottom","right","left","display","transform","createRoot","WidgetApp","currentConvId","handleClose","close","Toaster","toastOptions","open","storeConversations","unshift","saveConversations","updateConversationTitle","newTitle","DOMException","cleanupOldConversations","recent","onOpen","toggle","destroy","unmount","parentNode","removeChild","updateConfig","newConfig","refresh","isOpened","CustomGPTWidgetAPI","CustomGPTAPIClient","baseURL","hasApiKey","apiKeyPreview","request","endpoint","options","params","fetchOptions","URL","entries","searchParams","append","headers","FormData","requestOptions","apiRequest","method","retryWithBackoff","requestId","generateRequestId","abortControllers","fetch","signal","ok","errorText","text","errorCode","errorData","enhancedMessage","getEnhancedErrorMessage","apiError","originalMessage","fromEntries","APIError","json","apiResponse","dataPreview","streamRequest","streamOptions","hasBody","bodyContent","contentType","isEventStream","hasReceivedData","fullLine","lineLength","hasCitations","originalLine","cancelRequest","controller","cancelAllRequests","formData","sitemap_path","are_licenses_allowed","getAgentSettings","updateAgentSettings","isFormData","enhancedParams","userFilter","getMessages","lang","payload","custom_persona","hasCustomPersona","responseSource","streamParam","getMessageById","promptId","sendMessageOpenAIFormat","is_inline_citation","getConversationAnalytics","queryParams","URLSearchParams","start_date","end_date","limit","getQueryAnalytics","getTrafficAnalytics","period","getStatistics","getTrafficReport","getQueriesReport","getConversationsReport","getAnalysisReport","getPages","page","order","crawl_status","index_status","deletePage","pageId","reindexPage","getPageMetadata","updatePageMetadata","metadata","previewFile","getLicenses","createLicense","getLicense","licenseId","updateLicense","deleteLicense","getSources","createSitemapSource","uploadFileSource","updateSourceSettings","sourceId","deleteSource","instantSyncSource","getUserLimits","getUserProfile","updateUserProfile","post","put","details","super","defaultClient","initializeClient","isClientInitialized","Logger","isClient","getInstance","instance","formatMessage","entry","level","category","stack","formatted","toUpperCase","writeToFile","log","logs","sendToServer","getLogs","clearLogs","authCheck","authError","navigation","route","storeAction","store","action","inputs","twMerge","clsx","bytes","parseFloat","pow","toFixed","fileType","allowedTypes","date","diffInMs","getTime","diffInMinutes","diffInHours","diffInDays","navigator","clipboard","writeText","delta","choices","jsonError","parseError","ms","fn","maxAttempts","baseDelay","lastError","attempt","delayTime","generateConversationName","API_TIMEOUT","STREAM_TIMEOUT","RETRY_ATTEMPTS","RETRY_DELAY","persist","newAgent","filteredAgents","partialize","setBaseURL","setTheme","documentElement","onRehydrateStorage","responseType","hasData","dataLength","messagesCount","updatedConversations","updatedConversation","projectConversations","getSessionId","__customgpt_current_session","sessions","sessionIds","sessionStorage","setupError","updatedMessage","availableConversations","messageTypes","formattedMessages","msg","baseTimestamp","user_query","response_feedback","reaction","formattedCount","useUIStore","sidebarOpen","settingsOpen","setSidebarOpen","setSettingsOpen","setFontSize","remove","formatDate","getDefaultDateRange","endDate","startDate","setDate","getDate","useAnalyticsStore","analytics","dateRange","fetchAnalytics","queries","traffic","statistics","reports","analyticsData","total","active","trend","timeline","successful","failed","avgResponseTime","avg_response_time","topQueries","top_queries","uniqueUsers","unique_users","pageViews","page_views","avgSessionDuration","avg_session_duration","bounceRate","bounce_rate","totalMessages","total_messages","totalConversations","total_conversations","avgMessagesPerConversation","avg_messages_per_conversation","satisfactionRate","satisfaction_rate","responseAccuracy","response_accuracy","setDateRange","exportAnalytics","format","jsonData","blob","Blob","createObjectURL","download","revokeObjectURL","usePageStore","pages","paginationInfo","current_page","per_page","last_page","fetchPages","setQueryParams","useSourceStore","sources","currentSource","sortBy","sortOrder","syncStatus","syncing","fetchSources","fetchSource","uploadSources","uploadPromises","reject","updateSource","updates","bulkDelete","sourceIds","syncSources","query","setFilter","selectSource","useProfileStore","profile","fetchProfile","updateProfile","profilePhoto","activeRequests","useProjectSettingsStore","settingsLoading","settingsError","plugins","pluginsLoading","pluginsError","stats","statsLoading","statsError","fetchSettings","requestKey","updateSettings","settingsUpdate","question","File","newSettings","fetchPlugins","updatePlugin","pluginId","enabled","plugin","fetchStats","useLicenseStore","licenses","fetchLicenses","dataType","fullResponse","l","errorStatus","fullError","dataStructure","licenseKey","newLicense","license","licenseName","clearError","initializeStores","cleanupStores","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","__webpack_modules__","call","O","result","chunkIds","priority","notFulfilled","Infinity","fulfilled","j","every","splice","r","n","getter","__esModule","definition","o","defineProperty","enumerable","g","globalThis","Function","obj","prop","prototype","hasOwnProperty","Symbol","toStringTag","installedChunks","chunkId","webpackJsonpCallback","parentChunkLoadingFunction","moreModules","runtime","chunkLoadingGlobal","bind","__webpack_exports__"],"sourceRoot":""}